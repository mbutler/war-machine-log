// @bun
var $h=60000;function gu(u,A){if(!u)return A;let h=Number(u);if(Number.isNaN(h)||h<=0)return A;return h}function Ih(){let u=gu(process.env.SIM_TIME_SCALE,1),A=Math.max(10,Math.floor($h/u)),h=10,H=6,b=24,i=process.env.SIM_START_WORLD_TIME&&!Number.isNaN(Date.parse(process.env.SIM_START_WORLD_TIME))?new Date(process.env.SIM_START_WORLD_TIME):new Date,G=process.env.SIM_BATCH_DAYS,M=G?gu(G,0):null;return{timeScale:u,msPerWorldMinute:A,turnMinutes:10,hourTurns:6,dayHours:24,logDir:process.env.SIM_LOG_DIR??"logs",seed:process.env.SIM_SEED??"default-seed",startWorldTime:i,catchUp:process.env.SIM_CATCH_UP!=="false",catchUpSpeed:gu(process.env.SIM_CATCH_UP_SPEED,10),batchDays:M}}var U=Ih();class eu{handlers=new Map;subscribe(u,A){let h=this.handlers.get(u)??new Set;return h.add(A),this.handlers.set(u,h),()=>{this.handlers.get(u)?.delete(A)}}publish(u){let A=this.handlers.get(u.kind);if(!A)return;for(let h of A)try{let H=h(u);if(H instanceof Promise)H.catch((b)=>console.error(`Async error in event handler for ${u.kind}:`,b))}catch(H){console.error(`Error in event handler for ${u.kind}:`,H)}}}import nu from"fs/promises";import bi from"path";class ou{dir;constructor(u){this.dir=u}async ensureDir(){await nu.mkdir(this.dir,{recursive:!0})}async log(u){await this.ensureDir();let A=this.formatText(u)+`
`,h=JSON.stringify(this.formatJson(u))+`
`;await Promise.all([nu.appendFile(bi.join(this.dir,"events.log"),A,"utf8"),nu.appendFile(bi.join(this.dir,"events.jsonl"),h,"utf8")]),process.stdout.write(A)}formatText(u){let A=u.worldTime.toISOString(),h=u.location?` @ ${u.location}`:"",H=u.actors?.length?` [${u.actors.join(", ")}]`:"",b=u.details?` \u2014 ${u.details}`:"";return`${A} [${u.category}]${h}${H} ${u.summary}${b}`}formatJson(u){return{...u,worldTime:u.worldTime.toISOString(),realTime:u.realTime.toISOString()}}}function xh(u){let A=1779033703^u.length;for(let h=0;h<u.length;h+=1)A=Math.imul(A^u.charCodeAt(h),3432918353),A=A<<13|A>>>19;return A>>>0||1}function qh(u){let A=u>>>0;return()=>{A|=0,A=A+1831565813|0;let h=Math.imul(A^A>>>15,1|A);return h=h+Math.imul(h^h>>>7,61|h)^h,((h^h>>>14)>>>0)/4294967296}}function t(u){let A=qh(xh(u));return{next:A,int(h){if(h<=1)return 0;return Math.floor(A()*h)},pick(h){if(!h.length)throw new Error("Attempted to pick from an empty list.");return h[this.int(h.length)]},chance(h){if(h<=0)return!1;if(h>=1)return!0;return A()<h},shuffle(h){let H=[...h];for(let b=H.length-1;b>0;b--){let i=this.int(b+1);[H[b],H[i]]=[H[i],H[b]]}return H}}}class ru{bus;config;world;interval;turnIndex=0;turnIntervalMs;startRealTime;startWorldTime;constructor(u,A,h){this.bus=u;this.config=A;this.world=h;this.turnIntervalMs=this.config.msPerWorldMinute*this.config.turnMinutes,this.startWorldTime=h.lastTickAt?new Date(h.lastTickAt):new Date(A.startWorldTime);let H=h.lastRealTickAt;this.startRealTime=H?new Date(H):new Date(h.startedAt);let b=this.startWorldTime.getTime()-A.startWorldTime.getTime(),i=A.turnMinutes*60*1000,G=h.lastRealTickAt;if((G?Date.now()-new Date(G).getTime():1/0)<60000)this.turnIndex=0;else this.turnIndex=Math.floor(b/i)}start(){if(this.interval)return;this.interval=setInterval(()=>this.emitTurn(),this.turnIntervalMs)}stop(){if(!this.interval)return;clearInterval(this.interval),this.interval=void 0}emitTurn(){this.turnIndex+=1;let A=new Date().getTime()-this.startRealTime.getTime(),H={kind:"turn",worldTime:new Date(this.startWorldTime.getTime()+A),turnIndex:this.turnIndex};if(this.bus.publish(H),this.turnIndex%this.config.hourTurns===0)this.bus.publish({...H,kind:"hour"});if(this.turnIndex%(this.config.hourTurns*this.config.dayHours)===0)this.bus.publish({...H,kind:"day"})}}var tu=["Aafte","Aal\xE8s","Aal\xE8z","Aalfte","Aalina","Aaline","Aalis","Aaliz","Aaltje","Aanor","Ababilia","Abarne","Abauntza","Abbatissa","Abbelina","Abelie","Abelota","Abte","Acelina","Achaia","Achethe","Achradina","Acta\xEBe","Act\xEB","Ada","Adala","Adalberta","Adaleide","Adalheid","Adalheidis","Adalind","Adalindis","Adaliz","Adallinda","Adallindis","Adalmut","Adalrada","Adaltrude","Adaltrutis","Adaluuidis","Adalwara","Adalwif","Adda","Addela","Ade","Adeia","Adela","Adelaide","Adelaidis","Adelais","Adeldreda","Adelena","Adelheid","Adelheidis","Adelicia","Adelid","Adelie","Adelin","Adelina","Adeline","Adelisa","Adeliz","Adeliza","Adeltrudis","Adelysia","Adeodata","Adere","Ad\xE8te","Adhela","Adhelina","Adila","Admiranda","Adonie","Adula","Aduna","Adwala","Aebbe","Aedelflete","Aeditha","Aediva","Aedon","Aegiolea","Aegle","Aeileua","Aeilgyuu","Aeldid","Aeldiet","Aeldit","Aeleis","Aelesia","Aelffled","Aelfgiuee","Aelfgiva","Aelfgyd","Aelfled","Aelfleda","Aelfryth","Aelgytha","Aelienor","Aelina","Aelis","Aelisia","Aelive","Aelizia","Aelueua","Aenor","Aerope","Aes","Aeschine","Aetheldreda","Aethelfleada","Aethelind","Aethelinda","Aethelthryth","Aetheria","Aethre","Agace","Agacia","Agacie","Agamede","Aganippe","Agape","Agapia","Agarista","Agas","Agase","Agate","Agatha","Agath\xE9","Agathonice","Agave","Agentrudis","Aggie","Agglethrudis","Aginaga","Agirre","Aglaia","Aglaurus","Agnella","Agnesot","Agneta","Agnetis","Agnus","Agote","Agurne","Agurtzane","Ahelis","Ahelissa","Aiago","Aiala","Aicelina","Aicusa","Aiglante","Aiglente","Aiglentine","Aikaterine","Ailda","Aildreda","Ailed","Aileth","Aileua","Aileve","Ailfled","Ailhiet","Ailid","Ailiet","Ailith","Ailitha","Ailiue","Ailiva","Ailleda","Ailleth","Ailletha","Ailliva","Ailova","Ailufa","Aimie","Ainara","Ainhoa","Ainize","Ainoa","Aintza","Aintzane","Aintzile","Aintzine","Ainuesa","Aiora","Aisone","Aithra","Aitziber","Aizeti","Aizkorri","Aizpea","Aka","Akelda","Akenehi","Aketa","Akorda","Ala","Alaine","Alainne","Alais","Alaitz","Alaza\xEFs","Alazne","Alba","Albelenda","Alberad","Alberadis","Albie","Albizua","Albrad","Albrade","Albray","Albreda","Albree","Albruga","Alburch","Alburg","Alcandre","Alcestis","Alcippe","Alcmene","Alcyone","Alda","Alded","Aldet","Aldeth","Aldgid","Aldguda","Aldgudana","Aldgyth","Aldid","Aldiet","Aldieth","Aldietha","Aldis","Aldith","Alditha","Aldiva","Aldiytha","Aldruth","Alduara","Alduenza","Aldus","Aldusa","Alduse","Aldyet","Aldyt","Aleidis","Aleire","Alemene","Aleneite","Alesandese","Alesia","Alesone","Alesta","Aleusa","Alexandra","Alexandria","Alfgarda","Alfild","Alfled","Alfleda","Alflent","Alflet","Alfleta","Alfreda","Algaia","Algyva","Alhflaed","Alhflead","Alia","Alianor","Alianora","Alice","Alicen","Alicia","Alid","Alienor","Alienora","Alina","Aline","Alis","Alisaundre","Alisceon","Alise","Alison","Alisone","Alisoun","Aliss","Alissende","Alith","Aliua","Aliva","Aliz","Alize","Alkain","Alkmena","Allemande","Allie","Allison","Alma","Almika","Almt","Almuth","Almuza","Aloa","Alodia","Alot","Alote","Alpaida","Alpais","Alse","Alsneta","Alson","Althaea","Althaia","Althea","Altzagarate","Alueua","Alueue","Aluina","Aluinnia","Aluiua","Alverat","Alvered","Alveua","Alveva","Alviua","Alviva","Alycie","Alyna","Alyon","Alys","Alyson","Alysone","Alyva","Ama","Amabil","Amabili","Amabilia","Amabilis","Amabilla","Amabillia","Amable","Amaduena","Amagoia","Amaia","Amalasuintha","Amalberga","Amalberta","Amalbirga","Amalfrida","Amalfriede","Amalgunde","Amalone","Amalur","Amane","Amarhyllis","Amata","Amathea","Amatheia","Amatza","Ambra","Amee","Ameis","Amelia","Amelina","Ameline","Amelinne","Amellia","Amelot","Amelyn","Ameria","Amestrin","Amestris","Amets","Ametza","Amfelice","Amfelisia","Amflis","Amflisa","Amflisia","Amia","Amiable","Amic","Amica","Amicabilis","Amicia","Amicie","Amie","Amilamia","Amilia","Amiot","Amira","Amis","Amiscia","Amisia","Amke","Ammij","Ammio","Ammy","Amoltrud","Amparo","Amphelice","Amphelicia","Amphillis","Amphithoe","Amphitrite","Ampinomene","Amplias","Amulberga","Amuna","Amya","Amycia","Amye","Amyfelyse","Anabel","Anabell","Anabella","Anabill","Anabilla","Anabille","Anabul","Anachorita","Anaeaxi","Anaiansi","Anais","Anastas","Anastase","Anastasia","Anastatia","Anaurra","Anchoret","Anchoretta","Ancret","Ancreta","Ancrett","Ande","Anderazu","Andere","Anderexo","Anderkina","Andia","Andikona","Andion","Andolie","Andone","Andonine","Andre","Andrea","Andregoto","Andrekina","Andremisa","Andreva","Andrezuria","Andrie","Andromeda","Ane","An\xE8s","Anese","Anesot","Anestasia","Anfelisa","Anfelise","Angaret","Angel","Angela","Angelet","Angelu","Angnes","Angnet","Anis","Aniz","Ankerita","Ankharet","Anna","Annabele","Annabell","Annabella","Annabelle","Annable","Annais","Annaple","Annas","Anne","Anneis","Annes","Annestas","Anneyce","Anneys","Anneyse","Annice","Annina","Annis","Annise","Annke","Annor","Annora","Annot","Annys","Anora","Anoz","Ansa","Anselda","Ansere","Ansgard","Ansitruda","Anstes","Anstey","Anstice","Anstis","Anstiss","Anstruda","Antehe","Anteia","Antheia","Anthoinette","Anthousa","Anthusa","Anticleia","Antigone","Antiochis","Antiope","Antipatra","Antje","Antonia","Antxone","Antziasko","Anunciacion","Anyes","Anysia","Anzoy","Apain","Apala","Apeline","Aplin","Apoline","Appa","Applin","Appolina","Appollonia","Apseudes","Araba","Arabella","Arabia","Arable","Aragundia","Araitz","Arama","Arana","Arandon","Arantxa","Arantza","Arantzazu","Ar\xE1nzazu","Araoz","Arbeiza","Arbekoa","Arbell","Arbella","Arburua","Areagne","Areitio","Areria","Arete","Arethusa","Argeia","Argentea","Argentina","Argi","Argie","Argiloain","Ariadne","Arianna","Arie","Arima","Arisbe","Aristonike","Aristophane","Ariturri","Aritzaga","Aritzeta","Arkija","Arlas","Arlette","Arluzea","Armedaa","Armentaria","Armigil","Armola","Arnaude","Arnotegi","Aroha","Arraitz","Arrako","Arrate","Arrazubi","Arrene","Arreo","Arriaka","Arrieta","Arrigorria","Arriluzea","Arritokieta","Arrixaka","Arrizabalaga","Arrosa","Arsinoe","Artaynta","Artazostra","Artea","Artederreta","Artemidora","Artemisia","Artiga","Artiza","Artizar","Artystone","Artzanegi","Artzeina","Asa","Ascelina","Asceline","Ascelinne","Ascelot","Aschilt","Ascilia","Ashena","Asiturri","Askoa","Aspasia","Asselyna","Assuncion","Astera","Astrid","Astyoche","Astyocheia","Atalanta","Atallo","At\xEB","Athala","Athanasia","Athela","Athelesia","Atheleys","Athelflead","Athelina","Athelinda","Athelis","Athelisa","Athelisia","Athelyna","Athis","Atilda","Atossa","Atotz","Atsegie","Atxarte","Aua","Auacyn","Auber\xE9e","Aubirge","Aubourc","Aubreda","Aubrey","Aude","Audiarda","Audofleda","Audrey","Audry","Audrye","Auekin","Auelin","Auelina","Auelyna","Auge","Augo","Augustina","Auic","Auice","Auicia","Auin","Auina","Auisia","Auizia","Aunflis","Aunphelice","Aurela","Aurelia","Aureliana","Aurelne","Auria","Auriana","Aurildis","Auriol","Auriola","Aurkene","Austie","Austorga","Austrechildis","Autonoe","Auxesia","Ava","Avacyn","Aveis","Avekin","Avelina","Aveline","Avelot","Avelyn","Averell","Averil","Averill","Aveza","Avice","Avicia","Avila","Avilina","Avin","Avina","Avis","Avoca","Avril","Awdrie","Awhina","Axiothea","Axpe","Ayala","Aye","Ayla","Ayled","Ayleth","Aylett","Ayliua","Aylofa","Aylufa","Aylyetta","Ayzebel","Azella","Azitain","Baano","Bab","Babbe","Babcock","Babel","Babesne","Babeth","Babetta","Babitt","Bable","Babs","Badelota","Badia","Baiakua","Bakarne","Bakene","Baldechildis","Balere","Baltelda","Balthechildis","Balthildis","Bar","Barazorda","Barbara","Barbary","Barbata","Barbe","Barber","Barberella","Barberry","Barbery","Barbeta","Barbetta","Barbie","Barbot","Barbota","Barria","Barrika","Barsine","Bartholomette","Bartje","Basaba","Basagaitz","Basalgo","Basandre","Basiane","Basilea","Basilia","Basilie","Basilina","Basill","Basilla","Basille","Basina","Bassilly","Baucis","Baudegundis","Baufte","Bauin","Bauke","Bausanne","Bauteut","Bava","Bavacin","Bavin","Bea","Beat","Beatasis","Beaten","Beatrice","Beatricia","Beatricie","Beatricis","Beatrix","B\xE9atriz","Beattie","Beatty","Beautrice","Bechte","Becke","Becok","Bedaio","Bedeluue","Bee","Begga","Begoa","Begona","Belanda","Belaskita","Belate","Belegardis","Bellisente","Beloke","Beltzane","Bena","Bencelina","Benet","Bengoa","Bengoara","Bengolarrea","Benigna","Bennitt","Benoite","Beraza","Berberana","Berehta","Berenda","Berenga","Berengaria","B\xE9reng\xE8re","Berenike","Berezi","Bergard","Bergundis","Berhta","Beriungis","Berna","Bernadette","Bernewief","Bernewif","Berta","Bertaida","Berte","Bertha","Berthildis","Berthlenda","Bertildis","Bertliana","Bertrada","Bertruda","Bertswinda","Berzijana","Bete","Betiko","Betisa","Betje","Betlindis","Beton","Betrice","Betrys","Betryse","Betteresse","Bettin","Bettina","Bettrice","Bettris","Bettrys","Betune","Bianca","Bibie","Bidane","Biddy","Biedeluue","Bi\xE9tris","Bi\xE9trix","Bi\xE9triz","Bi\xE9tron","Bihotz","Bikarregi","Bilda","Bingene","Binhildis","Biolarra","Bioti","Bito","Bittore","Bittori","Bitxi","Bitxilore","Bixenta","Bizkaia","Bizkargi","Blanch","Blanchette","Blanchia","Blaunche","Blench","Blissot","Blitekin","Blitha","Blonde","Bobila","Boime","Boke","Boltiarda","Bonajoia","Bonassias","Bonne","Bonoque","Bore","Boukje","Bova","Boviardis","Bragwayn","Brangwayna","Brangwine","Branwyne","Braya","Brechtje","Bride","Bridget","Brigette","Brigida","Brigit","Brigitta","Brise","Briseis","Brune","Brunehaut","Brunisente","Brunissende","Bryde","Buiondo","Burgondo","Burgundefara","Burtzea","Bytzel","Byzantia","Caenis","Caesaria","Caleope","Calla","Callianeira","Callianessa","Calliphana","Calypso","Camilla","Campana","Canace","Candida","Carmel","Cassander","Cassandre","Cassandry","Casse","Castianiera","Catarine","Catel","Catelin","Cateline","Catella","Catelot","Caterina","Caterine","Catering","Catharine","Catherine","Catherne","Catin","Catlin","Caton","Catrina","Cattern","Cattle","Cecely","Cecelya","Cecelyna","Cecil","Cecili","Cecilia","Cecilie","Cecille","Cecillia","Cecy","Ceday","Celestine","Celestria","Celia","Celina","Cervella","Cesarea","Chantal","Charis","Charito","Charity","Childebertana","Chione","Chiore","Chloe","Chlo\xEB","Chloris","Chlotichhilda","Chlotsuintha","Chrisoogone","Christina","Chryse","Chryseida","Chryseis","Chrysothemis","Chuna","Chunegundis","Chydleluve","Cicely","Cicilia","Cicily","Cilia","Cilissa","Cilla","Circe","Cisse","Cissie","Cissota","Clamancia","Clara","Clarae","Claramunda","Clarcia","Clarell","Claremonde","Clariandra","Claribel","Clarice","Claricia","Claricie","Clarimond","Clariscia","Clarissa","Clarisse","Claritia","Clarrie","Clarry","Clarugge","Clemencia","Clemency","Clemenicia","Clemens","Clementia","Clementina","Clementine","Cler","Cleremunda","Clericia","Climence","Clio","Clodauuiua","Clothild","Clotrada","Clymence","Clymene","Clymere","Colecta","Coleite","Colet","Coleta","Col\xE8te","Colett","Coletta","Colina","Colleite","Collette","Colubra","Columba","Comito","Concepcion","Condors","Conegont","Conegundis","Conegunt","Consolantia","Constancia","Constantia","Constantina","Constanza","Contzel","Corinne","Corythia","Coulombe","Crapahildis","Cratais","Cresseid","Cressid","Creusa","Crisa","Criseida","Criseyde","Cristehildis","Cristemburga","Cristemia","Cristyne","Ctimene","Cunegund","Cunegundis","Cus","Cuss","Cussata","Cust","Custa","Custanc","Custance","Custancia","Custans","Custe","Custins","Cvenild","Cybele","Cycalye","Cycly","Cydippe","Cymodoce","Cymothoe","Cyneburga","Cyniburg","Cyra","Cyrene","Cyrilla","Cythereia","Cytheris","Dadin","Dagarada","Damaris","Damaspia","Dameta","Dametta","Damia","Damiane","Damisona","Dana\xEB","Danburga","Dania","Darklis","dear/beloved","Decima","Deianeira","Deineira","Deio","Deiphobe","Deipyle","Delias","Deloys","Demetria","Demophile","Demuth","Denis","Dennet","Denote","Deonisia","Deonysia","Desdemona","Desiderata","Desirata","Destasia","Dever","Dexamene","Diamanda","Diana","Dianeme","Dido","Didyma","Diene","Dilli","Dillo","Dinae","Dinah","Diomede","Dione","Dionis","Dionisia","Dionycia","Dionysia","Diot","Diota","Dirce","Dirtje","Disdemona","Distira","Doda","Dodda","Dodie","Dodo","Dolichena","Doll","Dolly","Dolore","Dolores","Doltza","Domeka","Domentzia","Dominica","Dominixe","Dominy","Domnica","Domnola","Donada","Donata","Donetzine","Doniantsu","Donianzu","Donnet","Dora","Dorate","Dorathea","Dorathia","Dorcas","Dor\xE9e","Doreen","Dorette","Doria","Doris","Dorleta","Dorothea","Dorthy","Dorythye","Dot","Dota","Dothy","Doto","Dottie","Douce","Doue","Dousabel","Dousable","Douset","Dousin","Douze","Dowsabel","Dowse","Dowzable","Drosis","Drueta","Drusilla","Drypetis","Duce","Duda","Dulanto","Dulcia","Dulcibella","Dulcie","Dulcinea","Duleia","Dunixe","Durilda","Dusa","Dussabel","Dussabele","Duszabell","Duua","Duva","Duze","Dyana","Dynamene","Dyonisia","Dyonisya","Dyot","Dyota","Ead","Eadburga","Eadgithu","Eadgyth","Eadgytha","Eadida","Eadie","Eadita","Eadu","Earthelinda","Eberhild","Ebertana","Eburhild","Eburhilt","Eda","Edan","Edborough","Edburga","Edda","Edde","Edden","Eddiva","Eddiz","Eddusa","Ede","Edeberga","Edeborg","Eded","Edekin","Edelin","Edelina","Edeline","Edelinne","Edelot","Eden","Ederne","Ederra","Edeua","Edeva","Edged","Edgida","Edgidia","Edgyth","Edgyue","Edhida","Edhiva","Edid","Edied","Ediet","Edihe","Edila","Edine","Edit","Editha","Edithe","Ediua","Ediva","Ediz","Edney","Edolina","Edon","Edonea","Edony","Edume","Edurne","Edurtzeta","Edus","Edy","Edytha","Edyva","Effam","Effemy","Effie","Effim","Effum","Eflead","Ega","Egecin","Egelina","Egeluuara","Egeria","Egesburga","Egesloga","Egiarte","Egilior","Egina","Eglantine","Eglentina","Eglentine","Eguene","Eguzki","Eguzkie","Ehgelhild","Ehgeluuara","Eider","Eidita","Eidothee","Eilaria","Eileithyia","Eileua","Eileue","Eileve","Eilieue","Eimde","Ejte","Ekhie","Ela","Elaia","Elaine","Elaisse","Elana","Elaria","Elayne","Elcmene","Eldid","Eldit","Elduara","Eleanora","Electra","Elen","Elena","Elene","Eleua","Elewisa","Elewys","Eleyn","Eleyne","Elfgifu","Elflet","Elfleta","Elfred","Elfrid","Elfrida","Elftrudis","Elgiva","Elia","Elianor","Elianora","Elicia","Elin","Elinor","Elinora","Elisabete","Elison","Elisot","Elisota","Elixabete","Elixane","Elizabeth","Elizamendi","Elizmendi","Elkano","Ella","Ellaire","Ellen","Ellene","Ellenor","Ellerete","Ellice","Ellie","Ellin","Ellot","Ellota","Ellyn","Elmerich","Eloisa","Eloise","Elorriaga","Elota","Elpir","Else","Elsebeth","Elske","Elueua","Eluiua","Eluiue","Eluned","Elurreta","Eluska","Eluyua","Elveva","Elvina","Elwisia","Elyenora","Elyne","Elysande","Elysant","Elyscia","Ema","Emayn","Emblem","Emblema","Emblen","Emblin","Emblyn","Emecin","Emelenine","Emelin","Emelina","Emeline","Emelisse","Emelnie","Emelot","Emelote","Emeloth","Emeludt","Emelye","Emelyn","Emelyne","Emengar","Emenjart","Emeny","Emeria","Emerita","Emerlee","Emersende","Emery","Emilia","Emlin","Emlyn","Emm","Emma","Emmanaia","Emme","Emmelina","Emmeline","Emmet","Emmete","Emmony","Emmot","Emmota","Emmote","Emoni","Emonie","Emony","Emota","Emulea","Emy","Emylyna","Enara","Encarnacion","Endeis","Endera","Enea","Eneka","Eneritz","Engelberga","Engelgard","Engelsuit","Engeluuara","Engelwara","Engle","Enmeline","Enna","Enota","Enyo","Eormengard","Eormengild","Eos","Epham","Epicaste","Epicelena","Epiphania","Eppie","Erchantrudis","Erchembrog","Erdaie","Erdie","Erdoitza","Erdotza","Erdoza","Ereleuva","Erelieva","Erembour","Erembourc","Eremburgis","Ereprad","Erguia","Eriboea","Erica","Eriete","Erigone","Erika","Eriopis","Eriphyle","Eris","Erisenda","Erkembrog","Erkenbrog","Erkenburoc","Erkenrad","Erkuden","Erlea","Erma","Ermandrud","Ermbourg","Ermecin","Ermegarde","Ermegardis","Ermengard","Ermengarda","Ermengarde","Ermengardis","Ermengart","Ermenjart","Ermentrudis","Ermessenda","Ermeswindis","Ermie","Ermin","Ermina","Ermingard","Erminia","Ermisenda","Ermua","Ernio","Erniobe","Erpsuid","Erramune","Erramusa","Errasti","Erregina","Erremulluri","Errictruda","Errita","Erromane","Errosali","Erroz","Errukine","Erta","Esa","Eschina","Eschiva","Esclairmonde","Esclamonde","Esclarmonde","Esdeline","Eskarne","Eskolunbe","Esozi","Esperte","Espoz","Esquiva","Essylt","Estebeni","Estibalitz","Estibaliz","Estienne","Estrangia","Estrelda","Estrilda","Estrildis","Estrill","Estrilld","Etfled","Ethel","Ethelchif","Etheldred","Etheldritha","Ethelenda","Ethelgard","Ethelgarda","Ethelia","Etorne","Etxano","Etxauarren","Eucarpia","Eudeline","Eudocia","Eudokia","Eudoxia","Eue","Euerloga","Eufamie","Eufemia","Eufemie","Eufemma","Eufemme","Eufemmia","Eufiama","Eufrata","Eugenia","Eulari","Eularia","Eunate","Eunice","Eunisia","Euodias","Eupham","Euphame","Eupheme","Euphemia","Euphrasia","Euphro","Euphrosyne","Euria","Eurildis","Eurohildis","Europa","Eurycleia","Eurydike","Eurynome","Eusa","Eusebia","Eustachia","Eustacia","Evadne","Evantia","Evelina","Evelyn","Evemy","Everelda","Evereldis","Everild","Everilda","Everildis","Everill","Evfemia","Ewfame","Extranea","Ezkurra","Ezozia","Eztegune","Fabia","Fabiana","Fabiola","Fabrisse","Fara","Farahilda","Fastrada","Fede","Feentje","Feike","Felica","Felice","Felicia","Felis","Felise","Felisia","Femmota","Fermina","Fieke","Filisia","Fillida","Fillon","Fillys","Fina","Finepopla","Flavia","Fleurie","Flo","Flora","Flore","Florence","Florencia","Florentia","Florentxi","Floria","Florie","Florina","Florion","Florymonde","Floss","Flossie","Flouerana","Flour","Flourie","Flur","Flurekin","Fluri","Focktje","Folclind","Folclinda","Folcrada","Folcuuara","Folgarda","Folsuindis","Folsuuendis","Fordola","Fortlifh","Fortunata","Fousafia","Foy","Francesca","Francesse","Francis","Franqueite","Frantsesa","Frantxa","Frantziska","Frauuara","Freadeyweed","Fredeburgis","Fredegonde","Frederada","Fredeuuara","Frediswitha","Frethegard","Frethesuinda","Frethesuindis","Fridayweed","Fridegundis","Fridesuenda","Frideswid","Fridewiga","Fridiswed","Fridiswid","Fridswed","Frisburgis","Frithelinda","Frithswith","Frouuin","Frouuina","Fruitutsu","Fryswyde","Fye","Gaatha","Gabone","Gabrielia","Gace","Gadea","Gaenor","Gailan","Gailana","Gaillarde","Gainko","Galatea","Galiene","Galienne","Ganleya","Ganor","Garaie","Garaitz","Garazi","Garbi","Garbie","Garbikunde","Garbine","Garden","Gardotza","Garoa","Garralda","Garrastazu","Garthrite","Gartrett","Gartrite","Gartrude","Gartzene","Gatty","Gatzarieta","Gaude","Gaunlaya","Gaunliena","Gauzia","Gaxi","Gaxuxa","Gaynore","Gazelu","Gazeta","Gaztain","Geaxi","Gebke","Geelte","Geerta","Geertje","Geertke","Geila","Gelduuara","Gele","Gelen","Gelleia","Gemma","Geneva","Genevieve","Genofeva","Gentile","Gentzane","Georgia","Geraxane","Gerbaga","Gerberga","Gerburg","Geredrudis","Geretrudis","Gerharde","Gerhild","Gerlent","Gerlinda","Germainne","Germana","Geroa","Gersenda","Gersendis","Gersuenda","Gersuinda","Gersvinda","Gert","Gertie","Gertje","Gertrud","Gertruda","Gertrudis","Gerty","Geruuara","Gesa","Geske","Gethrude","Geua","Geue","Geuecok","Geva","Gileite","Gil\xE8te","Gilia","Giliana","Giliane","Gill","Gille","Gilleis","Gilleite","Gillian","Gillie","Gillot","Gillota","Gilly","Ginnade","Giona","Gipuzkoa","Giraude","Gisela","Gisella","Giselle","Gisellee","Gisila","Gisla","Gismon","Giso","Gixane","Gladuse","Glauce","Glismoda","Glismodis","Glyke","Godalinda","Godeca","Godecin","Godefe","Godelda","Godeleve","Godelif","Godelinda","Godeliva","Godelive","Godeue","Godeva","Godgeua","Godgiua","Godgiva","Godid","Godildis","Godise","Godit","Goditha","Godiuia","Godleue","Godleva","Goduia","Godusa","Goduse","Goduuara","Godyf","Goiatz","Goikiria","Goikoana","Goiuria","Goizane","Goizargi","Goldeheve","Goldgeofu","Goldgeve","Goldhuie","Goldyeua","Goldyeue","Goldyva","Goldyve","Golla","Gonilda","Gonnild","Gonnilda","Gonnora","Gonora","Gonore","Goodeth","Goodeve","Goodife","Gorane","Goratze","Gordia","Gordiana","Gorgo","Gorostitza","Gorria","Gorritiz","Gorriza","Gothuuera","Goto","Gotzone","Gozo","Grace","Gracia","Gracye","Graeca","Gratianne","Graxi","Grazide","Grece","Grecia","Grecie","Grede","Gredechin","Gregoria","Gresilda","Greta","Grete","Gretje","Gricia","Grietje","Grimuuara","Grisegond","Grisel","Griseldis","Grishild","Grisigion","Grisogonia","Grissall","Grissecon","Grissel","Grissell","Grizel","Grizzel","Guanor","Guda","Gude","Gudeliva","Gudula","Gudule","Gudytha","Gueanor","Guener","Guenevere","Guiborc","Guibourc","Guillemete","Guillemette","Guillote","Guiote","Gumhild","Gundesvinda","Gundichild","Gundiperga","Gundrada","Gundrea","Gunel","Gunild","Gunilda","Gunne","Gunnell","Gunneuare","Gunnild","Gunnilda","Gunnilde","Gunnildes","Gunnilla","Gunnilt","Gunnora","Gunnore","Gunnota","Gunnote","Gunora","Gunwar","Gunware","Guodhelda","Guodlia","Gure","Gurutze","Gurutzeta","Guruzne","Gwenhevare","Gwenore","Gyel","Gygaea","Gylle","Gyly","Gynuara","Gyszel","Hadaken","Hadewidis","Hadwis","Hadwisa","Hadwise","Haidee","Haize","Halie","Hana","Hanneli","Hanni","Haouys","Haoys","Harbona","Harmke","Harmodias","Harmonia","Harriet","Harsent","Harwara","Haueis","Haurramari","Haute","Havisa","Hawis","Hawisa","Hawise","Hawisia","Hawys","Hawyse","Hazeca","Hecuba","Hedewigis","Hedheue","Hegazti","Hegelina","Heidi","Heidindrudis","Heilewif","Heilewis","Heilewisa","Heilswinda","Hekabe","Hekaline","Hekate","Helchen","Heldeburga","Hele","Heleanor","Helena","Helene","Heletradana","Heleuuidis","Helevisa","Helewidis","Helewis","Helewisa","Helewise","Helewys","Helewyse","Heleyne","Helga","Helice","Helike","Helinda","Heliodora","Helis","Helisende","Helisent","Helissent","Helissente","Hellanike","Helle","Helmech","Helmet","Helmeth","Heloise","Helouys","Heloys","Heloyson","Heltrada","Helueua","Helvynya","Helysoune","Helyssent","Hema","Hemin","Hemke","Hengelsenda","Heni","Herden","Herdin","Herena","Herenborg","Herenfrida","Herleva","Herleve","Herlinda","Herlindis","Hermana","Hermelinda","Hermengarda","Hermengart","Hermenjart","Hermesent","Hermessent","Hermine","Hermineite","Hermione","Herophile","Hersent","Hesione","Hesse","Hesychia","Hette","Hextilda","Hiart","Hida","Hiemke","Hientje","Hilaera","Hilargi","Hildberta","Hildborg","Hildcardis","Hilde","Hildeberga","Hildeburg","Hildeburgis","Hildegard","Hildegarde","Hildegardis","Hildegund","Hildelana","Hildemunda","Hildeswindis","Hildeth","Hildeuuara","Hildeuuif","Hildewara","Hildewif","Hildeyerd","Hildiard","Hilditha","Hildithe","Hildrada","Hildwara","Hildyard","Hiliard","Hilith","Hilka","Hilke","Hillaria","Hillda","Hille","Hiltrude","Hinauri","Hine","Hinemoa","Hinte","Hippodameia","Hippodamia","Hippolyta","Hira","Hirmenlind","Hismena","Hodiern","Hodierna","Hodierne","Hoki","Honnor","Honor","Honorata","Honor\xE9e","Honor\xE8te","Honoria","Honors","Horenga","Hostaruuara","Houd\xE9e","Hruodgarda","Hruotberta","Hua","Hugolinae","Hugone","Huguete","Huguette","Hunila","Hursell","Hutaosa","Hylda","Hylde","Hyldeiard","Hyolent","Hypsipyle","Hyrmina","Hysode","Hyssmaye","Iaera","Iaione","Ianeira","Ianessa","Ianthe","Ianuaria","Ibabe","Ibane","Ibernalo","Ibone","Ida","Idasgarda","Ide","Idemay","Ideny","Ideslef","Idesuuif","Ideswif","Idisiardis","Idoia","Idoibaltzaga","Idone","Idonia","Idony","Idurre","Iera","Igaratza","Igone","Igotz","Ihintza","Ikerne","Ikomar","Ikuska","Ilaria","Ilazkie","Ilene","Ilia","Iligardia","Illaria","Iloz","Imagantia","Imaigne","Imania","Imanie","Imayn","Imayne","Imblen","Imedia","Imelda","Imeyna","Imicina","Imma","Imme","Immine","Imte","Imyne","Infe","Ingaret","Ingaretta","Ingela","Ingelswindis","Ingeltrude","Ingeltrudis","Ingeluuara","Ingelwara","Ingerith","Ingrede","Inmaculada","Ino","Ioar","Iodberta","Iola","Iolanthe","Iole","Iolitha","Iomene","Ione","Ionna","Ionnia","Ionnina","Iphianassa","Iphigenia","Iphimedeia","Iphis","Iphitheme","Ipuza","Iragarte","Iraia","Irakusne","Irantzu","Irati","Iratxe","Irene","Iriberri","Iride","Irihapeti","Iris","Iristain","Iriuela","Irmele","Irmengard","Irmenhild","Irmenlind","Irua","Irune","Iruri","Irutxeta","Isa","Isadora","Isamaya","Isard","Isasi","Isata","Isaut","Isburch","Iseldis","Iselota","Isemay","Isemeine","Iseuda","Iseult","Iseut","Ismanna","Ismeina","Ismena","Ismene","Ismenia","Ismey","Isold","Isolde","Isolt","Isot","Isota","Isott","Isotta","Isouda","Issa","Issat","Isurieta","Isylte","Italia","Italica","Itoiz","Itsasne","Itsaso","Iturrieta","Iturrisantu","Itxaro","Itxaso","Itzal","Itzia","Itziar","Iuetta","Iuette","Iuliana","Iuotte","Iurre","Iustina","Ivetta","Ivette","Ixone","Izaga","Izar","Izaro","Izaskun","Izazkun","Izett","Izorne","Izot","Jacotte","Jaione","Jantje","Jasone","Jauregi","Jehanne","Jeike","Jeliana","Jellfte","Jelyan","Jenefer","Jeneuer","Jenningtje","Jeromia","Jervaise","Jesmaine","Jesmond","Jessamine","Jessimond","Jesusa","Jezebel","Jilfte","Jill","Jismond","Jivete","Joana","Joanna","Jocasta","Jocea","Jocey","Jocosa","Jodoca","Johi","Joia","Joie","Joiha","Jokie","Joleicia","Jolenta","Jolicia","Jone","Jordan","Josebe","Josephine","Josiane","Josina","Josse","Jossy","Josune","Jourdenete","Joveta","Joxepa","Joya","Joye","Joyeuse","Joyse","Judda","Juelina","Juet","Juete","Juetta","Jugatx","Juheta","Juhota","Juicea","Juicia","Julene","Julian","Juliana","Juliane","Julie","Julienne","Juliet","Juliote","Julitta","Julyan","June","Jurdana","Jurre","Justina","Juwete","Juye","Kaithren","Kalare","Kallisto","Kallixeina","Kalotte","Karin","Karine","Karitate","Karmele","Kassandra","Kat","Katalin","Katana","Kate","Katelin","Katelina","Kateline","Katerin","Katerina","Katerine","Katering","Kateryn","Kateryna","Kateryne","Katharina","Katharine","Katherin","Katherine","Katherne","Katheryn","Katheryne","Kathren","Kathrine","Katina","Katixa","Katja","Katrina","Katrine","Katring","Katryne","Kattalin","Katte","Kea","Keina","Kemma","Kephissa","Kharmion","Khl\xF6e","Khloris","Kiena","Kiles","Kima","Kimbery","Kinborough","Kinburga","Kineburga","Kinna","Kistie","Kitt","Kitty","Kizkitza","Kizzy","Kleio","Kleopatra","Klymene","Klytemnestra","Knellste","Kodes","Koldobike","Kontxesi","Kontzeziona","Kordel","Kordula","Kor\xE9","Koritto","Koru","Krabelin","Kriemhild","Kungund","Kuni","Kupe","Kupie","Kydilla","Kymme","Kyneburg","Kynna","Kynthia","Kypris","Kyra","Kytte","Labda","Labinia","Ladina","Laetitia","Lagliua","Laguia","Laguntzane","Laida","Lais","Lalage","Lall","Lally","Lamia","Lamiaran","Lamindao","Lamke","Lampetie","Lampito","Landa","Landburuga","Landerra","Landgarda","Landrada","Langhuie","Langiva","Langlaua","Langlif","Lanike","Lanthildis","Lantuuara","Laodameia","Laodamia","Laodice","Laothoe","Larraintzar","Larraitz","Larrara","Larrauri","Larraza","Lasagain","Lasarte","Lasthena","Latona","Latsari","Latxe","Laua","Laura","Laurana","Laurente","Laurentia","Laureola","Lauretia","Lauretta","Lavena","Lavin","Lavina","Lebdrudis","Lece","Lecelin","Lecelina","Lecenta","Lecia","Lecie","Leda","Leddinga","Lede","Lefchild","Leffeda","Leffquen","Lefled","Lefleda","Lefquen","Lefquena","Lefquene","Lefquenn","Lefqwen","Lefwen","Lefwenna","Legarda","Legarra","Legendika","Legundia","Leioar","Leire","Leitz","Lekaretxe","Lena","Leocadia","Leofwena","Leogife","Leolina","Leonina","Leontia","Leorin","Lerate","Lerden","Letasu","Lete","Letia","Letice","Leticia","Leto","Letoys","Letselina","Lett","Lette","Lettice","Lettie","Letty","Letyce","Leucothea","Leucotho\xEB","Leueiua","Leuekin","Leuerun","Leueua","Leueue","Leuieua","Leuild","Leuiua","Leurona","Leurun","Leuruna","Leuuich","Leveva","Lewana","Lewen","Lewena","Lexuri","Lezaeta","Lezana","Lezeta","Lia","Liana","Liaueld","Libourc","Licia","Lictina","Lide","Lidiardis","Liecia","Liedrada","Liefhun","Lieftet","Lientje","Liepmayt","Lierni","Lieste","Lietgarda","Lietgardis","Lietuuif","Lieuuara","Liffild","Lifgarda","Ligarda","Lige","Lili","Lilura","Limnoreia","Lina","Linda","Lindi","Linet","Linette","Linnet","Linniue","Linota","Linyeve","Linyive","Liobgytha","Liobsynde","Liodburga","Liodgard","Liodrada","Lion","Lioness","Lirain","Lisia","Litburh","Litgardis","Litiardis","Liuete","Liueua","Liuilda","Liuitha","Liuiua","Liutgarde","Livid","Livith","Lizarazu","Lohitzune","Loinaz","Lois","Lootje","Lopene","Lora","Lore","Lorella","Lorencete","Loreta","Lorete","Loretta","Lorie","Lota","Louisa","Louve","Loverun","Loza","Lubias","Lubje","Lubke","Lucardis","Luce","Lucete","Lucette","Lucey","Luciana","Lucie","Lucina","Lucque","Lucy","Luffechild","Lugardis","Luilda","Luixa","Lukene","Lumka","Lumke","Luned","Lunet","Lunete","Lur","Lutisse","Luuechild","Lynette","Lyneue","Lyonnete","Lype","Lyra","Lyse","Lyveva","Maarrieta","Mab","Mabbe","Mabel","Mabell","Mabella","Mabet","Mabil","Mabila","Mabile","Mabileite","Mabilete","Mabiley","Mabilia","Mabilie","Mabill","Mabilla","Mabillae","Mabillia","Mabin","Mable","Mabley","Mably","Mabot","Mabota","Mabs","Mabyle","Macedonia","Machtildis","Mactilda","Mactildis","Madelgarde","Madelrada","Madge","Madhalberta","Maeonia","Maera","Maerwynn","Mag","Mage","Magg","Magge","Maggie","Maggot","Maggote","Maghenyld","Maghtild","Magot","Magota","Magote","Magott","Magthildis","Magtildis","Magy","Mahald","Mahalt","Mahats","Mahaud","Mahault","Mahaut","Mahenyld","Maheut","Mahhild","Mahina","Mahthild","Mahthildis","Maia","Maialen","Maiandria","Maider","Maike","Maiken","Mairangi","Mairenni","Maisie","Maitagarri","Maitane","Maite","Maiteder","Maitena","Makatza","Malasintha","Malasuintha","Maldea","Malen","Manel","Maneld","Mania","Manild","Manna","Mantzia","Map","Marabel","Marama","Margar","Margaret","Margareta","Margarete","Margarett","Margarette","Margaria","Margarit","Margarita","Margat","Margeria","Margerie","Margerye","Marget","Margetta","Margoret","Margot","Margrat","Margreit","Margret","Margriet","Margue","Marguerin","Marguerite","Margueritte","Marguerot","Margyt","Mari","Maria","Mariaka","Maribella","Marider","Marilena","Mariora","Mariorie","Mariory","Maritxu","Marjer","Marjeria","Marjoria","Marjorie","Marjory","Markaret","Markuuara","Marlies","Maronne","Marozia","Marpessa","Marquise","Marrory","Marsilia","Martha","Martie","Martine","Martixa","Martxelie","Mary","Maryell","Masawa","Masticana","Matasuntha","Mathe","Matheld","Mathena","Mathila","Mathild","Mathildis","Matild","Matilde","Matildis","Matill","Matilldis","Matillis","Mattie","Matty","Matxalen","Maud","Maude","Maughtild","Mauld","Maura","Mauriana","Maut","Mautild","Mawd","Mawde","Mawt","Maxencia","Maximina","Maynild","Maysant","Maysaunt","Mazelina","Meaka","Mechtild","Meckil","Medea","Medesicaste","Meemte","Meg","Megaera","Megara","Megare","Megaris","Mege","Megenberta","Megendrod","Megenhelda","Megenlind","Megenlioba","Megensind","Megensinda","Megenuuara","Megethia","Megge","Meggot","Megy","Mehenilda","Meifte","Meinburg","Meinnelda","Meinsent","Meinswindis","Meisent","Meite","Melania","Melanie","Melantho","Meldred","Melicent","Melisant","Melisenda","Melisent","Melisentia","Melissa","Melissent","Melita","Melite","Melodia","Melodie","Melusine","Menborch","Mendi","Mendia","Mendiete","Mendigaa","Menelaia","Menga","Mengarde","Menica","Menosa","Mentzia","Meraud","Mere","Merewen","Merewina","Merget","Mergret","Merhild","Meriall","Meriel","Merilda","Merope","Merwenna","Meryall","Meryld","Methdin","Methild","Methildis","Metis","Metriche","Metylda","Michaela","Michi\xE8le","Mientje","Mikele","Milagros","Milborough","Milbrer","Milburegh","Milburew","Milburga","Milburh","Milbury","Milcentia","Mildthryth","Milesent","Milessent","Milia","Milicent","Milicenta","Milisandia","Milisant","Milisendis","Milisent","Milla","Mille","Millesant","Millesenta","Milo","Milto","Mina","Minervina","Miniain","Minicea","Minna","Minnota","Mique","Mira","Mirabell","Mirabella","Mirabelle","Mirabilis","Mirabillla","Mirable","Mirari","Mirella","Miren","Mirentxu","Miriald","Miriel","Miriela","Mirield","Mirielda","Mirielis","Miriella","Miriild","Mirils","Missa","Mitri","Mitxoleta","Moder","Moderte","Modesty","Moe","Mog","Mogg","Mogge","Mogota","Mohaut","Molara","Mold","Molde","Molora","Molpadia","Molt","Monette","Monima","Monime","Monlora","Montagne","Moolde","Mopp","Moppe","Moschia","Mott","Motte","Moude","Moulde","Moysant","Moysent","Munia","Muno","Munondoa","Muntsaratz","Murgindueta","Murie","Muriel","Muriele","Muriella","Murienne","Murina","Muruzabal","Muskilda","Muskoa","Muxika","Mydrede","Mykale","Mylecent","Mylisant","Mylla","Mylle","Myrine","Nabarne","Nabarra","Nafarroa","Nagore","Nahikari","Naiara","Nane","Nantechildis","Naroa","Natividad","Nausicaa","Nazubal","Neaera","Negu","Nekane","Nell","Nellie","Nelly","Nemerte","Nephele","Nerea","Nereida","Nesaea","Nest","Nesta","Ngaio","Ngawai","Nicasia","Nichola","Nicholaa","Nichole","Nicholina","Nicia","Nicol","Nicola","Nicolaa","Nicole","Nicopolis","Nidlebis","Niesenn","Nieves","Nikaia","Nikasepolis","Niko","Nikole","Niobe","Niree","Noblete","Nog","Nogga","Nogge","Nonna","Nora","Nordrada","Norma","Nunile","Nycaise","Nyra","Nyree","Nyrie","Nysa","Ockje","Oda","Odala","Odburga","Odela","Odelina","Odgiva","Odguda","Odgudana","Odiern","Odierna","Odierne","Odila","Odile","Odilia","Odlenda","Odolina","Odriana","Oenone","Ogiva","Oianko","Oiartza","Oibar","Oihana","Oihane","Oilandoi","Oinaze","Oitane","Oitia","Oka","Okon","Olaia","Olaiz","Olalla","Olar","Olaria","Olartia","Olatz","Olburgis","Olga","Olif","Oliff","Olimpias","Olite","Oliua","Olive","Olivet","Olivia","Ollano","Olleta","Ollett","Olligtie","Oloriz","Olyff","Olyffe","Olympias","Olyve","Omphale","Onditz","Ondiz","Oneka","Onintza","Onora","Opakua","Optata","Orabell","Orabella","Orabilia","Orabilis","Orabla","Orable","Orbaiz","Ordizia","Oreithuia","Oreithyia","Orella","Orenge","Orengia","Oreute","Organa","Oria","Oriabel","Oriande","Oriante","Orieldis","Oriholt","Oriold","Oriolda","Oriolt","Orithyia","Oriz","Oro","Oroitze","Ororbia","Orose","Orrao","Orreaga","Orsina","Orsola","Orthia","Orzuri","Osabide","Osakun","Osane","Osasune","Osgarda","Osgiua","Osina","Osith","Ositha","Oskia","Osteriz","Osthryd","Ostrogotho","Ostryd","Ostrythe","Osyth","Otberta","Otgiua","Otgiva","Otilia","Otonia","Otsana","Otsanda","Ottavia","Ottilia","Otzaurte","Our Lady of Begona","Ourse","Oydela","Pacchild","Palatina","Pales","Pandonia","Pandwyna","Panope","Panora","Panpoxa","Pantxike Patxi","Pare","Parezi","Parise","Parisete","Parmys","Parnel","Parnell","Paronel","Parthenia","Parthenope","Parysatis","Pasara","Pasiphae","Paskalin","Pasques","Passara","Passerose","Pateria","Paternain","Patricia","Patty","Pauee","Paui","Pauie","Paula","Pauli","Paulina","Paveya","Paveye","Paz","Pechel","Peg","Peggy","Pelela","Pelopia","Peneli","Penelope","Penne","Pentecost","Pentecouste","Penthesilea","Percalus","Pereite","Perialla","Periboea","Pericleia","Pernel","Pernella","Pernelle","Pero","Peronel","Peronele","Peronell","Peronelle","Perrete","Perronele","Perronnele","Perronnelle","Perrote","Perse","Persephone","Persis","Pertesia","Pertxenta","Pervica","Pervinca","Peryna","Peta","Peternel","Peternell","Peternella","Petje","Petrona","Petronel","Petronella","Petronilla","Petronille","Petronyl","Phaedra","Phaedre","Phaedyme","Phaethusa","Phaia","Pharahildis","Phelipote","Phelis","Phemie","Pherenike","Pheretima","Pherusa","Phigaleia","Philea","Philinna","Philip","Philippe","Philles","Phillice","Phillida","Phillip","Philomache","Philomela","Philomena","Philona","Philota","Phoebe","Phratagune","Phryne","Phylace","Phylia","Phyllis","Phylo","Phylomedusa","Pia","Piedad","Pilar","Pilare","Pipa","Pippa","Pizkunde","Placencia","Placidia","Placidina","Pleasant","Pleasaunce","Plectrudis","Plente","Plesance","Plesancia","Plesantia","Plesencia","Podarge","Pogge","Poggy","Poko","Polly","Polycaste","Polydamna","Polydora","Polymede","Polyxena","Pompeiana","Popelina","Poyo","Pozne","Praeiecta","Preciosa","Precious","Presentacion","Primaveira","Primeveire","Printza","Proba","Probina","Procne","Procris","Prone","Pron\xE8le","Proseria","Protezy","Prothasey","Prothesia","Proto","Protogonia","Prudencia","Prudentia","Prudie","Prue","Psamathe","Psyche","Pueyo","Purificacion","Purissimma","Purnelle","Purnle","Putiputi","Puy","Pylia","Pypa","Pyrrha","Pythias","Quenburga","Quenell","Queneua","Quenild","Quenilda","Quenill","Quenilla","Queniua","Quenyeve","Quenylda","Quynel","Qwinhild","Ra","Radagundis","Radborg","Radburg","Radburgis","Radegund","Radeken","Radgert","Radlia","Radogund","Radsuinda","Rainilda","Rainildis","Raisa","Ramburga","Rametta","Ramona","Rangi","Rante","Rata","RayneReine","Rechemay","Reenste","Reeste","Regana","Regenburuga","Regenelda","Regenlind","Regenset","Reginsuint","Regneuuig","Regula","Reimerich","Reinewif","Reingard","Reingardis","Reingart","Reingaud","Reingod","Reinhedis","Reinne","Reinsuent","Relindis","Remedios","Renata","Renburgis","Renilla","Rennewief","Rerte","Resli","Reta","Rewa","Rewi","Reyna","Reyne","Rhea","Rhene","Rhoda","Rhode","Rhodope","Riberta","Richardyne","Richelda","Richemeya","Richenda","Richenza","Richessa","Richil","Richild","Richildis","Richill","Richmal","Richoard","Richolda","Riclindis","Ricolda","Ricsuinda","Rieke","Rikild","Rikilda","Rikilde","Rikildis","Rikmai","Rinelt","Rinilda","Rinne","Rinnett","Rixenda","Rixende","Roana","Roberge","Rochilda","Rodburga","Rodelinda","Rodgarda","Rodgardae","Roes","Roese","Roesia","Roesli","Rofsind","Rogerete","Roheis","Roheisa","Roheisia","Rohese","Rohesia","Rohez","Roimata","Roisia","Rokilda","Roos","Rosa","Rosalind","Rosalinda","Rosaline","Rosamond","Rosamund","Rosamunda","Rosario","Rose","Roseaman","Roseia","Rosemond","Rosemonde","Rosemunda","Roslindis","Rosomon","Rossamond","Roste","Roswitha","Rotburga","Rothaide","Rothais","Rothin","Rotlenda","Rotrude","Rotrudis","Rousse","Roxane","Royce","Roysa","Royse","Roysia","Rozeman","Rubea","Ruothilde","Rupe","Rustica","Rusticana","Rychyld","Rykeld","Sabbe","Sabie","Sabin","Sabine","Saby","Sabyn","Saethrith","Saethryda","Sagarduia","Sagari","Sageua","Sageue","Sahats","Saieua","Saintisme","Saints","Saioa","Saiua","Salerna","Sallurtegi","Saloua","Salove","Salvianella","Samke","Sanceline","Sancha","Sanche","Sanctia","Santutxo","Sappho","Sarke","Sayeua","Sayeva","Sayntes","Sayua","Scholace","Scholast","Science","Sciencia","Scientia","Scolacia","Scolastica","Scylla","Sebasteia","Seburg","Seburga","Seburuh","Secile","Sedaina","Sedania","Sedehanna","Sedemai","Sedemaiden","Sedemode","Sedille","S\xE9dillon","Sedilon","Seghuie","Seheve","Seiua","Sela","Selinah","Seloua","Seloue","Selova","Seluue","Sely","Semele","Semera","Sence","Sens","Senses","Serena","Sergia","Seuar","Seuare","Sewenna","Seyiua","Seyua","Sib","Sibb","Sibba","Sibbe","Sibbet","Sibbly","Sibbot","Sibel","Sibeli","Sibell","Sibella","Sibely","Sibil","Sibile","Sibilia","Sibilie","Sibilla","Sibley","Sibli","Sibly","Siborch","Sibota","Sibri","Sibry","Siburg","Sibyll","Sibylla","Sicillia","Siddon","Sidney","Sidonia","Sidonie","Sieber","Sierida","Sieverte","Sigarda","Sigberta","Sigeberta","Sigeburgis","Sigerith","Sigethrod","Sigiburgis","Silke","Sillina","Silva","Similce","Sina","Sindonia","Sira","Sirida","Siscella","Sisilla","Sisley","Sisse","Sissota","Sisygambis","Sjante","Snelburch","Soberich","Sofie","Soiartze","Sokorri","Sol","Soledad","Sonja","Sophia","Sophoniba","Sophonisba","Sophonsiba","Sorauren","Sorkunde","Sorne","Soskao","Sotera","Soterraa","Souplice","Speio","Splendora","Sreda","Stacia","Stamburc","Stanborw","Stanburch","Stangiva","Stanguie","Stanhilda","Stanild","Stanilde","Stanuie","Stanyue","Stateira","Stenburch","Stephanie","Stheneboea","Stientje","Stilleuuara","Stina","Stonild","Stonilda","Stonildi","Stratonice","Strilleburg","Sueta","Sueteluue","Suitburgis","Sungyve","Sunigilda","Sunilda","Sunna","Sunngifu","Susanna","Swale","Swantje","Sweteloue","Swetelove","Swethyna","Swetiue","Swetyene","Swetyne","Syagria","Syardis","Sybbly","Sybby","Sybell","Sybil","Sybill","Sybilla","Sybille","Sybyle","Sybyll","Sybyly","Sycily","Syele","Synnove","Sysley","Syslye","Tacey","Tacia","Tacye","Taggett","Taggy","Taiaroa","Talaitha","Tamati","Tatje","Tawhaki","Tece","Tecmessa","Tede","Telephassa","Teresa","Terese","Tetradia","Tetxa","Teudsindis","Thais","Thalassa","Thaleia","Thalke","Thancuuara","Thangustella","Thea","Theaduuara","Theano","Thebe","Thedela","Theeste","Theldred","Theldry","Thelma","Themis","Theocharista","Theodananda","Theodelinda","Theoderada","Theodora","Theodoracis","Theodosia","Theodotis","Theognosia","Theophane","Theophania","Theophano","Theresa","Thessala","Thessalonike","Thetis","Theutberga","Thidela","Thieda","Thietgarda","Thietuuich","Thietwara","Thiodsind","Thiodsuinda","Thisbe","Thiudigotho","Thiutuuara","Tho\xEB","Thomassa","Thomassia","Tho\xF6sa","Thrasborg","Thrudberga","Thyia","Tice","Ticekin","Tiece","Ti\xE8ce","Tiecelin","Tiecia","Tiede","Tietlenda","Tietza","Tilda","Till","Tilla","Tille","Tillie","Tillot","Tillota","Tillote","Tilly","Timandra","Timo","Tina","Tiwho","Tjabbend","Tjalde","Toda","Toi","Toloo","Tomyris","Tonna","Toto","Trhutborgana","Trinidad","Trissie","Trixie","Truda","Trudi","Trudlinde","True","Truffeni","Trutilda","Tryphena","Tryphosa","Tui","Tungia","Turi","Txori","Ty\xE8ce","Tyecelin","Tyeceline","Tyro","Ualdburg","Ualdethruda","Uba","Ubaga","Ubarriaran","Uda","Udaberri","Udala","Udane","Udara","Udazken","Udelina","Udeline","Udiarraga","Udoz","Ueremund","Uerenburoc","Uga","Ugarte","Uiburgis","Uindborog","Uinebarga","Uireda","Ula","Ulfhild","Ulgarda","Uli","Ulia","Ulveva","Unice","Untza","Untzizu","Uoldolberta","Uraburu","Uralde","Urbe","Urcy","Urdaiaga","Urdie","Urdina","Uriarte","Uribarri","Urie","Uriz","Urkia","Uronea","Urraka","Urrategi","Urrea","Urreturre","Urretxa","Urrexola","Urrialdo","Urroz","Ursaly","Ursel","Urseley","Ursell","Ursola","Urtune","Urtza","Urtzumu","Uschi","Usmene","Usoa","Usue","Usune","Utsune","Uzuri","Vadamerca","Valdamerca","Vanora","Veleda","Veneranda","Verena","Vesta","Vigilantia","Vigilia","Violante","Violet","Violetta","Violette","Visitacion","Vitula","Vivian","Viviana","Vivien","Vivienne","Vreneli","Vreni","Vrowecin","Vualdberta","Vualdedruda","Vualdetruda","Vuifken","Vuinetberta","Vuissance","Vuiuechin","Wackrill","Waerburg","Waitohi","Waldburg","Waldrada","Wander","Wannore","Wannour","Wantelien","Wantliana","Warehild","Watcelina","Wavin","Wea","Wealdburg","Wealhburg","Weertje","Wekerild","Wemke","Wendel","Wenefreda","Wenthelen","Wentiliana","Werburg","Werburga","Werburgh","Werbyrgh","Wereburga","Whetu","Wibke","Wiblind","Wiburge","Wiburgis","Wiemda","Wifhildis","Wihted","Wilberga","Wilgefortis","Wilgeva","Willelda","Willelma","Willesuindis","Wilmetta","Wilmke","Wilmot","Wimarc","Wimarca","Winefred","Winifred","Winnifred","Wivecin","Wivin","Wlbergis","Wlbgis","Wlfeuua","Wlfildis","Wlgert","Wlueth","Wluiaa","Wluiua","Wluyua","Wlveva","Wocbke","Wofled","Wolfleda","Wolueua","Wolueue","Woluiua","Wubcke","Wulfhilda","Wulfhildis","Wulfiue","Wulfled","Wulfleda","Wulfrueua","Wuluefa","Wuluethia","Wulueua","Wuluiua","Wuluiue","Wulvela","Wulvella","Wulveva","Wulveve","Wulviva","Wulwiua","Wumke","Wyberg","Wybir","Wybur","Wyburgh","Wynifreed","Yayone","Yda","Ydany","Ydeneye","Ydenia","Ydon","Ydonea","Yera","Yfame","Ylaire","Ylaria","Yllaria","Ymanie","Ymanya","Ymanye","Ymeisna","Ymenia","Ynstauncia","Yolande","Yolant","Yootha","Yordana","Younice","Yrmengardis","Ysane","Ysemay","Ysenda","Yseult","Yseulte","Ysmay","Ysmeina","Ysmena","Ysmene","Ysolt","Ysopa","Ysoria","Ysoude","Ysout","Yulene","Yvette","Yzebel","Xabadin","Xanthe","Xanthippe","Xantippe","Xaxi","Xemein","Xene","Xenophile","Ximena","Xixili","Xoramen","Zabal","Zabaleta","Zaballa","Zaloa","Zamartze","Zandua","Zarala","Zeberiogana","Zelai","Zelina","Zelizi","Zenobia","Zerran","Zikuaga","Zilia","Ziortza","Zita","Zoe","Zohartze","Zorione","Zuberoa","Zubia","Zufiaurre","Zuhaitz","Zumadoia","Zumalburu","Zuri","Zuria","Zuriaa","Zurie","Zuza","Zuzene","Zwaante"],uA=["Aalart","Aalef","Aalot","Abantes","Abarrotz","Abas","Abascantus","Abbo","Abdalonymus","Abderos","Abelard","Aberardus","Aberkios","Aberri","Abimilki","Abisme","Ablabius","Ablerus","Abramius","Abreas","Abronychus","Absolon","Abundanitus","Abydos","Acaeus","Acamus","Acelin","Acessamenus","Acestes","Achard","Achart","Achestan","Achila","Achololim","Acindynus","Aclepiades","Acot","Acrisias","Acrisius","Acroneos","Actor","Acun","Acur","Adalbero","Adalbert","Adalbrecht","Adaldag","Adalfuns","Adalhard","Adaloald","Adame","Adei","Adeimanthos","Adelard","Adelardus","Adelchis","Adelphius","Adelredus","Adelroth","Adelstan","Adeluin","Adelulf","Adenot","Aderlard","Adestan","Adh\xE9mar","Adlard","Admago","Admetos","Adon","Adranus","Adrastos","Adrastus","Adred","Adrestus","Adri","Adrianus","Adrien","Adso","Adstan","Adur","Aeaces","Aeduin","Aeduuard","Aeduuin","Aega","Aegaeon","Aegelmaer","Aegicoros","Aegidius","Aegisthes","Aegon","Aeilmar","Aeimnestos","Aeldredus","Aeldret","Aelfraed","Aelgar","Aelger","Aelmar","Aelmer","Aeluin","Aeluuin","Aenesidemos","Aeolus","Aeropus","Aeschreas","Aesculapius","Aesepus","Aeson","Aesop","Aetes","Aethelmaer","Aethelraed","Aethon","Aetion","Aetios","Aetolos","Agamedes","Agamemnon","Aganbold","Agapenor","Agapetus","Agapias","Agastrophos","Agathocles","Agathon","Agbal","Ageio","Agelaus","Agenor","Ager","Agesilaus","Agetos","Agid","Agila","Agilbert","Agilof","Agilulf","Agin","Agino","Agis","Agiwulf","Agnellus","Agnien","Agobard","Agosti","Agoztar","Agrias","Agriwulf","Agu","Ahthari","Ahu","Aiantes","Aias","Aide","Aidoingus","Aiert","Aigeus","Aignen","Aigo","Aigulf","Ailbert","Ailbric","Ailbriht","Ailmar","Ailmer","Ailred","Ailuin","Ailwin","Ailwinus","Aimar","Aime","Aimeri","Aimeric","Aimeriguet","Aimery","Aingeru","Aintza","Aioro","Aire","Airopos","Aischylos","Aistan","Aistulf","Aita","Aithanarid","Aitor","Aitzol","Akadios","Akamas","Aketza","Aktis","Aktor","Akuhata","Alahis","Alain","Alainon","Alaire","Alana","Alane","Alanus","Alaon","Alar","Alarabi","Alard","Alarge","Alaric","Alaricus","Alart","Alastor","Alatheus","Alatz","Alaviv","Alaza\xEFs","Alberi","Alberic","Albericus","Albertus","Albgast","Albi","Albin","Albinus","Albirich","Alboin","Albrict","Alcaeos","Alcandros","Alcher","Alcides","Alcimos","Alcinous","Alcmaion","Alcman","Alcock","Alcon","Aldebrand","Aldemund","Alderan","Aldin","Aldis","Aldo","Aldredus","Aldret","Alduin","Aldun","Aldus","Aldyn","Aleaume","Aleaumin","Alec","Aleck","Alector","Alein","Alektryon","Alerot","Alesander","Alesaunder","Alestan","Aleuas","Alewyn","Alex","Alexandir","Alexandros","Alexarchos","Alexias","Alexis","Alexon","Aleyn","Aleyne","Alfan","Alfonce","Alfredus","Algar","Alger","Algor","Aliaume","Alica","Alick","Aligern","Alimahus","Alisander","Alisandre","Alisaunder","Alistair","Alixandre","Alizaunder","Alkamenos","Alkestis","Alketas","Alkibiades","Alkides","Alkimachos","Alkiphron","Alkmaion","Alla","Allan","Allande","Allen","Alleyn","Allowin","Almanzor","Almer","Almeric","Almericus","Alo","Alodet","Aloeus","Alois","Alots","Aloysius","Alphaeus","Alpheos","Alphesiboeus","Alphios","Alphonsins","Alret","Alsandre","Altes","Altzibar","Aluer","Aluerad","Aluerd","Alueredus","Alured","Aluredus","Aluret","Aluuin","Aluuine","Alvar","Alvere","Alvery","Alvredus","Alwinus","Alwyn","Alwyne","Alyattes","Alyaume","Alypius","Alysandir","Amadeus","Amal","Amalaric","Amalric","Amalrich","Amalricus","Amalvis","Amand","Amanieu","Amarinceus","Amator","Amatus","Amaud","Amauri","Amaurri","Amaury","Ambe","Ambrico","Ambricus","Ambroise","Ambrosius","Ambroys","Ambure","Ame","Ameinias","Ameinokles","Am\xE9lien","Amer","Americ","Americus","Amery","Ames","Ametz","Amfrid","Amfridus","Amiantos","Amias","Amiel","Amigart","Amils","Amiot","Amirrutzes","Amis","Amisius","Ammius","Ammonianus","Amo","Amohia","Amompharetos","Amopaon","Ampelius","Amphiaraos","Amphidamos","Amphimachos","Amphimnestus","Amphinomous","Amphion","Amphios","Amphitrion","Ampho","Amuruza","Amyas","Amyntas","Amyntor","Amyon","Amyris","Amythaon","Anabesineos","Anacharsis","Anafrid","Anagastes","Anaia","Anakletos","Anakoz","Anakreon","Anartz","Anastasios","Anastasius","Anatolicus","Anatolius","Anaut","Anaxagoras","Anaxandridas","Anaxandrides","Anaxandros","Anaxarchos","Anaxilaus","Anaximander","Anaximenes","Anaxis","Anaxos","Ancelin","Ancelm","Ancelmus","Ancelot","Anchialus","Anchier","Anchimolios","Anchises","Anchitel","Ancus","Andagis","Ander","Andhari","Andima","Andoitz","Andokides","Andolin","Andoni","Andraemon","Andrash","Andrea","Andreas","Andreu","Andrew","Andries","Androbulos","Androcles","Androdamos","Androgeus","Andronicus","Aner","Aneristos","Anfroi","Anfroy","Angegisis","Angilbart","Angilbert","Anianus","Anicius","Aniketos","Anisodoros","Anixi","Anketel","Anketil","Anketin","Anko","Anno","Anquetil","Anquetin","Anschetillus","Anschitillus","Anscoul","Ansegisel","Ansehelm","Anseis","Anselet","Ansell","Ansellus","Anselm","Anselme","Anselmet","Anselmus","Ansfroi","Ansgor","Ansgot","Anshelmus","Ansiau","Ansila","Ansis","Anskar","Ansketil","Anskettell","Ansobert","Ansout","Ansprand","Anstill","Ansure","Antaeus","Antagoras","Antemion","Antenor","Anter","Anthelme","Anthemion","Anthemius","Anthimus","Anthon","Anthonius","Antichares","Antidoros","Antigenes","Antigonos","Antikles","Antilochus","Antinous","Antiochus","Antipatris","Antipatros","Antiphales","Antiphones","Antiphus","Antisthenes","Antoinne","Anton","Antoni","Antonius","Antonius Tone","Antony","Antoynel","Antso","Antton","Antxoka","Antyaume","Anysus","Anytos","Anytus","Aoric","Apahida","Apal","Apat","Apelles","Apellicon","Aphidnos","Api","Apisaon","Apollodoros","Apollophanes","Apollos","Arabante","Arabo","Araimfres","Aralar","Arano","Aranold","Arapeta","Aratus","Aratz","Arbert","Arbitio","Arbogast","Arbogastes","Arcadius","Arcas","Arcavius","Arcebaldus","Arcenbaldus","Arcesilaus","Archagoras","Archambaud","Archel","Archelaos","Archembald","Archeptolemus","Archesilaus","Archestratidas","Archetel","Archil","Archilochus","Archimbalt","Archytas","Arcidamus","Arcturus","Arculf","Ardabur","Ardaric","Ardoin","Areilycus","Areisius","Areithous","Arenvald","Aresti","Argades","Argaeus","Argaith","Argi","Argider","Argina","Argoitz","Argos","Ariald","Ariaric","Aribert","Arichis","Aridolis","Arimir","Arioald","Arion","Aripert","Ariphron","Aristaeus","Aristagoras","Aristaios","Aristandros","Aristarchos","Aristarchus","Aristides","Aristion","Aristippus","Aristoboulos","Aristobulus","Aristocles","Aristocypros","Aristodemos","Aristogeiton","Aristomachos","Ariston","Aristonous","Aristonymos","Aristophanes","Aristophantes","Aristos","Aristotles","Aristoxenus","Arius","Arixo","Armand","Armando","Armant","Armatus","Armenius","Armentarius","Armin","Armine","Arminel","Armundus","Arnaitz","Arnald","Arnaldus","Arnalt","Arnas","Arnaud","Arnaut","Arnegis","Arnegliscus","Arnet","Arnoald","Arnold","Arnoldus","Arnott","Arnoul","Arnould","Arnulf","Arnwald","Arold","Arotza","Arrabaios","Arrats","Arridaios","Arrosko","Arsaphius","Arsenios","Arsenius","Arsieu","Artaud","Artavasdas","Artemas","Artemidoros","Artemios","Artemisthenes","Arter","Arther","Artheur","Arthurius","Arthurus","Artizar","Artor","Artos","Artur","Arturus","Artus","Artzai","Artzeiz","Arvandus","Arvide","Arybbas","Asasthenes","Asbad","Asbadus","Ascalaphus","Ascalo","Ascanius","Ascelin","Ascelyn","Aschetel","Aschetil","Aschetin","Aschines","Ascila","Asdrubal","Asentzio","Asier","Asius","Askell","Asketel","Asketin","Asklepios","Asonides","Asopodoros","Asopus","Aspar","Asphalion","Aspuanis","Assaraeus","Asselin","Astacos","Astegal","Astell","Aster","Asteri","Asterion","Asterius","Asteropaeus","Astigar","Astin","Astor","Astorge","Astrabacus","Astyanax","Atacinus","Atarrabi","Atarratze","Ataulf","Ataulph","Athalaric","Athalwolf","Athamas","Athanagild","Athanaric","Atharid","Athaulf","Athelard","Athelardus","Athelstan","Athelston","Athenades","Athenaeus","Athenion","Athenodorus","Atiphates","Atreus","Atrometos","Atseden","Attaginas","Attaginos","Attalos","Atymnius","Atys","Atze","Atzo","Aubelet","Auberi","Aubert","Aubertin","Aubery","Aubin","Aubinnet","Aubour","Aubray","Aubri","Aubry","Audax","Audegar","Audemar","Audila","Audo","Audoen","Audoenus","Audoin","Audomar","Audoneus","Audouin","Audramnus","Audri","Augebert","Augias","Auguinare","Augustinus","Auletes","Aunger","Aunsellus","Aurel","Aurken","Aurre","Aurri","Ausout","Austin","Austinus","Austyn","Autesion","Autgar","Authari","Autodikos","Autolycus","Autolykos","Automedon","Autonous","Auveray","Auvere","Auver\xE9","Auvrai","Auxitius","Auxkin","Avenel","Averardus","Averay","Avere","Averet","Averey","Averitt","Avery","Avienus","Avila","Axular","Axylus","Aylard","Aylbricht","Aylewynus","Aylmer","Aylmerus","Aymar","Aymer","Aymeri","Aymie","Aymon","Ayol","Azeari","Azelinus","Az\xE9mar","Azer","Azeus","Azibar","Aznar","Azorius","Aztore","Azubeli","Azur","Azzo","Baalhaan","Babai","Babylas","Bacauda","Bacchides","Bacchios","Bacchylides","Bacenor","Bacis","Baderon","Badouim","Badua","Baduaruis","Baduila","Baerius","Baiardo","Baiarte","Baiona","Bakar","Baladi","Balan","Balasi","Baldavin","Baldemarus","Baldewin","Baldewyn","Baldewyne","Baldric","Balduin","Baldwyn","Balendin","Baleren","Balesio","Balian","Baligant","Balius","Bangin","Baptiste","Barat","Barates","Baraxil","Bardas","Bardin","Bardo","Bardol","Bardolf","Bardolphus","Bardulphus","Barea","Baret","Barnard","Barnet","Barnier","Baro","Barret","Barrett","Barth\xE9lemy","Bartholomeus","Bartram","Bartrem","Basajaun","Basan","Basbrun","Basequin","Basile","Basileides","Basileios","Basiliakos","Basilides","Basilius","Basill","Baso","Basuin","Basyle","Bathyaes","Batsuen","Batzas","Baudet","Baudkin","Baudoin","Baudouin","Baudoyn","Baudry","Baugulf","Bausan","Baut","Bauto","Bavo","Bawden","Bayard","Baynard","Baza","Bazil","Bazkoare","Bazzo","Beat","Beatus","Beaudonnier","Beaudouin","Begon","Begue","Behe","Beila","Bela","Belasko","Belin","Belos","Beltxe","Beltza","Benat","Bendis","Bendy","Benedick","Benedictus","Benedicus","Beneger","Beneoit","Ben\xE9oit","Beneoite","Benet","Benett","Beneyt","B\xE9nezet","Benger","Benild","Benkamin","Bennet","Benoet","Benoiet","Benoist","Benoit","Beppolenus","Berahthraben","Berart","Berasko","Berbiz","Berchar","Berdaitz","Berdoi","Beremundo","Berend","Berengar","Berengarius","Berengerius","Berengerus","Berengier","Berhdoldus","Berhtolf","B\xE9ri","Berico","Berig","Berimud","Berimund","Berin","Beringaer","Beringer","Berinhard","Bernar","Bernard","Bernardus","Bernart","Bernat","Bernier","Berno","Bero","Beroald","Beroldus","Berolt","Berriotxoa","Bert","Bertaut","Bertelis","Berteram","Berthaire","Berthar","Berthomieu","Bertie","Bertilo","Bertin","Bertol","Bertramus","Bertran","Bertrand","Bertrannus","Bertrant","Bertulf","Berwelfus","Besgun","Bessa","Bessas","Bessi","Besso","Betadur","Betan","Beti","Betin","Betyn","Beuca","Beucad","Beuve","Beuves","Beves","Bevon","Bezilo","Bianor","Bias","Bibianus","Biche","Bidari","Bide","Bidun","Bigelis","Bihar","Bikendi","Bilbo","Bilimer","Bilintx","Billebaut","Bingen","Binizo","Bion","Birila","Birinus","Birjaio","Bisaltes","Bisinus","Biton","Bittor","Bitxintxo","Bixente","Bixintxo","Bizi","Bladi","Blaise","Blaive","Blancandrin","Blanko","Blasius","Blathyllos","Blaze","Blutmund","Bob","Bobbie","Bobby","Bobo","Bobs","Bochard","Bodenolf","Bodkin","Bodo","Bodolev","Bodoloff","Bodwine","Boethius","Boethus","Bohle","Boiorix","Boje","Boltof","Bomilcar","Bon-Ami","Boneface","Bonifacius","Bonifatius","Bonne","Bonyface","Boodes","Borani","Borchert","Bordat","Borjes","Bortzaioriz","Borus","Boso","Bostar","Boter","Botolfe","Botolph","Botulf","Bouchard","Bouke","Bovo","Braga","Brandila","Brantome","Bretonnet","Brianus","Briareus","Briarus","Brice","Bricet","Briceus","Bricot","Brien","Brienus","Brison","Britius","Brocard","Broder","Bruiant","Brune","Bruno","Brunte","Bruyant","Bryan","Bryant","Bryennius","Brygos","Bucoli","Bulis","Burchard","Burconius","Burel","Burgundus","Burkardus","Burnel","Burni","Burrhus","Burutzagi","Buselin","Butacidas","Butilin","Butlilinus","Caine","Callimachus","Callimorphus","Callinicus","Calopodius","Canbeus","Candac","Cannabas","Cannabaudes","Cantacuzenes","Canute","Canutus","Cappi","Capuel","Carbo","Carellus","Carenos","Carinus","Carle","Carloman","Carlon","Carneades","Carpophorus","Carpus","Carthalo","Casambus","Caschin","Casjen","Caspar","Cassyon","Castinus","Castor","Ceas","Cebriones","Celeas","Centule","Cephalos","Cepheus","Cephissos","Cerularius","Cethegus","Ceubasnus","Ceufroy","Ceyx","Chabrias","Chacili","Chaeremon","Chairophon","Chal","Chalcodon","Chalcon","Chalie","Chalin","Challemmeinne","Challemoinne","Challes","Charax","Charegiselus","Chares","Charibert","Charidemos","Charilaus","Charillos","Charle","Charlemayn","Charles","Charlet","Charlot","Charlys","Charmides","Charon","Charopos","Chartain","Chatbert","Chazili","Cheiron","Cheldric","Chenric","Chernubles","Chersis","Chik","Chilbudius","Childebert","Childebrand","Childeric","Chileos","Chilon","Chilperic","Chindasuinth","Chlodmer","Chlodovech","Chlodowig","Chlotar","Choerilos","Choeros","Chonrad","Chremes","Chremon","Chremonides","Chretzo","Chrezzo","Chrisogon","Christoboulus","Christophorus","Chrodegang","Chromis","Chromius","Chroniates","Chrysaor","Chryses","Chrysippos","Chrysogones","Chrysogonus","Chrysolorus","Chustaffus","Cilix","Cineas","Cinyras","Ciprianus","Cisses","Cisseus","Clair","Clairac","Clarebald","Clarembald","Clarembaut","Claren","Clarenbald","Clarien","Clarifant","Clarin","Clarus","Claudien","Cleades","Cleandros","Cleathes","Cleisthenes","Clem","Clemens","Clement","Cleobulus","Cleodaeos","Cleombrotos","Cleomenes","Cleon","Cleonicus","Cleonymus","Cleph","Clerebald","Clerenbald","Climborin","Climen\xE7on","Climent","Clinias","Clisthenes","Clodomir","Clonius","Clotaire","Clothair","Clovis","Clymen\xE7on","Clyment","Clytius","Clytomedes","Cniva","Cnivida","Cnoethos","Cobbo","Cobon","Codros","Coenus","Coeranus","Coes","Cois","Colbert","Colias","Colluthus","Comentas","Comentiolus","Cometas","Comitas","Comitiolus","Conandus","Conanus","Conayn","Conon","Constans","Constantianus","Constantinianus","Constantinus","C\xF6on","Copreus","Corbinian","Cordylion","Corippus","Cornel","Cornelys","Corney","Coronos","Corydallos","Corydon","Cosmas","Costaine","Costan","Costane","Costetine","Costin","Coumyn","Courtois","Cozard","Crathis","Cratinus","Cratippus","Cr\xE9pin","Crescentius","Cresconius","Cressant","Cressin","Cretheus","Crethon","Cretines","Crios","Crispian","Crispianus","Crispin","Crispinian","Crispinianus","Crispinus","Cristianus","Crocus","Croesus","Cronos","Crotila","Cteatus","Ctesippus","Cudbert","Cudbriht","Cuddey","Cuddie","Cuddy","Cunigast","Cunimund","Cuno","Cunradus","Cuphagoras","Curincpert","Curteis","Cuthbrid","Cyberniskos","Cycnus","Cylon","Cynaegiros","Cyncus","Cyneas","Cyniscus","Cyon","Cyprian","Cypselos","Cyr","Cyrenios","Cyriack","Cyricus","Cyril","Cyrila","Cytorissos","Dabi","Dadaces","Dado","Daedalos","Daetor","Dagilo","Dagobert","Dailus","Daimbert","Dalfin","Dalmas","Dalmatius","Daluce","Damasippus","Damasithymos","Damasos","Damastor","Damasus","Damian","Damianos","Damianus","Damiskos","Dammo","Damoetas","Damon","Danaos","Danaus","Danel","Daniel","Danielus","Danje","Danor","Dapamort","Daphis","Daphnis","Dardanus","Dares","Darius","Daufari","Daufer","David","Davos","Decentius","Decke","Dederic","Dederich","Dederick","Dedericus","Deenes","Deenys","Degarre","Degore","Dei","Deigenhardus","Deinias","Deinokrates","Deinomenes","Deiotones","Deiphobus","Deiphonous","Deipylus","Delion","Demades","Demaratos","Demarmenos","Demas","Demeas","Demetrios","Democedes","Democo\xF6n","Demodocus","Demokrates","Demoleon","Demonax","Demonous","Demophlos","Demosthenes","Denes","Denisot","Dennet","Dennie","Dennis","Denny","Denyse","Denysot","Deon","Derek","Derkylos","Derric","Derrick","Deryk","Detlef","Deukalion","Deunoro","Deuterius","Dexicos","Dexios","Diactorides","Diadromes","Diadumenus","Diagoras","Diagur","Dicaeus","Diccon","Dick","Dicke","Dicken","Dickie","Dickon","Dickory","Dicky","Didericus","Didymus","Diegotxe","Dieneces","Dieter","Diggin","Diggory","Digne","Digory","Dimarus","Diocles","Diodoros","Diodorus","Diokles","Diomedes","Dionisius","Dionysios","Dionysophanes","Dionysos","Diophantus","Diores","Diosconis","Dioscuros","Diotrephes","Dirk","Dismas","Distiratsu","Dithyrambos","Ditmarus","Ditwinus","Dmetor","Dob","Dobbin","Dod","Dodd","Doddie","Doddy","Dodge","Dodo","Doete","Dolfin","Dolleo","Dolon","Dolops","Domeka","Domentziolus","Domenyk","Domianus","Domiku","Dominic","Dominick","Dominicus","Dominix","Dominy","Domnicus","Domninus","Domnitziolus","Donaldus","Donat","Donato","Donestan","Doneuuald","Donnet","Donostia","Donston","Donus","Doolin","Doreios","Doreius","Dorian","Doriskos","Dorjes","Doros","Dorotheus","Doryssos","Dosithios","Draga","Drest","Dreu","Dreue","Dreues","Dreux","Drew","Drewett","Drimylos","Droart","Droet","Drogo","Dromeus","Dro-on","Droserius","Drouet","Droyn","Dru","Drue","Druet","Druettus","Drugo","Drust","Dryas","Dryops","Drystan","Dubius","Ducetius","Duche","Duda","Dudic","Dudo","Dudon","Duihna","Dukker","Dulcissinuis","Dulcitius","Dump","Dumphey","Dumphry","Dumpty","Dunestan","Dunixi Denis","Durand","Durandus","Durant","Duris","Dye","Dymas","Dymnos","Dynamius","Dyonisius","Dyryke","Eadmund","Eaduin","Eaduuard","Ealdred","Ealdwine","Eate","Ebbo","Eberhardus","Ebermud","Eberwolf","Ebrardus","Ebrimud","Ebroin","Ebrulf","Eburhart","Ech\xEBeus","Echekrates","Echelaos","Echemmon","Echemus","Echephron","Echepolus","Echestratos","Eck","Eckardus","Ecke","Ecky","Ede","Edelstein","Eden","Eder","Edica","Edmod","Edmond","Edmundus","Edon","Edorta","Edred","Eduard","Eduin","Eduinus","Edun","Edur","Eduuard","Eduuin","Eduuine","Edward","Edwardus","Edzard","Ee","Eetion","Eggihard","Eggo","Egidius","Eginhardt","Eginolf","Egoi","Egoitz","Egon","Eguen","Eguerdi","Egun","Eguntsenti","Eguzki","Ehren","Eicke","Eicko","Eidhart","Eielt","Eiffe","Eigio","Eilert","Eilmer","Einhard","Einolfus","Eioneus","Eirenaios","Ekain","Ekaitz","Ekhi","Ekialde","Elasus","Elatos","Elatreus","Elazar","Elbert","Eldred","Elduin","Eleder","Eleon","Elephenor","Elexander","Elie","Ellande","Elmar","Elmer","Elorri","Elpenor","Elpides","Elpidius","Elshender","Eluard","Elured","Eluret","Elvin","Elysandre","Emambe","Emaurri","Emaus","Embrico","Emelricus","Emenon","Emercho","Emeric","Emerick","Emericus","Emery","Emicho","Emme","Emmeran","Emmerich","Emond","Emont","Emory","Empedocles","Enaut","Endemannus","Endios","Endira","Endura","Endymion","Eneco","Enego","Eneko","Enekoitz","Eneto","Enetz","Engelard","Engelier","Engelke","Engenes","Engenouf","Engeram","Engeramus","Engerramet","Engerran","Engerrand","Engilbert","Enguerran","Enguerrand","Enion","Eniopus","Enjorran","Enjorren","Ennaeus","Enne","Enno","Ennodius","Ennomus","Ennychus","Enops","Enurchus","Eos","Epaenetus","Epaphos","Epaphroditus","Epeigeus","Epeius","Ephialtes","Epicurus","Epicydes","Epikrates","Epimenes","Epiphanes","Epiphanius","Epistor","Epistrophos","Epitrophos","Epizelos","Epowlett","Eral","Eraric","Erart","Erasistratus","Eratosthenes","Eratostheres","Erauso","Ercanbald","Erchambaut","Erchebald","Erchembaut","Erchenbaldus","Erchinoald","Erechtheus","Ereinotz","Erengier","Eretmenus","Ereuthalion","Erginus","Ergiyios","Erichthonius","Ericus","Eriulf","Eriz","Erkenbaud","Erlantz","Erlembald","Ermanaric","Ermelandus","Ermenoldus","Ernald","Ernaldus","Ernaut","Erneis","Ernis","Ernisius","Ernold","Ernoldus","Ernolf","Ernoul","Ernoulet","Ernoullet","Ernst","Ernust","Erramu","Erramun","Errando","Errapel","Errolan","Erroman","Erruki","Ertaut","Eru","Ervig","Erwin","Erxandros","Eryalus","Erysichton","Eryx","Eryximachos","Escremiz","Esdelot","Esdert","Eshmunazar","Eskuin","Esme","Esmond","Espan","Espanelis","Esprevere","Estebe","Est\xE8ne","Estmond","Estorgan","Estout","Estramarin","Eteocles","Eteokles","Eteonous","Eteus","Ethelbert","Ethelmar","Etienne","Etor","Etxahun","Etxatxu","Etxeberri","Etxekopar","Etxepare","Euaemon","Eualcidas","Euanthes","Euarestos","Eubalus","Eubulus","Eucarpus","Euchenor","Eucleides","Eudaemon","Eude","Eudes","Eudon","Eudorus","Eudoxius","Eudoxsus","Eudoxus","Eudropin","Euenius","Euenor","Euenus","Eugammon","Eugenios","Eugenius","Euhemenis","Euippus","Eukles","Eulalius","Eulampius","Eulogius","Eumaeus","Eumastas","Eumelus","Eumenes","Eumneus","Eumolpus","Euneas","Euonomos","Eupalinus","Eupatarius","Euphemius","Euphenes","Euphorbos","Euphorion","Euphratas","Euphronios","Euphronius","Eupolos","Euric","Euripides","Euryanax","Eurybates","Eurybiades","Eurycliedes","Eurydamus","Eurydemon","Eurydemos","Euryhus","Eurykrates","Eurykratides","Euryleon","Eurylochos","Eurymachos","Euryphon","Eurypylos","Eurystenes","Eurysthenes","Eurystheus","Eurysthios","Eurythion","Eurytos","Eusebius","Eusko","Eussorus","Eustache","Eustachius","Eustacius","Eustas","Eustathius","Eustochius","Eustratius","Eute","Eutha","Euthalius","Eutharic","Euthydemos","Euthynos","Eutolmius","Eutropios","Eutuches","Eutychianus","Eutychides","Eutychius","Eutychus","Euvrouin","Evaenetos","Evagoras","Evandros","Evanetus","Eve","Evelthon","Evenios","Evenon","Evenus","Everardus","Evert","Everwinus","Evios","Evrardin","Evrart","Evrat","Evrouin","Evroul","Evroult","Ewmond","Ewstace","Exaduis","Exekias","Eylgar","Ezkerra","Eztebe","Fabianus","Fabien","Fabyan","Facco","Fadiko","Faenus","Fairman","Faldron","Fallard","Fameite","Fam\xE8te","Fangeaux","Faramond","Faramund","Fardulf","Fareman","Faremanne","Farman","Farmanus","Farnobius","Faro","Faroald","Farrimond","Fastida","Fastred","Fato","Fauques","Faure","Fawkes","F\xE9deric","F\xE9deryc","Fehde","Feletheus","Felippe","Felippo","Felippot","Feliz","Felyse","Ferand","Ferant","Ferentus","Fermin","Ferrand","Ferrant","Ferri","Ferry","Fersio","Fersomeris","Fery","Feva","Fiebras","Fiehe","Fiepto","Fierelus","Filibert","Filimer","Firman","Firmin","Firmine","Firminus","Firmo","Fitel","Fitellus","Fithian","Fizzilo","Flaccitheus","Flaco","Flambard","Flanbert","Flavian","Flodoard","Floouen","Florant","Florence","Florencius","Florent","Florentinus","Florentius","Flori","Florian","Floridee","Floris","Florivet","Florus","Fluellen","Flurry","Fluvant","Focke","Foke","Folc","Folcard","Folke","Folkert","Folkes","Folkher","Folkmod","Folmar","Formerio","Formosos","Forsard","Fortin","Fortun","Foucaud","Foucaut","Foucher","Fouchier","Foulk","Foulque","Foulqueret","Fouquaut","Fouque","Fouqueret","Fouques","Fouquet","Fourcaut","Foursi","Fowke","Franceis","Franceys","Francio","Franciscus","Franco","Francus","Frankl","Franque","Franquet","Frantzes","Franz","Fraomanius","Fraunce","Fraunk","Fravitta","Fray","Fredegar","Frederic","Fredericus","Frederik","Freert","Fremin","Frerich","Frery","Freskin","Fretela","Fridebertus","Fridebraht","Frideric","Fridericus","Fridigern","Fridolin","Fridugis","Fridurih","Frigeridus","Frilo","Frithila","Frithuric","Fritigern","Froila","Fromondin","Fromony","Fructosus","Fuabal","Fuano","Fulbert","Fulbertus","Fulchard","Fulcher","Fulco","Fulgentius","Fulk","Fulke","Fulko","Fullofaudes","Fulrad","Fyrmyn","Gabirel","Gabo","Gabon","Gabrielius","Gadaric","Gadfrid","Gagino","Gahariet","Gai","Gaiallard","Gaido","Gaidon","Gaifer","Gaillard","Gaillart","Gainas","Gairbert","Gairebold","Gairhard","Gairovald","Gaiseric","Gaitzka","Gaizka","Gaizkine","Gaizko","Galafe","Galafre","Gale","Galefridus","Galenus","Galeran","Galeren","Gales","Galfridus","Galien","Galindo","Galindus","Gallien","Gallienus","Gallus","Galoer","Galot","Galter","Galterius","Gamelin","Gamelinus","Gamellus","Gamelus","Gammell","Ganelon","Ganix","Ganymedes","Gar","Garaile","Garaona","Garbrand","Garibald","Garikoitz","Garin","Garit","Garner","Garnet","Garnier","Garnot","Garnotin","Garoa","Garrat","Garratt","Garrelt","Garrett","Garrit","Garsille","Gartxot","Gartzea","Gartzen","Gartzi","Gascot","Gaskon","Gasteiz","Gastne","Gaston","Gau","Gauanes","Gauargi","Gaubert","Gauchier","Gaude","Gaudinus","Gaueko","Gaufrid","Gaufridus","Gaufroi","Gauguein","Gaumardas","Gaur","Gaut","Gautbehrt","Gautelen","Gauterit","Gauteron","Gautier","Gautzelin","Gauvain","Gauzelen","Gauzpert","Gavienus","Gavin","Gavinus","Gawayne","Gawen","Gawin","Gawn","Gawne","Gawter","Gawyn","Gawyne","Gaxan","Gaylord","Gaztea","Gebahard","Geberic","Gebhard","Geboin","Gebun","Geerd","Geertt","Geffe","Geffery","Geffrai","Geffray","Geffrei","Geffrey","Geffroi","Gefroi","Gefroy","Geike","Geleon","Gelfradus","Gelimer","Gelis","Gelo","Gelon","Gelther","Gemalfin","Gembert","Gemmel","Genethlius","Gennadios","Gennadius","Gentian","Gentien","Gento","Gentza","Geoff","Geoffrey","Geoffroi","Geofridus","Geordie","George","Georgie","Georgius","Georgus","Georgy","Ger","Gerald","Geraldo","Geraldus","Gerard","Gerardus","Gerasimos","Gerazan","Gerbert","Gerbertus","Gerbodo","Gerbotho","Gerente","Gereon","Gerfast","Gergori","Gerhardus","Gerhart","Gerier","Gerin","Gerjet","Gerlach","Gerlacus","Gerland","Germanus","Gernandus","Gerner","Gernier","Gero","Gerold","Geroldin","Geroldus","Gerolt","Gerontius","Gerould","Gerrart","Gerrit","Gerulf","Gerung","Geruntius","Gervais","Gervaise","Gervas","Gervasius","Gervassius","Gerv\xE8s","Gerv\xE8se","Gervesin","Gervesot","Gervis","Gerwald","Gesalec","Gesimund","Getica","Geuffroi","Geve","Gevehard","Gib","Gibbon","Gibby","Gide","Gidie","Gieffrinnet","Gifardus","Gifartus","Gifemund","Giff","Gifford","Gigo","Gil","Gilamu","Gilberd","Gilbertus","Gildon","Gile","Gilebert","Gilebertus","Gilebin","Gilen","Gilesindo","Gilet","Gilibertus","Gilius","Gill","Gillebertus","Gilles","Gillet","Gilliame","Gillius","Gillot","Gillotin","Gilmyn","Gilon","Gilonem","Gilot","Gilow","Gilpin","Gimmo","Giorgius","Gipp","Giradin","Giraldus","Girard","Girardus","Girars","Girart","Giraud","Giraudus","Giraut","Girbers","Giregilo","Giriaume","Girk","Giro","Giroldus","Girout","Giselberdus","Giseler","Gisfrid","Gisilbehrt","Gisilbert","Gislebertus","Giso","Gisulf","Gizon","Glaukias","Glaukos","Glaumunt","Glauperaht","Glycerius","Glycon","Gnipho","Goar","Gobelin","Gobert","Gobin","Goce","Gocelinus","Godafre","Godafried","Godard","Godart","Godbert","Goddas","Godebert","Godefray","Godefridus","Godefroi","Godefroy","Godefry","Godegisel","Godehard","Godeheard","Godelot","Godepert","Godesmannus","Godet","Godewinus","Godfery","Godfree","Godfreed","Godfrey","Godfry","Godichal","Godigisclus","Godila","Godilas","Godin","Godobald","Godohelm","Godscalcus","Goduin","Goduine","Godun","Godvynus","Goeuuin","Goffridus","Gogo","Goi","Goiaricus","Goin","Goisfrid","Goisfridus","Goiz","Goizeder","Goldin","Goldine","Golding","Goldkopf","Golduin","Goldwyn","Golias","Gomeric","Gomesano","Gonfroi","Gontier","Gora","Gorbea","Gordias","Goren","Gorgias","Gorgion","Gorgos","Gorgythion","Gorka","Gorosti","Gorri","Gosbert","Goscelin","Goscelinus","Gosfridus","Gotteschalk","Gottschalk","Gotwinus","Gotzon","Gotzstaf","Goubert","Goumelet","Gourdet","Gouththas","Gouzlim","Gozbert","Gozelinus","Gozolon","Gracien","Gracyen","Gralam","Grandoye","Granville","Gratian","Grawo","Grefin","Greg","Grege","Gregoras","Gregorius","Gregour","Grenville","Grifo","Grifon","Grigge","Grimald","Grimaldus","Grimbald","Grimbaldus","Grimbaud","Grimbol","Grimbold","Grimoald","Grimold","Gringoire","Gris","Grisigion","Grisigon","Gryllus","Gualter","Gualterius","Gualtier","Guarin","Guarinet","Guarinus","Guarnier","Guenes","Gu\xE9rart","Gueri","Gu\xE9rin","Guerinnet","Guermont","Guernier","Guernon","Guernot","Gui","Guiart","Guibe","Guibert","Guibour","Guichard","Guido","Guigue","Guilhabert","Guilhem","Guilielm","Guillame","Guillaume","Guille","Guillelmus","Guillemaque","Guillemet","Guillemin","Guillemot","Guillot","Guillotin","Guimar","Guimart","Guimer","Guimond","Guineboud","Guinemant","Guinemanz","Guinemar","Guinemat","Guiot","Guiraud","Guiraudet","Guiscard","Guischard","Gumpert","Gundehar","Gundiok","Gundo","Gundoald","Gundobad","Gundobald","Gunnulf","Guntard","Gunter","Gunteric","Gunterius","Gunterus","Gunthar","Gunthigis","Guntmar","Guntramn","Guntramus","Gunutz","Gunzelinus","Gurgos","Gurutz","Gusso","Gutthikas","Gutxi","Guyat","Guymar","Guyon","Gwalter","Gwatkin","Gwychardus","Gwydo","Gy","Gyffard","Gylaw","Gylbard","Gylbarde","Gylbart","Gylippos","Gylis","Gylmyne","Gylys","Gyrard","Gyras","Gyrtias","Haat","Hab","Habbe","Habbie","Habbo","Habreham","Hacon","Hacun","Hadubrand","Haemon","Hagarih","Hagen","Haggith","Hagias","Hagilo","Hagnon","Haguin","Haiete","Haimirich","Haimmon","Haimo","Haimona","Hairud","Haitz","Hal","Halebran","Halinard","Halisthertes","Halius","Halo","Haluin","Ham","Hamelen","Hamelin","Hameline","Hamelot","Hamen","Hamett","Hamilax","Hamilcar","Hamiscora","Hamlet","Hamlin","Hamlyn","Hammond","Hamnet","Hamon","Hamond","Hamonet","Hampsicora","Hamund","Handi","Hank","Hankin","Hann","Hannes","Hanni","Hannibal","Hannibalianus","Hanno","Hannon","Hano","Hanot","Hanry","Hans-Ruedi","Hapertus","Haquin","Harald","Haraldus","Harber","Harbert","Harchier","Harde","Hardegin","Hardi","Harding","Hardouin","Harduinus","Haribehrt","Hariberct","Hariman","Harimann","Haritz","Haritzeder","Hariwald","Harkaitz","Harm","Harman","Harmatidas","Harmocydes","Harmodios","Harmon","Haroldus","Harpagos","Harpalion","Harpalos","Harpernus","Harpocras","Harri","Harry","Hartmannus","Hartmudus","Hartmut","Hartz","Hary","Hascouf","Hasdrubal","Hats","Hauwe","Haveron","Hawkin","Haymo","Hebert","Hecataeus","Hecelin","Hedlef","Hegesandros","Hegesistratos","Hegetoridas","Hegoi","Heibert","Heidolfus","Heimart","Heimeri","Heimerich","Heimon","Heine","Heinricus","Heinz","Heirax","Heiron","Hektor","Helain","Heldebald","Heldefredus","Helenos","Helfricus","Helgaud","Helgesippos","Helgot","Helicaon","Helinand","Heliodorus","Helios","Helisachar","Helladius","Helle","Helmhart","Helouyn","Heloynet","Hemarc","Hemart","Hemeri","Hemmet","Hemmo","Hemonnet","Hendereye","Hendry","Hene","Henffen","Henfrey","Henko","Hennsmann","Henricus","Henriet","Henriot","Henseus","Hephaestos","Heraclius","Herakleides","Herakleitos","Heraklides","Heral","Herald","Herauso","Herbelot","Herbertus","Herbrand","Herchembaut","Herchier","Herculles","Herebert","Herensuge","Hereuuard","Herewardus","Herewart","Heribehrt","Heribert","Heribrand","Herilo","Heriot","H\xE9rique","Herluin","Herman","Hermangild","Hermannus","Hermeias","Hermenfred","Hermenigild","Hermenion","Herment","Hermeros","Herminafrid","Hermippos","Hermogenes","Hermolaos","Hermolycus","Hermon","Hermongenes","Hermotimos","Hernais","Hernaudin","Hernaut","Hernays","Hernegliscus","Hernouet","Hero","Herodes","Herodianus","Herodion","Herold","Herolt","Heromenes","Herould","Herriot","Herry","Hertwicus","Heruuord","Herve","Herveus","Hervey","Hervi","Herviet","Hervisse","Hervoet","Hervouet","Hervy","Hesdin","H\xE9touyn","Hetzkinus","Heude","Heudebrand","Heurle","Hew","Hewe","Hewelet","Hewelin","Hewerald","Hewet","Hewlett","Heymeri","Heymon","Hibai","Hibbe","Hibbo","Hicetaon","Hick","Hicket","Hickie","Hiero","Hieronymus","Higg","Hildebad","Hildebald","Hildeberht","Hildebold","Hildebrand","Hildebrandus","Hildebrant","Hildebrondus","Hildegaud","Hildeprand","Hilderic","Hilderith","Hildibrand","Hildigis","Hilduin","Hilfert","Hilmagis","Himel","Himerius","Himi","Himilco","Himnerith","Hincmar","Hinrich","Hipparchos","Hipparinos","Hippasus","Hippias","Hippoco\xF6n","Hippoklides","Hippokratides","Hippolytos","Hippomachos","Hippomenes","Hippon","Hipponax","Hipponicus","Hipponous","Hippotas","Hippothous","Hippotion","Hique","Hiram","Hiruz","Hisarna","Hitch","Hitchcock","Hitz","Hitzeder","Hlodver","Hluodohari","Hluodowig","Hnaufridus","Hob","Hobard","Hobb","Hobbie","Hocequin","Hodei","Hodge","Hodgkin","Hohepa","Hoiples","Hokianga","Holger","Holiver","Holo","Homeros","Hone","Honfroi","Honoratus","Honor\xE9","Honorius","Honot","Hootje","Hori","Hosbertus","Hosebert","Hosmundus","Hosmunt","Hotch","Hotu","Hotys","Hotz","Houdart","Houd\xE9et","Houdin","Houdoin","Houdouyn","How","Howard","Howkin","Hraban","Hremfing","Hroch","Hrodebert","Hrodgar","Hrodgaud","Hrodger","Hrodo","Hrodric","Hrodrich","Hrodulf","Hrotmar","Hrudolf","Hruodiger","Hruodland","Hruodpehrt","Huard","Huart","Hubard","Hubelet","Hubertus","Hubie","Huchon","Hud","Hudd","Hudde","Hue","Huebald","Huelin","Huet","Huffie","Hugelin","Huget","Hugethun","Huggett","Huggin","Hugh","Hughoc","Hugi","Hugin","Hugline","Hugo","Hugolinus","Hugon","Huguard","Hugubehrt","Hugubert","Hugue","Huguenin","Hugues","Huguet","Huidelon","Huidemar","Huirangi","Huitace","Hulmul","Humbert","Humfery","Humfredus","Humfrey","Humfridus","Humfrye","Huml","Humph","Humpherus","Humphery","Humphrey","Humpty","Hunald","Hunberct","Huneric","Hunfray","Hunfrid","Hunfridus","Hunigild","Hunimund","Hunout","Hunulf","Hunumund","Huolo","Huon","Huoul","Hupertus","Hurko","Hurmio","Huroin","Hurrey","Hustaz","Hutch","Hutchin","Hyakinthos","Hydatius","Hylas","Hyllos","Hyllus","Hypatius","Hypeirochus","Hypenor","Hyperenor","Hyperion","Hypsenor","Hyrcanus","Hyrtacus","Hyrtius","Iacobus","Iakchos","Iaki","Ialmenes","Iambulus","Iamus","Ianto","Ianuarius","Iasos","Iatragoras","Iatrokles","Iban","Ibanolis","Ibar","Ibba","Ibon","Ibykos","Icarion","Icarius","Icarus","Idaeus","Idaios","Idas","Idomeneus","Ieltxu","Ifebrand","Ignace","Ignatius","Igon","Ihazintu","Ihintza","Ihmel","Iigo","Ikatz","Iker","Ilari","Ilazki","Ilberd","Ilbert","Ilbertus","Ildebad","Ilioneus","Ilixo","Illart","Illyrius","Ilus","Imanol","Imbart","Imbert","Imbertus","Imbrasus","Imbrius","Imbrus","Imgelramus","Imninon","Inachos","Inachus","Inaki","Inaros","Inautzi","Indar","Indartsu","Inge","Ingelram","Ingelramnus","Ingelrandus","Ingelrannus","Ingeram","Ingerame","Ingraham","Ingram","Ingramus","Ingran","Ingrannus","Inguma","Inigo","Inko","Inna","Innocentius","Intxixu","Iobates","Ioco","Iolaos","Iollas","Ion","Ionnacius","Ionnes","Iordanes","Ioritz","Ioseph","Iosephius","Iosephus","Iovinus","Iovivus","Ipar","Iparragirre","Iphiclus","Iphicrates","Iphikrates","Iphinous","Iphitos","Iphitus","Ipolitus","Ippolitus","Ippollitt","Iraitz","Iratxo","Iratze","Iratzeder","Iraunkor","Irenaeus","Irnerius","Irnfried","Iros","Irrintzi","Iruinea","Irus","Isaaces","Isaacius","Isagoras","Isambard","Isandros","Ischenous","Isembard","Isembart","Isemberd","Isembert","Isenbard","Isenbardus","Isidor","Isidoros","Isidorus","Ision","Ismaros","Ismenios","Iso","Isocrates","Isodemos","Isokrates","Isore","Isusko","Itheus","Iturri","Itxaso","Itylus","Itys","Itzaina","Itziar","Ive","Ivo","Ivon","Ivone","Ivor","Ivote","Ivvanus","Ixaka","Ixidor","Ixona","Izaskun","Izotz","Iztal","Jabbe","Jabbo","Jabnit","Jacobo","Jacquelin","Jaime","Jaizki","Jakelin","Jakes","Jakobe","Jakue","Jal","Jangleu","Janpier","Janto","Japhet","Jarto","Jarvis","Jasce","Jasone","Jatsu","Jaunti","Jaunzuria","Jean","Jeff","Jeffcock","Jeffery","Jeffroy","Jeffry","Jehan","Jeharraz","Jehaue","Jelde","Jellrich","Jellste","Jenico","Jep","Jeph","Jeremi","Jervis","Jessamy","Jevan","Jewell","Jibbe","Jibbo","Jilde","Joannes","Job","Jobba","Joce","Jocelin","Jocelyn","Jocet","Joceus","Jo\xE7on","Jodocus","Joel","Joeli","Joffridus","Jofridus","Johan","Johannes","John","Johun","Jokin","Jolanus","Joldewin","Jolin","Jolis","Jollan","Jollanus","Jollivet","Jolyon","Jonas","Jonathas","Jop","Joppa","Joppo","Jordanes","Joren","Jorin","Joris","Josce","Joscelin","Joscelyn","Josclyn","Joseba","Josepe","Joss","Josse","Josson","Josu","Jourdain","Jowell","Jozeran","Juan","Juaneizu","Juango","Juantxiki","Judbert","Jude","Judo","Juel","Juerg","Julen","Jules","Julf","Julianus","Julien","Julyan","Jumel","Jupp","Jurdan","Jurfaret","Jurg","Jurgi","Jurke","Juste","Kacili","Kadmos","Kaenas","Kaeneus","Kahu","Kahumanu","Kahutea","Kai","Kaiet","Kalchas","Kalesius","Kaletor","Kalliaros","Kallias","Kallikles","Kallikrates","Kallimachos","Kallinicus","Kallinos","Kallipides","Kallipos","Kallisthenes","Kallon","Kameirus","Kamira","Kandaules","Kandaulo","Kannadis","Kapaneus","Kapys","Karipos","Karles","Karmel","Karolus","Karopophores","Kasen","Kasos","Kassandros","Kauldi","Kaunos","Kaxen","Kebalinos","Kebes","Kekrops","Kelemen","Kelmen","Kemen","Kenard","Kendrick","Keneweard","Kenewrec","Kennard","Kenric","Kenricus","Kenweard","Kenwrec","Keop","Keos","Kepa","Kephalon","Kephalos","Kerameikos","Kereama","Kerehi","Kerkyon","Kerrich","Keteus","Kiliz","Kimetz","Kimon","Kirphis","Kismi","Kittos","Klaes","Klaus","Kleitos","Kleobis","Kleomenes","Koert","Kohuru","Koines","Koinos","Koldo","Koldobika","Konon","Koob","Koragos","Korax","Kosmas","Krantor","Krateros","Kreon","Krinippos","Krino","Kristos","Kritias","Kritoboulos","Kritodemos","Kriton","Kroisos","Krokinos","Ktesiphon","Kuonrat","Kupe","Kusko","Kyknos","Kynaegeiros","Kyrillos","Kyrios","Kyros","Labdacus","Labotas","Lactanius","Ladislaus","Laertes","Lafele","Lagariman","Lagos","Lagot","Laiamicho","Laico","Lain","Laios","Lallo","Lamachos","Lambard","Lambekin","Lambelin","Lambequin","Lambert","Lambertus","Lambin","Lambkin","Lamissio","Lammert","Lampo","Lampon","Lampridius","Lampus","Lamus","Lancelet","Lancelin","Lancelot","Lancelyn","Landebert","Lander","Landico","Lando","Landoberct","Landri","Lanfranc","Lanslet","Lanzo","Laodamas","Laodocus","Laogonus","Laomedon","Laphanes","Lapurdi","Larance","Larendi","Larenz","Larkin","Larra","Lartaun","Laskaris","Lasos","Lasthenes","Lastur","Latinius","Lauaxeta","Laudus","Launce","Launceletus","Launcelot","Launobaudus","Launselot","Launus","Laureion","Laurencius","Laurent","Laurentius","Laurentzi","Laurgain","Laurin","Lawrence","Leagros","L\xE9al","Leandros","Learchos","Leavold","Lebuin","Lecapenus","Ledger","Leert","Leferich","Leffeyne","Lefric","Lefrich","Lefricus","Lefuuinus","Lefwinus","Lefwyne","Leger","Lehen","Leheren","Lehior","Lehoi","Leicritus","Leigh","Leitus","Leizarraga","Lekubegi","Lel","Lemnus","Lennard","Lennor","Lentfridus","Leo","Leocedes","Leodegar","Leodes","Leofard","Leofricus","Leofuuin","Leofuuinus","Leoiar","Leon","Leonardus","Leonel","Leonhard","Leonidas","Leonidem","Leonnatos","Leontiades","Leontis","Leontius","Leoprepes","Leoric","Leotychides","Leouric","Leouuinus","Leovigild","Ler","Lertxun","Letard","Lethos","Leucippus","Leudbald","Leufred","Leufroy","Leukos","Leuric","Leutfrid","Leuthere","Leuuin","Leuuine","Leuvibild","Leveridge","Levin","Lewenhart","Lewin","Lewine","Lewis","Liafwine","Lichas","Licymnios","Lie","Liebte","Li\xE8ce","Liellus","Lienart","Ligart","Ligier","Liher","Lijart","Linus","Lion","Lionet","Liudhard","Liudolf","Liukardis","Liulf","Liutbald","Liutbalt","Liutpert","Liutprand","Liutward","Livila","Lizar","Lizardi","Lo","Lodewicus","Loert","Lohitzun","Loiola","Lon","Looys","Lope","Loramendi","Lordi","Lore","Loren","Lorence","Lorencin","Lorens","Lorent","Lorenz","Lori","Lorrenz","Lothar","Loup","Louth","Louve","Louvel","Love","Lovel","Lovell","Loverich","Loverick","Lovet","Lowis","Lowrens","Lowrie","Loxias","Loys","Loyset","Luar","Lubbert","Lucianus","Lucien","Ludewicus","Ludoldus","Ludovicus","Ludwig","Luhre","Luitfridus","Luitgarde","Luitpold","Luix","Luk","Luken","Luki","Lukos","Lul","Luli","Lull","Luppe","Lutet","Lutjen","Luzaide","Luzea","Lvfridus","Lycaon","Lycaretos","Lycidas","Lycomedes","Lycophon","Lycophron","Lycoris","Lycurgos","Lycus","Lydus","Lyell","Lygdamis","Lykomedes","Lykon","Lynceus","Lyolf","Lyon","Lyonel","Lyonell","Lyonis","Lysagoras","Lysandros","Lysanios","Lysias","Lysikles","Lysimachos","Lysippos","Lysippus","Lysis","Lyulf","Lyulph","Macar","Macarias","Macedonius","Machaon","Madulnus","Maelgut","Maeon","Magahard","Maganhard","Maginfred","Maginrad","Maginulf","Magnentius","Mago","Maharbal","Mahond","Mahu","Mahutia","Maiandrios","Maillart","Maillet","Mainard","Mainardus","Mainet","Mainnet","Maiorga","Maiuel","Maixent","Majorian","Maju","Makarios","Malabayn","Malapallin","Malbert","Malcolinus","Malcolum","Malcude","Malculinus","Malculms","Malculmus","Malduit","Maleos","Males","Malger","Malise","Mallobaudes","Malo","Malpramis","Malprimis","Malquiant","Malun","Mamme","Mana","Manard","Manex","Manfred","Mangod","Manifred","Manoa","Mansuetus","Mantes","Mantio","Mantios","Mantzio","Manu","Manzio","Maore","Mapen","Maraulf","Marc","Marcel","Marcian","Marcion","Marcomir","Marcoul","Marcule","Marcus","Marganice","Margaris","Maricho","Maricus","Marin","Marius","Marke","Markel","Marko","Markus","Marlo","Marmaduc","Marmaducus","Marmedoke","Marnes","Maro","Maron","Marquardus","Marque","Marques","Marsile","Marsilion","Marsyas","Martel","Martelet","Marthanes","Martin","Martinet","Martinianus","Martino","Martinus","Martlet","Martxel","Martxelin","Martxot","Martyn","Martyrius","Maruthus","Marz","Maso","Masso","Mastor","Matai","Matei","Matfrid","Mathos","Matia","Matraien","Mattin","Matto","Matullus","Matxin","Maucolyn","Mauger","Maugis","Maukolum","Maule","Maulore","Maurentius","Maurianus","Mauricius","Maurie","Maurin","Maurinus","Mauris","Maurus","Maury","Maus","Mausolos","Maxentius","Maximianus","Maximin","Maximinus","Maynard","Mazo","Mazuste","Mazzi","Mecistes","Mecistios","M\xE9dard","Meder","Mederi","Medios","Medon","Medus","Meffridus","Megadates","Megakles","Megakreon","Megapenthes","Megareus","Megas","Megasthenes","Megathenes","Meges","Meginhard","Megistias","Megistus","Mehme","Meidias","Meiel","Meimert","Meine","Meinfridus","Meingotus","Melampos","Melampus","Melanippos","Melanthios","Melanthos","Melas","Melchert","Meleagros","Melegros","Meles","Meletius","Meliboeus","Melicertes","Mello","Melmer","Melmidoc","Melminius","Meme","Memnon","Menalcas","Menandros","Menares","Menas","Mendebal","Mendiko","Menekrates","Menelaos","Menestas","Menesthes","Menesthios","Menexinos","Mengotus","Menke","Menne","Mennte","Menoeces","Menoitios","Mentes","Mentor","Merbal","Mercadier","Mercurius","Merick","Meriet","Merigot","Meriones","Mermadak","Mermerus","Merobaudes","Merops","Merovech","Mervin","Mervyn","Mesaulius","Mesthles","Metallo","Methodios","Methodius","Metiochus","Meto","Meton","Metrobius","Metron","Metrophanes","Meuric","Meurik","Meurisse","Meurius","Meus","Mezzi","Michael","Michaelius","Michele","Michell","Micythos","Midas","Midylos","Miguel","Mihali","Mihi","Mikel","Mikelar","Mikelats","Mikeldi","Mikkos","Mikolas","Mikon","Milanion","Mile","Miles","Milet","Milian","Milo","Milon","Milot","Miltiades","Mimke","Min","Minos","Mintho","Miquiel","Mirande","Misenus","Mittainne","Mitxaut","Mitxel","Mnasyllus","Mnesiphilos","Mnester","Mnesus","Modaharius","Modares","Moeris","Mogel","Moliones","Molpagoras","Monoecus","Monomachus","Montxo","Mopsius","Mopsus","Mor","Morcock","Morel","Mores","Moricius","Morin","Moris","Morise","Moriset","Morrice","Morris","Morry","Morsimus","Morys","Moryse","Moschion","Moschus","Mourice","Muato","Mulius","Munderic","Mundo","Mundus","Munifrid","Munio","Munizo","Musaeus","Musaios","Musko","Musonius","Muttines","Mutu","Mydon","Mygdon","Myles","Myrsinus","Myrto","Mys","Nab","Nabar","Nadilo","Nagal","Nahia","Naimes","Naimon","Namatius","Namus","Nanno","Narkissos","Nastes","Naubolus","Naukles","Naulabates","Nausithous","Nauteus","Nazares","Neal","Neale","N\xE9apolion","Nearchos","Ned","Neddie","Neel","Neil","Nel","Nele","Neleos","Nell","Nelpus","Neokles","Neoptolemos","Neozzo","Nepotian","Neritos","Nestor","N\xE9velet","Ngakaukawa","Ngati","Niarchos","Nibelungus","Nicaise","Nicandros","Nicanor","Nicephorus","Nicetas","Nicetius","Nicholas","Nicholaus","Nichomachus","Nicias","Nicodromos","Nicolao","Nicolaus","Nicomachos","Nicon","Nidada","Nidungus","Niel","Nigelle","Nigellus","Nigs","Nihe","Nikandros","Nikanor","Nikasios","Nikeratos","Niketas","Nikias","Nikola","Nikomachos","Nikomedes","Nilus","Nino","Nireus","Nisos","Nithard","Niuzilo","Nivelet","Nob","Noe\xEB","No\xEBl","Noemon","Noll","Nolly","Nomion","Nonnosus","Nonnus","Norbert","Nordbert","Nordemann","Note","Nothon","Notker","Nott","Numa","Nuno","Nute","Nutkin","Nutt","Nuxila","Nyctinus","Nygell","Nymphicus","Nymphodorus","Obeko","Obert","Ocealus","Ochesius","Ochos","Ocke","Ocytos","Odaenathus","Odard","Odde","Oddo","Ode","Odger","Odibrand","Odinel","Odius","Odo","Odoin","Odol","Odon","Odotheus","Odouart","Odovacar","Odulf","Odysseus","Oeagnus","Oecleus","Oedipus","Oenemaus","Oeneus","Oenomaus","Oenopion","Oenops","Oenus","Oger","Ogerius","Oggery","Oggod","Ogier","Oicles","Oidor","Oier","Oihan","Oihenarte","Oileas","Oinatz","Oinaz","Olentzaro","Oliatos","Oliva","Olivere","Oliverus","Olivier","Olli","Ollier","Olly","Olo","Oltmann","Olus","Olver","Olybrius","Olympicus","Olympio","Olympiodorus","Olympius","Omer","Omerus","Omont","Onamakritos","Onbera","Ondart","Onesilos","Onesimos","Onesiphorus","Onetas","Onetor","Onfroi","Ongile","Onias","Onke","Onne","Onno","Onntje","Onomastos","Onuphrius","Ophelestes","Opilano","Opilio","Opites","Ops","Orable","Orain","Orcus","Orderic","Orell","Orestes","Oresus","Orges","Oriabel","Oriabiaus","Oribasius","Origen","Orion","Orius","Orixe","Orkatz","Orland","Oroites","Oroitz","Orpheus","Orrick","Orsilochus","Orsiphantes","Orthaeus","Orti","Ortle","Ortolfus","Ortwinus","Ortzi","Orythroneus","Orzaize","Osasun","Osbarn","Osbern","Osbernus","Osbertus","Oscar","Oseberne","Osebertus","Osewold","Osgar","Osgarus","Oskarbi","Oskell","Osketel","Oskitz","Osman","Osment","Osmon","Osmond","Osmont","Osmundus","Osoitz","Ospetsu","Ospin","Ostadar","Ostargi","Ostots","Ostrogotha","Osuin","Osuuald","Osuualdus","Osuuol","Osuuold","Osuuoldus","Oswall","Oswell","Oswinus","Oswold","Oswyn","Otebon","Otelin","Otes","Othes","Othi","Otho","Othon","Othone","Othuel","Oti","Otis","Otker","Otois","Oton","Otreus","Otrynteus","Otsando","Otsoa","Otsoko","Ottie","Ottig","Otto","Otuel","Otus","Oudart","Oudet","Oudin","Oudinet","Oudinnet","Ouein","Ouen","Ouin","Oure","Ourri","Ouus","Ovida","Owain","Owayne","Owen","Oweyn","Owin","Owine","Owini","Owun","Owyne","Oxarra","Oxel","Ozwell","Pablo","Pacatian","Pachymeres","Pae\xEBon","Paen","Pagane","Paganel","Paganus","Pagen","Pagomari","Paikea","Pain","Paios","Pair","Palaechthon","Palaemon","Palamas","Palladius","Pallans","Pallas","Palmys","Palque","Pammon","Pamphilus","Panaetios","Panaetius","Panares","Pancras","Pancratius","Pandaros","Pandion","Pandulf","Panionos","Panites","Pankratios","Pannet","Panpili","Pantagathus","Pantares","Panteleon","Panthous","Pantites","Pantzeska","Panuel","Paopeus","Paora","Papias","Papin","Paraebates","Parcin","Pardus","Paris","Pariset","Parmenides","Parmenion","Parsefal","Parthenius","Parthenopaeus","Parzifal","Paschalis","Pasion","Paskal","Pastor","Pataicos","Pate","Paterick","Paternus","Patey","Paton","Patrice","Patricius","Patriz","Patrobas","Patrobus","Patroclus","Patron","Patrycke","Patsy","Pattin","Pattrik","Patxi Frantxizko","Patza","Paulaui","Paulin","Paulo","Paulus","Pausanius","Payn","Payne","Paynel","Pedaeus","Pedasus","Pedocles","Pegarius","Peirithous","Peiros","Peisandros","Peithon","Pelagius","Pelagon","Pelegon","Peleus","Peli","Pelias","Pelicles","Pello","Pelonus","Pelopidas","Peneleos","Peneus","Pentheus","Penthylos","Peolpidas","Pepin","Perceval","Percevale","Percheval","Percival","Percivale","Perctarit","Percyvallus","Percyvell","Perdikkas","Perdix","Peregrine","Peregrinus","Periandros","Periclymenus","Perieeres","Perigenes","Perikles","Perimedes","Perimos","Periphas","Periphetes","Periscus","Peritas","Periumus","Perrando","Persefall","Persivell","Peru","Peruanton","Perutxo","Pes","Peteos","Petri","Petrigai","Petronas","Petruche","Petrus","Peukestes","Phaedo","Phaenippos","Phaeops","Phaestus","Phaidon","Phaidriades","Phalanthus","Phalces","Phalinos","Phanagoras","Phancis","Phanes","Phanias","Phantias","Phareman","Pharnaces","Phausius","Phegeus","Pheidias","Pheidippides","Pheidon","Phelipe","Phelipot","Phelippe","Phelippot","Pheliset","Phelyp","Phelypp","Phemius","Phereclus","Pherecydes","Pheres","Pheronactus","Phidias","Phigaleios","Phil","Philagrius","Philagros","Philaon","Philaretus","Philbert","Philcox","Phileas","Philemon","Philetor","Philibert","Philiot","Philip","Philipon","Philipot","Philippe","Philippicus","Philippot","Philippus","Philiskos","Philistos","Philkin","Phillipos","Phillippus","Phillipus","Philocion","Philocrates","Philoctetes","Philocypros","Philoetius","Philogus","Philokles","Philokrates","Philolaos","Philologus","Philomen","Philomenes","Philometer","Philon","Philonikos","Philopoemon","Philostratos","Philostratus","Philotas","Philotectes","Philoxenos","Philoxenus","Philpoemon","Philpot","Phineus","Phintias","Phipp","Phitelet","Phlaris","Phlegon","Phlios","Phoebammon","Phoenix","Phoibus","Phoinix","Phoitios","Phokas","Phokion","Phorbas","Phorcys","Phormion","Phormos","Photinus","Photius","Phrixus","Phrynichos","Phrynikos","Phrynon","Phylacus","Phylas","Phylypp","Phytheon","Phythian","Pi","Piarres","Piccolet","Picot","Pidytes","Pierre","Pierres","Pigres","Piligrim","Pinabel","Pinder","Pip","Pippin","Piri","Pirithoos","Pirmin","Pisistratos","Pistias","Pitama","Pittacos","Pittacus","Pittheus","Pixodarus","Pizzo","Plades","Platiau","Pleistarchos","Pleistos","Plutarch","Plutinus","Podaeleirus","Podaleirus","Podalinus","Podarces","Podargos","Podaroes","Podes","Poeas","Poecas","Poimen","Poince","Poincet","Polemion","Polentzi","Poliadas","Pollio","Polyas","Polybius","Polyctor","Polydectes","Polydeuces","Polydius","Polydoros","Polyeides","Polygonus","Polykleitos","Polykles","Polykritos","Polymedes","Polyneices","Polypemon","Polyperchon","Polyphemous","Polyphetes","Polyphontes","Polypoetes","Polyxeinus","Ponce","Poncet","Ponche","Ponteus","Popin","Popiniau","Poppa","Poppe","Poppens","Poppo","Porchier","Porphyrios","Porphyrius","Poseidon","Posides","Posidonios","Potamius","Potamon","Potkin","Poufille","Poz","Prades","Praesentinus","Praetextatus","Pratinos","Praxilaus","Praxis","Praxiteles","Praxites","Presebal","Prexinos","Priam","Priamon","Pricion","Principius","Prinetadas","Priscian","Priskos","Probus","Procrustes","Proctus","Proetus","Prokles","Prokopios","Prokrustes","Proreus","Protagoras","Protesilaus","Prothoenor","Prothous","Protogenes","Protus","Proxenos","Prymneus","Prytanis","Ptolemaios","Ptolomaeus","Pudes","Puhi","Pupt","Puvis","Pylades","Pylaemenes","Pylaeus","Pylartes","Pylas","Pylenor","Pyris","Pyrrhus","Pythagoras","Pytheas","Pythes","Pythios","Pythogenes","Quabin","Quenall","Quintin","Quintinus","Quito","Raaf","Rab","Rabbie","Rabel","Radagaisus","Radamanthos","Radigis","Radoald","Radolf","Radulf","Radulfus","Rafe","Raff","Raffo","Rafold","Raganald","Raganfrid","Raganhard","Raganher","Ragenald","Raginhart","Raginmund","Raginpert","Ragnfred","Raguenel","Raguet","Rahere","Rahier","Raignald","Raiimond","Raimbaud","Raimbaut","Raimer","Raimond","Raimund","Raimundus","Rainald","Rainaldus","Rainard","Rainerius","Rainerus","Rainier","Raitin","Ralf","Rammius","Rampo","Ran","Ranald","Rand","Randal","Randall","Randle","Randolph","Randoul","Randulfus","Randull","Randy","Rangi","Rankin","Rannulf","Rannulfus","Ranulf","Ranulfus","Ranulph","Ranulphus","Raolet","Raolin","Raollet","Raollin","Raoul","Raoulet","Raoulin","Rasequin","Ratchis","Ratier","Ratilo","Rauf","Rauffe","Raulf","Raullin","Raulyn","Rausimod","Rautio","Rauve","Rawkin","Rawlin","Raymundus","Raynaldus","Rayner","Raynerus","Raynoldus","Razo","Recared","Reccared","Recceswinth","Rechiar","Rechimund","Recitach","Redway","Reginald","Reginalde","Reginaldus","Reginar","Regino","R\xE9gnier","Reignald","Reignolde","Reimfred","Reimond","Reimund","Reinald","Reinboldus","Reinfred","Reinfrid","Reinfridus","Reinhold","Reinold","Reinoldus","Reipert","Rekitach","Remert","Remfrey","Remi","Remia","Remier","Remir","Remismund","Remmer","Remon","Remondin","Remonnet","Remont","R\xE9my","Renard","Renart","Renaud","Renaudin","Renaut","Renfred","Renfry","Renier","Renko","Reno","Renodet","Renoldus","Renonys","Renost","Renouart","Renouf","Renout","Reolus","Respa","Resse","Retemeris","Reto","Rewa","Rex","Reymnd","Reynald","Reynard","Reynaud","Reyner","Reynfred","Reynfrey","Reynold","Reynoldus","Rhadamanthos","Rhesus","Rhexenor","Rhima","Ribald","Ribes","Ricard","Ricardus","Ricaud","Rich","Richal","Richarde","Richardin","Richardus","Richart","Richemanus","Richeut","Richie","Richier","Richomer","Richomeres","Ricimer","Rick","Rickert","Ricket","Ricohard","Ricon","Rictiovarus","Rikiar","Ringerus","Rionet","Ripertus","Rique","Riquebourc","Riquier","Riso","Rizon","Rob","Robard","Robbie","Rober","Robertus","Robin","Robinet","Robion","Robyn","Rocelinus","Rodbertus","Roderic","Roderick","Rodney","Rodolf","Rodolph","Rodolphe","Roduulf","Rogatus","Rogerin","Rogerius","Rogerus","Roget","Rogier","Roguelin","Roland","Rolandus","Rolant","Roley","Rolf","Rolfe","Rolft","Rolland","Rollant","Rollin","Rollo","Rolph","Romainne","Romayne","Romuald","Ronald","Roncin","Rongo","Roolf","Roricus","Roscelin Rocelin","Rosser","Rostand","Rotari","Rotbert","Rotbertus","Rotgerius","Rothad","Rothari","Rotrou","Roucaud","Rouland","Roulant","Roule","Roulf","Roumain","Roumiet","Rowland","Rowley","Ruald Ruaud","Rubertus","Rudegerus","Rudesind","Rudolfus","Rufier Rufin Rufus","Ruisko","Runo","Russell Roussel","Rusto","Ruthardus","Rychard","Rycharde","Saba","Sabas","Sabin","Sabyllos","Sadagares","Sadun","Saer","Saerus","Safrax","Sagar","Sagard","Sagarus","Saillot","Sainte Santin","Salbatore","Salicar","Salla","Salmoneus","Samer","Samo","Samson","Sandaili","Sander","Sanders","Sandre","Sandrin","Sanduru","Sandy","Sangiban","Sanguin","Sansalas","Santi","Santikurtz","Santio","Santutxo","Santxo","Santxol","Saphrax","Sarapammon","Sarilo","Sarpedon","Sarus","Sasoin","Satabus","Satordi","Satyros","Saunder","Saundre","Savaric Savary","Sawney","Sawnie","Saxo","Sayer","Scaios","Scamandius","Scamandrius","Schedius","Scholasticus","Sconea","Scylax","Scyllias","Scythas","Searl","Searle","Seaward","Sebastianus","Sebastos","Seber","Sede","Segar","Segarus","Segeric","Seguin","Sehier Syhier","Sein","Seisames","Selagus","Selatse","Seldomus","Selenas","Selepos","Seleukos","Selle","Selles","Seme","Semeno","Sendoa","Senebaut","Sengrat","Senuthius","Sequin","Serell","Sergius","Seri","Serill","Serle","Serlo","Serlon","Sernays","Serrell","Serrill","Sesuldo","Seuuard","Seuuardus","Seven","Sevestre","Sevrin","Sewal","Sewale","Sewallus","Seward","Sewell","Shapur","Shilgen","Shipitbaal","Sibertus","Sibico","Sibilo","Siboldus","Sibragtus","Sibratus","Sicard Sicho Sicre","Sicho","Sicinnos","Siculus","Sidimund","Siebrand","Siefke","Siegmyrth","Sifridus","Sigan","Sigebert","Sigenandus","Sigeric","Sigesar","Sigibald","Sigibert","Sigibuld","Sigismund","Sigisvult","Sikke","Silanos","Silban","Silenos","Silvestre","Simmias","Simo","Simocatta","Simoisius","Simonides","Sindel","Sindila","Sindo","Sinibaldo","Sinis","Sinon","Sippas","Sirion","Sirom","Siromos","Sisbert","Sisebut","Sisenand","Sisyphus","Sito","Sittas","Situli","Sivis","Siwardus","Sjamme","Skiron","Smaragdus","Smindyrides","Smintheus","Snaracho","Snarung","Snato","Snazi","Soas","Socus","Sohalet Soolet","Sohier","Soin","Soke","Sophanes","Sophokles","Soranus","Sosibios","Sosicles","Sosigines","Sosilus","Sosimenes","Sosipatros","Sosthenes","Sostias","Sostratos","Soter","Sotil","Souni Sonnet","Speciosus","Spertias","Speudon","Speusippos","Spinther","Spirodion","Staas","Stace","Stacey","Stachys","Stacius","Stacy","Stallo","Starchari","Stauracius","Steffen","Stentor","Stephane","Stephen","Stesagoras","Stesanor","Stesilaus","Sthenelaus","Sthenelus","Stichius","Stielf","Stilicho","Stolos","Strabo","Strachys","Strategius","Stratios","Straton","Strophantes","Strophius","Strymon","Su","Suatrius","Sueridus","Sugar","Suger","Sugoi","Suidbert","Suidger","Sumar","Sunericus","Sunnia","Sunno","Suntje","Suppo","Sustrai","Sweert","Swikerus","Swirt","Swittert","Syagricus","Syagrius","Syagros","Syennesis","Syloson","Sylvester","Symeon","Symeonius","Synesius","Syriack","Syward","Sywardus","Tadica","Taiaho","Taillefer","Taillemache","Taine","Taino","Taki","Talaemenes","Talaos","Talaus","Talbot","Talebot","Tallo","Talon","Talos","Talthybios","Tam\xE1s","Tame","Tamme","Tanais","Tanca","Tancard","Tancred","Tancrede","Tane","Tankard","Tarchaniotes","Tarchon","Tardu","Tartalo","Tassart Tassot Tassin","Tassilo","Tato","Taua","Taunui","Taureas","Taurin","Tawno","Te","Tebaeus","Tebald","Tebaud","Tebbe","Tecton","Tedbaldus","Tedric","Teebald","Teias","Teiresias","Teja","Te Kori","Tekukuni","Telamon","Telekles","Telemacho","Telemachos","Telemachus","Telephos","Telephus","Telesinus","Telesphorus","Telines","Tellias","Tellis","Tello","Telys","Tem","Temenos","Temuera","Tendao","Tenes","Tenny","Tenthredon","Teodbald","Teodric","Tere","Tereus","Tericius","Terillos","Terrell","Terric","Terrick","Terricus","Terry","Tescelin","Tetbald","Tetramnestus","Tettrino","Teucer","Teukros","Teutamos","Teuthranes","Teuthras","Teutobod","Tevenot","Thales","Thaleus","Thalpius","Thalysios","Thancharat","Thancheri","Thancred","Thankmar","Tharuaro","Tharybis","Thaulos","Thaumastus","Theagenes","Theages","Theas","Theasides","Thebaldus","Thee","Thela","Themistius","Theobald","Theobaldus","Theocharistus","Theoclymnius","Theoctistus","Theocydes","Theodahad","Th\xE9odard","Theodbald","Theodehad","Theodekles","Theodemar","Theodemer","Theoderic","Theodericus","Theoderid","Theodilacus","Theodo","Theodoracius","Theodore","Theodoretus","Theodoric","Theodoricus","Theodoros","Theodorus","Theodotus","Theodric","Theodulf","Theodulph","Theodulus","Theogenius","Theognis","Theomestor","Theomestros","Theon","Theopemptus","Theophanes","Theophilius","Theophilus","Theophrastos","Theophrastus","Theophylact","Theophylactus","Theophylaktos","Theopompos","Theopompus","Theopropides","Theoros","Theos","Theotimus","Theotpert","Theramenes","Therapon","Theras","Thero","Theron","Thersandros","Therseandros","Thersilochus","Thersites","Thessalos","Thestor","Thettalos","Theudebert","Theudegisel","Theudegisklos","Theuderic","Theudis","Theudoald","Theudobald","Theutgaud","Theutlich","Thibaud","Thidrek","Thi\xE9baut","Thieme","Thiemmo","Thierri","Thierry","Thietmar","Thilko","Thim","Thirkell","Thiudimir","Thiudorieks","Thoas","Thomas","Thon","Thonyn","Tho\xF6n","Thorald","Thorax","Thore","Thorismud","Thorismund","Thorkill","Thorold","Thouche","Thrasamund","Thrasaric","Thrasidaios","Thrasilaus","Thrasius","Thrasybulos","Thrasyllus","Thrasymedes","Thraustila","Threspotus","Thrustanus","Thrystan","Thukydides","Thurstan","Thurstanus","Thurstin","Thybaudin","Thybaut","Thyestes","Thymoetes","Thymotes","Thyrsis","Thyrsos","Tiaki","Tiakinga","Tib","Tibald","Tibalt","Tibaut","Tibbald","Tibbott","Tibost","Tibout","Tiebaut","Tiele","Tierri","Tiessot","Tika","Timagenidas","Timagoras","Timais","Timanthes","Timasion","Timasitheus","Timesithius","Timm","Timnes","Timo","Timoleon","Timon","Timonax","Timote","Timotheus","Timoti","Timoxenos","Timozel","Tinnelt","Tipi","Tiro","Tirrell","Tirynthius","Tisamenos","Tisandros","Tisias","Tithonius","Titormos","Tityrus","Tjalf","Tjark","Tlepolemus","Tmolus","Toa","Tobar","Todor","Tom\xE1s","T\xF6njes","Torleu","Torphin","Torquil","Totakoxe","Totila","Trafstila","Trapsta","Trasaric","Trasaricus","Trasimondo","Trechus","Tribigild","Tribonianus","Tribunas","Triopas","Triptolemus","Tristan","Tristian","Triston","Tristram","Triton","Troezenus","Trophimus","Trophnus","Tros","Trostheri","Trostila","Truhtilo","Trustan","Trustram","Trypho","Trystrem","Tuaivi","Tufa","Tuluin","Turbertus","Turgis","Turold","Turoldus","Turpin","Turquan","Turrianus","Turstan","Turstanus","Tursten","Turstin","Turstinus","Tuste","Tutain","Tuu","Tuyon","Txanton","Txaran","Txartiko","Txatxu","Txerran","Txeru","Txilar","Tximitx","Txindoki","Txomin","Txordon","Txurio","Tybalt","Tybaut","Tybost","Tybout","Tychaeus","Tydeides","Tydeus","Tymnes","Tyndareus","Tyndarios","Tyon","Tyrell","Tzimisas","Tzittas","Ubarna","Ubben","Ubelteso","Ubendu","Ucalegon","Ucco","Uchered","Ucke","Uctred","Udalaitz","Udo","Udona","Uelert","Ueli","Ugaitz","Ughtred","Ugurtz","Ugutz","Uhin","Uhredus","Uhtred","Uidt","Ulert","Ulfert","Ulfilas","Ulger","Ulpt","Ulricus","Ulta","Uluric","Umea","Umfray","Umfrey","Umfridus","Umphrey","Unai","Unax","Unigild","Unila","Unimund","Uno","Unsenis","Untel","Uptet","Ur","Uraias","Uranius","Urbasa","Urbez","Urbicus","Urdaspal","Urdin","Urian","Urianus","Urien","Urki","Urko","Urre","Urritz","Urs","Urtats","Urti","Urtsin","Urtsua","Urtun","Urtungo","Urtzi","Uryene","Uwe","Uwen","Uzuri","Vaanes","Vacho","Vagdvaraestus","Valamer","Valamir","Valantinus","Valaravans","Valdebron","Valentinus","Valia","Valter","Vandalarius","Vandil","Vane","Vannes","Varazes","Varin","Varocher","Vasacius","Vasey","Vauquelin","Vedast","Veduco","Veitel","Venantius","Venerandus","Venyse","Vetericus","Vetranio","Vetranis","Vettias","V\xE9zian","Viator","Vicelin","Victor","Victorinus","Vidans","Videric","Vidigoia","Vidimir","Viel","Viennet","Vigilius","Vigor","Viliame","Viliaris","Vilihame","Villiame","Vince","Vincenot","Vincent","Vincentius","Vincey","Vinitharius","Virus","Visimar","Vital","Vitalianus","Vitalius","Vitel","Vithimiris","Vithmiris","Vitigis","Vittamar","Vitus","Vivianus","Vivien","Volusian","Vulmar","Vultuulf","Vvillequin","Vyell","Waco","Waibilo","Waido","Waihoroi","Waimar","Waimiria","Waiofar","Waisale","Wala","Walahfrid","Walahmar","Walaric","Walchelim","Walchelin","Walcher","Waldef","Waldeof","Waldeve","Waldew","Waldhar","Waldhere","Waldibert","Waldief","Waldipert","Waldive","Waldolanus","Waldomar","Waleran Waleron","Walganus","Walhbert","Waliko","Walkelin","Walkelinus","Wallevus","Wallia","Wally","Waloco","Walpurga","Walt","Walterius","Walterus","Waltgaud","Wamba","Wandilo","Wandregisel","Wandregisilus","Wandrille","Warenheri","Warin","Wariner","Warinhari","Warinus","Warmann","Warnerius","Warnerus","Warren","Warrenus","Wasili","Wat","Water","Watje","Watkin","Watkyn","Watt","Wattie","Watty","Wauter","Wazo","Wealdtheow","Wecelo","Weert","Weffel","Weidheri","Weila","Weinert","Weintje","Wella","Welp","Welpo","Wene","Wenert","Wercha","Wercrata","Werdo","Werinbert","Werner","Wernerus","Wesh","Wezilo","Whatahui","Wherehiko","Wibert","Wibil","Wichard","Wichmann","Widargelt","Widigast","Wido","Widogast","Widradus","Wiebrand","Wiebt","Wigandus","Wigayn","Wigo","Wigstan","Wihtred","Wikerus","Wilcke","Wilcock","Wilecoc","Wilfred","Wilhelm","Wilhelmus","Wiliam","Wiliame","Wilkie","Wilkin","Wilko","Will","Willahelm","Willamar","Willcock","Willehad","Willehelm","Willelm","Willelmus","Willet","William","Williame","Willibald","Willibrord","Willie","Willmot","Wilmot","Wilred","Wimarc","Wimark","Winebaud","Winguric","Winicho","Wintar","Wintherus","Wintri","Wirtje","Wiscar","Wiscard","Wischard","Wisgarus","Wistan","Wistanus","Withari","Withekindus","Witige","Wittigis","Wittiza","Wlfric","Wlfriche","Wlvricus","Wobias","Wocco","Woco","Wolkan","Woltje","Wortwinus","Wracwulf","Wulfram","Wulfric","Wultgar","Wulurich","Wunnihad","Wurm","Wy","Wyat","Wyliame","Wylymot","Wyman","Wymar","Wymarc","Wymare","Wymark","Wymer","Wymerus","Wymon","Wymond","Wymund","Wynkyn","Wyon","Wyschardus","Wystan","Ydevert","Ymbert","Yngerame","Yon","Ypolit","Ypolitus","Yric","Ysembert","Yuli","Yvain","Yve","Yves","Yvet","Yvon","Yvone","Yvonnet","Yvonus","Ywain","Xabat","Xabier","Xalbador","Xantalen","Xanthippos","Xanthippus","Xanthos","Xanti","Xarles","Xavier","Xefe","Xenagoras","Xenokrates","Xenophanes","Xenophon","Ximun","Xiphilinus","Xofre","Xuban","Xurdin","Xuthos","Xuthus","Zabal","Zadornin","Zagreus","Zamolxis","Zaracas","Zarles","Zebe","Zeledon","Zelimir","Zemarchus","Zenicetes","Zeno","Zenobius","Zenodoros","Zephyrinus","Zernin","Zeru","Zeruko","Zethus","Zeuxidamos","Zeuxis","Zigor","Zilar","Zindel","Zindelo","Zinnridi","Zinzo","Ziper","Zobe","Zohiartze","Zoil","Zoilus","Zoltan","Zorion","Zosimus","Zuhaitz","Zumar","Zunbeltz","Zuri","Zuriko","Zuzen","Zwentibold"];var Mi=["Ufora","Hogsfeet","Tamworth","Tywardreath","Butterpond","Padstow","Bradfordshire","Bexley","Hillford","Calcheth","Murkwell","Anghor Wat","Monmouth","Cherrytown","Banrockburn","Haling Cove","Carningsby","Penkurth","Wanborne","Favorsham","Zalfari","Coombe","Scrabster","Penketh","Crossroads","Auchendinny","Macclesfield","Porthcawl","South Warren","Daemarrel","Tottenham","Oldham","Pathstow","Aria","Barnsley","Boroughton","Beggar's Hole","Moonbright","Bleakburn","Hankala","Auchendale","Penzance","Norton","Sanlow","Lunaris","Dewsbury","Narnclaedra","Harthwaite","Watford","Tregaron","Waeldestone","Red Hawk","Snowbush","Ilragorn","Newsham","Tunstead","Myrrka","Bannockburn","Crullfeld","Helmfirth","Langdale","Ashborne","Bailymena","Stathmore","Clacton","Wavemeet","Nishka","Pella's Wish","Holsworthy","Larnwick","Cardended","Acrine","Islesbury","Sharnwick","Durnatel","Blackpool","Hollyhead","Ampleforth","Wolford","Faversham","Axminster","Larkinge","Yarrin","Skystead","Nantgarth","Zeffari","Sudbury","Westray","Drumnacanvy","Calmarnock","Newham","Grasmere","Fanfoss","Oar's Rest","Beachcastle","Bradford","Fortaare","Sheffield","Lingmell","Fool's March","Pontybridge","Kilmarnock","Perthlochry","Hirane","Bullmar","Colchester","Kilerth","Mensfield","Fernsworth","Crasmere","Arkala","Haerndean","Glaenarm","Wealdstone","Wolfden","Aroonshire","Calchester","Violl's Garden","Moressley","Poltragow","Blencathra","Caelfall","Beckinsdale","Willsden","Caister","Peterborough","Marren's Eve","Veritas","Kinecardine","Orilon","Katinhanta","Draycott","Cullfield","Longdale","Fallholt","Galssop","Sutton","Mestauskalio","Glanchester","Garthram","Northon","Peatsland","Haran","Cromer","Firebend","Nerton","Llaneybyder","Hampstead","Grimsby","Caerleon","Bredon","Farnworth","Archmouth","Lancaster","Azmarin","Hardersfield","Wallowdale","Lakeshore","Solari","Goldenleaf","Pernrith","Lerwick","Seameet","Rochdale","Black Crystal","Alcombey","Huthwaite","Arkaley","Woodpine","Ruthorham","Pirn","Perlshaw","Bamburgh","Astrakane","Mansfield","Coniston","Black Hallows","Jedburgh","Tow","Holden","Waekefield","Whiteridge","Pitmerden","Cumdivock","Bournemouth","Arcton","Holbeck","Cirrane","Murtovaara","Blencalgo","Dornwich","Halivaara","Millstone","Doncaster","Acton","Bromwich","Kameeraska","Gramsby","Lhanbyrde","Alderham","Wealdlock","Strathkeld","Oldaton","Mynyddburn","Hogring","Awkalea","Fleshampton","Lawsby","Dripsnake","Venaldame","Vileshagg Lake","Slavechute Hill","Stinkbane","Morttor","Exebeck","Woldmore","Blazemount","Denburgh","Bitehovel Marsh","Fatmede","Killmancatt","Langton","Hawkoflea","Devilach","Monkfall","Whelchester","Leser Mynyddmere","Painlea","Fatleigh","Monkbeat","Marenden","Holmside","Aldermere Lake","Spidersoflea","Pontingham","Foglowe","Slavebugga","Mount Dogoch","Horefall Lake","Leser Dinasmouth","Redpool Fell","Paintower","Pitenden","Horettin Mount","Blackshen","Llyndean","Inverbryde Lake","Treton","Piratebugr Temple","Worldsing","Balingford","Rendtease","Stowtown","Brigenhill Lodge","Mormena","Lyngburn","Wesham","Windleigh","Illring","Estorden","Slaughterbunge","Impsgrip","Impsmede","Breington","Winterend","Monkslot","Belyslock","Witchettin","Holmster","Spitmarshe","Winterbridge","Spothenge","Angenford","Hawkdroop","Fisherscrutch","Vilecastle","Morworthy Castle","Lanberry","Bleddep","Grimach","Norlock","Balasay","Slimeington","Itchyerscrutch Hills","Hellsonas Lake","Axeington","Drumwardine","Norsay","Pucettin","Moistely","Somerchulish","Norcheth","Guiltyhalt","Dorthwaite","Shitester","Lower Pipemount","Norsby","Shitettin","Lickdame","Knightance","Worldsbeck","Kineter","Slutsmound","Cunhole","Lawwardine","Skullslip Bridge","Ashingford","Killmanbugr","Kilsey","Lickoflea Bridge","Helgame","Filthtupp Farm","Flopbunge","Drunkoflea","Whelsworth","Moringham","Huntingbran","Mount Lhanetton","Spidersgrip","Smellhenge","Fishwood","Glamyscott","Nankeld","Dimmarshe","Hawkerscrutch","Exeingford","Mordock","Stickigrip","Spidersbottom","Morfeld","Frozendame","Dorham","Astster","Meatettin","Boodysfolly","Lickoflea Hill","Morarder","Houndskne Mountain","Swinenden","Culfield","Pantingdene","Trend","Hurtdich Tor","Drunkles","East Huntingburn","Someringdon","Holmsey","Knighttreath Mountain","Strathbury Caves","Puckdive","Palmenden","Belyscester","Namysadale Moors","Sadchute","Llynsham","Bourneshaw","Morwich","Port Balshen","Evilbunge","Blackenhill","Lickonas","Glamysworthy","Puckander","Deathtick","Mortmede Bridge","Killmantower Mount","Aldstow","Finham Hill","Groklump","Woldminster","Minastow","East Glamysanger","Exelock","Lower Sutmena","Llynworthy","Macden","Illrise","Ringgill","Belysbeck","Horebeat Down","Dinasend Hill","Drippinwind Mount","Shepburgh","Moistmarke Mountain","Slavefall","Fulstow","Polminster","Culbury","Lickdive","Blazedump","Drumdale","Hogkis","Blazetick","Angenden","Billlowe","Culington","Axesham Down","Itchyring","Trenden Marsh","Firerise","Eldich","Modesingham","Brigtun","Wormsgrip","Venallea","Worldston Lodge","Blindbatte","Venalslip","Grentun","Spitbugr","Grokbreath Marsh","Fireclapp","Dalwich","Monkcatt","Dalster Moors","Shafteadale","Lickhalt","Balashaw","Asclapp Bridge","Drunktor Lake","Skullsllyn","Dimllyn","Axend","Puckhalt","Kilside","Vilemound","Belfos","Stormely","Taxylis Lake","Guiltycrack","Dengate Fell","Bellock","Namysaton","Aslea","Itchyaxe","Holmshen","Minasbran","Auchtersey","Inverdock","Deathold Mount","Askis Lodge","Fulgill","Fleshach","Belmer","Somerburgh","Viledame","Nastimarshe","Estham","Modesacombe Farm","Lowampton Plains","Lickhalt Plains","Seaonas Farm","Grotarmpit","Wrongbent","Illkne","Belasington","Olddean Hill","Blackedene","Hoppbumton Lake","Minasfeld","Fishbane","Filthknock","Langingdene","Poisonknot","Polbrough","Nastidep Down","Huntingthwaite","Killock Mountain","Witchdump Tor","Sadles","Poldean","Enderlock","Mortbane Barrow","Gobblebane","Hairdump","Itchyonas Mount","Gobbleslip","Spotbugga","Bledmarke Tor","Filthrise","Wealdstow","Ponybottom","Blindarmpit","Mynyddchulish","Firemes","Gutkis","Fishcave","Brigbury","Neatburgh","Morchulish Castle","Gobblesfolly Mountain","South Macington","Lyngster","Mortbottom","Panteter","Gobbledame","South Drippindump","Leverbury Down","Kilminstry","Corley","Mageshore","Strongcourt","Wildeburn","Ashedge","Rockshore","Griffinmarsh","Marshshore","Springview","Bushbridge","Edgeham","Falconmoor","Westbarrow","Greenby","Lightash","Springmeadow","Freymead","Highsnow","Moorborough","Iceland","Violetfalcon","Lightgrass","Aelbank","Dragonmill","Newoak","Vertmerrow","Brookwyn","Wellston","Rockhollow","Oldedge","Strongston","Vertness","Clearmarsh","Bysilver","Bushmeadow","Freylake","Vertshade","Shadowburn","Mallowmead","Eastmeadow","Jangate","Fallmont","Highhurst","Linfield","Butterwind","Beledge","Summercoast","Waterhedge","Redmead","Springhedge","Wyvernston","Elfbridge","Bellmarsh","Janwynne","Northglass","Wildecliff","Byhill","Wayfort","Newwald","Bellview","Crystalbush","Butterley","Fallgate","Lochston","Valview","Goldston","Summernesse","Southfield","Janvale","Greenmist","Snowway","Westgrass","Westerhill","Flowerbush","Redwheat","Olddell","Glasshill","Wildelyn","Coldrock","Lordale","Westflower","Deeplight","Goldhollow","Redfay","Shadowcrest","Swynland","Mallowlyn","Shadowshore","Crystalwilde","Mallowrose","Eastspring","Rosenesse","Iceness","Northbeach","Dracwynne","Merrimead","Southhollow","Esterway","Bluemill","Marbleport","Elffield","Meadowcoast"];function $(u,A="any"){if(A==="female")return u.pick(tu);if(A==="male")return u.pick(uA);return u.pick(u.chance(0.5)?tu:uA)}function g(u){return u.pick(Mi)}var _h=["The %ADJ% %NOUN%","%NOUN% of the %SYMBOL%","The %SYMBOL% %NOUN%","%ADJ% %NOUN% of %PLACE%","Order of the %SYMBOL%","Brotherhood of the %SYMBOL%","Sisterhood of the %SYMBOL%","Guild of %PLURAL%","The %SYMBOL% Compact","House of the %SYMBOL%","Sons of the %SYMBOL%","Daughters of the %SYMBOL%","Keepers of the %SYMBOL%","The %SYMBOL% Hand","The %ADJ% Covenant"],Nh=["Silent","Hidden","Crimson","Golden","Silver","Iron","Shadowed","Burning","Frozen","Ancient","Eternal","Vigilant","Faithful","Merciful","Vengeful","Watchful","Steadfast","Wandering","Blessed","Forsaken","Twilight","Dawn","Midnight","Storm","Thunder"],Sh=["Brotherhood","Sisterhood","Order","Guild","Company","Lodge","Circle","Council","Covenant","Fellowship","League","Society","Cabal","Congregation","Assembly","Conclave","Syndicate","Union"],Hi=["Flame","Star","Moon","Sun","Serpent","Wolf","Raven","Lion","Rose","Thorn","Oak","Iron","Gold","Silver","Crown","Sword","Shield","Coin","Scale","Compass","Anchor","Key","Chalice","Eye","Hand","Heart","Skull","Tower","Gate","Bridge","Path","Chain","Ring","Wheel","Hammer","Anvil","Quill","Scroll","Ash","Storm","Bone","Blood","Shadow","Frost","Dawn","Dusk","Wyrm","Phoenix","Griffin","Stag","Bear","Hawk","Spider","Viper"],fh=["Shadows","Flames","Whispers","Secrets","Blades","Coins","Stars","Storms","Thorns","Ravens","Wolves","Lions"];function Bi(u,A){let h;if(A==="trade")h=u.pick(["Guild of %PLURAL%","The %SYMBOL% Compact","%ADJ% %NOUN% of %PLACE%","The %ADJ% %NOUN%"]);else if(A==="martial")h=u.pick(["Brotherhood of the %SYMBOL%","Order of the %SYMBOL%","The %SYMBOL% %NOUN%","Sons of the %SYMBOL%","The %ADJ% %NOUN%"]);else if(A==="pious")h=u.pick(["Order of the %SYMBOL%","Keepers of the %SYMBOL%","The %ADJ% Covenant","Sisterhood of the %SYMBOL%","House of the %SYMBOL%"]);else if(A==="arcane")h=u.pick(["The %ADJ% %NOUN%","Keepers of the %SYMBOL%","Order of the %SYMBOL%","The %SYMBOL% Compact","Circle of the %SYMBOL%"]);else h=u.pick(_h);return h.replace("%ADJ%",u.pick(Nh)).replace("%NOUN%",u.pick(Sh)).replace("%SYMBOL%",u.pick(Hi)).replace("%PLURAL%",u.pick(fh)).replace("%PLACE%",g(u))}var vh=["%NAME%'s Company","%NAME%'s Band","The %ADJ% %PLURAL%","%NAME%'s Wolves","The %PLACE% %PLURAL%","%NAME%'s Blades","The %ADJ% Company","%NAME% and Company","The Wayward %PLURAL%","%NAME%'s Oath"],ah=["Bold","Brave","Free","Wild","Wandering","Lucky","Merry","Grim","Iron","Steel","Silver","Golden","Red","Black","White"],Th=["Companions","Blades","Swords","Shields","Brothers","Sisters","Wolves","Hawks","Ravens","Lions","Foxes","Hounds","Fists"];function AA(u){return u.pick(vh).replace("%NAME%",$(u)).replace("%ADJ%",u.pick(ah)).replace("%PLURAL%",u.pick(Th)).replace("%PLACE%",g(u))}var yh=["%PLACE% Traders","The %ADJ% Caravan","%NAME%'s Wagons","%PLACE% Merchants","The %SYMBOL% Trading Company","%NAME% & Sons","%PLACE% Provisioners","The Wandering %PLURAL%"],lh=["Northern","Southern","Eastern","Western","Far","Old","New","Great","Swift","Honest","Lucky","Prosperous","Wandering"],sh=["Merchants","Traders","Peddlers","Provisioners"];function ki(u){return u.pick(yh).replace("%NAME%",$(u)).replace("%ADJ%",u.pick(lh)).replace("%PLURAL%",u.pick(sh)).replace("%SYMBOL%",u.pick(Hi)).replace("%PLACE%",g(u))}var mh=["The %ADJ% %PLACE_TYPE%","%PLACE_TYPE% of %NOUN%","The %NOUN% %PLACE_TYPE%","%NAME%'s %PLACE_TYPE%","%PLACE% %PLACE_TYPE%","The %PLACE_TYPE% of %ADJ% %NOUN%","%ADJ% %PLACE_TYPE% of %PLACE%"],dh=["Ruins","Crypt","Tomb","Lair","Caverns","Depths","Dungeon","Fortress","Tower","Barrow","Pit","Maze","Sanctum","Vault","Catacombs","Warren","Hold","Keep","Citadel","Halls"],ph=["Forgotten","Ruined","Sunken","Haunted","Cursed","Burning","Frozen","Ancient","Lost","Hidden","Forsaken","Shadowed","Blighted","Flooded","Crumbling","Eternal","Silent","Screaming"],ch=["Shadows","Bones","Sorrow","Madness","Despair","Whispers","Echoes","Chains","Thorns","Flame","Ice","Blood","Death","Secrets","Doom","Wrath","Silence","Darkness","Dreams"];function zi(u){return u.pick(mh).replace("%NAME%",$(u)).replace("%ADJ%",u.pick(ph)).replace("%NOUN%",u.pick(ch)).replace("%PLACE_TYPE%",u.pick(dh)).replace("%PLACE%",g(u))}var wh=["lair","trap","treasure","empty","shrine","laboratory"];function ju(u,A,h=12){let H=[];for(let b=0;b<h;b+=1){let i=u.pick(wh),G=Math.max(1,Math.min(5,A.danger+u.int(3)-1)),M=u.chance(0.35),B=M&&u.chance(0.1)?u.pick(["artifact","relic","ancient-map"]):void 0;H.push({type:i,threat:G,loot:M,rare:B})}return H}function gh(u,A){return`${u}-${A}`}var eh=["Standard","Age of War","The Great Plague","Arcane Bloom","Wilderness Unbound","Golden Age"],nh=[{terrain:"clear",weight:4},{terrain:"forest",weight:3},{terrain:"hills",weight:3},{terrain:"mountains",weight:2},{terrain:"swamp",weight:2},{terrain:"desert",weight:1}];function Pi(u,A){let h=A.reduce((b,i)=>b+i.weight,0),H=u.int(h);for(let b of A)if(H-=b.weight,H<0)return b.terrain;return"clear"}function iA(u,A,h,H){return[{q:1,r:0},{q:-1,r:0},{q:0,r:1},{q:0,r:-1},{q:1,r:-1},{q:-1,r:1}].map((i)=>({q:u+i.q,r:A+i.r})).filter((i)=>i.q>=0&&i.q<h&&i.r>=0&&i.r<H)}function Ei(u,A){let h={desert:["swamp","ocean","river"],swamp:["desert","mountains"],mountains:["swamp","ocean"],ocean:["mountains","desert","forest"]};return!(h[u]?.includes(A)||h[A]?.includes(u))}function oh(u,A=6,h=6,H){let b=[],i=new Map,G=u.int(4),M=u.chance(0.6),B=M?1+u.int(A-2):-1,k=u.chance(0.5);for(let P=0;P<A;P+=1)for(let E=0;E<h;E+=1){let K=`${P},${E}`,L,W=G===0&&P===0||G===1&&E===h-1||G===2&&P===A-1||G===3&&E===0,J=G===0&&P===1||G===1&&E===h-2||G===2&&P===A-2||G===3&&E===1,V=M&&(k&&E===B||!k&&P===B),C=M?k?Math.abs(E-B):Math.abs(P-B):999;if(W)L="ocean";else if(J)L=u.chance(0.8)?"coastal":"clear";else if(V)L=u.chance(0.7)?"mountains":"hills";else if(C===1)L=u.chance(0.5)?"hills":Pi(u,H);else L=Pi(u,H);let O={coord:{q:P,r:E},terrain:L};b.push(O),i.set(K,O)}let z=2;for(let P=0;P<z;P++)for(let E of b){if(E.terrain==="ocean"||E.terrain==="coastal")continue;let L=iA(E.coord.q,E.coord.r,A,h).map((C)=>i.get(`${C.q},${C.r}`)?.terrain).filter((C)=>!!C&&C!=="ocean");if(L.length===0)continue;let W={};for(let C of L)W[C]=(W[C]??0)+1;let J=null,V=0;for(let[C,O]of Object.entries(W))if(O>V&&O>=2)V=O,J=C;if(J&&u.chance(0.35)&&Ei(E.terrain,J)){if(J==="coastal"){if(!L.includes("ocean"))continue}E.terrain=J}}for(let P of b){if(P.terrain==="ocean"||P.terrain==="coastal")continue;let K=iA(P.coord.q,P.coord.r,A,h).map((L)=>i.get(`${L.q},${L.r}`)?.terrain).filter((L)=>!!L);for(let L of K)if(!Ei(P.terrain,L)){if(P.terrain==="swamp"&&L==="mountains")P.terrain="hills";else if(P.terrain==="desert"&&L==="swamp")P.terrain="clear";else if(P.terrain==="swamp"&&L==="desert")P.terrain="clear";else if(P.terrain==="mountains"&&L==="ocean")P.terrain="hills";else if(P.terrain==="desert"&&L==="ocean")P.terrain="coastal";else if(P.terrain==="forest"&&L==="ocean")P.terrain="coastal";break}}if(M&&u.chance(0.5)){let P=b.filter((E)=>E.terrain==="mountains");if(P.length>0){let K=u.pick(P).coord,L=3+u.int(5);for(let W=0;W<L;W++){let V=iA(K.q,K.r,A,h).find((C)=>{if(G===0)return C.q<K.q;if(G===1)return C.r>K.r;if(G===2)return C.q>K.q;return C.r<K.r});if(V){let C=i.get(`${V.q},${V.r}`);if(C&&C.terrain!=="ocean"&&C.terrain!=="mountains"){if(u.chance(0.5))C.terrain="river";K=V}else break}else break}}}return b}function Di(u,A){return u.hexes.find((H)=>H.coord.q===A.q&&H.coord.r===A.r)?.terrain==="coastal"}function rh(u,A,h){let H=[...A],b=[];for(let i=0;i<h&&H.length;i+=1){let G=u.int(H.length);b.push(H[G]),H.splice(G,1)}return b}function th(u,A){return(Math.abs(u.q-A.q)+Math.abs(u.q+u.r-A.q-A.r)+Math.abs(u.r-A.r))/2}function uG(u,A){let h={road:0,clear:1,coastal:1,river:2,desert:2,hills:3,forest:3,swamp:4,mountains:5,ocean:6,reef:6};return(h[u]??3)>=(h[A]??3)?u:A}function Li(u,A,h){let H=u.pick(eh),b=10,i=10,G=[...nh];if(H==="Wilderness Unbound")G.find((J)=>J.terrain==="clear").weight=1,G.find((J)=>J.terrain==="forest").weight=6,G.find((J)=>J.terrain==="mountains").weight=4;let M=oh(u,10,10,G),B=M.filter((J)=>J.terrain!=="ocean"&&J.terrain!=="reef"),k=(H==="Golden Age"?7:H==="Wilderness Unbound"?3:5)+u.int(3),z=rh(u,B,k),P=["grain","timber","ore","textiles","salt","fish","livestock"],E=z.map((J,V)=>{let C=Object.fromEntries(P.map((Y)=>[Y,u.int(5)-2]));if(H==="Golden Age")C.grain+=2;if(H==="The Great Plague")C.livestock-=2;let O=Object.fromEntries(P.map((Y)=>[Y,"normal"]));return{id:gh("settlement",V),name:g(u),population:(H==="Golden Age"?1000:200)+u.int(1800),type:V===0?"town":u.chance(0.3)?"town":"village",coord:J.coord,supply:C,mood:H==="Golden Age"?2:H==="Age of War"?-2:u.int(5)-2,priceTrends:O}}),K=[];if(E.length>1){for(let J=1;J<E.length;J+=1)K.push([E[0].id,E[J].id]);if(E.length>2){let J=u.pick(E),V=u.pick(E);if(V.id===J.id)V=E[(E.indexOf(J)+1)%E.length];K.push([J.id,V.id])}}let L=[{id:"party-0",name:AA(u),members:[{name:$(u),class:"Fighter",level:1+u.int(3),hp:20,maxHp:20},{name:$(u),class:"Cleric",level:1+u.int(3),hp:15,maxHp:15},{name:$(u),class:"Magic-User",level:1+u.int(3),hp:10,maxHp:10}],location:E[0]?.name??E[E.length-1]?.name??g(u),status:"idle",xp:0},{id:"band-0",name:AA(u),members:[{name:$(u),class:"Thief",level:1+u.int(2),hp:12,maxHp:12},{name:$(u),class:"Elf",level:1+u.int(2),hp:14,maxHp:14}],location:E[E.length-1]?.name??E[0]?.name??g(u),status:"idle",xp:0}],W=HG(u,H);return{seed:A,archetype:H,hexes:M,width:10,height:10,settlements:E,parties:L,roads:K,dungeons:GG(u,E,H,10,M),activeRumors:[],npcs:bG(u,E),factions:W,caravans:MG(u,E,W,K),strongholds:[],armies:[],landmarks:[],ruins:[],nexuses:iG(u,(H==="Arcane Bloom"?8:4)+u.int(4),10),mercenaries:AG(u,E),startedAt:h}}function AG(u,A){return["The Iron Brotherhood","Silver Shields","The Golden Lions","Black Boars","Red Ravagers","The Free Company"].map((H,b)=>{let i=u.pick(A);return{id:`merc-${b}`,name:H,captainId:`npc-merc-captain-${b}`,location:i.name,size:50+u.int(150),quality:2+u.int(5),monthlyRate:100+u.int(400),loyalty:7+u.int(3)}})}function iG(u,A,h=10){let H=["Arcane","Divine","Primal","Shadow"];return Array.from({length:A},(b,i)=>({id:`nexus-${i}`,name:`${u.pick(["Whispering","Eternal","Shattered","Golden","Deep"])} Nexus of ${u.pick(["Stars","Bones","Life","Void","Time"])}`,location:{q:u.int(h),r:u.int(h)},powerType:u.pick(H),intensity:5+u.int(5)}))}function hA(u,A){return u.settlements.find((h)=>h.name===A)}function hG(u,A){return u.dungeons.find((h)=>h.name===A)}function Xu(u,A){let h=hA(u,A);if(h)return h.coord;let H=hG(u,A);if(H)return H.coord;return null}function Ku(u,A,h){let H=Xu(u,A),b=Xu(u,h);if(!H||!b)return null;let i=th(H,b);return Math.max(6,i*6)}function Du(u,A,h){let H=Xu(u,A),b=Xu(u,h);if(!H||!b)return"clear";let i=hA(u,A),G=hA(u,h);if(i&&G){if(u.roads.some(([B,k])=>B===i.id&&k===G.id||B===G.id&&k===i.id))return"road"}return uG(Ki(u,H)?.terrain??"clear",Ki(u,b)?.terrain??"clear")}function Ki(u,A){return u.hexes.find((h)=>h.coord.q===A.q&&h.coord.r===A.r)}function GA(u,A){return u.settlements.find((h)=>h.id===A)}function bA(u,A,h){let H=u.factions.find((b)=>b.id===A);if(!H)return;H.wealth=Math.max(0,H.wealth+h)}function MA(u,A,h,H){let b=u.factions.find((i)=>i.id===A);if(!b)return;if(!b.attitude[h])b.attitude[h]=0;b.attitude[h]=Math.max(-3,Math.min(3,b.attitude[h]+H))}function GG(u,A,h,H=10,b=[]){if(!A.length)return[];let i=new Set(b.filter((k)=>k.terrain==="ocean"||k.terrain==="reef").map((k)=>`${k.coord.q},${k.coord.r}`)),G=2+u.int(2),M=[],B=new Set;for(let k=0;k<G;k++){let z=u.pick(A),P,E=0;do P={q:Math.max(0,Math.min(H-1,z.coord.q+(u.int(5)-2))),r:Math.max(0,Math.min(H-1,z.coord.r+(u.int(5)-2)))},E++;while((B.has(`${P.q},${P.r}`)||i.has(`${P.q},${P.r}`))&&E<20);B.add(`${P.q},${P.r}`);let K={id:`dungeon-${k}`,name:zi(u),coord:P,depth:(h==="Standard"?3:5)+u.int(3),danger:(h==="Wilderness Unbound"?4:2)+u.int(3)};K.rooms=ju(u,K),K.explored=0,M.push(K)}return M}function bG(u,A){let h=["merchant","guard","scout","priest","bard","laborer"],H=[],b=Math.max(12,A.length*2)+u.int(6);for(let i=0;i<b;i+=1){let G=u.pick(A);H.push({id:`npc-${i}`,name:$(u),role:u.pick(h),home:G.id,location:G.name,reputation:u.int(7)-3,fame:0,alive:!0})}return H}function MG(u,A,h,H){if(A.length<2||H.length===0)return[];let b=[],i=new Set,G=Math.min(H.length,3+u.int(3));for(let M=0;M<G;M+=1){let B=H.filter(([L,W])=>!i.has(`${L}-${W}`)&&!i.has(`${W}-${L}`));if(B.length===0)break;let[k,z]=u.pick(B);i.add(`${k}-${z}`);let P=A.find((L)=>L.id===k),E=A.find((L)=>L.id===z);if(!P||!E)continue;let K=u.chance(0.6)&&h.length>0?u.pick(h):void 0;b.push({id:`caravan-${M}`,name:ki(u),route:[k,z],goods:u.pick([["grain","textiles"],["ore","timber"],["salt","fish"],["livestock"]]),location:P.name,progressHours:0,direction:"outbound",escorts:[],factionId:K?.id,merchantId:void 0})}return b}function HG(u,A){let h=["trade","martial","pious","arcane","trade","martial"],H=4+u.int(3);return Array.from({length:H},(b,i)=>{let G=h[i%h.length];if(A==="Age of War"&&u.chance(0.5))G="martial";if(A==="Arcane Bloom"&&i===0)G="arcane";return{id:`faction-${i}`,name:Bi(u,G),attitude:{},wealth:(A==="Golden Age"?200:50)+u.int(100),focus:G}})}var BG={road:0.08333333333333333,clear:0.16666666666666666,forest:0.3333333333333333,hills:0.3333333333333333,mountains:0.5,swamp:0.5,desert:0.3333333333333333,coastal:0.16666666666666666,ocean:0,reef:0,river:0.125},kG={road:0.1,clear:0.08333333333333333,forest:0.16666666666666666,hills:0.16666666666666666,mountains:0.25,swamp:0.25,desert:0.16666666666666666,coastal:0.125,ocean:0,reef:0,river:0.1},Ji={road:["bandits","brigands","patrolling guards","merchants"],clear:["bandits","wolves","goblins","orc raiders"],forest:["wolves","goblins","brigands","giant spiders"],hills:["orc raiders","goblins","brigands","ogre"],mountains:["orc raiders","giant bats","goblins","ogre"],swamp:["lizardfolk","giant leeches","goblins","brigands"],desert:["bandits","giant scorpions","orc raiders","gnolls"],coastal:["smugglers","pirates","giant crabs","fishermen","sahuagin"],ocean:["sea serpent","pirates","merfolk"],reef:["sharks","merfolk","giant octopus"],river:["bandits","fishermen","nixies","giant pike"]};function zG(u){let A=2+u.int(6)+u.int(6);if(A>=10)return"friendly";if(A>=7)return"cautious";return"hostile"}function PG(u,A,h){let H=Ji[A]??Ji.clear,b=u.pick(H),i=zG(u);if(i==="friendly")return{summary:`${h[0]} parley with ${b}`,details:"Trade news and share a quick meal before parting ways."};if(i==="cautious"){if(u.chance(0.5))return{summary:`${h[0]} spot ${b} and avoid notice`,details:"They detour carefully, leaving only faint tracks.",delayMiles:u.chance(0.5)?3:0,fatigueDelta:u.chance(0.3)?1:0};return{summary:`${h[0]} shadowed by ${b}`,details:"Tense standoff; both sides withdraw before blades are drawn.",delayMiles:u.chance(0.5)?2:0,fatigueDelta:u.chance(0.3)?1:0}}if(u.chance(0.65))return{summary:`${h[0]} clash with ${b}`,details:"Brief skirmish; foes driven off with minor bruises.",fatigueDelta:u.chance(0.2)?1:0,injured:u.chance(0.15)};let M=u.chance(0.2);return{summary:`${h[0]} ambushed by ${b}`,details:M?"Casualties suffered in the rout.":"Forced retreat; they fall back to regroup.",delayMiles:6+u.int(6),fatigueDelta:1+u.int(2),injured:!M&&u.chance(0.4),death:M}}function Wi(u,A,h,H,b,i){let G=h.getUTCHours(),B=G>=6&&G<18?BG[A]??0:kG[A]??0;if(!u.chance(B))return;let k=PG(u,A,b);return{category:"road",summary:k.summary,details:k.details,location:H,actors:b,worldTime:h,realTime:new Date,seed:i,delayMiles:k.delayMiles}}var EG=["treasure","missing","omen","threat","plot","mystery"],KG=["whispered","urgent","conflicting","cryptic","official","boastful"],DG=["an old map fragment","a wounded messenger","a frantic merchant","a border scout","a drunken soldier","a frightened child","a wandering priest","a caravan guard","a bard fresh from the road"];function LG(u,A){if(u.dungeons.length&&A.chance(0.4))return{target:A.pick(u.dungeons).name,kind:"dungeon"};if(A.chance(0.3))return{target:A.pick(u.settlements).name,kind:"caravan"};if(A.chance(0.2))return{target:g(A),kind:"monster-sign"};return{target:A.pick(u.settlements).name,kind:"feud"}}function JG(u,A,h,H){let b=A.pick(EG),i=A.pick(KG),G=A.pick(DG),M=$(A),B=u.dungeons.find((P)=>P.name===H),k=[`strange lights near ${H}`,`missing heirlooms traced toward ${H}`,"bandits offering odd coins","beasts refusing to cross the old road","a sealed door that hums at night","villagers hearing chanting at dusk","fresh graves disturbed","a caravan late by two days","guards buying lamp oil in bulk"];if(B)k.push(`whispers of depth ${B.depth} halls`,`signs of danger tier ${B.danger}`,`old map showing ${B.depth} levels and barred doors`);let z=A.pick(k);return`${i} ${b}: ${G} says ${M} heard of ${z} (from ${h}).`}function Oi(u,A,h){let{target:H,kind:b}=LG(u,A);return{id:`rumor-${Date.now()}-${A.int(1e6)}`,kind:b,text:JG(u,A,h,H),target:H,origin:h,freshness:5+A.int(4)}}function Fi(u){u.activeRumors=u.activeRumors.map((A)=>({...A,freshness:A.freshness-1})).filter((A)=>A.freshness>0)}function e(u,A,h,H,b,i,G=5+A.int(4)){return{id:`rumor-${Date.now()}-${A.int(1e6)}`,kind:b,text:i,target:H,origin:h,freshness:G}}function d(u,A,h){return{category:"town",summary:`Rumor in ${u.origin}`,details:u.text,location:u.origin,worldTime:A,realTime:new Date,seed:h}}var WG=["a loose-tongued innkeeper","a boastful adventurer","a merchant counting coins","a wounded survivor","a jealous rival","a temple acolyte","a fence with nervous eyes","a bard embellishing tales","a spy in the shadows","a drunk celebrating too loudly"],OG=["Collectors take note.","Thieves sharpen their knives.","Rivals grow envious.","Old enemies remember.","Dragons stir in their lairs.","Dark forces take interest.","Noble houses dispatch agents.","The greedy make plans.","Fortune-seekers gather.","The underworld whispers."];function Yu(u,A,h,H,b,i,G,M){let B=u.pick(WG),k=u.pick(OG),z=[],P;switch(h){case"legendary-item":z=["thieves-guild","rival-party","collector","dragon","antagonist","faction"],P=`whispered treasure: ${B} tells of ${i} finding ${H??"a legendary artifact"}. ${k}`;break;case"artifact":z=["antagonist","faction","dragon","collector","dark-cult"],P=`urgent treasure: ${B} speaks of ${i} possessing ${H??"an artifact of immense power"}. ${k}`;break;case"rare-item":z=["thieves-guild","rival-party","collector"],P=`boastful treasure: ${B} mentions ${i} carrying ${H??"a rare magic item"}. ${k}`;break;case"magic-weapon":z=["rival-party","faction","warlord"],P=`conflicting treasure: ${B} describes ${H??"a powerful enchanted weapon"} now wielded by ${i}. ${k}`;break;case"massive-hoard":z=["thieves-guild","rival-party","dragon","faction","bandit"],P=`urgent treasure: ${B} whispers of ${i} discovering a hoard worth ${G.toLocaleString()} gold. ${k}`;break;case"ongoing-extraction":z=["thieves-guild","rival-party","bandit","monster"],P=`cryptic treasure: ${B} notes ${i} making repeated trips to ${b}, laden with gold each time. ${k}`;break;case"unguarded-treasure":z=["rival-party","monster","bandit","faction"],P=`whispered treasure: ${B} claims a fortune lies abandoned in ${b}, left behind by ${i}. ${k}`;break}let E=A.settlements.filter((W)=>W.name!==b),K=E.length>0?u.pick(E).name:b,L=h==="legendary-item"||h==="artifact"?14+u.int(14):h==="massive-hoard"?10+u.int(10):5+u.int(7);return{id:`treasure-rumor-${Date.now()}-${u.int(1e6)}`,kind:"mystery",text:P,target:b,origin:K,freshness:L,treasureType:h,itemId:M,itemName:H,estimatedValue:G,discoveredBy:i,attractsTypes:z}}function Qu(u,A,h){let H=[h],b=h.treasureType==="legendary-item"||h.treasureType==="artifact"?2+u.int(3):h.treasureType==="massive-hoard"?1+u.int(2):u.chance(0.5)?1:0,i=A.settlements.filter((G)=>G.name!==h.origin);for(let G=0;G<Math.min(b,i.length);G++){let M=i[G],B={...h};if(B.id=`treasure-rumor-${Date.now()}-${u.int(1e6)}`,B.origin=M.name,B.freshness=h.freshness-1-u.int(3),u.chance(0.3))B.estimatedValue=Math.floor((B.estimatedValue??0)*(1.2+u.next())),B.text=B.text.replace("whispered","exaggerated");if(B.freshness>0)H.push(B)}return H}function HA(u,A,h,H,b,i){let G=e(u,A,h,h,"feud",b);return u.activeRumors.push(G),d(G,i,u.seed)}function Ri(u,A,h,H){let b=[];for(let i of u.factions)if(!i.lastNoted||A.chance(0.2)){let G=i.attitude[h]??0,M=G>=2?"offers protection for caravans":G<=-2?"demands tariffs and patrols the roads heavily":"watches the markets quietly",B=e(u,A,h,h,"feud",`${i.name} ${M}.`);u.activeRumors.push(B),b.push(d(B,H,u.seed)),i.lastNoted=h}return b}function FG(u,A){return u.settlements.find((H)=>H.id===A)?.name??A}function $u(u,A,h){let H=[];for(let b of A){let i=u.npcs.find((G)=>G.id===b);if(i&&i.alive!==!1)i.location=h,H.push(i)}return H}function Iu(u,A,h,H,b){return u.map((i)=>({category:"town",summary:`${i.name} arrives in ${A}`,details:`${i.role} from ${FG(b,i.home)}`,location:A,worldTime:h,realTime:new Date,seed:H}))}function Zi(u,A,h,H){return u.map((b)=>({category:"town",summary:`${b.name} seen in ${A} markets`,details:`${b.role} haggles and swaps news.`,location:A,worldTime:h,realTime:new Date,seed:H}))}var Bu=["grain","timber","ore","textiles","salt","fish","livestock"];function RG(u){return u.toISOString().slice(0,10)}function ZG(u,A){let h=A.pick(Bu),H=A.chance(0.5)?1:-1;u[h]=Math.max(-3,Math.min(3,u[h]+H))}function Vi(u,A,h){let H=u.settlements.find((b)=>b.name===A);if(!H)return;for(let b of h)H.supply[b]=Math.min(4,(H.supply[b]??0)+1);Ci(H)}function Ci(u){u.priceTrends??={};for(let A of Bu){let h=u.supply[A]??0;u.priceTrends[A]=h>=2?"low":h<=-2?"high":"normal"}}function VG(u){let A=Bu.filter((H)=>u[H]>=2),h=Bu.filter((H)=>u[H]<=-2);if(A.length&&h.length)return`Surplus ${A.join("/")} and shortages in ${h.join("/")}.`;if(A.length)return`Surplus ${A.join("/")}.`;if(h.length)return`Shortages in ${h.join("/")}.`;return"Markets steady."}function CG(u,A){let h=Bu.filter((b)=>A.supply[b]<=-2),H=Bu.filter((b)=>A.supply[b]>=2);if(h.length&&u.chance(0.5))return`Levies rumored to secure ${u.pick(h)}; officials say caravans delayed.`;if(H.length&&u.chance(0.3))return`Bargain prices on ${u.pick(H)}; traders racing to ${A.name}.`;return null}function UG(u,A,h,H,b){if(A.chance(0.35)){let i=Oi(u,A,h);u.activeRumors.push(i),H.push({category:"town",summary:`Rumor in ${h}`,details:i.text,location:h,worldTime:b,realTime:new Date,seed:u.seed})}}function BA(u,A,h){let H=[];Fi(u);for(let b of u.settlements){let i=RG(h);if(b.lastTownLogDay===i&&A.chance(0.5)===!1)continue;ZG(b.supply,A),b.mood=Math.max(-3,Math.min(3,b.mood+(A.chance(0.3)?1:-1))),Ci(b);let G=VG(b.supply),M=b.mood>=2?"spirits high":b.mood<=-2?"tempers frayed":"folk watchful",B=u.npcs.filter((P)=>P.location===b.name&&P.alive!==!1);if(B.length&&A.chance(0.4))H.push(...Zi(B.slice(0,2),b.name,h,u.seed));let k=u.parties.filter((P)=>P.location===b.name&&(P.fame??0)>=5);if(k.length&&A.chance(0.5))for(let P of k.slice(0,1))H.push({category:"town",summary:`${P.name} hailed in ${b.name}`,details:"Locals toast their exploits.",location:b.name,worldTime:h,realTime:new Date,seed:u.seed});H.push({category:"town",summary:`${b.name} ${M}`,details:G,location:b.name,worldTime:h,realTime:new Date,seed:u.seed});let z=CG(A,b);if(z){let P=e(u,A,b.name,b.name,"mystery",z);u.activeRumors.push(P),H.push(d(P,h,u.seed))}else UG(u,A,b.name,H,h);H.push(...Ri(u,A,b.name,h)),b.lastTownLogDay=i}return H}function kA(u,A,h){if(!u.activeRumors.length)return null;let H=[...u.activeRumors].sort((i,G)=>G.freshness-i.freshness);return H[Math.min(H.length-1,A.int(H.length))]}var Lu={pending:[]};function zA(){return Lu}function Ui(u){Lu=u}function j(u){let A=t("consequence-seed"),h=`conseq-${A.int(1e6)}-${A.int(1e6)}`;Lu.pending.push({...u,id:h})}function PA(u,A,h){let H=[],b=[];for(let i of Lu.pending)if(i.turnsUntilResolution-=1,i.turnsUntilResolution<=0){let G=jG(i,u,A,h);if(G)H.push(...G)}else b.push(i);return Lu.pending=b,H}function jG(u,A,h,H){let b=[];switch(u.type){case"spawn-rumor":{let{origin:i,target:G,kind:M,text:B}=u.data,k=e(A,h,i,G,M,B);A.activeRumors.push(k),b.push({category:"town",summary:`Word spreads in ${i}`,details:k.text,location:i,worldTime:H,realTime:new Date,seed:A.seed});break}case"faction-action":{let{factionId:i,action:G,targetLocation:M}=u.data,B=A.factions.find((z)=>z.id===i);if(!B)break;let k=XG(B,G,M,A,h,H);b.push(...k);break}case"npc-reaction":{let{npcId:i,reaction:G,cause:M}=u.data,B=A.npcs.find((z)=>z.id===i);if(!B||B.alive===!1)break;let k=YG(B,G,M,A,h,H);b.push(...k);break}case"settlement-change":{let{settlementName:i,change:G,magnitude:M}=u.data,B=A.settlements.find((k)=>k.name===i);if(!B)break;if(G==="mood-shift"){let k=B.mood;if(B.mood=Math.max(-3,Math.min(3,B.mood+M)),B.mood!==k){let z=M>0?"improves":"darkens";b.push({category:"town",summary:`Mood ${z} in ${B.name}`,details:`Following recent events, the people's spirit ${z==="improves"?"lifts":"sinks"}.`,location:B.name,worldTime:H,realTime:new Date,seed:A.seed})}}break}case"spawn-antagonist":{let{location:i,threat:G,origin:M}=u.data;b.push({category:"road",summary:`A new threat emerges near ${i}`,details:`${G}. This is a consequence of ${M}.`,location:i,worldTime:H,realTime:new Date,seed:A.seed}),j({type:"spawn-rumor",triggerEvent:`New threat: ${G}`,turnsUntilResolution:72+h.int(72),data:{origin:i,target:i,kind:"monster-sign",text:`Travelers speak of ${G.toLowerCase()} on the roads near ${i}.`},priority:3});break}case"spawn-event":{let{category:i,summary:G,details:M,location:B,actors:k}=u.data;b.push({category:i,summary:G,details:M,location:B,actors:k,worldTime:H,realTime:new Date,seed:A.seed});break}case"supply-disruption":{let{armyId:i,duration:G}=u.data,M=A.armies.find((B)=>B.id===i);if(M)M.supplies=Math.max(0,M.supplies-30),b.push({category:"faction",summary:`Sudden supply shortage for ${M.ownerId}'s forces`,details:`A critical supply caravan was lost or delayed. The army at ${M.location} is feeling the pinch.`,location:M.location,worldTime:H,realTime:new Date,seed:A.seed});break}}return b}function XG(u,A,h,H,b,i){let G=[];switch(A){case"patrol":{let M={martial:[`Armed members of ${u.name} now patrol the roads${h?` near ${h}`:""}.`,`${u.name} deploys additional troops to secure trade routes${h?` around ${h}`:""}.`,`Warriors from ${u.name} stand guard along the highways${h?` near ${h}`:""}.`,`${u.name} establishes checkpoints to deter bandits${h?` around ${h}`:""}.`],pious:[`Devout members of ${u.name} now walk the roads in prayer${h?` near ${h}`:""}.`,`${u.name} blesses travelers and watches for signs of corruption${h?` around ${h}`:""}.`,`Pilgrims from ${u.name} patrol the sacred paths${h?` near ${h}`:""}.`,`${u.name} sends holy warriors to protect the faithful${h?` around ${h}`:""}.`],trade:[`Mercantile guards from ${u.name} now protect the roads${h?` near ${h}`:""}.`,`${u.name} hires additional caravan escorts for safety${h?` around ${h}`:""}.`,`Traders from ${u.name} organize mutual protection pacts${h?` near ${h}`:""}.`,`${u.name} establishes toll stations to fund road security${h?` around ${h}`:""}.`],arcane:[`Mystical wards from ${u.name} now protect the roads${h?` near ${h}`:""}.`,`${u.name} summons guardians to watch over travelers${h?` around ${h}`:""}.`,`Arcane sentinels from ${u.name} patrol the pathways${h?` near ${h}`:""}.`,`${u.name} enchants the roads against unlawful passage${h?` around ${h}`:""}.`]};if(G.push({category:"faction",summary:`${u.name} increases patrols`,details:b.pick(M[u.focus]||M.martial),location:h,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed}),h){let B=u.attitude[h]??0;u.attitude[h]=Math.min(3,B+1)}break}case"retaliate":{let M=h??"their enemies",B={martial:[`${u.name} marshals troops for vengeance against ${M}.`,`Warriors of ${u.name} prepare a punitive expedition against ${M}.`,`${u.name} declares a blood feud against ${M}.`,`The ${u.focus} faction raises arms for retribution against ${M}.`],pious:[`${u.name} calls for divine justice against ${M}.`,`Holy warriors of ${u.name} prepare to smite ${M}.`,`${u.name} declares a crusade against the wickedness of ${M}.`,`The ${u.focus} faction marshals the faithful against ${M}.`],trade:[`${u.name} organizes a trade embargo against ${M}.`,`Mercantile houses of ${u.name} cut ties with ${M}.`,`${u.name} hires bounty hunters to pursue ${M}.`,`The ${u.focus} faction marshals economic power against ${M}.`],arcane:[`${u.name} weaves curses against ${M}.`,`Mages of ${u.name} prepare mystical vengeance on ${M}.`,`${u.name} summons otherworldly allies against ${M}.`,`The ${u.focus} faction marshals arcane forces against ${M}.`]};G.push({category:"faction",summary:`${u.name} seeks retribution`,details:b.pick(B[u.focus]||B.martial),location:h,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed}),j({type:"spawn-event",triggerEvent:`${u.name} retaliation`,turnsUntilResolution:288+b.int(144),data:{category:"faction",summary:`${u.name} strikes back`,details:`Agents of ${u.name} carry out their vengeance. The repercussions will be felt.`,location:h,actors:[u.name]},priority:4});break}case"recruit":{let M=h?H.settlements.find((B)=>B.name===h):b.pick(H.settlements);if(!M)break;G.push({category:"faction",summary:`${u.name} recruiting in ${M.name}`,details:"Agents seek new members, promising coin and purpose.",location:M.name,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed});break}case"trade-embargo":{if(!h)break;let M=H.settlements.find((B)=>B.name===h);if(!M)break;u.attitude[h]=Math.max(-3,(u.attitude[h]??0)-2),G.push({category:"faction",summary:`${u.name} cuts ties with ${h}`,details:`Caravans flying the ${u.name} banner no longer enter ${M.name}.`,location:h,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed}),j({type:"settlement-change",triggerEvent:`Trade embargo by ${u.name}`,turnsUntilResolution:3,data:{settlementName:h,change:"mood-shift",magnitude:-1},priority:2});break}}return G}function YG(u,A,h,H,b,i){let G=[];switch(A){case"seek-revenge":{G.push({category:"town",summary:`${u.name} vows vengeance`,details:`Following ${h}, the ${u.role} swears an oath that cannot go unanswered.`,location:u.location,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed}),j({type:"spawn-event",triggerEvent:`${u.name}'s revenge`,turnsUntilResolution:24+b.int(48),data:{category:"town",summary:`${u.name} makes their move`,details:`The vengeance long promised by the ${u.role} comes to pass.`,location:u.location,actors:[u.name]},priority:3});break}case"flee":{let M=H.settlements.filter((k)=>k.name!==u.location);if(M.length===0)break;let B=b.pick(M);G.push({category:"road",summary:`${u.name} flees ${u.location}`,details:`Driven by ${h}, they take to the road toward ${B.name}.`,location:u.location,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed}),j({type:"spawn-event",triggerEvent:`${u.name}'s flight`,turnsUntilResolution:12+b.int(24),data:{category:"town",summary:`${u.name} arrives in ${B.name}`,details:"The refugee finds uncertain welcome in their new home.",location:B.name,actors:[u.name]},priority:2}),u.location=B.name;break}case"spread-rumors":{let M=u.location;G.push({category:"town",summary:`${u.name} spreads tales`,details:`The ${u.role} speaks openly of ${h}. The story grows in the telling.`,location:M,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed}),j({type:"spawn-rumor",triggerEvent:`${u.name} gossip`,turnsUntilResolution:1,data:{origin:M,target:M,kind:"mystery",text:`${u.name} tells all who will listen: "${h}." The tale spreads.`},priority:2});break}case"seek-protection":{let M=H.factions.filter((k)=>k.focus==="martial"||k.focus==="pious");if(M.length===0)break;let B=b.pick(M);if(G.push({category:"faction",summary:`${u.name} seeks ${B.name}'s protection`,details:`Frightened by ${h}, the ${u.role} appeals to the ${B.focus} faction.`,location:u.location,actors:[u.name,B.name],worldTime:i,realTime:new Date,seed:H.seed}),b.chance(0.5))j({type:"faction-action",triggerEvent:`${u.name}'s appeal`,turnsUntilResolution:6+b.int(12),data:{factionId:B.id,action:"patrol",targetLocation:u.location},priority:2});break}}return G}function xu(u,A,h){let H=u.summary.toLowerCase(),b=u.location??"";if(H.includes("clash")||H.includes("ambush")||H.includes("battle")||H.includes("falls")||H.includes("driven back")){let i=A.npcs.filter((G)=>G.location===b&&G.alive!==!1);for(let G of i)if(h.chance(0.2)){let M=["seek-revenge","flee","spread-rumors","seek-protection"];j({type:"npc-reaction",triggerEvent:u.summary,turnsUntilResolution:6+h.int(30),data:{npcId:G.id,reaction:h.pick(M),cause:u.summary},priority:2})}for(let G of A.factions)if(h.chance(0.15))j({type:"faction-action",triggerEvent:u.summary,turnsUntilResolution:72+h.int(72),data:{factionId:G.id,action:h.chance(0.5)?"patrol":"retaliate",targetLocation:b},priority:3});if(b&&A.settlements.some((G)=>G.name===b))j({type:"settlement-change",triggerEvent:u.summary,turnsUntilResolution:2,data:{settlementName:b,change:"mood-shift",magnitude:-1},priority:1})}if(H.includes("caravan")&&(H.includes("loss")||H.includes("raid"))){let i=A.factions.find((G)=>H.includes(G.name.toLowerCase()));if(i){j({type:"faction-action",triggerEvent:u.summary,turnsUntilResolution:288+h.int(144),data:{factionId:i.id,action:"retaliate",targetLocation:b},priority:4});let G=A.armies.find((M)=>M.ownerId===i.id&&M.supplyLineFrom===b);if(G)j({type:"supply-disruption",triggerEvent:u.summary,turnsUntilResolution:6+h.int(12),data:{armyId:G.id},priority:5})}}if(u.actors?.length&&H.includes("gain renown")){let i=u.actors[0];j({type:"spawn-rumor",triggerEvent:u.summary,turnsUntilResolution:36+h.int(36),data:{origin:b,target:b,kind:"mystery",text:`Tales of ${i}'s deeds spread across the region. Some say they ${h.pick(["slew a beast of legend","recovered ancient treasures","survived impossible odds","earned the gratitude of the common folk"])}.`},priority:2})}if(H.includes("dungeon")||H.includes("ruin")){if(H.includes("artifact")||H.includes("relic")||H.includes("treasure"))j({type:"spawn-antagonist",triggerEvent:u.summary,turnsUntilResolution:24+h.int(48),data:{location:b,threat:"Rivals drawn by tales of treasure",origin:u.summary},priority:3})}}var QG={cp:0.01,sp:0.1,ep:0.5,gp:1,pp:5},$G={A:{coins:{cp:{chance:0.25,dice:"1d6*1000"},sp:{chance:0.3,dice:"1d6*1000"},ep:{chance:0.2,dice:"1d4*1000"},gp:{chance:0.35,dice:"2d6*1000"},pp:{chance:0.25,dice:"1d2*1000"}},gems:{chance:0.5,count:"6d6"},jewelry:{chance:0.5,count:"6d6"},magic:{chance:0.3,count:3},isLair:!0,typicalValue:{min:1e4,max:50000}},B:{coins:{cp:{chance:0.5,dice:"1d8*1000"},sp:{chance:0.25,dice:"1d6*1000"},ep:{chance:0.25,dice:"1d4*1000"},gp:{chance:0.25,dice:"1d3*1000"}},gems:{chance:0.25,count:"1d6"},jewelry:{chance:0.25,count:"1d6"},magic:{chance:0.1,count:1,types:["weapon","armor"]},isLair:!0,typicalValue:{min:2000,max:1e4}},C:{coins:{cp:{chance:0.2,dice:"1d12*1000"},sp:{chance:0.3,dice:"1d4*1000"},ep:{chance:0.1,dice:"1d4*1000"}},gems:{chance:0.25,count:"1d4"},jewelry:{chance:0.25,count:"1d4"},magic:{chance:0.1,count:2},isLair:!0,typicalValue:{min:1000,max:5000}},D:{coins:{cp:{chance:0.1,dice:"1d8*1000"},sp:{chance:0.15,dice:"1d12*1000"},gp:{chance:0.6,dice:"1d6*1000"}},gems:{chance:0.3,count:"1d8"},jewelry:{chance:0.3,count:"1d8"},magic:{chance:0.15,count:2,types:["potion","scroll"]},isLair:!0,typicalValue:{min:2000,max:8000}},E:{coins:{cp:{chance:0.05,dice:"1d10*1000"},sp:{chance:0.3,dice:"1d12*1000"},ep:{chance:0.25,dice:"1d4*1000"},gp:{chance:0.25,dice:"1d8*1000"}},gems:{chance:0.1,count:"1d10"},jewelry:{chance:0.1,count:"1d10"},magic:{chance:0.25,count:3,types:["scroll","ring","wand"]},isLair:!0,typicalValue:{min:3000,max:12000}},F:{coins:{sp:{chance:0.1,dice:"2d10*1000"},ep:{chance:0.2,dice:"1d8*1000"},gp:{chance:0.45,dice:"1d12*1000"},pp:{chance:0.3,dice:"1d3*1000"}},gems:{chance:0.2,count:"2d12"},jewelry:{chance:0.1,count:"1d12"},magic:{chance:0.3,count:3,types:["potion","scroll","weapon"]},isLair:!0,typicalValue:{min:5000,max:25000}},G:{coins:{gp:{chance:0.75,dice:"10d4*1000"},pp:{chance:0.5,dice:"1d6*1000"}},gems:{chance:0.25,count:"3d6"},jewelry:{chance:0.25,count:"1d10"},magic:{chance:0.35,count:4,types:["weapon","armor","misc"]},isLair:!0,typicalValue:{min:8000,max:40000}},H:{coins:{cp:{chance:0.25,dice:"3d8*1000"},sp:{chance:0.5,dice:"1d100*1000"},ep:{chance:0.5,dice:"10d4*1000"},gp:{chance:0.5,dice:"10d6*1000"},pp:{chance:0.25,dice:"5d4*1000"}},gems:{chance:0.5,count:"1d100"},jewelry:{chance:0.5,count:"10d4"},magic:{chance:0.15,count:4},isLair:!0,typicalValue:{min:25000,max:1e5}},I:{gems:{chance:0.5,count:"2d6"},jewelry:{chance:0.5,count:"2d6"},magic:{chance:0.15,count:1},coins:{},isLair:!0,typicalValue:{min:1000,max:5000}},J:{coins:{cp:{chance:1,dice:"3d8"}},isLair:!1,typicalValue:{min:1,max:3}},K:{coins:{sp:{chance:1,dice:"3d6"}},isLair:!1,typicalValue:{min:1,max:5}},L:{coins:{ep:{chance:1,dice:"2d6"}},isLair:!1,typicalValue:{min:3,max:10}},M:{coins:{gp:{chance:1,dice:"2d4"}},isLair:!1,typicalValue:{min:2,max:10}},N:{coins:{pp:{chance:1,dice:"1d6"}},isLair:!1,typicalValue:{min:5,max:30}},O:{coins:{cp:{chance:0.25,dice:"1d4*10"},sp:{chance:0.25,dice:"1d3*10"}},isLair:!1,typicalValue:{min:5,max:20}},P:{coins:{cp:{chance:0.3,dice:"4d6"},sp:{chance:0.3,dice:"3d6"},ep:{chance:0.1,dice:"2d6"}},isLair:!1,typicalValue:{min:5,max:25}},Q:{gems:{chance:0.5,count:"1d4"},coins:{},isLair:!1,typicalValue:{min:50,max:200}},R:{coins:{gp:{chance:0.4,dice:"2d6"}},gems:{chance:0.4,count:"1d4"},jewelry:{chance:0.5,count:"1d4"},isLair:!1,typicalValue:{min:100,max:500}},S:{coins:{},magic:{chance:0.4,count:1,types:["potion"]},isLair:!1,typicalValue:{min:100,max:300}},T:{coins:{},magic:{chance:0.5,count:1,types:["scroll"]},isLair:!1,typicalValue:{min:100,max:500}},U:{coins:{},gems:{chance:0.1,count:"1d4"},jewelry:{chance:0.1,count:"1d4"},magic:{chance:0.7,count:1},isLair:!1,typicalValue:{min:500,max:2000}},V:{coins:{},magic:{chance:0.85,count:2},isLair:!1,typicalValue:{min:1000,max:5000}},Nil:{coins:{},isLair:!1,typicalValue:{min:0,max:0}}},IG=["Longsword","Shortsword","Greatsword","Battleaxe","Warhammer","Mace","Flail","Spear","Dagger","Bow","Crossbow","Halberd"],xG=["Flaming","Frost","Lightning","Venomous","Holy","Unholy","Keen","Vorpal","Dancing","Defending","Disrupting","Seeking","Giant-Slaying","Dragon-Slaying","Undead-Bane","Orc-Cleaver"],qG=["Chain Mail","Plate Mail","Shield","Leather Armor","Scale Mail","Banded Mail","Splint Mail","Helm","Gauntlets","Boots"],_G=["Elven","Dwarven","Mithral","Adamantine","Ethereal","Reflecting","Resistance","Fortification","Shadow","Silent","Flying"],NG=["Healing","Greater Healing","Supreme Healing","Giant Strength","Flying","Invisibility","Speed","Fire Resistance","Cold Resistance","Water Breathing","Gaseous Form","Diminution","Growth","Heroism","Clairvoyance","ESP","Longevity","Poison","Delusion"],SG=["Fireball","Lightning Bolt","Dispel Magic","Protection from Evil","Invisibility","Fly","Haste","Slow","Polymorph","Teleport","Raise Dead","Remove Curse","Disintegrate","Meteor Swarm","Wish"],fG=["Protection","Invisibility","Fire Resistance","Spell Storing","Regeneration","Three Wishes","Telekinesis","X-Ray Vision","Water Walking","Feather Falling","Spell Turning","Free Action","Weakness","Contrariness"],vG=["Magic Missiles","Lightning","Fire","Cold","Polymorph","Paralysis","Fear","Illusion","Enemy Detection","Secret Door Detection","Negation","Wonder"],aG=["Bag of Holding","Boots of Speed","Boots of Elvenkind","Cloak of Elvenkind","Cloak of Protection","Gauntlets of Ogre Power","Girdle of Giant Strength","Helm of Telepathy","Rope of Climbing","Portable Hole","Decanter of Endless Water","Eversmoking Bottle","Crystal Ball","Mirror of Life Trapping","Carpet of Flying","Broom of Flying","Figurine of Wondrous Power","Amulet of Proof Against Detection","Periapt of Health","Ioun Stone","Horn of Blasting","Drums of Panic","Pipes of the Sewers","Scarab of Protection","Medallion of ESP","Necklace of Fireballs","Cube of Force","Sphere of Annihilation","Deck of Many Things"];function EA(u,A){let h=A.match(/(\d+)d(\d+)(?:\*(\d+))?/);if(!h)return 0;let H=parseInt(h[1]),b=parseInt(h[2]),i=h[3]?parseInt(h[3]):1,G=0;for(let M=0;M<H;M++)G+=1+u.int(b);return G*i}function ji(u,A){let b=A==="gem"?[{name:"agate",value:10},{name:"quartz",value:10},{name:"turquoise",value:10},{name:"onyx",value:50},{name:"amethyst",value:100},{name:"garnet",value:100},{name:"pearl",value:100},{name:"jade",value:100},{name:"aquamarine",value:500},{name:"topaz",value:500},{name:"opal",value:1000},{name:"sapphire",value:1000},{name:"emerald",value:1000},{name:"ruby",value:5000},{name:"diamond",value:5000},{name:"star ruby",value:1e4}]:[{name:"silver ring",value:100},{name:"gold ring",value:200},{name:"silver bracelet",value:200},{name:"gold bracelet",value:500},{name:"silver necklace",value:300},{name:"gold necklace",value:1000},{name:"jeweled brooch",value:500},{name:"platinum tiara",value:2000},{name:"gem-encrusted crown",value:5000},{name:"royal scepter",value:1e4}],i=u.pick(b),G=0.5+u.next(),M=Math.floor(i.value*G);return{id:`${A}-${Date.now()}-${u.int(1e4)}`,type:A,description:A==="gem"?`a ${i.name}`:`a ${i.name}`,value:M}}function TG(u,A,h,H){if(!A){let z=["weapon","armor","potion","scroll","ring","wand","misc"];A=u.pick(z)}let b,i,G,M,B=[],k=u.chance(0.05);switch(A){case"weapon":let z=u.pick(IG);if(i=u.chance(0.5)?1:u.chance(0.7)?2:u.chance(0.85)?3:u.chance(0.95)?4:5,u.chance(0.3)){let J=u.pick(xG);b=`${J} ${z} +${i}`,B.push(J.toLowerCase())}else b=`${z} +${i}`;G=i*1000+(B.length>0?2000:0),M=i>=4?"very-rare":i>=3?"rare":i>=2?"uncommon":"common";break;case"armor":let P=u.pick(qG);if(i=u.chance(0.6)?1:u.chance(0.8)?2:u.chance(0.95)?3:4,u.chance(0.25)){let J=u.pick(_G);b=`${J} ${P} +${i}`,B.push(J.toLowerCase())}else b=`${P} +${i}`;G=i*1500+(B.length>0?3000:0),M=i>=3?"very-rare":i>=2?"rare":"uncommon";break;case"potion":let E=u.pick(NG);b=`Potion of ${E}`,G=E.includes("Healing")?50:E.includes("Greater")?150:300,M="common";break;case"scroll":let K=u.pick(SG);b=`Scroll of ${K}`,G=K==="Wish"?25000:K==="Meteor Swarm"?5000:K==="Raise Dead"?3000:500,M=K==="Wish"?"legendary":K.includes("Meteor")?"very-rare":"uncommon";break;case"ring":let L=u.pick(fG);b=`Ring of ${L}`,G=L==="Three Wishes"?50000:L==="Regeneration"?25000:L==="Spell Turning"?15000:5000,M=L==="Three Wishes"?"legendary":L==="Regeneration"?"very-rare":"rare";break;case"wand":b=`Wand of ${u.pick(vG)}`,G=5000+u.int(5000),M="rare",B.push(`${10+u.int(20)} charges`);break;case"staff":b=`Staff of ${u.pick(["Power","the Magi","Healing","Fire","Frost","Thunder"])}`,G=15000+u.int(15000),M="very-rare";break;case"rod":b=`Rod of ${u.pick(["Absorption","Lordly Might","Rulership","Cancellation"])}`,G=20000+u.int(20000),M="very-rare";break;case"misc":default:b=u.pick(aG),G=b.includes("Sphere")?50000:b.includes("Deck")?30000:b.includes("Crystal")?1e4:2000+u.int(3000),M=b.includes("Sphere")||b.includes("Deck")?"legendary":b.includes("Crystal")?"very-rare":"rare";break}if(k)b=b.replace(/\+\d/,"-1"),B.push("cursed");return{id:`magic-${Date.now()}-${u.int(1e4)}`,name:b,category:A,rarity:M,bonus:i,cursed:k,identified:!1,value:G,properties:B,location:H??"unknown",discoveredAt:h}}function yG(u,A,h,H){let b=$G[A],i={cp:0,sp:0,ep:0,gp:0,pp:0},G=[],M=[],B=[];for(let[z,P]of Object.entries(b.coins))if(P&&u.chance(P.chance))i[z]=EA(u,P.dice);if(b.gems&&u.chance(b.gems.chance)){let z=EA(u,b.gems.count);for(let P=0;P<z;P++)G.push(ji(u,"gem"))}if(b.jewelry&&u.chance(b.jewelry.chance)){let z=EA(u,b.jewelry.count);for(let P=0;P<z;P++)M.push(ji(u,"jewelry"))}if(b.magic&&u.chance(b.magic.chance))for(let z=0;z<b.magic.count;z++){let P=b.magic.types?u.pick(b.magic.types):void 0;B.push(TG(u,P,h,H))}let k=0;for(let[z,P]of Object.entries(i))k+=P*QG[z];return k+=G.reduce((z,P)=>z+P.value,0),k+=M.reduce((z,P)=>z+P.value,0),k+=B.reduce((z,P)=>z+P.value,0),{coins:i,totalGoldValue:Math.floor(k),gems:G,jewelry:M,magicItems:B,isHoard:b.isLair,treasureType:A}}var p=0.1,qu=1,_u=10,Xi={potion:5,scroll:1,ring:1,wand:5,staff:40,rod:20,weapon:50,armor:100,misc:20,artifact:30},Yi=500;function Qi(u,A){let h=Math.max(1,Math.ceil(u/4)),H=A==="swamp"?1.5:A==="mountains"?1.3:A==="forest"?1.1:1;return Math.ceil(h*2*H)}function lG(u){let A=0;for(let[h,H]of Object.entries(u.coins))A+=H*p;A+=u.gems.length*qu,A+=u.jewelry.length*_u;for(let h of u.magicItems)A+=Xi[h.category]??20;return A}function $i(u,A,h){let H={coins:{cp:0,sp:0,ep:0,gp:0,pp:0},gems:0,jewelry:0,magicItems:[],weight:0};for(let P of u.remainingMagicItems){let E=A.find((L)=>L.id===P);if(!E)continue;let K=Xi[E.category]??20;if(H.weight+K<=h)H.magicItems.push(P),H.weight+=K}let b=Math.min(u.remainingCoins.pp,Math.floor((h-H.weight)/p));if(b>0)H.coins.pp=b,H.weight+=b*p;let i=Math.min(u.remainingGems,Math.floor((h-H.weight)/qu));if(i>0)H.gems=i,H.weight+=i*qu;let G=Math.min(u.remainingCoins.gp,Math.floor((h-H.weight)/p));if(G>0)H.coins.gp=G,H.weight+=G*p;let M=Math.min(u.remainingJewelry,Math.floor((h-H.weight)/_u));if(M>0)H.jewelry=M,H.weight+=M*_u;let B=Math.min(u.remainingCoins.ep,Math.floor((h-H.weight)/p));if(B>0)H.coins.ep=B,H.weight+=B*p;let k=Math.min(u.remainingCoins.sp,Math.floor((h-H.weight)/p));if(k>0)H.coins.sp=k,H.weight+=k*p;let z=Math.min(u.remainingCoins.cp,Math.floor((h-H.weight)/p));if(z>0)H.coins.cp=z,H.weight+=z*p;return H}function Nu(){return{discoveredHoards:[],circulatingMagicItems:[],recentInfluxes:[],activeExtractions:[]}}function KA(u,A,h,H,b,i,G){let M=[],B=yG(u,A,G,h);if(B.totalGoldValue===0&&B.magicItems.length===0)return M;let k=lG(B),E=(i.parties.find((O)=>O.name===H)?.members?.length??4)*Yi,K={id:`hoard-${Date.now()}`,location:h,discoveredBy:H,discoveredAt:G,totalValue:B.totalGoldValue,magicItems:B.magicItems.map((O)=>O.id),liquidated:!1,percentSpent:0};b.discoveredHoards.push(K);for(let O of B.magicItems)O.discoveredBy=H,O.location=h,b.circulatingMagicItems.push(O);let L="";if(B.coins.gp>0||B.coins.pp>0){let O=B.coins.gp>0?`${B.coins.gp.toLocaleString()} gold`:"",Y=B.coins.pp>0?`${B.coins.pp.toLocaleString()} platinum`:"";L+=[O,Y].filter(Boolean).join(" and ")+". "}if(B.gems.length>0)L+=`${B.gems.length} gems. `;if(B.jewelry.length>0)L+=`${B.jewelry.length} pieces of jewelry. `;let W=Math.ceil(k/E),V=i.dungeons.find((O)=>O.name===h)?.rooms?.length??12,C=Qi(V,"hills");if(W<=1&&k<=E){M.push({category:"dungeon",summary:`${H} discovers and claims a cache worth ${B.totalGoldValue.toLocaleString()} gold`,details:`${L.trim()} Light enough to carry out immediately.`,location:h,actors:[H],worldTime:G,realTime:new Date,seed:i.seed});for(let O of B.magicItems)O.ownerId=H;if(B.totalGoldValue>=500)j({type:"treasure-influx",triggerEvent:`${H} brings treasure to market`,turnsUntilResolution:24+u.int(72),data:{amount:B.totalGoldValue,hoardId:K.id,location:h,discoveredBy:H},priority:3})}else{let O={id:`extraction-${Date.now()}`,hoardId:K.id,location:h,extractingParty:H,remainingCoins:{...B.coins},remainingGems:B.gems.length,remainingJewelry:B.jewelry.length,remainingMagicItems:B.magicItems.map((a)=>a.id),totalWeight:k,extractedWeight:0,tripsCompleted:0,estimatedTripsRemaining:W,startedAt:G,currentLoad:{coins:{cp:0,sp:0,ep:0,gp:0,pp:0},gems:0,jewelry:0,magicItems:[],weight:0},abandoned:!1,completed:!1};O.currentLoad=$i(O,b.circulatingMagicItems,E),O.nextTripCompletes=new Date(G.getTime()+C*60*60*1000),b.activeExtractions.push(O);let Y=W*C,X=Math.round(Y/24*10)/10;if(M.push({category:"dungeon",summary:`${H} discovers a massive hoard worth ${B.totalGoldValue.toLocaleString()} gold!`,details:`${L.trim()} The hoard weighs ${Math.floor(k).toLocaleString()} cn. It will take approximately ${W} trips over ${X} days to extract.`,location:h,actors:[H],worldTime:G,realTime:new Date,seed:i.seed}),B.coins.cp>1000)M.push({category:"dungeon",summary:`${H} prioritizes valuable items`,details:`The ${B.coins.cp.toLocaleString()} copper pieces may be left for later... or never. Platinum, gems, and magic items go first.`,location:h,actors:[H],worldTime:G,realTime:new Date,seed:i.seed})}for(let O of B.magicItems)if(O.rarity==="rare"||O.rarity==="very-rare"||O.rarity==="legendary"){M.push({category:"dungeon",summary:`${H} finds ${O.name}`,details:O.rarity==="legendary"?"A legendary item of incredible power! Word of this will spread far.":`A ${O.rarity} magic item worth approximately ${O.value.toLocaleString()} gold.`,location:h,actors:[H],worldTime:G,realTime:new Date,seed:i.seed});let Y=O.rarity==="legendary"?0.9:O.rarity==="very-rare"?0.6:O.rarity==="rare"?0.3:0;if(u.chance(Y)){let X=O.rarity==="legendary"?"legendary-item":O.category==="weapon"||O.category==="armor"?"magic-weapon":"rare-item",a=Yu(u,i,X,O.name,h,H,O.value,O.id),R=Qu(u,i,a);for(let I of R)i.activeRumors.push(I),M.push(d(I,G,i.seed));for(let I of a.attractsTypes){let x=O.rarity==="legendary"?0.4:O.rarity==="very-rare"?0.25:0.15;if(u.chance(x))j({type:`treasure-${I}`,triggerEvent:`${I} learns of ${O.name}`,turnsUntilResolution:72+u.int(336),data:{itemId:O.id,itemName:O.name,location:h,discoveredBy:H,rumorId:a.id,attractType:I},priority:I==="dragon"||I==="antagonist"?5:3})}}}if(B.isHoard&&B.totalGoldValue>=5000){if(u.chance(0.5)){let O=Yu(u,i,"massive-hoard",void 0,h,H,B.totalGoldValue),Y=Qu(u,i,O);for(let X of Y)i.activeRumors.push(X),M.push(d(X,G,i.seed))}}return M}function sG(u,A,h,H){let b=[];for(let G of A.activeExtractions){if(G.completed||G.abandoned)continue;if(G.nextTripCompletes&&new Date(G.nextTripCompletes)<=H){let M=h.parties.find((k)=>k.name===G.extractingParty);if(u.chance(0.1)){let k=["wandering monsters attack the laden party","rival adventurers ambush them on the way out","the dungeon denizens have reinforced","a cave-in blocks the exit temporarily","thieves were waiting outside"],z=u.pick(k);if(u.chance(0.3)){let P=0.1+u.next()*0.3;if(b.push({category:"dungeon",summary:`${G.extractingParty} ambushed during extraction!`,details:`${z.charAt(0).toUpperCase()+z.slice(1)}. Some treasure is lost in the chaos.`,location:G.location,actors:[G.extractingParty],worldTime:H,realTime:new Date,seed:h.seed}),G.currentLoad.coins.gp=Math.floor(G.currentLoad.coins.gp*(1-P)),G.currentLoad.coins.pp=Math.floor(G.currentLoad.coins.pp*(1-P)),G.currentLoad.gems=Math.floor(G.currentLoad.gems*(1-P)),M&&u.chance(0.4))M.wounded=!0,M.restHoursRemaining=Math.max(M.restHoursRemaining??0,12)}else b.push({category:"dungeon",summary:`${G.extractingParty} fights off attackers during extraction`,details:`${z.charAt(0).toUpperCase()+z.slice(1)}, but the party prevails and continues.`,location:G.location,actors:[G.extractingParty],worldTime:H,realTime:new Date,seed:h.seed})}G.tripsCompleted++,G.lastTripAt=H,G.extractedWeight+=G.currentLoad.weight;for(let k of Object.keys(G.currentLoad.coins))G.remainingCoins[k]-=G.currentLoad.coins[k];G.remainingGems-=G.currentLoad.gems,G.remainingJewelry-=G.currentLoad.jewelry;for(let k of G.currentLoad.magicItems){let z=A.circulatingMagicItems.find((P)=>P.id===k);if(z)z.ownerId=G.extractingParty,z.location=M?.location??G.location;G.remainingMagicItems=G.remainingMagicItems.filter((P)=>P!==k)}if(G.tripsCompleted===1||G.tripsCompleted%3===0){let k=Math.round(G.extractedWeight/G.totalWeight*100);b.push({category:"dungeon",summary:`${G.extractingParty} completes extraction trip #${G.tripsCompleted}`,details:`${k}% of the hoard extracted. ${G.estimatedTripsRemaining-G.tripsCompleted} trips remaining.`,location:G.location,actors:[G.extractingParty],worldTime:H,realTime:new Date,seed:h.seed})}let B=Object.values(G.remainingCoins).reduce((k,z)=>k+z*p,0)+G.remainingGems*qu+G.remainingJewelry*_u+G.remainingMagicItems.length*20;if(B<=0||G.remainingCoins.pp===0&&G.remainingCoins.gp===0&&G.remainingGems===0&&G.remainingJewelry===0&&G.remainingMagicItems.length===0){G.completed=!0;let k=G.remainingCoins.cp+G.remainingCoins.sp+G.remainingCoins.ep;b.push({category:"dungeon",summary:`${G.extractingParty} finishes extracting the hoard!`,details:k>100?`After ${G.tripsCompleted} trips, the valuable items are secured. ${k.toLocaleString()} lesser coins were left behind.`:`After ${G.tripsCompleted} trips, the hoard is fully claimed.`,location:G.location,actors:[G.extractingParty],worldTime:H,realTime:new Date,seed:h.seed});let z=A.discoveredHoards.find((P)=>P.id===G.hoardId);if(z&&z.totalValue>=1000)j({type:"treasure-influx",triggerEvent:`${G.extractingParty} brings treasure to market`,turnsUntilResolution:72+u.int(168),data:{amount:z.totalValue,hoardId:z.id,location:G.location,discoveredBy:G.extractingParty},priority:3})}else{let z=(M?.members?.length??4)*Yi;G.currentLoad=$i(G,A.circulatingMagicItems,z),G.estimatedTripsRemaining=Math.ceil(B/z);let P=h.dungeons.find((L)=>L.name===G.location),E=Qi(P?.rooms?.length??12,"hills");G.nextTripCompletes=new Date(H.getTime()+E*60*60*1000);let K=G.remainingCoins.cp*0.01+G.remainingCoins.sp*0.1+G.remainingCoins.ep*0.5;if(K<50&&G.remainingGems===0&&G.remainingMagicItems.length===0){if(u.chance(0.5))G.abandoned=!0,b.push({category:"dungeon",summary:`${G.extractingParty} abandons remaining copper and silver`,details:`The remaining ${Math.floor(K)} gold worth of base coins isn't worth the danger. They move on.`,location:G.location,actors:[G.extractingParty],worldTime:H,realTime:new Date,seed:h.seed})}}}if(!G.completed&&!G.abandoned&&G.tripsCompleted>0){if(G.tripsCompleted===2&&u.chance(0.4)){let M=A.discoveredHoards.find((z)=>z.id===G.hoardId),B=Yu(u,h,"ongoing-extraction",void 0,G.location,G.extractingParty,M?.totalValue??G.totalWeight*10),k=Qu(u,h,B);for(let z of k)h.activeRumors.push(z),b.push(d(z,H,h.seed));b.push({category:"faction",summary:`Word spreads of ${G.extractingParty}'s treasure haul`,details:"Thieves and rivals take note. The extraction may become more dangerous.",location:G.location,worldTime:H,realTime:new Date,seed:h.seed});for(let z of B.attractsTypes)if(u.chance(0.25))j({type:`treasure-${z}`,triggerEvent:`${z} learns of ${G.extractingParty}'s extraction`,turnsUntilResolution:24+u.int(120),data:{extractionId:G.id,partyName:G.extractingParty,location:G.location,attractType:z},priority:z==="bandit"||z==="monster"?4:3})}}}let i=new Date(H.getTime()-604800000);return A.activeExtractions=A.activeExtractions.filter((G)=>!G.completed&&!G.abandoned||new Date(G.startedAt)>i),b}function mG(u,A,h,H){let b=[];for(let i of A.recentInfluxes){let G=h.settlements.find((B)=>B.id===i.settlementId||B.name===i.settlementId);if(!G)continue;let M=(H.getTime()-new Date(i.arrivedAt).getTime())/86400000;if(M<=7){if(i.amount/(G.population*10)>=0.5){for(let k of Object.keys(G.priceTrends??{})){if(!G.priceTrends)G.priceTrends={};G.priceTrends[k]="high"}if(M===1)b.push({category:"town",summary:`Prices rise in ${G.name}`,details:`A flood of gold from ${i.source} drives up prices. Merchants smile; common folk grumble.`,location:G.name,worldTime:H,realTime:new Date,seed:h.seed})}}else if(M>=60)i.amount=0}A.recentInfluxes=A.recentInfluxes.filter((i)=>i.amount>0);for(let i of A.discoveredHoards){if(i.liquidated||i.percentSpent>=100)continue;if((H.getTime()-new Date(i.discoveredAt).getTime())/86400000>=1&&i.percentSpent<100){let M=100/(14+u.int(14));if(i.percentSpent=Math.min(100,i.percentSpent+M),i.percentSpent>=100){if(i.liquidated=!0,i.liquidatedAt=H,i.totalValue>=5000)b.push({category:"town",summary:`${i.discoveredBy} finishes spending their fortune`,details:`The ${i.totalValue.toLocaleString()} gold hoard has been distributed throughout the region. The economy absorbs the wealth.`,location:i.location,actors:[i.discoveredBy],worldTime:H,realTime:new Date,seed:h.seed})}}}return b}function dG(u,A,h,H){let b=[];for(let i of A.circulatingMagicItems)if(!i.identified&&i.discoveredAt){if((H.getTime()-new Date(i.discoveredAt).getTime())/86400000>=1&&u.chance(0.15)){if(i.identified=!0,i.identifiedAt=H,i.rarity!=="common")b.push({category:"town",summary:`${i.name} identified`,details:i.cursed?"A curse is revealed! The item is not what it seemed.":`The item's true nature is discovered: ${i.properties.join(", ")||"a fine magical item"}.`,location:i.location,worldTime:H,realTime:new Date,seed:h.seed})}}return b}function pG(u,A,h,H){let b=[],i=h.activeRumors.filter((G)=>G.treasureType!==void 0);for(let G of i){if(!u.chance(0.01))continue;switch(u.pick(G.attractsTypes)){case"thieves-guild":b.push({category:"faction",summary:`The underworld takes interest in ${G.itemName??"the treasure"}`,details:`Thieves discuss the ${G.treasureType.replace("-"," ")} discovered by ${G.discoveredBy}. Plans are being made.`,location:G.origin,worldTime:H,realTime:new Date,seed:h.seed}),j({type:"guild-heist-target",triggerEvent:`Guild targets ${G.discoveredBy}'s treasure`,turnsUntilResolution:168+u.int(336),data:{targetParty:G.discoveredBy,itemName:G.itemName,itemId:G.itemId},priority:3});break;case"rival-party":let B=`The ${u.pick(["Iron","Black","Silver","Red","Golden"])} ${u.pick(["Blades","Company","Brotherhood","Hand","Wolves"])}`;b.push({category:"road",summary:`${B} hear of ${G.discoveredBy}'s fortune`,details:"Jealousy and ambition stir. A rival party considers their options.",location:G.origin,worldTime:H,realTime:new Date,seed:h.seed}),j({type:"rival-party-conflict",triggerEvent:`${B} confronts ${G.discoveredBy}`,turnsUntilResolution:48+u.int(168),data:{rivalName:B,targetParty:G.discoveredBy,reason:G.treasureType},priority:4});break;case"collector":let k=`Lord ${u.pick(["Blackwood","Silverton","Goldmane","Ravenholm","Thornwood"])}`,z=Math.floor((G.estimatedValue??1000)*(1.2+u.next()*0.8));b.push({category:"town",summary:`${k} seeks to acquire ${G.itemName??"the treasure"}`,details:`Word reaches ${G.discoveredBy} of a collector offering ${z.toLocaleString()} gold. A legitimate offer, or a trap?`,location:G.origin,actors:[k,G.discoveredBy??"unknown"],worldTime:H,realTime:new Date,seed:h.seed});break;case"dragon":if(G.treasureType==="legendary-item"||G.treasureType==="massive-hoard")b.push({category:"road",summary:"A dragon stirs at rumors of treasure",details:`Ancient instincts awaken. A wyrm has heard of ${G.itemName??"gold"} in ${G.target}.`,location:G.target,worldTime:H,realTime:new Date,seed:h.seed}),j({type:"dragon-seeks-treasure",triggerEvent:"Dragon seeks the treasure",turnsUntilResolution:336+u.int(336),data:{target:G.target,itemName:G.itemName,discoveredBy:G.discoveredBy,value:G.estimatedValue},priority:5});break;case"antagonist":if(h.antagonists&&h.antagonists.length>0){let P=u.pick(h.antagonists);if(P.alive)b.push({category:"faction",summary:`${P.name} covets ${G.itemName??"the treasure"}`,details:`The villain's agents are dispatched. ${G.discoveredBy} has drawn dangerous attention.`,location:P.territory,actors:[P.name,G.discoveredBy??"unknown"],worldTime:H,realTime:new Date,seed:h.seed}),j({type:"antagonist-seeks-item",triggerEvent:`${P.name} hunts for ${G.itemName}`,turnsUntilResolution:168+u.int(504),data:{antagonistId:P.id,antagonistName:P.name,itemName:G.itemName,targetParty:G.discoveredBy},priority:5})}break;case"faction":if(h.factions.length>0){let P=u.pick(h.factions);if(b.push({category:"faction",summary:`${P.name} take interest in ${G.itemName??"the treasure"}`,details:`The ${P.focus} faction considers how ${G.itemName??"this treasure"} might serve their goals.`,location:G.origin,actors:[P.name],worldTime:H,realTime:new Date,seed:h.seed}),u.chance(0.3))j({type:"faction-acquires-item",triggerEvent:`${P.name} moves to acquire ${G.itemName}`,turnsUntilResolution:72+u.int(168),data:{factionId:P.id,itemName:G.itemName,targetParty:G.discoveredBy},priority:3})}break;case"bandit":b.push({category:"road",summary:`Bandits learn of ${G.discoveredBy}'s wealth`,details:`Cutthroats gather on the roads near ${G.target}. An ambush is being planned.`,location:G.target,worldTime:H,realTime:new Date,seed:h.seed}),j({type:"bandit-ambush",triggerEvent:"Bandits ambush treasure-laden party",turnsUntilResolution:24+u.int(72),data:{targetParty:G.discoveredBy,location:G.target},priority:4});break}G.freshness=Math.max(0,G.freshness-2)}return b}function DA(u,A,h,H){let b=[];return b.push(...sG(u,A,h,H)),b.push(...pG(u,A,h,H)),b.push(...mG(u,A,h,H)),b.push(...dG(u,A,h,H)),b}var cG=0.16666666666666666,wG=["giant rats","skeletons","kobolds","goblins","stirges","spiders"],gG=["tarnished coins","old tapestries","silver candlesticks","uncut gems","ancient scrolls"];function eG(u,A){let h=u.pick(wG);if(!u.chance(0.6)){if(u.chance(0.2)){let i=u.pick(gG);return{summary:`${A[0]} notice ${i}`,details:"They mark the cache for later."}}return{summary:`${A[0]} hear ${h} nearby`,details:"Footsteps fade into the dark."}}if(u.chance(0.65))return{summary:`${A[0]} fend off ${h}`,details:"Short clash in the corridors."};return{summary:`${A[0]} driven back by ${h}`,details:"They fall back to safer halls."}}function Ii(u,A,h){if(A==="lair"){if(u>=5)return h.pick(["E","F","D"]);if(u>=3)return h.pick(["C","D","B"]);return h.pick(["C","J","K"])}if(u>=5)return h.pick(["D","E"]);if(u>=3)return h.pick(["C","D"]);return h.pick(["J","K","L","M"])}function nG(u,A,h,H,b,i,G){switch(h.type){case"treasure":{let M=Ii(A.danger,"treasure",u),B=[];if(i&&b&&G){let k=KA(u,M,A.name,H[0],i,b,G);B.push(...k)}return{summary:`${H[0]} discover a treasure cache`,details:`Type ${M} treasure found in the depths.`,fameDelta:1,rare:h.rare,treasureLogs:B}}case"trap":{let M=u.chance(0.2);return{summary:`${H[0]} trigger a trap`,details:M?"A lethal fall in the dark.":"Bruised and shaken, they press on.",fameDelta:M?-1:0,death:M,injury:!M}}case"lair":{let M=u.chance(0.15),B=[];if(!M&&i&&b&&G){let k=Ii(A.danger,"lair",u),z=KA(u,k,A.name,H[0],i,b,G);B.push(...z)}return{summary:`${H[0]} battle lair denizens`,details:M?"They withdraw, leaving fallen behind.":"Beasts broken after a grim melee. Their hoard is claimed.",fameDelta:M?-1:1,death:M,injury:!M&&u.chance(0.3),treasureLogs:B}}case"shrine":case"laboratory":return{summary:`${H[0]} uncover a ${h.type}`,details:"Strange glyphs and relics hint at deeper secrets.",fameDelta:1};case"empty":default:return{summary:`${H[0]} comb dusty halls`,details:"Old bones and silence."}}}function LA(u,A,h,H,b,i,G){let M=[];if(!A.rooms||A.rooms.length===0)return M.push({category:"dungeon",summary:`${A.name} shows no new clues`,details:"Explorers retrace old steps.",location:A.name,actors:h,worldTime:H,realTime:new Date,seed:b}),M;let B=A.rooms.shift();A.explored=(A.explored??0)+1;let k=nG(u,A,B,h,i,G,H),z=i.parties.find((P)=>P.name===h[0]);if(z&&k.fameDelta)z.fame=Math.max(0,(z.fame??0)+k.fameDelta);if(z)z.xp+=200+u.int(800);if(k.rare&&i){let P=e(i,u,A.name,A.name,"mystery",`${h[0]} emerge with a ${k.rare}; traders whisper of shifting prices.`);i.activeRumors.push(P),M.push(d(P,H,b))}if(z&&k.injury)z.wounded=!0,z.restHoursRemaining=Math.max(z.restHoursRemaining??0,24);if(z&&k.death)z.fame=Math.max(0,(z.fame??0)-1);if(M.push({category:"dungeon",summary:`${A.name}: ${k.summary}`,details:k.details,location:A.name,actors:h,worldTime:H,realTime:new Date,seed:b}),k.treasureLogs)M.push(...k.treasureLogs);return M}function xi(u,A,h,H,b,i){if(!u.chance(cG))return;let G=eG(u,h);if(i&&u.chance(0.2)){let M=h[0],B=i.parties.find((k)=>k.name===M);if(B)B.fame=(B.fame??0)+1}if(i&&u.chance(0.1)){let M=e(i,u,A.name,A.name,"dungeon",`${h[0]} whisper about ${A.name}: ${G.summary}`);return i.activeRumors.push(M),d(M,H,b)}return{category:"dungeon",summary:`${A.name}: ${G.summary}`,details:G.details,location:A.name,actors:h,worldTime:H,realTime:new Date,seed:b}}function oG(u){let A=u.getUTCHours();return A>=6&&A<18}function qi(u,A,h,H){if(H)return H;let b=u.settlements.map((B)=>B.name),i=u.dungeons.map((B)=>B.name),G=[...b,...b,...i].filter((B)=>B!==h);if(!G.length)return h;let M=u.parties.find((B)=>B.location===h);if(M&&(M.fame??0)>=3&&A.chance(0.4)){let B=u.dungeons.filter((k)=>k.name!==h&&k.rooms&&k.rooms.length>0);if(B.length>0)return A.pick(B).name}return A.pick(G)}var rG={road:36,clear:24,forest:16,hills:16,mountains:12,swamp:12,desert:16,coastal:20,river:8,ocean:0,reef:0};function JA(u){return(rG[u]??12)/24}function Ju(u,A){if(!A||A<=0)return u;let h=1/(1+0.3*A);return u*h}function tG(u,A,h){let H=[],b=!1;for(let i of u.parties){if(i.restHoursRemaining&&i.restHoursRemaining>0)continue;if(i.status==="idle"&&A.chance(0.8)){if(!i.goal){let z=kA(u,A,i.id);if(z)i.goal={kind:"travel-to",target:z.target,sourceRumorId:z.id}}let G=qi(u,A,i.location,i.goal?.target);if(G===i.location)continue;let M=Ku(u,i.location,G);if(!M||M<=0)continue;let B=Du(u,i.location,G),k=Ju(JA(B),i.fatigue);i.status="travel",i.travel={destination:G,terrain:B,milesRemaining:M,milesPerHour:k},H.push({category:"road",summary:`${i.name} departs ${i.location}`,details:`Bound for ${G} across ${B} (~${M} miles).`,location:i.location,actors:[i.name],worldTime:h,realTime:new Date,seed:u.seed}),b=!0}}if(!b){let i=u.parties.find((G)=>G.status==="idle");if(i){if(i.restHoursRemaining&&i.restHoursRemaining>0)return H;if(!i.goal){let M=kA(u,A,i.id);if(M)i.goal={kind:"travel-to",target:M.target,sourceRumorId:M.id}}let G=qi(u,A,i.location,i.goal?.target);if(G!==i.location){let M=Ku(u,i.location,G);if(M&&M>0){let B=Du(u,i.location,G),k=Ju(JA(B),i.fatigue);i.status="travel",i.travel={destination:G,terrain:B,milesRemaining:M,milesPerHour:k},H.push({category:"road",summary:`${i.name} departs ${i.location}`,details:`Bound for ${G} across ${B} (~${M} miles).`,location:i.location,actors:[i.name],worldTime:h,realTime:new Date,seed:u.seed})}}}}return H}function WA(u,A,h){let H=[];for(let b of u.parties)if(b.restHoursRemaining&&b.restHoursRemaining>0){if(b.restHoursRemaining-=1,b.restHoursRemaining<=0)b.restHoursRemaining=0,b.wounded=!1,H.push({category:"road",summary:`${b.name} completes rest`,details:"Ready to travel again.",location:b.location,actors:[b.name],worldTime:h,realTime:new Date,seed:u.seed})}if(A.chance(0.002)){let b=`band-${u.parties.length}`,i=`${$(A)}'s Band`;u.parties.push({id:b,name:i,members:[$(A),$(A)],location:A.pick(u.settlements).name,status:"idle"}),H.push({category:"faction",summary:`A new band appears near ${u.parties.length>0?u.parties[u.parties.length-1]?.location??"the road":"the road"}`,details:`${i} takes to the byways.`,location:u.parties.length>0?u.parties[u.parties.length-1]?.location:void 0,worldTime:h,realTime:new Date,seed:u.seed})}for(let b of u.parties){if(b.status!=="travel"||!b.travel)continue;if(A.chance(0.25)){let G=Wi(A,b.travel.terrain,h,b.location,[b.name],u.seed);if(G){if(G.delayMiles&&G.delayMiles>0)b.travel.milesRemaining+=G.delayMiles;if(G.fatigueDelta&&G.fatigueDelta>0)b.fatigue=(b.fatigue??0)+G.fatigueDelta,b.travel.milesPerHour=Ju(JA(b.travel.terrain),b.fatigue);if(G.injured)b.wounded=!0,b.restHoursRemaining=Math.max(b.restHoursRemaining??0,24);if(G.death)b.fame=Math.max(0,(b.fame??0)-1),H.push({category:"road",summary:`${b.name} suffers losses`,details:"A grim tally after the fight.",actors:[b.name],location:b.location,worldTime:h,realTime:new Date,seed:u.seed});else b.fame=(b.fame??0)+1;H.push(G)}}if(u.dungeons.some((G)=>G.name===b.travel.destination)&&A.chance(0.3)){let G=u.dungeons.find((B)=>B.name===b.travel.destination),M=xi(A,G,[b.name],h,u.seed,u);if(M)H.push(M)}if(b.travel.milesRemaining-=b.travel.milesPerHour,b.travel.milesRemaining<=0){b.location=b.travel.destination;let G=b.location;if(b.status="idle",b.travel=void 0,b.goal&&b.goal.target===G)b.goal=void 0;if(b.fatigue&&b.fatigue>0)b.fatigue=Math.max(0,b.fatigue-1);H.push({category:"road",summary:`${b.name} arrives at ${G}`,details:oG(h)?"They find an inn and stable their mounts.":"They slip through the gates as lanterns are lit.",location:G,actors:[b.name],worldTime:h,realTime:new Date,seed:u.seed});let M=u.dungeons.find((B)=>B.name===G);if((b.fame??0)>=5&&A.chance(0.3))H.push({category:"town",summary:`${b.name} gain renown`,details:"Locals share tales of their exploits.",location:G,worldTime:h,realTime:new Date,seed:u.seed})}}return H}function Su(u,A,h){return tG(u,A,h)}import{readFile as ub,writeFile as Ab}from"fs/promises";var _i="world.json",fu=2,ib=["road","clear","forest","hills","mountains","swamp","desert","coastal","ocean","reef","river"];function hb(u){if(!u.schemaVersion)u.schemaVersion=1;if(!u.activeRumors)u.activeRumors=[];if(!u.dungeons)u.dungeons=[];if(!u.roads)u.roads=[];if(!u.landmarks)u.landmarks=[];if(!u.ruins)u.ruins=[];if(!u.strongholds)u.strongholds=[];if(!u.armies)u.armies=[];if(!u.mercenaries)u.mercenaries=[];if(!u.nexuses)u.nexuses=[];let A=["grain","timber","ore","textiles","salt","fish","livestock"];for(let h of u.settlements){if(!h.supply)h.supply=Object.fromEntries(A.map((H)=>[H,0]));if(typeof h.mood!=="number")h.mood=0;if(!h.priceTrends)h.priceTrends=Object.fromEntries(A.map((H)=>[H,"normal"]))}if(!u.npcs)u.npcs=[];for(let h of u.npcs){if(h.alive===void 0)h.alive=!0;if(h.fame===void 0)h.fame=0}if(!u.caravans)u.caravans=[];if(!u.factions)u.factions=[];for(let h of u.dungeons)if(h.explored===void 0)h.explored=0;for(let h of u.hexes)if(!ib.includes(h.terrain))console.warn(`Unknown terrain type "${h.terrain}" at (${h.coord.q},${h.coord.r}), defaulting to "clear"`),h.terrain="clear";for(let h of u.parties){if(h.fame===void 0)h.fame=0;if(h.fatigue===void 0)h.fatigue=0}return u.schemaVersion=fu,u}async function OA(){try{let u=await ub(_i,"utf8"),A=JSON.parse(u),h=A.schemaVersion??1;if(h<fu)console.log(`\uD83D\uDCE6 Migrating world from schema v${h} to v${fu}...`);if(A.startedAt=new Date(A.startedAt),A.lastTickAt)A.lastTickAt=new Date(A.lastTickAt);else A.lastTickAt=new Date(A.startedAt),console.log("\u23F0 No lastTickAt found - using startedAt for catch-up baseline");if(A.lastRealTickAt)A.lastRealTickAt=new Date(A.lastRealTickAt);if(A.storyThreads)for(let b of A.storyThreads){if(b.startedAt)b.startedAt=new Date(b.startedAt);if(b.lastUpdated)b.lastUpdated=new Date(b.lastUpdated);if(b.beats){for(let i of b.beats)if(i.timestamp)i.timestamp=new Date(i.timestamp)}if(!b.context)b.context={actorRelationships:[],keyLocations:[],themes:[],motivations:{}};if(!b.branchingState)b.branchingState={path:void 0,choices:[],variables:{}}}if(A.antagonists){for(let b of A.antagonists)if(b.lastSeen)b.lastSeen=new Date(b.lastSeen)}let H=hb(A);return console.log(`\u2713 World loaded successfully (schema v${fu})`),H}catch(u){if(u.code==="ENOENT")return null;throw u}}async function w(u){let A=JSON.stringify(u,null,2);await Ab(_i,A,"utf8")}import{stat as hi}from"fs/promises";function Ni(u,A){let h=new Set(u.caravans.flatMap((b)=>b.escorts||[])),H=u.npcs.filter((b)=>["guard","scout"].includes(b.role)&&!h.has(b.id));if(!H.length)return null;return A.pick(H)}function Si(u,A){let h=new Set(u.caravans.map((b)=>b.merchantId).filter(Boolean)),H=u.npcs.filter((b)=>["merchant","bard"].includes(b.role)&&!h.has(b.id));if(!H.length)return null;return A.pick(H)}function c(u,A,h,H,b){let i=[];if(!A.eventHistory)A.eventHistory=[];if(A.eventHistory.push(u),A.eventHistory.length>200)A.eventHistory=A.eventHistory.slice(-200);switch(u.type){case"raid":i.push(...Gb(u,A,h,H));break;case"battle":i.push(...bb(u,A,h));break;case"death":i.push(...FA(u,A,h,b));break;case"robbery":i.push(...Mb(u,A,h));break;case"assassination":i.push(...Hb(u,A,h,b));break;case"conquest":i.push(...Bb(u,A,h));break;case"alliance":i.push(...kb(u,A,h));break;case"betrayal":i.push(...zb(u,A,h,b));break;case"discovery":i.push(...Wb(u,A,h));break}if(i.push(...Eb(u,A,h)),i.push(...Jb(u,A,h)),i.push(...Kb(u,A,h,b)),u.witnessed&&u.magnitude>=3)Db(u,A,h);return i}function Gb(u,A,h,H){let b=[],i=A.settlements.find((K)=>K.name===u.location);if(!i)return b;let{damage:G,loot:M,casualties:B}=u.data,k=Object.keys(i.supply);for(let K=0;K<G;K++){let L=h.pick(k);i.supply[L]=Math.max(0,i.supply[L]-h.int(5)-1)}i.mood=Math.max(-5,i.mood-Math.ceil(G/2));let z=_(A,i.name);if(z.safety=Math.max(-10,z.safety-G),z.recentEvents.push(u.id),G>=3)z.populationDelta-=Math.floor(G*10),b.push({category:"town",summary:`Refugees flee ${i.name}`,details:"The raid drives families from their homes. The roads fill with the displaced.",location:i.name,worldTime:u.timestamp,realTime:new Date,seed:A.seed});let P=A.npcs.filter((K)=>K.location===i.name&&K.alive!==!1);for(let K=0;K<B&&P.length>0;K++){let L=h.pick(P);if(h.chance(0.3))L.alive=!1,b.push(...FA({...u,id:`${u.id}-death-${K}`,type:"death",victims:[L.name],data:{cause:"raid",killedBy:u.perpetrators?.[0]}},A,h,[]));else{L.morale=(L.morale??0)-3;let W=vu(h,"was-attacked","raid",u.timestamp,u.location,h.pick(["angry","fearful","bitter"]),5+h.int(5),u.perpetrators?.[0],void 0,void 0,!1);au(L,W)}}for(let K of A.factions)if((K.attitude[i.name]??0)>0){let W=q(A,K.id);if(W.recentLosses+=G,W.recentLosses>=5)j({type:"faction-action",triggerEvent:`Raid on ${i.name}`,turnsUntilResolution:6+h.int(12),data:{factionId:K.id,action:"retaliate",targetLocation:i.name},priority:5}),b.push({category:"faction",summary:`${K.name} musters for war`,details:`The attacks on ${i.name} cannot go unanswered. ${K.name} gathers its strength.`,location:i.name,actors:[K.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed}),W.recentLosses=0}let E=A.parties.filter((K)=>K.location===i.name||K.travel&&K.travel.destination===i.name);for(let K of E){let L=n(A,K.id);if(u.perpetrators?.length&&h.chance(0.5))L.vendetta=u.perpetrators[0],L.enemies=[...new Set([...L.enemies??[],u.perpetrators[0]])],b.push({category:"road",summary:`${K.name} vows to hunt the raiders`,details:`Witnessing the devastation, they swear to bring ${u.perpetrators[0]} to justice.`,location:i.name,actors:[K.name,u.perpetrators[0]],worldTime:u.timestamp,realTime:new Date,seed:A.seed}),L.questLog=L.questLog??[],L.questLog.push({id:`quest-${Date.now()}`,type:"hunt",target:u.perpetrators[0],reason:`Avenge the raid on ${i.name}`,progress:0})}return b}function bb(u,A,h){let H=[],{victor:b,loser:i,significance:G}=u.data,M=A.parties.find((E)=>E.name===b),B=A.parties.find((E)=>E.name===i),k=A.factions.find((E)=>E.name===b),z=A.factions.find((E)=>E.name===i);if(M){let E=n(A,M.id);if(E.morale=Math.min(10,(E.morale??0)+G),M.fame=(M.fame??0)+G,E.vendetta===i)E.vendetta=void 0,E.killList=[...E.killList??[],i],H.push({category:"road",summary:`${M.name} completes their vendetta`,details:`${i} falls. The oath is fulfilled.`,location:u.location,actors:[M.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed})}if(B){let E=n(A,B.id);if(E.morale=Math.max(-10,(E.morale??0)-G),B.fame=Math.max(0,(B.fame??0)-1),B.wounded=!0,B.restHoursRemaining=24+h.int(24),G>=3&&h.chance(0.5))E.vendetta=b,E.enemies=[...new Set([...E.enemies??[],b])]}if(k){let E=q(A,k.id);if(E.recentWins+=G,E.power=Math.min(100,E.power+G*2),E.recentWins>=5)H.push({category:"faction",summary:`${k.name} grows bold`,details:"Emboldened by recent victories, they eye new territories.",location:u.location,actors:[k.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed}),E.recentWins=0}if(z){let E=q(A,z.id);if(E.recentLosses+=G,E.power=Math.max(0,E.power-G*2),E.morale=Math.max(-10,(E.morale??0)-G),k&&!E.enemies.includes(k.id))E.enemies.push(k.id),H.push({category:"faction",summary:`${z.name} declares ${k.name} their enemy`,details:"Blood demands blood. Open warfare may follow.",location:u.location,actors:[z.name,k.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed})}let P=A.settlements.find((E)=>E.name===u.location);if(P){P.mood=Math.max(-5,P.mood-1);let E=_(A,P.name);if(E.safety-=1,E.recentEvents.push(u.id),G>=3)E.unrest=Math.min(10,(E.unrest??0)+1)}return H}function FA(u,A,h,H){let b=[],{cause:i,killedBy:G}=u.data,M=u.victims?.[0];if(!M)return b;let B=A.npcs.find((z)=>z.name===M||z.id===M),k=A.antagonists?.find((z)=>z.name===M);if(B){B.alive=!1;let z=B;if(z.depth?.relationships)for(let K of z.depth.relationships){let L=A.npcs.find((V)=>V.id===K.targetId);if(!L||L.alive===!1)continue;let W=K.type==="enemy"?"grateful":G?"angry":"grieving",J=vu(h,K.type==="enemy"?"witnessed-death":"lost-loved-one","death",u.timestamp,u.location,W,5+K.strength,G??B.name,void 0,B.name,!1);if(au(L,J),["ally","lover","kin","mentor"].includes(K.type)&&G)Wu(L,{type:"revenge",target:G,priority:7+h.int(3),progress:0,description:`Avenge ${B.name}'s death at the hands of ${G}`}),b.push({category:"town",summary:`${L.name} swears vengeance for ${B.name}`,details:`The ${L.role}'s grief turns to cold fury. ${G} has made a powerful enemy.`,location:L.location,actors:[L.name,G],worldTime:u.timestamp,realTime:new Date,seed:A.seed})}let P=A.factions.find((K)=>A.npcs.some((L)=>L.loyalty===K.id&&L.id===B.id));if(P){let K=q(A,P.id);if(K.recentLosses+=2,K.morale=Math.max(-10,(K.morale??0)-2),G){let L=A.factions.find((W)=>W.name===G);if(L&&!K.enemies.includes(L.id))K.enemies.push(L.id)}}let E=A.settlements.find((K)=>K.name===B.location);if(E){let K=_(A,E.name);if(B.fame&&B.fame>=3)E.mood=Math.max(-5,E.mood-2),K.unrest=Math.min(10,(K.unrest??0)+1),b.push({category:"town",summary:`${E.name} mourns ${B.name}`,details:"A notable figure has fallen. The settlement is shaken.",location:E.name,worldTime:u.timestamp,realTime:new Date,seed:A.seed})}}if(k){k.alive=!1;for(let z of A.settlements)j({type:"spawn-rumor",triggerEvent:`Death of ${k.name}`,turnsUntilResolution:1+h.int(3),data:{origin:z.name,target:u.location,kind:"mystery",text:`${k.name} ${k.epithet} is dead! Slain near ${u.location}.`},priority:5});if(k.minions&&k.minions>0)if(h.chance(0.5))b.push({category:"faction",summary:`${k.name}'s followers scatter`,details:"With their leader dead, the remaining minions flee into the wilds.",location:u.location,worldTime:u.timestamp,realTime:new Date,seed:A.seed});else b.push({category:"faction",summary:`${k.name}'s followers swear vengeance`,details:"A new leader rises from the ashes, vowing to continue the fallen master's work.",location:u.location,worldTime:u.timestamp,realTime:new Date,seed:A.seed}),j({type:"spawn-antagonist",triggerEvent:`Succession of ${k.name}`,turnsUntilResolution:48+h.int(72),data:{location:u.location,threat:`A successor to ${k.name}`,origin:`The death of ${k.name}`},priority:4})}return b}function Mb(u,A,h){let H=[],{value:b,targetType:i,factionId:G,goods:M}=u.data;if(i==="caravan"){let B=A.settlements.find((k)=>k.name===u.location);if(B){let k=_(A,B.name);k.safety-=2,k.prosperity-=1,H.push({category:"town",summary:`Trade routes near ${B.name} grow dangerous`,details:"Merchants speak of losses. Some refuse to travel until the roads are secured.",location:B.name,worldTime:u.timestamp,realTime:new Date,seed:A.seed})}if(G&&u.perpetrators?.length){let k=q(A,G),z=u.perpetrators[0],P=A.factions.find((E)=>E.name===z||E.id===z);if(P){if(k.casusBelli[P.id]={reason:`the robbery of their caravan near ${u.location}`,magnitude:5},!k.enemies.includes(P.id))k.enemies.push(P.id)}}}if(u.perpetrators?.length){let B=u.perpetrators[0],k=A.parties.find((z)=>z.name===B);if(k){let z=n(A,k.id);z.resources=(z.resources??0)+b}}return H}function Hb(u,A,h,H){let b=[];b.push(...FA(u,A,h,H));let i=A.npcs.find((G)=>G.name===u.victims?.[0]);if(i){let G=A.settlements.find((M)=>M.name===i.location);if(G){let M=_(A,G.name);if(M.unrest=Math.min(10,(M.unrest??0)+3),M.rulerNpcId===i.id)M.rulerNpcId=void 0,M.contested=!0,b.push({category:"town",summary:`${G.name} plunges into chaos`,details:"With their leader dead, factions vie for control. The streets grow tense.",location:G.name,worldTime:u.timestamp,realTime:new Date,seed:A.seed})}}return b}function Bb(u,A,h){let H=[],{conqueror:b,previous:i}=u.data,G=A.settlements.find((k)=>k.name===u.location);if(!G)return H;let M=_(A,G.name),B=A.factions.find((k)=>k.id===b||k.name===b);if(B){M.controlledBy=B.id,M.contested=!1;let k=q(A,B.id);if(!k.territory.includes(G.name))k.territory.push(G.name);if(k.power+=10,i){let P=A.factions.find((E)=>E.id===i||E.name===i);if(P){let E=q(A,P.id);if(E.territory=E.territory.filter((K)=>K!==G.name),E.power=Math.max(0,E.power-10),E.morale-=3,!E.enemies.includes(B.id))E.enemies.push(B.id);if(!k.enemies.includes(P.id))k.enemies.push(P.id)}}let z=B.attitude[G.name]??0;G.mood=z>0?1:-2,H.push({category:"faction",summary:`${G.name} falls under ${B.name} control`,details:i?`The banners of ${i} are torn down. New masters rule.`:"A new power claims this settlement as their own.",location:G.name,actors:[B.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed})}return H}function kb(u,A,h){let H=[],[b,i]=u.actors,G=A.factions.find((B)=>B.name===b),M=A.factions.find((B)=>B.name===i);if(G&&M){let B=q(A,G.id),k=q(A,M.id);if(!B.allies.includes(M.id))B.allies.push(M.id);if(!k.allies.includes(G.id))k.allies.push(G.id);B.enemies=B.enemies.filter((P)=>P!==M.id),k.enemies=k.enemies.filter((P)=>P!==G.id);let z=B.enemies.filter((P)=>k.enemies.includes(P));if(z.length>0){let P=A.factions.find((E)=>E.id===z[0]);if(P)H.push({category:"faction",summary:`${G.name} and ${M.name} unite against ${P.name}`,details:"A pact is sealed. Their common enemy should be worried.",location:u.location,actors:[G.name,M.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed})}}return H}function zb(u,A,h,H){let b=[],{betrayer:i,betrayed:G,nature:M}=u.data,B=A.npcs.find((P)=>P.name===G),k=A.factions.find((P)=>P.name===G),z=A.parties.find((P)=>P.name===G);if(B&&B.alive!==!1){let P=vu(h,"was-betrayed","betrayal",u.timestamp,u.location,"angry",10,i,void 0,void 0,!1);au(B,P),Wu(B,{type:"revenge",target:i,priority:10,progress:0,description:`Make ${i} pay for their treachery`,sourceMemoryId:P.id}),b.push({category:"town",summary:`${B.name} learns of ${i}'s betrayal`,details:`Trust shattered, the ${B.role} speaks of nothing but revenge.`,location:B.location,actors:[B.name,i],worldTime:u.timestamp,realTime:new Date,seed:A.seed})}if(z){let P=n(A,z.id);P.vendetta=i,P.morale=Math.max(-10,(P.morale??0)-5),P.enemies=[...new Set([...P.enemies??[],i])],P.allies=(P.allies??[]).filter((E)=>E!==i)}if(k){let P=A.factions.find((E)=>E.name===i);if(P){let E=q(A,k.id);if(E.allies=E.allies.filter((K)=>K!==P.id),!E.enemies.includes(P.id))E.enemies.push(P.id)}}return b}function Pb(){let u=t("memory-seed");return`mem-${u.int(1e6)}-${u.int(1e6)}`}function vu(u,A,h,H,b,i,G,M,B,k,z=!1){let E={"was-betrayed":[`remembers when ${M??"someone trusted"} betrayed them`,`will never forget the knife in the back from ${M??"an ally"}`,`still tastes the bitterness of ${M??"that"} betrayal`],"was-attacked":[`bears scars from the attack by ${M??"assailants"}`,`remembers the violence done by ${M??"enemies"}`,`flinches at memories of ${M??"that"} assault`],"was-robbed":[`lost everything to ${M??"thieves"}`,`remembers when ${M??"bandits"} took what was theirs`,`still seethes at the theft by ${M??"criminals"}`],"was-insulted":[`burns with shame from ${M??"public"} humiliation`,`will not forget the insult delivered by ${M??"that snake"}`,`remembers every word of ${M??"the"} mockery`],"was-threatened":[`lives with the threat made by ${M??"enemies"}`,`sleeps poorly since ${M??"those"} threats`,`knows ${M??"someone"} wants them dead`],"lost-loved-one":[`grieves for ${M??"the fallen"}`,`carries the loss of ${M??"loved ones"} every day`,`lights candles for ${M??"the dead"}`],"lost-home":[`dreams of ${M??"their lost home"}`,`has no place to return to since ${M??"the destruction"}`,`wanders, homeless since ${M??"that day"}`],"was-imprisoned":[`knows the inside of ${M??"a cell"} too well`,`still has nightmares of ${M??"imprisonment"}`,`values freedom after ${M??"captivity"}`],"was-exiled":[`was cast out of ${M??"their homeland"}`,`remembers the gates of ${M??"home"} closing forever`,`burns to return to ${M??"where they belong"}`],"was-saved":[`owes their life to ${M??"a savior"}`,`will never forget when ${M??"someone"} rescued them`,`considers ${M??"their rescuer"} the truest friend`],"was-healed":[`was brought back from death's door by ${M??"a healer"}`,`owes their health to ${M??"skilled hands"}`,`remembers ${M??"who"} drove away the fever`],"was-enriched":[`prospered thanks to ${M??"a benefactor"}`,`remembers when ${M??"fortune"} smiled upon them`,`knows ${M??"who"} made them wealthy`],"was-defended":[`remembers when ${M??"a champion"} stood for them`,`knows ${M??"who"} had their back when it mattered`,`will always be grateful to ${M??"their defender"}`],"was-taught":[`learned everything from ${M??"a mentor"}`,`carries the lessons of ${M??"a teacher"} still`,`owes their skills to ${M??"a master"}`],"was-promoted":[`rose high thanks to ${M??"opportunity"}`,`remembers when ${M??"fortune"} elevated them`,`knows ${M??"who"} saw their potential`],"was-married":[`wed ${M??"their spouse"} in ${b}`,`remembers the day ${M??"they"} exchanged vows`,`built a life with ${M??"a partner"}`],"had-child":[`became a parent when ${M??"their child"} was born`,`remembers the cry of ${M??"their newborn"}`,`lives now for ${M??"their children"}`],"was-forgiven":[`was pardoned by ${M??"those wronged"}`,`received mercy from ${M??"the aggrieved"}`,`knows the weight lifted by ${M??"forgiveness"}`],"witnessed-heroism":[`saw ${M??"a hero"} do the impossible`,`witnessed ${M??"true"} bravery`,`tells tales of ${M??"heroic"} deeds`],"witnessed-cruelty":[`saw what ${M??"monsters"} are capable of`,`witnessed atrocities committed by ${M??"the cruel"}`,`cannot unsee what ${M??"evil"} did`],"witnessed-miracle":[`saw divine intervention in ${b}`,`witnessed ${M??"a miracle"} that changed everything`,`knows the gods are real after ${M??"the miracle"}`],"witnessed-betrayal":[`saw ${M??"someone"} betray ${k??"an ally"}`,`witnessed treachery between ${M??"allies"}`,`knows what ${M??"the traitor"} is capable of`],"witnessed-death":[`watched ${M??"someone"} die`,`was there when ${M??"they"} fell`,`carries the memory of ${M??"death"}`],"witnessed-discovery":[`was present when ${M??"secrets"} were revealed`,`saw ${M??"the discovery"} that changed everything`,`knows what was found in ${b}`],"witnessed-battle":[`survived the battle at ${b}`,`saw ${M??"armies"} clash`,"knows the chaos of combat firsthand"],"witnessed-festival":[`celebrated ${M??"the festival"} in ${b}`,`remembers the joy of ${M??"that celebration"}`,`danced and drank at ${M??"the feast"}`],"committed-violence":[`shed ${M??"blood"} with their own hands`,`remembers striking down ${M??"an enemy"}`,`knows the weight of killing ${M??"another"}`],"committed-betrayal":[`betrayed ${M??"someone who trusted them"}`,`turned on ${M??"an ally"} when it served them`,`knows they wronged ${M??"a friend"}`],"committed-theft":[`stole from ${M??"others"}`,`took what belonged to ${M??"someone else"}`,`prospers from ${M??"theft"}`],"committed-heroism":[`saved ${M??"lives"} through courage`,`stood against ${M??"danger"} when others fled`,`earned glory through ${M??"brave deeds"}`],"committed-mercy":[`spared ${M??"those"} they could have destroyed`,`showed compassion to ${M??"enemies"}`,`let ${M??"the fallen"} live`],"committed-cruelty":[`did terrible things to ${M??"victims"}`,`showed no mercy to ${M??"the helpless"}`,`carries dark deeds against ${M??"innocents"}`],"broke-oath":[`violated their promise to ${M??"someone"}`,`broke faith with ${M??"those who trusted"}`,`is known to have lied to ${M??"allies"}`],"kept-oath":[`honored their word to ${M??"all"} despite the cost`,`proved their loyalty to ${M??"their promise"}`,`paid dearly to keep faith with ${M??"an oath"}`],"made-friend":[`formed a bond with ${M??"an ally"}`,`found a true companion in ${M??"someone"}`,`counts ${M??"a new friend"} among allies`],"made-enemy":[`earned the hatred of ${M??"an enemy"}`,`crossed ${M??"someone dangerous"}`,`knows ${M??"a foe"} wishes them ill`],"lost-friend":[`lost ${M??"a friend"} to circumstance or death`,`mourns the friendship with ${M??"an old ally"}`,`no longer speaks with ${M??"a former friend"}`],reconciled:[`mended the rift with ${M??"an estranged ally"}`,`forgave ${M??"an old wrong"} and moved on`,`rebuilt the bond with ${M??"someone lost"}`],"fell-in-love":[`loves ${M??"someone"} deeply`,`burns with passion for ${M??"another"}`,`dreams of ${M??"their beloved"}`],"fell-out-of-love":[`no longer loves ${M??"a former partner"}`,`watches ${M??"their ex"} with cold eyes`,`wonders what they ever saw in ${M??"that one"}`],"was-rejected":[`was spurned by ${M??"the one they loved"}`,`knows ${M??"that person"} will never return their feelings`,`carries the sting of ${M??"romantic"} rejection`],"discovered-secret":[`knows ${M??"someone's"} darkest secret`,`learned what ${M??"others"} tried to hide`,`holds dangerous knowledge about ${M??"certain parties"}`]}[A]??[`remembers something about ${M??"the past"}`],K=u.pick(E);return{id:Pb(),category:A,eventType:h,timestamp:H,location:b,emotion:i,target:M,targetId:B,secondaryTarget:k,intensity:G,acted:!1,narrative:K,secret:z}}function au(u,A){if(!u.memories)u.memories=[];if(u.memories.push(A),u.memories.length>30)u.memories.sort((h,H)=>H.intensity-h.intensity||new Date(H.timestamp).getTime()-new Date(h.timestamp).getTime()),u.memories=u.memories.slice(0,30)}function Wu(u,A){if(!u.agendas)u.agendas=[];if(u.agendas.some((h)=>h.type===A.type&&h.target===A.target))return;u.agendas.push(A)}function Eb(u,A,h){let H=[];if(!u.witnessed)return H;let b=A.npcs.filter((M)=>M.location===u.location&&M.alive!==!1),i={battle:"witnessed-battle",raid:"was-attacked",death:"witnessed-death",betrayal:"witnessed-betrayal",discovery:"witnessed-discovery",miracle:"witnessed-miracle",festival:"witnessed-festival"},G={battle:["fearful","angry","proud"],raid:["fearful","angry"],death:["grieving","fearful"],betrayal:["suspicious","angry"],miracle:["inspired","hopeful"],festival:["hopeful","grateful"],discovery:["inspired","suspicious"]};for(let M of b)if(h.chance(0.35)){let B=M,k=i[u.type]??"witnessed-battle",z=G[u.type]??["suspicious"],P=h.pick(z),E=vu(h,k,u.type,u.timestamp,u.location,P,u.magnitude,u.actors?.[0],void 0,u.actors?.[1],!1);au(B,E)}return H}function Kb(u,A,h,H){let b=[];for(let i of H){if(i.resolved)continue;let G=new Set([...u.actors??[],...u.victims??[],...u.perpetrators??[]]),M=new Set(i.actors);if(![...G].some((k)=>M.has(k)))continue;if(i.lastUpdated=u.timestamp,i.beats.push({timestamp:u.timestamp,summary:u.type==="death"?"A key figure falls.":u.type==="battle"?"Blood is spilled.":"Events unfold.",tensionChange:u.magnitude>5?2:1}),i.tension=Math.min(10,i.tension+u.magnitude/3),i.tension>=8&&i.phase!=="climax")i.phase="climax",b.push({category:"faction",summary:`${i.title} approaches its climax`,details:"The threads of fate draw tight. A decisive moment is at hand.",location:i.location,actors:i.actors,worldTime:u.timestamp,realTime:new Date,seed:A.seed});else if(i.tension>=5&&i.phase==="inciting")i.phase="rising";if(u.type==="death"&&u.victims?.some((k)=>i.actors.includes(k))){if(i.type==="hunt"&&i.actors[1]&&u.victims.includes(i.actors[1]))i.resolved=!0,i.phase="resolution",i.resolution="The hunt ends in blood.",b.push({category:"faction",summary:`"${i.title}" concludes`,details:i.resolution,location:u.location,actors:i.actors,worldTime:u.timestamp,realTime:new Date,seed:A.seed})}}return b}function Db(u,A,h){if(!A.settlements.find((b)=>b.name===u.location))return;for(let b of A.settlements){if(b.name===u.location)continue;if(h.chance(0.3))j({type:"spawn-rumor",triggerEvent:u.type,turnsUntilResolution:6+h.int(24),data:{origin:b.name,target:u.location,kind:"mystery",text:Lb(u,h)},priority:u.magnitude})}}function Lb(u,A){let H={raid:[`Raiders struck at ${u.location}. They say ${u.perpetrators?.[0]??"bandits"} were responsible.`,`${u.location} was attacked! Survivors speak of ${u.perpetrators?.[0]??"unknown assailants"}.`],battle:[`A battle was fought near ${u.location}. Blood stains the earth.`,`${u.actors?.join(" and ")??"Warriors"} clashed at ${u.location}.`],death:[`${u.victims?.[0]??"Someone important"} has died at ${u.location}.`,`They say ${u.victims?.[0]??"a notable figure"} met their end. Foul play is suspected.`],robbery:[`Thieves struck near ${u.location}. The roads grow dangerous.`,`A valuable shipment was lost near ${u.location}.`],discovery:[`Something wondrous was found near ${u.location}!`,`Treasure-seekers should head to ${u.location}, they say.`],alliance:[`${u.actors?.join(" and ")??"Great powers"} have joined forces.`,"A pact was sealed. The balance of power shifts."],betrayal:[`Treachery most foul! ${u.actors?.[0]??"Someone"} broke faith.`,`Trust is a currency spent in ${u.location}.`],conquest:[`${u.location} has new masters now.`,`The banners have changed at ${u.location}.`],disaster:[`Catastrophe struck ${u.location}. The gods must be angry.`,`${u.location} suffers greatly. Refugees flee.`],miracle:[`A miracle occurred at ${u.location}! The faithful rejoice.`,`Divine favor shines upon ${u.location}.`],assassination:[`${u.victims?.[0]??"A leader"} was murdered. Intrigue thickens.`,`Someone paid for ${u.victims?.[0]??"a death"} in ${u.location}.`],recruitment:["A faction grows stronger."],defection:["Loyalties shift."],"trade-deal":["Commerce flows."],embargo:["Trade routes close."],festival:[`Celebration in ${u.location}!`],plague:[`Sickness spreads from ${u.location}. Avoid the afflicted.`],famine:[`${u.location} starves. Food is worth gold.`],uprising:[`The people of ${u.location} rise against their masters!`],prophecy:[`Strange omens seen near ${u.location}.`]}[u.type]??[`Something happened at ${u.location}.`];return A.pick(H)}function Jb(u,A,h){let H=[],b=A.npcs.filter((i)=>i.location===u.location&&i.alive!==!1);if(b.length<2)return H;for(let i=0;i<b.length;i++)for(let G=0;G<b.length;G++){if(i===G)continue;let M=b[i],B=b[G],k=M.depth?.traits||[],z=B.depth?.traits||[];if(u.type==="raid"||u.type==="battle"){if(h.chance(0.1)){if(k.includes("brave")||k.includes("honorable")){if(H.push({category:"town",summary:`${B.name} is inspired by ${M.name}`,details:`Witnessing ${M.name}'s courage during the ${u.type}, ${B.name} feels a new bond of loyalty.`,location:u.location,actors:[M.name,B.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed}),h.chance(0.2)&&(z.includes("romantic")||z.includes("naive")))Wu(B,{type:"romance",target:M.name,priority:5,progress:20,description:`Pursue a romantic bond with ${M.name} after the ${u.type}`})}if(k.includes("treacherous")||k.includes("cowardly")){if(h.chance(0.1))Wu(M,{type:"betrayal",target:B.name,priority:6,progress:10,description:`Exploit ${B.name}'s trust during the chaos`})}}}if(u.type==="festival"||u.type==="miracle"){if(h.chance(0.15)){if(k.includes("romantic")||z.includes("romantic"))Wu(M,{type:"romance",target:B.name,priority:4,progress:10,description:`A connection formed during the ${u.type}`})}}}return H}function Wb(u,A,h){let H=[],{item:b,type:i}=u.data,G=A.settlements.find((M)=>M.name===u.location);if(G){let M=_(A,G.name);M.prosperity+=1;for(let B of A.factions)if(h.chance(0.2))H.push({category:"faction",summary:`${B.name} seeks the ${b}`,details:`News of the ${i} reaches the halls of ${B.name}. They begin plotting to acquire it.`,location:u.location,actors:[B.name],worldTime:u.timestamp,realTime:new Date,seed:A.seed})}return H}function _(u,A){if(!u.settlementStates)u.settlementStates={};if(!u.settlementStates[A])u.settlementStates[A]={prosperity:0,safety:5,unrest:0,populationDelta:0,recentEvents:[],contested:!1,defenseLevel:3,quarantined:!1};return u.settlementStates[A]}function q(u,A){if(!u.factionStates)u.factionStates={};if(!u.factionStates[A])u.factionStates[A]={power:50,territory:[],enemies:[],allies:[],resources:100,morale:0,resourceNeeds:[],casusBelli:{},activeOperations:[],recentLosses:0,recentWins:0};return u.factionStates[A]}function n(u,A){if(!u.partyStates)u.partyStates={};if(!u.partyStates[A])u.partyStates[A]={morale:5,resources:50,enemies:[],allies:[],questLog:[],killList:[],reputation:{}};return u.partyStates[A]}function fi(u,A){return u.factions.find((H)=>H.id===A)?.name??A}function RA(u,A,h){let H=[];for(let b of u.caravans){let[i,G]=b.direction==="outbound"?b.route:[b.route[1],b.route[0]],M=GA(u,i),B=GA(u,G);if(!M||!B)continue;if(!b.escorts||b.escorts.length===0){let K=Ni(u,A);if(K)b.escorts=[K.id]}if(!b.merchantId){let K=Si(u,A);if(K)b.merchantId=K.id}let k=Ku(u,M.name,B.name)??12,z=Du(u,M.name,B.name),P=Ju(k/24*0.75,0);if(b.progressHours+=1,b.progressHours*P>=k){if(b.location=B.name,b.direction=b.direction==="outbound"?"inbound":"outbound",b.progressHours=0,Vi(u,B.name,b.goods),b.factionId)bA(u,b.factionId,3),MA(u,b.factionId,B.name,1);let K=b.escorts?$u(u,b.escorts,B.name):[],L=b.merchantId?$u(u,[b.merchantId],B.name):[],W=b.factionId?fi(u,b.factionId):null;if(H.push({category:"town",summary:`${b.name} arrives at ${B.name}`,details:`Bringing ${b.goods.join("/")} from ${M.name}${b.escorts?.length?" with escorts":""}${W?` under banner of ${W}`:""}.`,location:B.name,worldTime:h,realTime:new Date,seed:u.seed}),H.push(...Iu(K,B.name,h,u.seed,u)),H.push(...Iu(L,B.name,h,u.seed,u)),b.factionId&&A.chance(0.4)){let J=`Word spreads that ${b.name} of ${W} reached ${B.name} with ${b.goods.join("/")}.`;H.push(HA(u,A,B.name,b.factionId,J,h))}}else if(A.chance(0.02)){let K=A.pick(u.factions.filter((J)=>J.focus==="martial")||[{name:"Bandits",id:"bandits"}]),L={id:`robbery-${Date.now()}`,type:"robbery",timestamp:h,location:b.location,actors:[K.name],perpetrators:[K.name],magnitude:4,witnessed:!0,data:{value:50+A.int(100),targetType:"caravan",factionId:b.factionId,goods:b.goods}};H.push({category:"road",summary:`${b.name} is raided!`,details:`${K.name} forces have intercepted the caravan en route to ${B.name}.`,location:b.location,actors:[b.name,K.name],worldTime:h,realTime:new Date,seed:u.seed});let W=c(L,u,A,u.antagonists||[],u.storyThreads||[]);H.push(...W),b.progressHours=Math.max(0,b.progressHours-12)}else if(A.chance(0.05)){let K=b.escorts?.length?" under escort":"";if(H.push({category:"road",summary:`${b.name} makes camp${K}`,details:`Road to ${B.name} (${z}) quiet tonight.`,location:b.location,worldTime:h,realTime:new Date,seed:u.seed}),b.factionId&&A.chance(0.1)){bA(u,b.factionId,-2),MA(u,b.factionId,B.name,-1);let L=b.factionId?fi(u,b.factionId):"the caravan";if(b.escorts?.length&&A.chance(0.3)){let J=$u(u,b.escorts,b.location);for(let V of J)if(A.chance(0.2))V.alive=!1,V.wounded=!0,H.push({category:"road",summary:`${V.name} falls defending the caravan`,details:`Loss shakes ${L}.`,location:b.location,worldTime:h,realTime:new Date,seed:u.seed});else V.wounded=!0,V.fame=(V.fame??0)+1;H.push(...Iu(J.filter((V)=>V.alive!==!1),b.location,h,u.seed,u))}else H.push({category:"road",summary:`${b.name} reports losses`,details:`Supplies spoiled en route; banners of ${L} tarnished.`,location:b.location,worldTime:h,realTime:new Date,seed:u.seed});let W=`${b.name} of ${L} lost goods on the road; prices may shift.`;H.push(HA(u,A,b.location,b.factionId,W,h))}}}return H}function Ou(u){if(u>=5&&u<7)return"dawn";if(u>=7&&u<11)return"morning";if(u>=11&&u<14)return"midday";if(u>=14&&u<17)return"afternoon";if(u>=17&&u<20)return"dusk";if(u>=20&&u<23)return"evening";if(u>=23||u<2)return"night";return"deep-night"}var vi={dawn:["as rose light crept across the land","with the first cock-crow","as mist still clung to low places","while dew pearled on grass and stone","as the world stirred from slumber"],morning:["under a brightening sky","as folk went about their labors","with the sun climbing steadily","amid the bustle of morning trade","as smoke rose from breakfast fires"],midday:["under the high sun","as shadows pooled beneath eaves","in the drowsy heat of noon","while sensible folk sought shade","as the bell tolled the sixth hour"],afternoon:["as the day wore on","with lengthening shadows","in the golden afternoon light","as travelers grew road-weary","while the sun began its descent"],dusk:["as purple shadows gathered","with the setting of the sun","as lanterns were kindled","in the gloaming hour","as bats took wing"],evening:["by candlelight and hearth-glow","as the stars emerged one by one","with ale flowing in taprooms","as songs rose from dim taverns","under an indigo sky"],night:["under a canopy of stars","as owls hunted in darkness","with only moonlight for company","in the hush of late night","while decent folk lay sleeping"],"deep-night":["in the witching hour","as even the taverns fell silent","when shadows grew deepest","in the cold hours before dawn","as the world held its breath"]},ai={road:{sights:["wagon ruts worn deep into the earth","a milestone marking leagues to the capital","a wayside shrine with fresh offerings","dust rising from distant hooves","a peddler's cart overturned by the verge","an abandoned cart with broken axles","merchant stalls lined along the roadside","a hanging sign creaking in the wind","fresh horse droppings on the path","a lone scarecrow guarding a field","toll markers carved into boundary stones","a caravan of wagons approaching from the distance","the weathered remains of an old signpost","a stone bridge arching over a muddy stream","fresh graffiti on a merchant wagon","a collapsed roadside well, long abandoned","merchant flags fluttering from tall poles","the faint outline of a ruined watchtower","tracks of many booted feet in the soft earth","a caravan guard sharpening his sword"],sounds:["the creak of wagon wheels","distant hoofbeats","a tinker's bell","the song of road-weary pilgrims","ravens arguing over carrion","the jingle of harness bells","merchants haggling over prices","the flap of canvas wagon covers","children laughing from a nearby farm","the distant bark of a shepherd's dog","caravan drivers shouting commands","the clink of coins being counted","wind whistling through fence posts","the crunch of gravel under boots","a lone traveler whistling a tune","the rumble of distant thunder","birds singing from roadside trees","the occasional crack of a whip","footsteps echoing on cobblestones","the murmur of passing conversations"],smells:["road dust and horse sweat","wildflowers along the verge","smoke from a roadside camp","the tang of iron from a smithy","fresh bread from a traveler's pack","leather and saddle soap","wood smoke from distant chimneys","the sharp scent of pine forests","wet earth after recent rain","hay bales stacked by the roadside","the metallic tang of blood","spices wafting from merchant wagons","fresh manure from farm carts","the sweet smell of wild berries","tobacco smoke from a pipe","the faint odor of decay","perfume from a passing noble","baking bread from a nearby inn","fresh-cut hay in wagon beds","the sharp tang of vinegar"],hazards:["a suspicious band loitering at the crossroads","signs of recent violence: bloodstains, abandoned goods","a broken bridge forcing a detour","bandits watching from the treeline","a rickety rope bridge over a gorge","freshly dug pit traps hidden in grass","a collapsed tunnel through a hill","wolves howling in the distance","a storm brewing on the horizon","flooded ford making crossing dangerous","a landslide blocking the path ahead","poisonous snakes sunning on rocks","a swarm of biting insects","quicksand near the river crossing","a weakened bridge creaking ominously","bear tracks crossing the road","freshly broken wagon wheel spokes","a plague sign nailed to a tree","suspicious footprints in the mud","a hornet's nest in a low branch"]},clear:{sights:["golden wheat swaying in the breeze","a shepherd minding distant flocks","ancient standing stones on a hilltop","a lone oak spreading its branches wide","farmsteads dotting the gentle hills","vast meadows stretching to the horizon","a windmill turning lazily in the breeze","herds of deer grazing peacefully","plowed fields in neat geometric patterns","a thatched cottage with smoke curling from the chimney","stone fences dividing property lines","a scarecrow dressed in ragged clothes","wildflowers painting the landscape in color","a distant village with church spires","grazing cattle with bells around their necks","hay bales scattered across harvested fields","a dirt track winding through the countryside","orchards heavy with ripening fruit","sheep being herded by border collies","a babbling brook cutting through green meadows"],sounds:["skylarks singing overhead","the rustle of tall grass","cattle lowing in distant fields","wind sighing through grain","frogs croaking in nearby ponds","the distant clank of a blacksmith's hammer","children playing in farmyards","roosters crowing at dawn","the buzz of bees in wildflower meadows","waterwheels turning in streams","sheep bells tinkling softly","the flap of laundry on clotheslines","farmers calling to their livestock","the rustle of leaves in gentle breezes","church bells ringing in the distance","the low hum of summer insects","dogs barking at passing travelers","the crunch of gravel paths","wind chimes on cottage porches","the occasional rumble of cart wheels"],smells:["fresh-turned earth","hay and clover","the sweetness of ripening apples","wood smoke from a cottage chimney","new-mown grass and wild herbs","fresh bread baking in ovens","damp earth after morning dew","the sharp scent of cut hay","fruit ripening on orchard trees","fresh manure spread on fields","jasmine blooming in cottage gardens","the clean smell of washed linen","smoke from autumn bonfires","wild mint crushed underfoot","the metallic tang of well water","freshly baked pies cooling on windowsills","the earthy scent of root vegetables","honeysuckle blooming on fences","fresh milk from dairy barns","the sharp tang of farm cider"],hazards:["tracks of some large beast in the soft earth","a burned farmstead, still smoldering","circling crows marking something dead","poisonous snakes hiding in tall grass","sudden drop-offs hidden by vegetation","sinks holes in soft meadow soil","flash floods during heavy rains","rabid animals wandering the plains","tornadoes forming on the horizon","prairie fires spreading rapidly","locust swarms devouring crops","feral dogs hunting in packs","unmarked wells covered by grass","sudden fog reducing visibility","lightning strikes during storms","venomous spiders in hay bales","sharp stones hidden in meadows","sudden hailstorms","marauding bandits using grass for cover","contaminated water sources"]},forest:{sights:["ancient oaks draped in moss","shafts of light piercing the canopy","a clearing where standing stones lurked","fungus growing in strange patterns","a ruined tower choked by vines","towering pines reaching for the sky","a carpet of fallen autumn leaves","moss-covered boulders scattered about","a narrow path winding through underbrush","sun-dappled glades with wildflowers","ancient runes carved into tree bark","a hunter's blind hidden in branches","streams cutting through rocky beds","fairy rings of mushrooms in clearings","vines hanging like curtains from branches","a hollow tree large enough to enter","berries ripening on thorny bushes","animal tracks in soft forest floor","a hermit's hut overgrown with ivy","lightning-struck trees split down the middle"],sounds:["branches creaking overhead","unseen things rustling in undergrowth","the tap of a woodpecker","an eerie silence where birdsong ceased","distant howling at dusk","leaves crunching underfoot","small streams bubbling over rocks","wind whistling through pine needles","owls hooting in the night","squirrels chattering in the branches","the distant crash of a falling tree","frogs singing from hidden ponds","the buzz of insects in the undergrowth","rain dripping from leaves after a shower","the crack of twigs snapping","birds calling territorial warnings","the rustle of small animals fleeing","water dripping from moss-covered rocks","the occasional snap of a trap","echoes of distant axes chopping wood"],smells:["leaf mold and decay","pine resin sharp and clean","the musk of some passing beast","rotting wood and toadstools","wild mint and forest herbs","damp earth and wet bark","the sharp scent of pine sap","wild berries crushed underfoot","smoke from a distant campfire","the clean smell of rain on leaves","mushrooms sprouting after rain","cedar wood and bark chips","the faint scent of wild game","honeysuckle blooming in clearings","the earthy smell of truffles","charred wood from lightning strikes","fresh sawdust from logging","the metallic tang of mineral springs","juniper berries crushed on the path","the sharp tang of wild onions"],hazards:["webs strung between trees, too large for ordinary spiders","claw marks on bark, head-height or higher","bones scattered near a dark hollow","poisonous plants with alluring berries","sudden drops into hidden ravines","quick-mud along stream banks","wolves hunting in coordinated packs","bear dens marked by fresh diggings","bandits using trees for ambush cover","fallen trees blocking narrow paths","vines that constrict when touched","fungus that causes vivid hallucinations","swarms of stinging insects","sharp thorns on berry bushes","unstable ground over abandoned mines","caves that echo with unnatural sounds","trees that bleed red sap","mushrooms that scream when picked","sudden fog that disorients travelers","ancient curses bound to specific groves"]},hills:{sights:["cairns marking ancient graves","the mouth of a cave, dark and inviting","a ruined watchtower on the heights","goats picking their way along cliffs","mist pooling in the valleys below","rolling hills covered in heather","sheep grazing on steep slopes","stone walls dividing hill farms","ancient hill forts with crumbling walls","narrow passes between rocky peaks","waterfalls cascading down cliffs","wild ponies roaming free","quarries carved into hillside rock","wind-bent trees clinging to slopes","stone circles on hilltops","abandoned shepherd huts","hawk nests on rocky outcrops","fossils embedded in cliff faces","hot springs steaming in valleys","zigzag paths climbing steep inclines"],sounds:["wind keening through rocky passes","the clatter of loose stones","a distant rockslide","the scream of a hunting hawk","sheep bells tinkling in the distance","waterfalls roaring down cliffs","wind whistling around boulders","goats bleating on steep slopes","the crunch of gravel under boots","streams rushing through narrow gorges","birds of prey crying overhead","the distant lowing of cattle","rain pattering on slate roofs","thunder echoing between hills","the occasional crack of splitting rock","farmers calling to livestock","wild ponies whinnying","water wheels turning in streams","the flap of laundry in the breeze","church bells from valley villages"],smells:["heather and wild thyme","mineral tang from exposed rock","the cold scent of coming rain","fresh mountain air and ozone","sheep wool and lanolin","damp moss on stone walls","wild garlic growing in cracks","smoke from peat fires","freshly cut stone dust","mineral springs with a metallic tang","wild mint crushed on paths","the sharp scent of gorse flowers","damp earth in valley bottoms","cedar trees lining streams","the faint odor of sheep manure","freshly baked bread from hill farms","juniper berries on low bushes","the clean smell of rain-washed rock","wild roses blooming on slopes","the sharp tang of mountain herbs"],hazards:["a rope bridge in poor repair","fresh rockfall blocking the path","smoke rising from caves\u2014someone, or something, dwells within","sheer drops with no guard rails","loose scree sliding underfoot","sudden mists reducing visibility","bandits using hilltops for surveillance","unstable cliffs prone to collapse","flash floods in narrow valleys","poisonous plants on rocky slopes","bear dens in hillside caves","loose stones starting rockslides","treacherous paths washed out by rain","sudden gusts of wind","hidden sinkholes in meadows","rabid animals in remote areas","lightning strikes on exposed peaks","frost heaves cracking pathways","wild dogs hunting in packs","ancient curses on hilltop monuments"]},mountains:{sights:["snow-capped peaks gleaming in sunlight","a glacier grinding slowly downward","the ruins of a dwarven gatehouse","a frozen waterfall","vast chasms with no visible bottom","eagles soaring on thermal winds","switchback paths climbing steep slopes","avalanche scars on rocky faces","mountain goats leaping between boulders","hot springs steaming in rocky basins","ancient petroglyphs on cliff walls","copper deposits staining rock faces green","crystal formations in cave mouths","lightning-blasted trees at timberline","stone cairns marking safe paths","glaciers carving valleys below","waterfalls plunging into deep pools","condors circling high overhead","meteor impact craters on peaks","bridges spanning raging torrents"],sounds:["the groan of shifting ice","thunder echoing between peaks","the shriek of mountain winds","ominous silence after an avalanche","waterfalls roaring into gorges","wind howling through rocky passes","the crack of splitting rock","avalanches rumbling in the distance","eagles screaming overhead","streams bubbling over smooth stones","the occasional boom of falling ice","wolves howling from distant valleys","the crunch of boots on gravel","wind chimes made of bone","the distant toll of monastery bells","thunder rolling between peaks","the splash of mountain streams","rockslides clattering down slopes","the sharp crack of ice breaking","wind whistling through cave entrances"],smells:["thin cold air","sulfur from hot springs","the iron tang of altitude","fresh snow and ice crystals","pine forests at lower elevations","mineral-rich hot springs","ozone from lightning strikes","wildflowers blooming briefly","charred wood from forest fires","the sharp scent of juniper","freshly quarried stone dust","cedar incense from monasteries","wild mint growing in cracks","the faint metallic tang of ore","crushed rock and gravel","smoke from signal fires","the clean smell of glacial melt","wild berries ripening on bushes","the sharp tang of alpine herbs","fresh goat cheese from herds"],hazards:["unstable ice over deep crevasses","giant footprints in the snow","a cave mouth breathing warm, fetid air","sudden blizzards reducing visibility","rockslides triggered by footsteps","altitude sickness and dizziness","crevasses hidden by snow bridges","mountain lions stalking travelers","sudden fog in mountain passes","lightning strikes on exposed ridges","avalanches triggered by noise","unstable snow bridges over chasms","poisonous plants at high altitudes","extreme cold and frostbite","treacherous ice on steep slopes","bandits using peaks for ambush","sudden gusts of hurricane-force wind","rock falls from crumbling cliffs","contaminated water sources","ancient curses on mountain shrines"]},swamp:{sights:["will-o-wisps dancing over dark water","a drowned village, rooftops jutting above the murk","twisted trees rising from fog","bubbles rising from the deep","a heron standing motionless, watching","cypress trees draped in Spanish moss","alligators sunning on muddy banks","snakelike roots twisting through water","fog-shrouded islands in the distance","abandoned fishing boats rotting in shallows","fireflies dancing at dusk","moss hanging like curtains from branches","sinking houses tilting into the mire","dragonflies skimming the water surface","ancient burial mounds half-submerged","frog eyes gleaming in the darkness","cattails swaying in gentle breezes","the occasional flash of fish scales","rusted tools protruding from mud","vultures perched on dead snags"],sounds:["the croak of countless frogs","something heavy sliding into water","the buzz of biting flies","sucking mud reluctant to release boots","alligators bellowing in the night","water dripping from hanging moss","the splash of jumping fish","wind rustling through cattails","the distant hoot of owls","mosquitoes buzzing in clouds","the gurgle of methane bubbles","tree frogs singing in chorus","the occasional snap of a twig","water lapping against rotting docks","the flap of heron wings taking flight","the deep rumble of bullfrogs","squirrels chattering in cypress crowns","the plop of turtles slipping into water","distant thunder rolling through fog","the whisper of wind through reeds"],smells:["rot and stagnant water","the sweetness of decay","methane rising from the depths","damp earth and wet vegetation","the sharp scent of cypress bark","mud and decomposing leaves","freshwater algae blooming","wild onions growing in clearings","smoke from distant cookfires","the faint tang of salt water","honeysuckle blooming on vines","freshly cut marsh grass","the earthy smell of peat","fish guts from cleaning stations","the sharp bite of black pepper plants","jasmine blooming in the humid air","the faint odor of gunpowder","fresh-caught catfish frying","the metallic tang of bog iron","wild mint crushed underfoot"],hazards:["quicksand lurking beneath innocent-looking moss","humanoid tracks leading into the mire\u2014none returning","a half-sunken boat, owner unknown","venomous snakes hiding in roots","alligator nests in shallow water","sinking mud that traps the unwary","malaria-carrying mosquitoes","poisonous plants with attractive flowers","sudden fog reducing visibility to feet","crocodiles disguised as logs","unstable ground over hidden waterways","bandits using fog for ambush","contaminated water causing illness","leeches in stagnant pools","sharp reeds that cut like razors","sudden storms with lightning","ancient curses on burial mounds","fungus that causes fever dreams","ghost lights leading travelers astray","corrosive bog water damaging equipment"]},desert:{sights:["bleached bones half-buried in sand","mirages shimmering on the horizon","a ruined city of sandstone pillars","an oasis ringed with palms","vultures circling lazily overhead","dunes shifting in the wind","camel caravans crossing the sands","ancient petroglyphs on canyon walls","lightning striking distant mesas","cacti blooming with vibrant flowers","abandoned mining camps","fossil beds exposed by erosion","stone arches carved by wind","salt flats gleaming white","thunderheads forming over mountains","rivers of sand flowing down slopes","bedouin tents pitched in wadis","meteor craters in the hardpan","geyser cones venting steam","caravanserais along ancient routes"],sounds:["the hiss of sand in the wind","the scuttle of scorpions","thunder of a distant sandstorm","the cry of a desert hawk","camels grumbling discontentedly","wind whistling through canyon walls","the crunch of boots on gravel","the occasional crack of splitting rock","jackals yipping in the night","the flap of tent canvas","water dripping in hidden springs","the low hum of heat haze","sand sliding down dune faces","the distant toll of caravan bells","owls hooting from canyon ledges","the splash of oasis springs","locusts buzzing in rare vegetation","thunder echoing across vast distances","the sharp crack of lightning","wind chimes on desert shrines"],smells:["dry heat and dust","the rare sweetness of date palms","the musk of passing camels","sagebrush and creosote","the sharp tang of mineral springs","smoke from desert cookfires","the faint scent of ozone","wildflowers blooming after rain","freshly baked flatbread","spices carried by traders","the metallic tang of copper mines","rain on hot sand creating steam","jasmine blooming in oases","the sharp bite of chili peppers","freshly cut cactus pads","smoke from signal fires","the faint odor of decay","fresh goat milk curdling","cedar incense from shrines","the clean smell of gypsum dust"],hazards:["signs of a sandstorm on the horizon","a dried corpse clutching an empty waterskin","strange geometric carvings in exposed bedrock","scorpions hiding under rocks","rattlesnakes coiled in shade","sudden flash floods in wadis","bandits using dunes for cover","quicksand in dry riverbeds","extreme heat causing heatstroke","contaminated water sources","cactus spines that cause infection","sudden sandstorms blinding travelers","jagged rocks cutting boots","wild dogs hunting in packs","ancient curses on desert ruins","lightning strikes during storms","sinkholes in gypsum flats","venomous spiders in abandoned tents","extreme cold at desert nights","lost travelers turned hostile"]},coastal:{sights:["fishing boats bobbing in the harbor","nets hung to dry on wooden frames","seagulls wheeling over the docks","a lighthouse standing sentinel on the headland","driftwood scattered along the tideline"],sounds:["the cry of seabirds","waves crashing against rocks","the creak of mooring lines","fishermen calling to one another"],smells:["salt spray and seaweed","fresh fish and brine","tar from boat repairs","wood smoke from smokehouses"],hazards:["treacherous rocks hidden beneath the surf","a wrecked ship visible at low tide","smuggler caves in the cliffs"]},ocean:{sights:["endless blue stretching to the horizon","distant sails on the edge of sight","dolphins racing the bow wave","dark shapes moving beneath the surface","a school of flying fish breaking the surface"],sounds:["the endless rhythm of waves","canvas snapping in the wind","the groan of ship timbers","the lonely cry of an albatross"],smells:["salt air and open water","tar and rope","the freshness of a sea breeze"],hazards:["storm clouds gathering on the horizon","debris from a recent shipwreck","an uncharted reef showing white water"]},reef:{sights:["colorful fish darting through coral","the skeleton of a wrecked ship","crystal-clear water revealing the seabed","sea turtles gliding past","white sand beneath turquoise shallows"],sounds:["waves breaking over the reef","the click and rustle of crabs","the splash of diving pelicans"],smells:["salt and sun-warmed sand","seaweed drying on rocks","the clean scent of tropical waters"],hazards:["razor-sharp coral lurking beneath the surface","sharks patrolling the reef edge","a sudden riptide pulling toward deeper water"]},river:{sights:["willows trailing in the current","a stone bridge arching over the water","fishermen in small boats","a watermill turning steadily","herons standing in the shallows"],sounds:["water rushing over stones","the plop of jumping fish","the call of kingfishers","oars dipping rhythmically"],smells:["fresh water and wet earth","water lilies in bloom","the musk of river mud"],hazards:["rapids too dangerous for safe passage","a flooded ford impassable on foot","crocodiles sunning on the banks"]}},Ti={village:{bustle:["chickens scattered before approaching travelers","the blacksmith's hammer rang out steadily","children chased each other through muddy lanes","farmers argued over the price of grain"],tension:["doors were barred and shutters drawn","watchmen eyed strangers with open suspicion","whispered conversations fell silent at approach","a gibbet creaked in the village square"],peace:["old men dozed on benches in the sun","the smell of baking bread drifted from open doors","a wedding party spilled laughing from the chapel","children gathered to hear a pedlar's tales"]},town:{bustle:["merchants hawked wares in crowded market squares","guild banners snapped in the breeze","a crier announced the day's proclamations","the town watch marched in ordered formation"],tension:["tavern brawls spilled into the streets","tax collectors moved under armed guard","gallows stood freshly constructed in the square","rumors of plague set folk on edge"],peace:["fountain water sparkled in the afternoon sun","minstrels played in the garden of the Merchant's Guild","the cathedral bells marked the peaceful hours","street performers drew laughing crowds"]},city:{bustle:["the roar of ten thousand souls going about their business","carriages rattled over cobblestones","exotic spices scented the market district","foreign tongues mingled in the harbor quarter"],tension:["the city watch patrolled in force after dark","a noble's retinue swept commoners from the path","the executioner's block saw fresh use","plague doctors stalked the poorer quarters"],peace:["great temples rose in marble splendor","scholars debated in university cloisters","a grand festival filled the streets with color","the duke's gardens opened to public promenade"]}};function Tu(u,A,h,H){let b=A.getUTCHours(),i=Ou(b),G=u.pick(vi[i]),M=ai[h],B=[];if(u.chance(0.6))B.push(u.pick(M.sights));if(u.chance(0.4))B.push(u.pick(M.sounds));if(u.chance(0.25))B.push(u.pick(M.smells)+" hung in the air");if(H==="ominous"&&u.chance(0.5))B.push(u.pick(M.hazards));let k=B.length?` ${u.pick(B)}.`:"";return`${ku(G)}${k}`}function yi(u,A,h,H){let b=Ti[A.type],i=H??A.mood,G;if(i>=2)G=b.tension;else if(i<=-2)G=b.peace;else G=b.bustle;let M=h.getUTCHours(),B=Ou(M),k=u.pick(vi[B]);return`${ku(u.pick(G))} ${k}.`}function li(u,A,h,H,b,i){let G=i[0]??"The company",M=ai[b],B=[`${G} share a fire with wandering ${A}`,`${G} trade news with passing ${A}`,`${G} and ${A} find common cause`,`${A} offer ${G} aid on the road`,`${G} exchange stories with curious ${A}`,`${G} share trail rations with hungry ${A}`,`${A} guide ${G} to a hidden spring`,`${G} learn local customs from friendly ${A}`,`${A} warn ${G} of dangers ahead`,`${G} assist ${A} with a broken wagon`,`${A} share hunting tips with ${G}`,`${G} trade crafted goods with ${A}`,`${A} invite ${G} to their encampment`,`${G} help ${A} gather firewood`,`${A} show ${G} a shortcut through the wilds`,`${G} band together with ${A} against a common threat`,`${A} teach ${G} a useful survival skill`,`${G} share songs and tales around the campfire`,`${A} provide shelter from the weather`,`${G} aid injured ${A} with healing herbs`],k=[`${G} observe ${A} from a distance`,`${G} skirt around wary ${A}`,`${A} shadow ${G} but keep their distance`,`Tense standoff between ${G} and ${A}`,`${G} watch ${A} warily from cover`,`${A} eye ${G} suspiciously`,`${G} keep their distance from armed ${A}`,`${A} block the path but allow passage`,`${G} signal peaceful intentions to ${A}`,`${A} demand tolls from passing ${G}`,`${G} detour to avoid ${A}'s territory`,`${A} follow ${G} at a safe distance`,`${G} prepare defenses against potential ${A} attack`,`${A} display weapons as a warning`,`${G} offer small gifts to appease ${A}`,`${A} test ${G}'s resolve with challenges`,`${G} hide their valuables from view`,`${A} communicate through gestures and signs`,`${G} move slowly to avoid alarming ${A}`,`${A} mark their territory with warning signs`],z=[`${G} clash with ${A}`,`${A} ambush ${G}`,`Battle joined between ${G} and ${A}`,`${G} face ${A} in deadly combat`,`${A} attack ${G} without warning`,`${G} defend against ${A} assault`,`${A} charge ${G} with weapons drawn`,`${G} battle ${A} for control of the path`,`${A} surround ${G} in a coordinated attack`,`${G} repel ${A} raiding party`,`${A} launch arrows at ${G} from hiding`,`${G} counterattack ${A} invaders`,`${A} poison ${G}'s water supply`,`${G} hunt down marauding ${A}`,`${A} set traps for unwary ${G}`,`${G} storm ${A}'s stronghold`,`${A} burn ${G}'s supplies`,`${G} duel ${A} champions`,`${A} blockade ${G}'s route`,`${G} siege ${A}'s encampment`],P=["Steel rang and blood was spilled, but they prevailed.","The fight was brief and brutal. The survivors withdrew.","With discipline and fury, the foe was broken.","Blades flashed in the uncertain light. When it ended, the way was clear.","Though wounds were taken, the day was won.","Their tactics turned the tide against overwhelming odds.","The foe fought bravely but could not withstand the onslaught.","A decisive strike ended the conflict before it could escalate.","They stood their ground against the charging enemy.","Superior positioning gave them the advantage they needed.","The foe's formation broke under relentless pressure.","Magic and steel combined to turn certain defeat into victory.","They exploited a momentary weakness in the enemy line.","Courage and quick thinking saved the day.","The battle raged fiercely, but their resolve never wavered.","They fought like cornered lions, driving back the attackers.","A well-timed feint created the opening they needed.","The foe's weapons glanced off enchanted armor.","They pressed their advantage until the enemy fled.","Victory came at great cost, but the path was secured."],E=["They were driven back, leaving the field to their enemies.","A bitter retreat, carrying wounded through the darkness.","The rout was complete. They would not soon forget this day.","Blood and humiliation marked the aftermath.","The enemy pressed their advantage relentlessly.","Overwhelming numbers told against them.","A critical mistake opened the door to disaster.","They fought valiantly but were simply outmatched.","The foe's ferocity was beyond anything they had expected.","Bad luck and poor positioning sealed their fate.","They stood their ground as long as they could.","The battle turned against them with terrifying speed.","Injuries and fatigue took their toll.","The enemy's tactics were simply too clever.","They retreated in good order, preserving what they could.","The cost of victory was too high for their foe to pursue.","A momentary lapse led to catastrophic consequences.","They learned a hard lesson about underestimating enemies.","The terrain worked against them from the beginning.","Fate smiled upon their enemies this day."],K=["Words proved mightier than steel on this occasion.","Coin changed hands. Honor was satisfied, barely.","An uneasy bargain was struck beneath wary eyes.","Neither side wished to die today. Terms were agreed.","Diplomacy prevailed where force might have failed.","They reached an accommodation that served both sides.","A compromise was hammered out after tense negotiations.","They found common ground in their mutual interests.","The exchange of gifts sealed the temporary truce.","Cultural misunderstandings were resolved through patience.","They traded information as valuable as gold.","A non-aggression pact was established.","They agreed to respect each other's territories.","The meeting ended with mutual respect, if not friendship.","They parted as wary allies rather than bitter enemies.","A hostage exchange ensured good behavior.","They established rules for future encounters.","The negotiation revealed unexpected shared values.","Both sides gained knowledge that might prove useful.","They left the meeting with hope for peaceful coexistence."],L=["They ran. There was no shame in it\u2014only survival.","Discretion proved the better part of valor.","A fighting withdrawal, but a withdrawal nonetheless.","Sometimes wisdom is knowing when to flee.","They withdrew to fight another day.","Strategic retreat preserved their strength.","The odds were insurmountable; they chose life over glory.","They faded into the wilderness, leaving no trail.","A tactical withdrawal under covering fire.","They vanished into the shadows before the enemy could react.","Preserving their lives was the wiser course.","They retreated with honor intact.","The battle was lost, but the war continued.","They slipped away while the enemy celebrated prematurely.","A calculated withdrawal to more favorable ground.","They left the field but not their dignity.","Survival trumped victory in this encounter.","They retreated in good order, minimizing losses.","The enemy's numbers forced a strategic withdrawal.","They lived to fight\u2014and win\u2014another battle."],W,J;switch(h){case"friendly":W=u.pick(B),J=K;break;case"cautious":W=u.pick(k),J=H==="flight"?L:K;break;case"hostile":default:W=u.pick(z),J=H==="victory"?P:H==="defeat"?E:H==="flight"?L:K}let V=u.pick(J);if(u.chance(0.3))V+=` ${ku(u.pick(M.sights))} marked the scene.`;return{summary:W,details:V}}function ZA(u,A,h,H){if(!H?.npcs?.length&&!H?.parties?.length&&u.chance(0.7))return null;let b=h.getUTCHours(),i=Ou(b);if(i==="night"||i==="deep-night")return null;let G=Ti[A.type],M=H?.tension??A.mood,B={low_tension:[`Fair weather and fair dealing in ${A.name}`,`${A.name} enjoys prosperous trade`,`Peace reigns in the markets of ${A.name}`],normal:[`Commerce flows through ${A.name}`,`The usual business in ${A.name}`,`${A.name} sees steady trade`],high_tension:[`Unrest simmers in ${A.name}`,`Tensions run high in ${A.name}'s streets`,`Trouble brewing in ${A.name}`]},k=M>=2?"high_tension":M<=-2?"low_tension":"normal",z=u.pick(B[k]),P=u.pick(G.bustle);if(H?.npcs?.length){let E=H.npcs[0];P+=` ${E.name} the ${E.role} was seen about town.`}if(H?.parties?.length){let E=H.parties[0];if((E.fame??0)>=3)P+=` Folk whispered of ${E.name}'s exploits.`}return{summary:z,details:P}}function si(u,A,h,H){let i={clear:{summaries:[`Blue skies over ${A.name}`,`Fair weather blesses ${A.name}`,`The sun shines upon ${A.name}`],details:["Perfect conditions for travel and trade.","Not a cloud marred the heavens.","Farmers gave thanks for the gentle weather."]},cloudy:{summaries:[`Clouds gather over ${A.name}`,`Grey skies hang over ${A.name}`,`Overcast weather at ${A.name}`],details:["Whether rain would follow, none could say.","The mood matched the dull sky.","Old wounds ached with the change in pressure."]},rain:{summaries:[`Rain falls on ${A.name}`,`${A.name} weathers a downpour`,`The heavens open over ${A.name}`],details:["The streets emptied as folk sought shelter.","Merchants cursed as goods needed covering.","Children splashed in growing puddles."]},storm:{summaries:[`Storm lashes ${A.name}`,`Thunder rolls over ${A.name}`,`Tempest strikes ${A.name}`],details:["Shutters slammed and animals huddled in barns.","Lightning illuminated the darkened streets.","The old folk said such storms brought change."]},snow:{summaries:[`Snow blankets ${A.name}`,`Winter's grip tightens on ${A.name}`,`${A.name} wakes to fresh snowfall`],details:["Sounds were muffled under the white covering.","The cold drove all but the hardiest indoors.","Children made sport while adults worried over firewood."]},fog:{summaries:[`Fog shrouds ${A.name}`,`Mist rolls through ${A.name}`,`${A.name} vanishes into fog`],details:["Shapes loomed and vanished in the murk.","Sound carried strangely in the thick air.","The watch doubled their patrols, seeing danger in every shadow."]}}[h];return{summary:u.pick(i.summaries),details:u.pick(i.details)}}function ku(u){if(!u)return u;return u.charAt(0).toUpperCase()+u.slice(1)}var Ob=["January","February","March","April","May","June","July","August","September","October","November","December"],Fb=[{name:"New Year",month:0,day:1,description:"The start of a new year brings hope and renewal.",effects:{moodBonus:1}},{name:"Valentine's Day",month:1,day:14,description:"A day of love and affection.",effects:{moodBonus:1}},{name:"April Fools",month:3,day:1,description:"Pranks and jokes fill the air.",effects:{moodBonus:1}},{name:"Halloween",month:9,day:31,description:"The veil between worlds thins. Ghosts and ghouls roam.",effects:{magicPotent:!0}},{name:"Christmas",month:11,day:25,description:"Gifts are exchanged and families gather.",effects:{moodBonus:2,tradeBonus:!0}}];function Fu(u,A){let H=Math.floor(u.getTime()/86400000)%30,b;if(H<7)b="new";else if(H<15)b="waxing";else if(H<22)b="full";else b="waning";return{weather:A??"clear",weatherDuration:12,moonPhase:b,activeEffects:{}}}function hu(u){if(u>=2&&u<=4)return"spring";if(u>=5&&u<=7)return"summer";if(u>=8&&u<=10)return"autumn";return"winter"}function mi(u){return Ob[u%12]}function yu(u){let A=mi(u.getUTCMonth()),h=u.getUTCDate(),H=u.getUTCFullYear(),b=Rb(h);return`${A} ${h}${b}, ${H}`}function Rb(u){let A=["th","st","nd","rd"],h=u%100;return A[(h-20)%10]||A[h]||A[0]}function Zb(u){let A=u.getUTCMonth(),h=u.getUTCDate();for(let H of Fb)if(A===H.month&&h===H.day)return H;return}var Vb={spring:{clear:0.3,cloudy:0.25,rain:0.3,storm:0.1,snow:0.02,fog:0.08},summer:{clear:0.5,cloudy:0.2,rain:0.15,storm:0.1,snow:0,fog:0.05},autumn:{clear:0.25,cloudy:0.3,rain:0.25,storm:0.05,snow:0.05,fog:0.15},winter:{clear:0.2,cloudy:0.25,rain:0.1,storm:0.05,snow:0.3,fog:0.1}};function VA(u,A,h){let H=Vb[A];if(h&&u.chance(0.6))return h;let b=u.next(),i=0;for(let[G,M]of Object.entries(H))if(i+=M,b<i)return G;return"clear"}function CA(u){switch(u){case"clear":return{travelSpeedMod:1,encounterChanceMod:1,visibilityReduced:!1,outdoorActivityPenalty:!1,descriptiveCondition:"fine weather",moodModifier:1,combatModifier:0,magicModifier:0,narrativeHooks:["Perfect weather for a journey","The gods smile upon travelers","A beautiful day for commerce"]};case"cloudy":return{travelSpeedMod:1,encounterChanceMod:1,visibilityReduced:!1,outdoorActivityPenalty:!1,descriptiveCondition:"overcast skies",moodModifier:0,combatModifier:0,magicModifier:0,narrativeHooks:["An oppressive sky weighs on spirits","The gray light hides intentions","Change comes with the clouds"]};case"rain":return{travelSpeedMod:0.75,encounterChanceMod:0.8,visibilityReduced:!0,outdoorActivityPenalty:!0,descriptiveCondition:"steady rain",moodModifier:-1,combatModifier:-1,magicModifier:1,narrativeHooks:["Rain drives folk indoors\u2014and secrets outdoors","Footprints wash away quickly","The rivers rise","Crops drink deep"]};case"storm":return{travelSpeedMod:0.5,encounterChanceMod:0.5,visibilityReduced:!0,outdoorActivityPenalty:!0,descriptiveCondition:"raging storm",moodModifier:-2,combatModifier:-2,magicModifier:2,narrativeHooks:["The storm covers all sounds","Lightning illuminates hidden truths","Only the desperate or the mad travel now","Something stirs in the thunder","The old gods speak in the wind"]};case"snow":return{travelSpeedMod:0.6,encounterChanceMod:0.7,visibilityReduced:!0,outdoorActivityPenalty:!0,descriptiveCondition:"falling snow",moodModifier:0,combatModifier:-1,magicModifier:1,narrativeHooks:["Tracks show clearly in fresh snow","The cold claims the unwary","Beauty and danger in equal measure","Supplies become precious","Fire is life"]};case"fog":return{travelSpeedMod:0.8,encounterChanceMod:1.2,visibilityReduced:!0,outdoorActivityPenalty:!1,descriptiveCondition:"thick fog",moodModifier:-1,combatModifier:0,magicModifier:1,narrativeHooks:["The fog hides friend and foe alike","Sounds carry strangely","The veil between worlds thins","Ghosts walk more freely","Perfect weather for secrets"]}}}function di(u){switch(u){case"spring":return{travelMod:1,encounterMod:1.1,economicMod:0.9,moodMod:1,agricultureMod:1.5,militaryMod:0.8,narrativeHooks:["New life stirs in the land","The thaw reveals what winter hid","Young animals are vulnerable","Rivers run high with snowmelt","Romance blooms with the flowers"],monsters:["wolves","bears","goblins","bandits"],events:["flooding","migration","romance","planting-festival","disease-outbreak"]};case"summer":return{travelMod:1.1,encounterMod:1,economicMod:1.1,moodMod:1,agricultureMod:1.2,militaryMod:1.2,narrativeHooks:["The long days favor the bold","Armies march while the roads are dry","Travelers fill the roads","The heat breeds tempers","Droughts threaten the harvest"],monsters:["dragons","giants","orcs","trolls"],events:["war","tournament","drought","plague","trade-fair"]};case"autumn":return{travelMod:1,encounterMod:1.2,economicMod:1.3,moodMod:0,agricultureMod:2,militaryMod:1,narrativeHooks:["The harvest will determine who survives winter","Creatures grow desperate before the cold","The veil between worlds thins","Old things stir in the dying light","Debts come due before winter"],monsters:["undead","werewolves","demons","fey"],events:["harvest","haunting","succession","wedding","famine"]};case"winter":return{travelMod:0.7,encounterMod:0.6,economicMod:0.7,moodMod:-1,agricultureMod:0,militaryMod:0.5,narrativeHooks:["The cold is a patient killer","Communities huddle together","Old rivalries simmer by the fire","The desperate take desperate measures","Ice locks the roads","Hunger gnaws at the edges"],monsters:["frost-giants","ice-trolls","yeti","white-dragons","wolves"],events:["starvation","siege","murder","conspiracy","fire"]}}}function Cb(u,A,h,H,b){let i=di(A);if(!u.chance(0.05))return null;let M={spring:{summaries:[`Spring rains flood areas near ${h.name}`,`Young couples celebrate romance in ${h.name}`,`Fresh spring produce arrives in ${h.name}`,`Gardening begins in earnest near ${h.name}`,`Wildflowers bloom around ${h.name}`],details:["Heavy rains cause flooding. Some areas become impassable.","Love is in the air as spring brings renewal and hope.","Fresh fruits and vegetables arrive from nearby farms.","The earth awakens. Gardens are planted and tended.","Colorful wildflowers carpet the meadows and hills."]},summer:{summaries:[`Heat wave affects ${h.name}`,`Summer travelers arrive in ${h.name}`,`Local festival announced in ${h.name}`,`Dry conditions worry farmers near ${h.name}`,`Busy market days in ${h.name}`],details:["The sun beats down relentlessly. People seek shade and water.","The roads fill with merchants, pilgrims, and adventurers.","Community events bring people together for celebration.","Lack of rain threatens crops. Farmers watch the skies anxiously.","Trade flourishes as people buy and sell in the warm weather."]},autumn:{summaries:[`Harvest season peaks in ${h.name}`,`Mysterious occurrences near ${h.name}`,`Cool weather arrives in ${h.name}`,`Animals prepare for winter near ${h.name}`,`Fall colors surround ${h.name}`],details:["Crops are gathered. The harvest determines winter prosperity.","Strange sightings and sounds as the veil thins.","Temperatures drop. People prepare for colder months.","Wildlife grows more active before hibernation.","Trees display brilliant colors before winter dormancy."]},winter:{summaries:[`Snowfall covers ${h.name}`,`Winter supplies monitored in ${h.name}`,`Indoor activities flourish in ${h.name}`,`Fire breaks out in ${h.name}`,`Cold weather isolates ${h.name}`],details:["Snow blankets everything. Travel becomes difficult.","Food stores are carefully managed for the long winter.","People gather indoors for warmth and entertainment.","Dry conditions make fires more dangerous.","Heavy snow and cold limit movement and communication."]}}[A],B=u.int(M.summaries.length);return{category:"weather",summary:M.summaries[B],details:M.details[B],location:h.name,worldTime:H,realTime:new Date,seed:b}}function Ub(u,A,h,H,b){let i=[`${h.name} celebrations in ${A.name}`,`${A.name} observes ${h.name}`,`The spirit of ${h.name} fills ${A.name}`],G=["Festivities fill the streets with joy and merriment.","Merchants offer special deals; the air smells of celebration.","People gather to mark this special occasion.","The community comes together in celebration.","Old traditions are honored and new memories made.","Visitors are welcomed with festive cheer."];return{category:"town",summary:u.pick(i),details:`${h.description} ${u.pick(G)}`,location:A.name,worldTime:H,realTime:new Date,seed:b}}function UA(u,A,h,H){let b=[],i=Fu(h,H.weather),G=h.getUTCDate(),M=h.getUTCMonth(),B=h.getUTCFullYear(),k=new Date(h.getTime()-86400000),z=k.getUTCDate(),P=k.getUTCMonth(),E=k.getUTCFullYear();if(G===1&&z>1){if(M===0&&P===11)b.push({category:"town",summary:`Happy New Year: ${B}`,details:"Church bells ring across the land. A fresh page turns in the chronicle.",worldTime:h,realTime:new Date,seed:u.seed});else if(M!==P)b.push({category:"town",summary:`The month of ${mi(M)} begins`,details:`${ku(hu(M))} ${M<6?"strengthens its grip":"settles over the land"}.`,worldTime:h,realTime:new Date,seed:u.seed})}let K=hu(i.month),L=VA(A,K,H.weather);if(L!==H.weather){let O=A.pick(u.settlements),Y=si(A,O,L,h);b.push({category:"weather",summary:Y.summary,details:Y.details,location:O.name,worldTime:h,realTime:new Date,seed:u.seed})}i.weather=L;let W=Zb(h);if(W){for(let O of u.settlements)if(b.push(Ub(A,O,W,h,u.seed)),W.effects.moodBonus)O.mood=Math.min(3,O.mood+W.effects.moodBonus)}if(i.moonPhase==="full"&&H.moonPhase!=="full")b.push({category:"weather",summary:"The full moon rises",details:"Silver light bathes the land. Strange things stir in the shadows.",worldTime:h,realTime:new Date,seed:u.seed}),i.activeEffects.omens=["Werewolves hunt","Ghosts walk","The fey are restless"];if(A.chance(0.002)){let O=[{summary:"Eclipse darkens the sky",details:"For long minutes, day becomes night. Animals panic. Priests pray."},{summary:"A comet blazes overhead",details:"Seers proclaim doom. Others see opportunity. All agree: change is coming."},{summary:"Aurora lights the northern sky",details:"Rivers of color flow across the heavens. The old folk speak of portents."},{summary:"The earth trembles",details:"A quake rattles buildings and nerves alike. Some walls crack; some secrets are exposed."}],Y=A.pick(O);b.push({category:"weather",summary:Y.summary,details:Y.details,worldTime:h,realTime:new Date,seed:u.seed})}for(let O of u.settlements){let Y=Cb(A,K,O,h,u.seed);if(Y){b.push(Y);let X=di(K),a=CA(L);O.mood=Math.max(-3,Math.min(3,O.mood+X.moodMod*0.1+a.moodModifier*0.1))}}if(L==="storm"&&A.chance(0.1)){let O=A.pick(u.settlements),Y=[{summary:`Lightning strikes ${O.name}`,details:"A building catches fire. The bucket brigade forms."},{summary:`Flooding in ${O.name}`,details:"The river overflows its banks. Lower districts evacuate."},{summary:`Roof collapse in ${O.name}`,details:"The wind proves too much for an old structure. Fortunately, no deaths."},{summary:`Tree falls on ${O.name} road`,details:"The main thoroughfare is blocked. Traffic reroutes through cramped alleys."}],X=A.pick(Y);b.push({category:"weather",summary:X.summary,details:X.details,location:O.name,worldTime:h,realTime:new Date,seed:u.seed}),O.mood=Math.max(-3,O.mood-1)}if(L==="snow"&&K==="winter"&&A.chance(0.05)){let O=A.pick(u.settlements);b.push({category:"weather",summary:`Heavy snow isolates ${O.name}`,details:"The roads are impassable. The settlement must rely on its own stores.",location:O.name,worldTime:h,realTime:new Date,seed:u.seed})}if(L==="fog"&&A.chance(0.08)){let O=A.pick(u.settlements),Y=[{summary:`Robbery in ${O.name} under cover of fog`,details:"The thieves vanished into the murk before anyone could react."},{summary:`Body discovered in ${O.name} fog`,details:"The victim was not killed by the weather. The watch investigates."},{summary:`Smugglers slip through ${O.name}`,details:"Contraband moves freely when no one can see."}],X=A.pick(Y);b.push({category:"town",summary:X.summary,details:X.details,location:O.name,worldTime:h,realTime:new Date,seed:u.seed})}let J=h.getUTCMonth(),V=new Date(h.getTime()-86400000).getUTCMonth(),C=hu(V);if(J!==V&&K!==C)b.push({category:"weather",summary:`${ku(K)} arrives`,details:jb(A,K,C),worldTime:h,realTime:new Date,seed:u.seed});return{logs:b,newCalendar:i}}function jb(u,A,h){let H={spring:["Spring arrives with melting snow and swelling rivers.","Birds return and flowers bloom as winter finally releases its grip.","The earth awakens from its long slumber. Life begins anew.","Warmer weather brings anticipation. Gardens and fields prepare for growth."],summer:["Summer heat builds as days grow longer and hotter.","The sun dominates the sky. Crops flourish in the warmth.","Travel increases as roads dry and weather improves.","Hot days bring both opportunity and the need for caution."],autumn:["Fall colors emerge as temperatures begin to cool.","Harvest season brings bounty and the preparation for winter.","Days shorten and nights grow longer. A time of change approaches.","The land shows its autumn finery before winter's approach."],winter:["Winter arrives with the first frosts and cooling winds.","Snow begins to fall, covering the world in white.","Cold weather drives people indoors. Communities huddle together.","The long winter nights bring reflection and storytelling."]};return u.pick(H[A])}function pi(u,A,h){let b={road:{clear:["Dust rises from the dry road.","The cobbles gleam in sunlight."],cloudy:["The road stretches grey beneath grey skies."],rain:["The road has become a river of mud.","Puddles fill every rut."],storm:["The road is nearly impassable in the downpour."],snow:["Snow covers the road, hiding its dangers."],fog:["The road vanishes into white ahead and behind."]},forest:{clear:["Shafts of light pierce the canopy."],cloudy:["The forest is gloomy beneath the overcast."],rain:["Rain patters on leaves, a thousand tiny drums."],storm:["Branches whip and trees groan in the wind."],snow:["Snow lies in patches where it pierces the canopy."],fog:["Mist winds between the trunks like searching fingers."]},hills:{clear:["The hilltops stand sharp against the blue."],cloudy:["Clouds cling to the higher peaks."],rain:["Rivulets carve new paths down every slope."],storm:["Lightning seeks the hilltops. Thunder follows."],snow:["The hills are white quilts, beautiful and deadly."],fog:["The valleys have become lakes of mist."]},mountains:{clear:["The peaks gleam with eternal snow."],cloudy:["Clouds obscure all but the lowest slopes."],rain:["Waterfalls multiply. The paths run with water."],storm:["The mountain seems alive with fury."],snow:["Fresh snow makes every path treacherous."],fog:["The world shrinks to arms-length in the murk."]},swamp:{clear:["Steam rises from the murky waters."],cloudy:["The swamp is even more oppressive beneath grey skies."],rain:["There is no shelter. Water above, water below."],storm:["Lightning illuminates horrors half-seen in the reeds."],snow:["Snow sits uneasily on the unfrozen mire."],fog:["The fog could hide anything. It probably does."]},desert:{clear:["The sun beats down without mercy."],cloudy:["A rare respite from the relentless glare."],rain:["The desert drinks. Flash floods threaten wadis."],storm:["Sandstorm. Bury yourself and pray."],snow:["The dunes wear caps of white. It will not last."],fog:["Morning mist burns away by the third hour."]}}[u]?.[A]??["The weather is unremarkable."];return h.pick(b)}var Xb={"bandit-chief":["the Red","Blackhand","the Grinning","Scar","Goldtooth","the Wolf"],"orc-warlord":["Bonecruncher","the Brutal","Skullsplitter","Bloodaxe","the Destroyer"],"dark-wizard":["the Pallid","of the Black Tower","the Whisperer","Shadowbane","the Unbound"],vampire:["the Immortal","of the Crimson Kiss","Nightwalker","the Thirsty","the Ancient"],dragon:["the Magnificent","Flamescale","the Terror","Goldhoarth","the Sleeping Death"],"cult-leader":["the Prophet","the Enlightened","Voice of the Deep","the Chosen","the Reborn"],"corrupt-noble":["the Grasping","Silvertongue","the Ambitious","of the Iron Purse","the Betrayer"],"renegade-knight":["the Fallen","Oathbreaker","the Dishonored","Black Shield","the Condemned"],"beast-lord":["of the Wild","the Untamed","Packmaster","the Feral","Beastcaller"],necromancer:["the Pale","Gravebinder","of the Charnel House","the Deathless","Bonewarden"],"fey-lord":["the Mercurial","of the Twilight Court","the Enchanter","Dreamweaver","the Fair Folk's Champion"],"demon-bound":["the Damned","Hellsworn","of the Burning Pact","the Tormented","Soultrader"],"pirate-captain":["Blacksail","the Scourge","of the Crimson Tide","Stormchaser","the Corsair King","Deadwater"],"sea-raider":["the Reaver","Wavebreaker","of the Northern Fleet","Ironprow","the Sea Wolf","Saltblood"],"kraken-cult":["Voice of the Deep","the Tentacled One","Deepcaller","the Drowned Prophet","Ink-Touched"],"ghost-ship":["the Eternal","of the Phantom Fleet","Never-Sinking","the Damned Voyage","Deathwatch"],"sea-witch":["of the Sunken Isle","Storm-Sister","the Tide-Turner","Saltweaver","the Siren's Bane"]},Yb={"bandit-chief":["Wealth stolen from the rich and kept from the poor","Revenge on the authorities who wronged them","Building an empire of outlaws","Survival in a cruel world"],"orc-warlord":["Glory in battle and dominion over the weak","Uniting the tribes under one banner","Driving the softskins from ancestral lands","Pleasing the dark gods with slaughter"],"pirate-captain":["Plunder enough gold to retire as a king","Vengeance on the navy that betrayed them","Building a pirate republic free from all law","Finding the legendary treasure of a lost fleet"],"sea-raider":["Glory and plunder in the old ways","Claiming coastal lands for their people","Sacrifices to appease the sea gods","Testing their strength against softened southerners"],"kraken-cult":["Awakening the great beast from the deep","Drowning the surface world in endless waves","Gaining the favor of things that should not be","Preparing the way for the masters below"],"ghost-ship":["Breaking the curse that binds the crew","Collecting souls to replace the damned","Eternal hunting of those who wronged them in life","Completing the voyage they were denied"],"sea-witch":["Dominion over all who sail","Revenge on the sailors who wronged them","Gathering power from drowned souls","Summoning leviathans to do their bidding"],"dark-wizard":["Forbidden knowledge at any cost","Power over life and death","Revenge on the academy that expelled them","Ascending to godhood"],vampire:["Building a dynasty of the undead","Reclaiming lost nobility","An endless feast of blood","Finding a cure\u2014or spreading the curse"],dragon:["Accumulating a hoard beyond measure","Ruling as a god over lesser beings","Ancient grudges against humanity","Simple, terrible hunger"],"cult-leader":["Awakening a slumbering deity","Preparing the world for transformation","Gathering power through faithful","Fleeing a doom only they can see"],"corrupt-noble":["Absolute power over the region","Wealth beyond counting","Destroying rival houses","Ascending to royalty"],"renegade-knight":["Vengeance on those who betrayed their honor","Proving that might makes right","Carving out a domain by the sword","Finding redemption through blood"],"beast-lord":["Driving civilization from the wild places","Protecting the beasts from hunters","Ruling a kingdom of fang and claw","Becoming one with the primal spirits"],necromancer:["Conquering death itself","Raising an army that never tires","Speaking with those long dead","Punishing the living for ancient wrongs"],"fey-lord":["Reclaiming lands stolen by mortals","Playing games with human lives","Fulfilling ancient bargains","Escaping the ennui of eternity"],"demon-bound":["Fulfilling a hellish contract","Spreading corruption to delay their damnation","Breaking free of infernal bonds","Serving dark masters for promised power"]},Qb={"bandit-chief":["cunning tactician","inspires fierce loyalty","knows every back road","never fights fair"],"orc-warlord":["brutally strong","surprisingly clever","leads from the front","respects worthy foes"],"dark-wizard":["commands fell magic","always prepared","paranoid and secretive","speaks in riddles"],vampire:["supernaturally charming","centuries of experience","patient as the grave","rage beneath the calm"],dragon:["ancient and wise","pride is their weakness","treasure-obsessed","respects courage"],"cult-leader":["magnetic personality","truly believes","sees omens everywhere","protects the inner circle"],"corrupt-noble":["politically connected","buys loyalty","never gets hands dirty","underestimates commoners"],"renegade-knight":["master combatant","broken honor haunts them","attracts other outcasts","seeks death in battle"],"beast-lord":["fights with animal fury","commands beasts","hates civilization","respects natural law"],necromancer:["surrounded by undead","fears true death","hoards knowledge","once was idealistic"],"fey-lord":["bound by their word","capricious moods","allergic to iron","cannot lie outright"],"demon-bound":["hellfire at their call","desperate and dangerous","seeks victims constantly","bound by the contract"],"pirate-captain":["knows every cove","crew would die for them","master sailor","surprisingly honorable to their code"],"sea-raider":["born on the waves","berserker fury","strike fast and vanish","worship the old sea gods"],"kraken-cult":["speak with sea creatures","breathe underwater","inhuman patience","madness grants insight"],"ghost-ship":["cannot truly die","passes through storms","crew feels no pain","draws other lost ships"],"sea-witch":["commands weather","knows drowned secrets","binds sailors to service","ageless and bitter"]},$b={"bandit-chief":["gold can buy their followers","enemies among their own","wanted by law"],"orc-warlord":["tribal rivalries","superstitious","can be challenged to single combat"],"dark-wizard":["spells require preparation","physical frailty","obsessive over research"],vampire:["sunlight","running water","holy symbols","must be invited in"],dragon:["vulnerable underbelly","pride can be manipulated","long slumber cycles"],"cult-leader":["the prophecy has flaws","rival cults","depends on followers' faith"],"corrupt-noble":["paper trail of crimes","enemies at court","cowardly in person"],"renegade-knight":["old comrades","sense of honor still lingers","death wish"],"beast-lord":["cannot enter settlements","beasts can be calmed or frightened","isolated"],necromancer:["destroy the phylactery","consecrated ground","the dead sometimes rebel"],"fey-lord":["cold iron","broken promises","cannot enter uninvited"],"demon-bound":["holy water","true names","the contract has loopholes"],"pirate-captain":["letters of marque can sway them","crew loyalty has limits","trapped on land","old rivals among pirates"],"sea-raider":["ice in their homeland","gods demand costly sacrifices","divided clans","vulnerable on land"],"kraken-cult":["the beast demands feeding","other cults oppose them","surface dwellers are needed","symbols of the sun god"],"ghost-ship":["the original log tells their doom","holy ground blocks them","bound to certain waters","can be put to rest"],"sea-witch":["must touch seawater daily","iron shackles","old lovers remember the truth","the drowned can rebel"]};function ci(u,A,h,H=3+u.int(5)){let b=$(u),i=u.pick(Xb[A]),G=Qb[A],M=[];for(let z=0;z<2&&G.length>0;z++){let P=u.pick(G);if(!M.includes(P))M.push(P)}let B=$b[A],k=[];for(let z=0;z<2&&B.length>0;z++){let P=u.pick(B);if(!k.includes(P))k.push(P)}return{id:`antagonist-${Date.now()}-${u.int(1e4)}`,name:b,epithet:i,type:A,threat:H,territory:h,motivation:u.pick(Yb[A]),notoriety:1+u.int(3),defeats:0,victories:0,nemeses:[],followers:5+u.int(H*10),treasure:100*H+u.int(500),alive:!0,traits:M,weaknesses:k}}function wi(u,A,h,H){let b=[],i=[`A new threat arises: ${u.name} ${u.epithet}`,`${u.name} ${u.epithet} makes their presence known`,`Word spreads of ${u.name} ${u.epithet}`,`The shadow of ${u.name} ${u.epithet} falls over the region`],G={"bandit-chief":["A ruthless outlaw who commands a growing band of cutthroats.","Their gang has been preying on travelers and caravans."],"orc-warlord":["The tribes rally to a new war-chief. Raids have intensified.","Orc banners have been seen where they were not seen before."],"dark-wizard":["Strange lights and stranger disappearances mark their domain.","Wizards whisper of forbidden arts practiced in secret."],vampire:["The pale sickness spreads. Livestock found drained.","An old castle has new occupants who shun the day."],dragon:["Fire in the hills. Flocks decimated overnight.","The old stories speak of such terrors. Now they live again."],"cult-leader":["A new faith spreads among the desperate and dispossessed.","Rituals in the night. Converts who speak in tongues."],"corrupt-noble":["Taxes rise. Justice is bought and sold. The law protects only the wealthy.","Those who speak against them disappear. Those who comply grow poor."],"renegade-knight":["A warrior who abandoned oaths now carves a bloody path.","Former comrades weep for what they must hunt."],"beast-lord":["The forests grow dangerous. Animals attack without provocation.","Hunters become the hunted. Something commands the wild things."],necromancer:["Graves disturbed. The dead walk. Children have nightmares.","Old tombs have been opened. What was taken? What was released?"],"fey-lord":["Time runs strange near the old stones. Travelers vanish for years.","The Fair Folk hold court in the twilight, and mortals are their toys."],"demon-bound":["Sulfur and screaming in the night. Bargains offered at crossroads.","Someone has made a pact. The price will be paid by many."]};return b.push({category:"faction",summary:h.pick(i),details:h.pick(G[u.type]),location:u.territory,actors:[`${u.name} ${u.epithet}`],worldTime:H,realTime:new Date,seed:A.seed}),j({type:"spawn-rumor",triggerEvent:`${u.name} appearance`,turnsUntilResolution:1+h.int(6),data:{origin:u.territory,target:u.territory,kind:"threat",text:`Travelers speak of ${u.name} ${u.epithet}. ${u.motivation}.`},priority:4}),b}function jA(u,A,h,H){let b=[];if(!u.alive)return b;let i={"bandit-chief":[{summary:`${u.name}'s gang raids a caravan`,details:"Goods seized, drivers left bound on the road."},{summary:`${u.name} expands their territory`,details:"New hideouts established. More recruits join."},{summary:`${u.name} offers "protection"`,details:"Villages face a choice: pay tribute or burn."}],"orc-warlord":[{summary:`${u.name}'s horde raids the frontier`,details:"Farms burned. Captives taken."},{summary:`${u.name} demands tribute`,details:"Submit or be destroyed, the messengers say."},{summary:`${u.name} defeats a rival chief`,details:"The horde grows stronger. Warbands unite."}],"dark-wizard":[{summary:`${u.name} conducts a dark ritual`,details:"Strange lights in the sky. Animals flee."},{summary:`Agents of ${u.name} gather components`,details:"Graverobbing. Herb theft. Missing children."},{summary:`${u.name} curses a village`,details:"Crops wither. Wells run foul. Prayers go unanswered."}],vampire:[{summary:`${u.name} claims another victim`,details:"Pale. Drained. The marks are unmistakable."},{summary:`${u.name} turns a new thrall`,details:"Another joins the undying court."},{summary:`${u.name} hosts a midnight ball`,details:"Nobles attend. Some do not return."}],dragon:[{summary:`${u.name} demands tribute`,details:"Gold and livestock, or the village burns."},{summary:`${u.name} is seen on the wing`,details:"Terror grips all who witness the passage."},{summary:`${u.name} destroys a settlement`,details:"Fire and ruin. Few survivors."}],"cult-leader":[{summary:`${u.name} gains new followers`,details:"The desperate find purpose. The faithful grow."},{summary:`${u.name} performs a public miracle`,details:"Believers multiply. Skeptics are troubled."},{summary:`${u.name} declares a prophecy`,details:"The end times approach. Only the faithful will be saved."}],"corrupt-noble":[{summary:`${u.name} seizes more land`,details:"Legal pretexts, backed by armed men."},{summary:`${u.name} silences a critic`,details:"An accident. Everyone knows. No one speaks."},{summary:`${u.name} hosts a lavish feast`,details:"While the common folk starve, nobles toast."}],"renegade-knight":[{summary:`${u.name} challenges a champion`,details:"Another body. Another notch on a bloodied blade."},{summary:`${u.name} takes a keep by force`,details:"No quarter given. No surrender accepted."},{summary:`${u.name} recruits dispossessed knights`,details:"A fellowship of the fallen forms."}],"beast-lord":[{summary:`${u.name}'s beasts attack travelers`,details:"Wolves. Bears. Worse. They hunt together."},{summary:`${u.name} drives settlers from the forest`,details:"Homesteads abandoned. The wild reclaims."},{summary:`${u.name} corrupts tame animals`,details:"Dogs turn on masters. Horses bolt into the wild."}],necromancer:[{summary:`${u.name} raises the dead`,details:"A cemetery stands empty. Its occupants walk."},{summary:`${u.name} binds a powerful spirit`,details:"The hauntings begin. None can rest."},{summary:`${u.name} seeks ancient tombs`,details:"Old graves are opened. Old evils released."}],"fey-lord":[{summary:`${u.name} steals a child`,details:"A changeling left in the cradle."},{summary:`${u.name} enchants a grove`,details:"Those who enter forget the way out."},{summary:`${u.name} makes a bargain`,details:"A mortal gets their wish. The price comes due."}],"demon-bound":[{summary:`${u.name} offers dark bargains`,details:"Desperate souls sign away more than they know."},{summary:`${u.name} spreads corruption`,details:"Madness. Violence. The taint spreads."},{summary:`${u.name} summons a lesser demon`,details:"The pact demands servants. Servants are provided."}]},G=h.pick(i[u.type]);u.notoriety=Math.min(10,u.notoriety+1),u.lastSeen=H,u.followers=(u.followers??0)+h.int(3),u.treasure=(u.treasure??0)+h.int(10),b.push({category:"faction",summary:G.summary,details:G.details,location:u.territory,actors:[`${u.name} ${u.epithet}`],worldTime:H,realTime:new Date,seed:A.seed});let M=A.settlements.find((B)=>B.name===u.territory);if(M){if(M.mood=Math.max(-5,M.mood-1),["bandit-chief","orc-warlord","dragon"].includes(u.type)&&h.chance(0.5)){let B=Object.keys(M.supply),k=h.pick(B),z=Math.min(M.supply[k],2+h.int(5));if(M.supply[k]-=z,z>0)b.push({category:"town",summary:`${u.territory} suffers losses`,details:`${u.name}'s depredations cost the settlement dearly. Supplies dwindle.`,location:u.territory,worldTime:H,realTime:new Date,seed:A.seed})}}if(u.type==="cult-leader"&&h.chance(0.3)){let B=A.npcs.filter((k)=>k.location===u.territory&&k.alive!==!1);if(B.length>0){let k=h.pick(B);k.reputation=Math.max(-3,k.reputation-1),b.push({category:"town",summary:`${k.name} falls under ${u.name}'s influence`,details:`The ${k.role}'s eyes hold a new fervor. They speak of the prophet's wisdom.`,location:u.territory,actors:[k.name,u.name],worldTime:H,realTime:new Date,seed:A.seed})}}if(u.type==="vampire"&&h.chance(0.2)){let B=A.npcs.filter((k)=>k.location===u.territory&&k.alive!==!1);if(B.length>0){let k=h.pick(B);k.alive=!1,b.push({category:"town",summary:`${k.name} found dead in ${u.territory}`,details:`Pale. Drained. The marks of ${u.name}'s feeding are unmistakable.`,location:u.territory,actors:[k.name],worldTime:H,realTime:new Date,seed:A.seed}),j({type:"settlement-change",triggerEvent:`${k.name}'s death`,turnsUntilResolution:1,data:{settlementName:u.territory,change:"mood-shift",magnitude:-2},priority:3})}}if(u.type==="dragon"&&h.chance(0.2)){if(M){let B=Object.keys(M.supply);for(let k of B)M.supply[k]=Math.max(0,M.supply[k]-h.int(3));M.mood=Math.max(-5,M.mood-2),b.push({category:"town",summary:`${u.name} burns ${u.territory}`,details:"Fire rains from above. The settlement counts its dead and mourns its losses.",location:u.territory,worldTime:H,realTime:new Date,seed:A.seed})}}if(h.chance(0.3))j({type:"settlement-change",triggerEvent:G.summary,turnsUntilResolution:2,data:{settlementName:u.territory,change:"mood-shift",magnitude:-1},priority:2});if(u.notoriety>=3&&h.chance(0.4)){for(let B of A.settlements)if(B.name!==u.territory&&h.chance(0.3))j({type:"spawn-rumor",triggerEvent:G.summary,turnsUntilResolution:3+h.int(6),data:{origin:B.name,target:u.territory,kind:"monster-sign",text:`Travelers speak of ${u.name} ${u.epithet}. The roads grow dangerous.`},priority:3})}return b}function gi(u,A){let h=[],H=1+u.int(3),b=["bandit-chief","bandit-chief","orc-warlord","dark-wizard","cult-leader","corrupt-noble","beast-lord","necromancer"];for(let i=0;i<H;i++){let G=u.pick(b),M=u.pick(A.settlements).name,B=2+u.int(4);h.push(ci(u,G,M,B))}return h}var Ib=["Citadel","Catacombs","Sanctum","Archives","Forge","Bastion","Ossuary","Vault"],xb=["Shattered","Forgotten","Buried","Nameless","Sunken","Cursed","Ashen","Silver"];function ei(u,A,h,H){let b=`${u.pick(xb)} ${u.pick(Ib)}`,i=2+u.int(4),G=2+u.int(5),M={id:`ruin-${Date.now()}-${u.int(1000)}`,name:b,description:`An ancient ${b.toLowerCase()} from the ${u.pick(["Age of Wonders","First Age","Empire of Dust"])}.`,location:A,rooms:[],cleared:!1,danger:G,history:`${b} was once a center of ${u.pick(["magic","trade","war","faith"])} before its fall.`};return M.rooms=ju(u,{depth:i,danger:G,id:M.id,name:M.name,coord:M.location}),M}function XA(u,A,h){let H=[];for(let b of u.ruins)if(b.cleared&&!b.occupiedBy&&A.chance(0.01)){let i=A.pick(u.factions);b.occupiedBy=i.name,b.cleared=!1,b.danger+=2,H.push({category:"faction",summary:`${i.name} occupies ${b.name}`,details:"Seeking a strategic base, the faction has moved into the cleared ruins.",location:`hex:${b.location.q},${b.location.r}`,actors:[i.name],worldTime:h,realTime:new Date,seed:u.seed})}return H}var ni={road:{creatures:["bandits","merchants","pilgrims","patrol guards","beggars","deserters","traveling entertainers","tax collectors"],weights:[3,2,2,2,1,1,1,1]},clear:{creatures:["bandits","wolves","goblins","wild dogs","cattle rustlers","patrol guards","wandering knights","peasant militia"],weights:[2,2,2,1,1,1,1,1]},forest:{creatures:["wolves","goblins","brigands","giant spiders","wood elves","bears","outlaws","druids","owlbears"],weights:[2,2,2,1,1,1,1,1,1]},hills:{creatures:["orc raiders","goblins","brigands","ogres","hill giants","mountain lions","goatherds","prospectors"],weights:[2,2,2,1,1,1,1,1]},mountains:{creatures:["orc raiders","giant eagles","goblins","ogres","trolls","dwarven patrols","yeti","wyverns"],weights:[2,2,2,1,1,1,1,1]},swamp:{creatures:["lizardfolk","giant leeches","goblins","will-o-wisps","crocodiles","bullywugs","hags","shambling mounds"],weights:[2,2,2,1,1,1,1,1]},desert:{creatures:["bandits","giant scorpions","gnolls","nomads","giant snakes","sand wurms","dust devils","mummies"],weights:[2,2,2,1,1,1,1,1]},coastal:{creatures:["pirates","smugglers","fishermen","sahuagin","sea hags","giant crabs","merfolk","shipwreck survivors"],weights:[2,2,2,1,1,1,1,1]},ocean:{creatures:["sea serpent","pirates","merfolk","sahuagin raiders","giant sharks","water elementals","ghost ship","kraken spawn"],weights:[2,2,2,1,1,1,1,1]},reef:{creatures:["giant crabs","merfolk","sahuagin","sea hags","nixies","lacedons","shipwreck survivors","treasure hunters"],weights:[2,2,2,1,1,1,1,1]},river:{creatures:["fishermen","smugglers","river pirates","giant pike","nixies","water elementals","crocodiles","kelpies"],weights:[2,2,2,1,1,1,1,1]}},oi={bandits:["ragged","well-armed","desperate","cocky","scarred","masked"],goblins:["mangy","sneaky","cowardly","cunning","tribal","feral"],wolves:["gaunt","massive","winter-hungry","shadowy","patient","silver-furred"],"orc raiders":["battle-scarred","tribal","disciplined","frenzied","mounted","war-painted"],brigands:["former soldiers","ruthless","organized","poorly equipped","seasoned","cruel"],pirates:["salt-crusted","tattooed","cutlass-wielding","one-eyed","rum-soaked","desperate"],smugglers:["nervous","well-connected","armed","secretive","night-working","cunning"],sahuagin:["scaled","trident-wielding","pack-hunting","blood-frenzied","deep-dwelling","territorial"],merfolk:["curious","wary","shimmering","armed with coral spears","singing","ancient-looking"],"sea serpent":["massive","coiling","barnacle-encrusted","ancient","territorial","hungry"],"giant crabs":["armored","snapping","massive-clawed","beach-dwelling","aggressive","tide-hunting"],"sea hags":["cackling","seaweed-draped","curse-wielding","drowned-looking","malevolent","ancient"],nixies:["playful","enchanting","mischievous","water-dancing","alluring","territorial"],"ghost ship":["spectral","fog-shrouded","creaking","crewed by the damned","silent","cursed"],ogres:["dim-witted","hungry","massive","armored","solitary","kin to giants"],"giant spiders":["web-spinning","venomous","patient","ancient","bloated","intelligent"],lizardfolk:["scaled warriors","primitive","territorial","shaman-led","hunting party","traders"],default:["dangerous","wary","aggressive","territorial","numerous","scarce"]},ri={bandits:["demanding toll","setting an ambush","fleeing from the law","recruiting","celebrating a recent score"],goblins:["arguing among themselves","tracking something","carrying plunder","setting crude traps","worshipping a crude idol"],wolves:["hunting in formation","circling warily","following the scent of blood","protecting young","starving and desperate"],"orc raiders":["returning from a raid","scouting for targets","performing war rituals","dragging captives","quarreling over spoils"],default:["watching warily","moving with purpose","apparently startled","blocking the path","emerging from concealment"]},qb={lone:["a solitary","a single","one","a lone"],few:["a handful of","several","a few","two or three"],band:["a band of","a group of","many","a company of"],horde:["a horde of","countless","a swarm of","an army of"]};function _b(u,A,h){let H=h.reduce((i,G)=>i+G,0),b=u.next()*H;for(let i=0;i<A.length;i++)if(b-=h[i],b<=0)return A[i];return A[A.length-1]}function Nb(u,A,h){let H=ni[A]??ni.clear,b=_b(u,H.creatures,H.weights),i=u.chance(0.08),G=u.next(),M;if(G<0.2)M="lone";else if(G<0.6)M="few";else if(G<0.9)M="band";else M="horde";if(["ogres","trolls","bears","yeti","hags"].includes(b)&&M!=="horde")M=u.chance(0.7)?"lone":"few";let k=oi[b]??oi.default,z=ri[b]??ri.default,P=b;if(i){let E=$(u),K=[`${E}'s ${b}`,`${E} the ${u.pick(k)}`,`the ${b} called ${E}`];P=u.pick(K)}if(h)k.push("shadow-cloaked","night-hunting","red-eyed in the dark");return{name:P,type:b,isNamed:i,numbers:M,descriptor:u.pick(k),behavior:u.pick(z)}}var ti=[{name:"Monolith",types:["forest","hills","mountains","desert"]},{name:"Obelisk",types:["swamp","desert","clear"]},{name:"Statue",types:["clear","hills","road"]},{name:"Grove",types:["forest","swamp"]},{name:"Cave",types:["hills","mountains","forest"]},{name:"Spring",types:["forest","mountains","clear"]},{name:"Altar",types:["mountains","swamp","desert"]},{name:"Cairn",types:["hills","mountains","road"]},{name:"Ruin",types:["clear","forest","swamp","desert"]},{name:"Pillar",types:["desert","mountains"]},{name:"Tree",types:["forest","swamp","clear"]},{name:"Pool",types:["swamp","forest","clear"]}],Sb=["obsidian","glowing","ancient","weeping","moss-covered","cracked","sun-bleached","overgrown","floating","shadowy","silver","eerie","blood-stained","weather-worn","perfectly smooth","crystalline","petrified"],fb=["pulsing with a faint, rhythmic light","whispering in an unknown, melodic tongue","dripping with a thick, dark sap","swarming with spectral, blue butterflies","humming a low, vibrating note","surrounded by a thin, unnerving mist","etched with shifting, golden runes","home to a silent, white-haired hermit","bearing the marks of a thousand years","smelling of summer rain and ozone","vibrating when approached","swallowing all sound around it"],uh=[{name:"arcane-insight",text:"The party feels a surge of mental clarity.",fatigue:-1},{name:"historical-knowledge",text:"They uncover a fragment of lost history.",rumorKind:"mystery"},{name:"prophetic-hint",text:"A sudden vision of what is to come flashes before them.",rumorKind:"omen"},{name:"fey-blessing",text:"A light heart and swift feet follow them.",fatigue:-2},{name:"treasure-clue",text:"They find a marking pointing toward a hidden cache.",rumorKind:"dungeon"}];function vb(u,A,h,H,b){let i=ti.filter((K)=>K.types.includes(A)),G=(i.length>0?u.pick(i):ti[0]).name,M=u.pick(Sb),B=u.pick(fb),k=u.pick(uh),z=`The ${Ah(M)} ${G}`,P=b.settlements.find((K)=>K.name===h.location),E=P?P.coord:{q:u.int(b.width),r:u.int(b.height)};return{id:`landmark-${Date.now()}-${u.int(1000)}`,name:z,description:`A ${M} ${G.toLowerCase()}, ${B}.`,location:E,terrain:A,discoveryDate:H,discoveredBy:h.name,effect:k.name,knownBy:[h.name]}}function YA(u,A,h,H,b,i,G){let M=h.getUTCHours(),B=M<6||M>=18,k=Ou(M),P={road:0.08333333333333333,clear:0.125,forest:0.16666666666666666,hills:0.16666666666666666,mountains:0.2,swamp:0.2,desert:0.16666666666666666,coastal:0.125,ocean:0.16666666666666666,reef:0.2,river:0.125}[A]??0.125;if(i.ecologyState){if(i.ecologyState.populations.filter((y)=>y.population>0&&y.territoryName===H).length>0)P*=1.3}if(B&&A!=="road")P*=1.5;if(G){let f=CA(G.weather);P*=f.encounterChanceMod}if(G?.moonPhase==="full")P*=1.2;if(!u.chance(P)){if(u.chance(0.05)){if(u.chance(0.2)){let Z=i.settlements.find((Au)=>Au.name===b.location),l=Z?Z.coord:{q:u.int(i.width),r:u.int(i.height)},v=i.ruins?.find((Au)=>Au.location.q===l.q&&Au.location.r===l.r);if(!v){if(v=ei(u,l,A,i),!i.ruins)i.ruins=[];i.ruins.push(v)}return{category:"dungeon",summary:`${b.name} discovers ${v.name}`,details:`${Tu(u,h,A)} They have found ${v.description} ${v.history}`,location:H,actors:[b.name],worldTime:h,realTime:new Date,seed:i.seed}}let f=vb(u,A,b,h,i);i.landmarks.push(f);let y=uh.find((Z)=>Z.name===f.effect);if(y?.rumorKind&&i)j({type:"spawn-rumor",triggerEvent:`Discovery of ${f.name}`,turnsUntilResolution:12+u.int(24),data:{origin:H,target:H,kind:y.rumorKind,text:`Explorers speak of a strange discovery near ${H}.`},priority:3});return{category:"road",summary:`${b.name} discovers ${f.name}`,details:`${Tu(u,h,A)} ${f.description} ${y?.text??""}`,location:H,actors:[b.name],worldTime:h,realTime:new Date,seed:i.seed,fatigueDelta:y?.fatigue??0}}return}let E=Nb(u,A,B),K=2+u.int(6)+u.int(6),L;if(K>=10)L="friendly";else if(K>=6)L="cautious";else L="hostile";if((b.fame??0)>=5&&L==="cautious")L=u.chance(0.3)?"friendly":"cautious";if(["giant spiders","giant leeches","giant scorpions","trolls","mummies","shambling mounds"].includes(E.type))L="hostile";let J,V=!1,C=!1,O=0,Y=0,X=0,a=!1,R=b.members.some((f)=>f.class==="Magic-User"||f.class==="Elf"),I=b.members.some((f)=>f.class==="Cleric"),x=b.members.some((f)=>f.class==="Thief"||f.class==="Halfling");if(L==="friendly"){if(J="negotiation",u.chance(0.3))a=!0}else if(L==="cautious")if(u.chance(0.5))J="negotiation",O=u.chance(0.3)?2+u.int(4):0;else J="flight",O=3+u.int(3),Y=u.chance(0.3)?1:0;else{let f=u.next(),y=0.6;if(y+=(b.fame??0)*0.02,R)y+=0.1;if(I)y+=0.05;if(x)y+=0.05;let Z=b.members.reduce((l,v)=>l+v.level,0)/b.members.length;if(y+=(Z-1)*0.05,f<y){if(J="victory",V=u.chance(0.2),X=u.chance(0.4)?10+u.int(50):0,Y=u.chance(0.3)?1:0,b.xp+=100+u.int(500),E.isNamed||E.numbers==="horde")a=!0}else if(f<y+0.25)J="defeat",V=!0,O=6+u.int(6),Y=1+u.int(2),C=u.chance(0.15),a=!0;else J="flight",O=4+u.int(4),Y=1,V=u.chance(0.25)}let uu=li(u,E.name,L,J,A,[b.name]),Pu=Tu(u,h,A,L==="hostile"?"tense":void 0),Uu=G?pi(A,G.weather,u):"",wu=u.pick(qb[E.numbers]),r=`${Pu} `;if(Uu&&u.chance(0.4))r+=`${Uu} `;if(r+=`${Ah(wu)} ${E.descriptor} ${E.type}, ${E.behavior}. `,r+=uu.details,J==="victory"){if(R&&u.chance(0.4))r+=" A well-timed spell from their caster turned the tide.";else if(I&&u.chance(0.4))r+=" Divine favor shielded them from the worst of the blows."}if(X>0)r+=` The victors claim ${X} coin worth of plunder.`;let Eu={category:"road",summary:uu.summary,details:r,location:H,actors:[b.name,E.name],worldTime:h,realTime:new Date,seed:i.seed,delayMiles:O,fatigueDelta:Y,injured:V,death:C};if(xu(Eu,i,u),a&&E.isNamed&&J!=="victory")j({type:"spawn-antagonist",triggerEvent:Eu.summary,turnsUntilResolution:24+u.int(72),data:{location:H,threat:`${E.name} gathers strength and swears revenge`,origin:`defeat at the hands of ${b.name}`},priority:3});return Eu}function Ah(u){if(!u)return u;return u.charAt(0).toUpperCase()+u.slice(1)}function QA(u,A,h,H,b,i){if(!u.chance(0.15))return;let G={road:["Fresh hoofprints diverge from the road, as if riders left in haste.","A broken wagon wheel lies by the verge. No sign of the wagon.","Crows gather ahead. They scatter at your approach.","A weathered signpost has been defaced with crude warnings."],clear:["Trampled grass marks the passage of many feet.","Smoke rises from beyond the next hill.","Livestock have fled into the open, masterless and panicked.","A campfire, still warm, but hastily abandoned."],forest:["Claw marks on the trees, head-height or higher.","Webs span the path ahead, freshly spun.","A hunter's blind, recently occupied. Arrow nocks in the bark.","The birds have gone silent. Something is wrong."],hills:["Caves in the hillside show signs of habitation.","Bones litter a rock shelf. Not all are animal bones.","Crude totems mark a boundary. You have been warned.","Rockfall has blocked the easy path. An ambush site, perhaps."],mountains:["Giant footprints in the snow, each as long as a man is tall.","The ruins of a dwarven waystation, recently looted.","Eagle cries echo, but no birds are visible.","A cairn of skulls marks a territorial boundary."],swamp:["Ripples in the water. Something large is moving.","A boat, half-sunken. Its passengers are nowhere to be seen.","Strange lights dance over the water. Will-o-wisps?","Fetish dolls hang from the dead trees. Warnings or invitations?"],desert:["Bleached bones half-buried in the sand.","An oasis\u2014but no birds sing there, and the water is too still.","Tracks in the sand, leading toward you. Many feet. Clawed.","A buried structure protrudes from a dune. Something ancient stirs."]},M=G[A]??G.clear,B=u.pick(M);return{category:"road",summary:`${b} spot signs of danger`,details:B,location:H,actors:[b],worldTime:h,realTime:new Date,seed:i}}var ih={hunt:["Tracks are found. The quarry draws near.","A witness points the way.","The hunter's patience wears thin.","The quarry leaves a taunt. It's personal now.","The hunt leads through treacherous terrain.","Allies offer aid, but at a steep price.","The quarry seems to anticipate every move.","A storm hampers the pursuit.","Local villagers share rumors of the prey.","The hunters discover they are not alone in the chase.","Supplies dwindle; the hunt becomes desperate.","The quarry turns the tables, becoming the hunter.","Ancient ruins hold clues to the prey's location.","A bounty is placed, attracting more hunters.","The chase crosses into forbidden territory."],feud:["Harsh words are exchanged publicly.","An ally is subverted.","Blood is spilled in a back alley.","Neutral parties are forced to choose sides.","A peace offering is rejected with scorn.","Rumors of assassination attempts spread.","Economic pressure is applied through boycotts.","Marriage alliances are proposed to end the feud.","A third party profits from the conflict.","Religious leaders attempt mediation.","The feud spreads to younger generations.","Property is vandalized in the night.","Legal battles drain both sides' resources.","Mercenaries are hired for dirty work.","A beloved figure is caught in the crossfire."],revenge:["The avenger moves closer.","Old alliances are tested.","The weight of vengeance grows heavier.","The target learns they are being hunted.","Friends warn the avenger to stop.","The target hires bodyguards.","A weapon is forged for the final confrontation.","The avenger trains relentlessly.","Memories of the original wrong fuel the fire.","The target flees to a distant land.","Allies of the target are threatened.","The avenger infiltrates the target's inner circle.","A bounty is placed on the avenger.","The original crime's details emerge.","The avenger questions their own motives."],war:["Skirmishes break out along the border.","Diplomatic options narrow.","The drums beat louder.","Mercenaries arrive, choosing sides.","Fortifications are hastily constructed.","Spies infiltrate enemy territory.","Supply lines are disrupted.","Deserters tell tales of enemy weakness.","Religious figures bless the troops.","A famous commander takes the field.","Siege engines are brought forward.","Naval blockades are established.","Refugees flee the war zone.","Neutral territories are invaded.","Peace negotiations are attempted and fail."],siege:["Supplies inside the walls dwindle.","A sortie attempts to break the ring.","Disease spreads among the besieged.","Siege engines are brought into position.","Miners tunnel under the walls.","Catapults hurl flaming projectiles.","Defenders sally forth at night.","Psychological warfare begins.","Reinforcements arrive for the attackers.","The besieged attempt to smuggle messages out.","Water sources are poisoned or diverted.","Religious ceremonies bolster morale.","A famous hero leads the defense.","Weather hampers siege operations.","Negotiations occur under a flag of truce."],rebellion:["Another village joins the uprising.","The authorities respond with force.","A charismatic leader emerges.","Nobles flee the region.","Secret meetings are held in hidden places.","Propaganda leaflets circulate.","Taxes are refused, leading to conflict.","Armories are raided for weapons.","Foreign powers offer support.","The rebels establish their own courts.","Loyalists organize counter-rebellions.","Religious leaders take sides.","Trade is disrupted by blockades.","Prisoners are taken and ransomed.","The rebellion spreads to neighboring regions."],duel:["Seconds negotiate the terms.","One party attempts reconciliation.","Rumors spread about the coming fight.","Spectators gather to witness.","The chosen weapons are prepared.","The location is scouted and agreed upon.","Wagers are placed on the outcome.","Family members attempt intervention.","Medical aid is arranged.","The duel is delayed by weather or omens.","One combatant trains intensely.","Honor codes are debated.","A poet composes verses about the duel.","Political implications are discussed.","The duel becomes a matter of public interest."],raid:["Scouts report enemy movements.","Defenses are hastily reinforced.","Fires on the horizon approach.","Refugees flee ahead of the raiders.","Livestock is driven off in the night.","Ambushes are set along expected routes.","Raiders demand tribute to spare settlements.","Prisoners are taken for ransom.","War cries echo through the valleys.","Smoke signals warn of the advance.","Villagers hide their valuables.","The raiders employ guerrilla tactics.","Local heroes organize resistance.","The raid escalates into open warfare.","Survivors tell tales of the attackers."],mystery:["A new clue surfaces.","Someone who knew too much falls silent.","The pattern becomes clearer\u2014and more disturbing.","An old document reveals a connection.","Witnesses contradict each other.","Strange symbols appear in unexpected places.","Dreams plague those investigating.","Ancient ruins yield cryptic messages.","A suspect is cleared, pointing elsewhere.","The mystery seems connected to ancient legends.","False leads waste valuable time.","A trusted ally is revealed as unreliable.","The investigators receive anonymous warnings.","The mystery touches personal lives.","Time pressure mounts as events accelerate."],treasure:["A rival expedition sets out.","The map proves partially false.","Greed begins to poison the company.","Guardians of the treasure awaken.","Supplies are lost to bandits or weather.","Team members desert with portions of the map.","Ancient traps claim lives.","The treasure proves to be cursed.","Local legends prove partially true.","The expedition splits over strategy.","A guide betrays the group.","The treasure hoard proves disappointingly small.","Magical wards must be overcome.","The treasure attracts monstrous attention.","Political complications arise."],prophecy:["Another sign manifests.","Believers grow in number.","The skeptics fall silent.","Those who would prevent the prophecy act.","Interpretations of the prophecy conflict.","A false prophet emerges.","Sacred texts are rediscovered.","Miracles are attributed to the prophecy.","Skeptics are converted by events.","The prophesied figure remains hidden.","Political factions align around interpretations.","Ancient artifacts confirm the prophecy.","The prophesied events begin small.","Opponents attempt to forge counter-prophecies.","The prophecy affects daily life."],expedition:["The terrain becomes impassable.","Strange landmarks appear as described.","Supplies run dangerously low.","Contact with home is lost.","The expedition encounters hostile natives.","Disease strikes the explorers.","Weather turns against the group.","Internal conflicts emerge.","Amazing discoveries are made.","The expedition must turn back.","A mutiny threatens the leadership.","The goal proves farther than expected.","Valuable trade opportunities appear.","The expedition inspires future explorers.","Tragedy strikes the group."],artifact:["A fragment of the artifact is found.","Another seeker enters the race.","The artifact's location is narrowed down.","Visions reveal the artifact's power.","The artifact begins to influence seekers.","Ancient guardians oppose the search.","False artifacts mislead seekers.","The artifact chooses its own path.","Political powers become involved.","The artifact proves sentient.","Time pressure mounts.","The search reveals other secrets.","Betrayals occur among seekers.","The artifact's true nature emerges.","Unintended consequences appear."],"lost-heir":["Evidence of the bloodline surfaces.","Enemies of the heir move to suppress the claim.","The heir learns fragments of their history.","Old servants remember the true lineage.","The heir proves their claim.","Imposters emerge to challenge the claim.","The heir must prove their worth.","Ancient secrets are revealed.","Political alliances shift.","The heir faces assassination attempts.","Family members have divided loyalties.","The throne proves contested.","The heir discovers hidden talents.","The past catches up with the family.","Loyal supporters rally to the cause."],"ancient-evil":["Tremors shake the earth.","Animals flee the area.","The seals show signs of weakening.","Dreams of darkness plague the populace.","Strange creatures appear at night.","Ancient runes glow with power.","The ground becomes unstable.","Local wildlife behaves erratically.","Old artifacts reactivate.","Scholars debate the signs.","The evil sends visions to the weak.","Guardians of the seal grow restless.","Time seems to distort near the site.","The evil influences local politics.","Heroes are drawn to confront it."],portal:["Strange creatures emerge.","The portal fluctuates in stability.","Communication across the threshold begins.","The other side sends an emissary.","Energy signatures change.","Local magic becomes unreliable.","Time flows differently near the portal.","Strange materials appear.","The portal attracts scholars.","Monsters from beyond appear.","The portal begins to expand.","Communication becomes clearer.","Trade through the portal begins.","The other side requests aid.","The portal threatens to become permanent."],romance:["A secret meeting is arranged.","Jealousy rears its head.","Families object to the union.","A rival for affection appears.","Love letters are exchanged.","A romantic gesture goes wrong.","Family secrets complicate matters.","Social expectations create tension.","A scandal threatens the relationship.","Long separations test their bond.","Cultural differences emerge.","Friends offer conflicting advice.","A grand romantic gesture is planned.","Misunderstandings create drama.","True feelings are finally revealed."],rise:["Another triumph adds to the legend.","Enemies begin to take notice.","The price of success becomes apparent.","Old allies are left behind.","New opportunities present themselves.","Rivals attempt to undermine success.","The rising figure inspires others.","Power brings unexpected responsibilities.","Jealousy affects old relationships.","Success attracts dangerous attention.","The figure questions their ambitions.","Mentors offer guidance.","New allies seek association.","The path becomes more dangerous.","Success brings moral dilemmas."],fall:["Another supporter abandons ship.","Debts come due.","The vultures circle lower.","Former rivals offer hollow sympathy.","Mistakes from the past resurface.","Allies prove unreliable.","The fall happens gradually.","Public opinion turns.","Internal conflicts weaken resolve.","Opportunities for redemption appear.","The fallen figure loses confidence.","Old enemies take advantage.","Supporters dwindle.","The fall becomes inevitable.","Rock bottom offers new perspective."],scandal:["Whispers become open conversation.","Evidence surfaces\u2014real or fabricated.","Allies distance themselves.","Public condemnation begins.","The accused denies everything.","Investigations are launched.","Media attention grows.","Friends are forced to choose sides.","The scandal affects innocent bystanders.","Damage control efforts begin.","The truth becomes obscured.","Political implications emerge.","Legal battles ensue.","The scandal spreads to others.","Time reveals the full story."],betrayal:["Small inconsistencies are noticed.","The betrayer grows bolder.","Suspicion falls on the wrong person.","The moment of truth approaches.","Evidence begins to accumulate.","The betrayed feels growing unease.","Allies offer conflicting information.","The betrayal affects multiple people.","Confrontation becomes inevitable.","The betrayer's motives emerge.","Collateral damage occurs.","Trust is shattered.","Reconciliation seems impossible.","The betrayal changes everything.","Lessons are learned too late."],succession:["Alliances form behind each claimant.","Legal scholars debate legitimacy.","Gold changes hands to buy support.","Assassination attempts multiply.","Public opinion sways.","Ancient laws are consulted.","Foreign powers become involved.","The claimants campaign actively.","Scandals affect various candidates.","Military support is courted.","Religious approval is sought.","The succession becomes contested.","Compromises are proposed.","Violence breaks out.","A winner finally emerges."],exile:["The exile finds temporary shelter.","Messages from home bring mixed news.","The exile's skills prove valuable abroad.","Plots to return home form.","The exile adapts to new surroundings.","Old enemies pursue relentlessly.","New allies are found.","The exile learns valuable lessons.","Home seems both distant and alluring.","Time softens the pain of exile.","The exile builds a new life.","Calls for return grow louder.","The exile faces temptation.","Old wounds are reopened.","The exile finds inner peace."],redemption:["A small act of kindness is noted.","Old victims are confronted.","The path proves harder than expected.","A test of true change arrives.","Progress is made slowly.","Skeptics remain unconvinced.","New opportunities emerge.","The redeemed faces temptation.","Allies offer support.","Old habits prove hard to break.","Public opinion shifts gradually.","The redeemed proves their sincerity.","Forgiveness is granted.","A new chapter begins.","True redemption is achieved."],rescue:["A ransom demand arrives.","A rescue attempt fails.","Hope dwindles with each passing day.","The captive sends a secret message.","Rescuers gather resources.","The captors grow impatient.","Negotiations begin.","Time runs short.","A rescue plan is formulated.","Unexpected complications arise.","The captive's condition deteriorates.","Allies provide crucial aid.","The rescue becomes desperate.","Success seems within reach.","The outcome hangs in balance."],plague:["The sickness spreads.","A cure is rumored.","Quarantines prove inadequate.","The source of the plague is suspected.","Symptoms become more severe.","Healers work tirelessly.","Fear grips the population.","Quack cures proliferate.","The plague affects the powerful.","Scientific investigation begins.","Traditional remedies are tried.","The plague changes society.","Heroes emerge.","The source is finally identified.","Recovery begins."],famine:["Rations are cut again.","Hoarding is punished severely.","The desperate turn to crime.","Relief supplies are diverted.","The famine affects the powerful.","Migration begins.","Social order breaks down.","Aid arrives from unexpected sources.","The famine changes society.","Innovation solves problems.","The famine ends gradually.","Scars remain.","Lessons are learned.","Society rebuilds stronger.","Memory fades with time."],migration:["The column stretches for miles.","Local populations react with fear.","Resources along the route are exhausted.","Splinter groups break away.","The migrants face hostility.","New lands prove challenging.","Cultural clashes occur.","The migration changes everyone.","Adaptation proves difficult.","New communities form.","The journey tests resolve.","Unexpected allies appear.","The migrants reach their goal.","Integration begins.","A new chapter opens."],sanctuary:["The defenses are tested.","Supplies begin to run low.","Tension rises between refugees.","A spy is suspected within.","The sanctuary proves inadequate.","External threats grow.","Internal conflicts emerge.","Resources are rationed.","The sanctuary becomes overcrowded.","Leadership is challenged.","Allies provide support.","The sanctuary holds.","Compromises are made.","Growth occurs.","The sanctuary evolves."],curse:["The curse begins to manifest.","Victims seek relief.","The curse affects the innocent.","Ancient knowledge is consulted.","The curse spreads.","Heroes investigate.","The source is revealed.","Breaking the curse proves difficult.","Sacrifices are made.","The curse changes everything.","Hope emerges.","The curse is broken.","Consequences remain.","Lessons are learned.","Healing begins."],"hunt-survival":["The hunted evades capture.","Pursuers close in.","The hunted finds temporary refuge.","The chase becomes personal.","Allies aid the hunted.","The hunted turns the tables.","Time runs short.","The hunted faces despair.","Unexpected help arrives.","The hunted proves resourceful.","The chase ends.","Consequences follow.","The hunted survives.","New threats emerge.","The story continues."],conspiracy:["Whispers spread in dark corners.","Allies prove unreliable.","The conspiracy grows.","Evidence is planted.","Doubts emerge.","The conspiracy succeeds.","Exposure threatens.","Internal conflicts arise.","The conspiracy evolves.","Truth emerges.","Consequences follow.","Justice is served.","The conspiracy ends.","Lessons are learned.","Society changes."],heist:["Planning intensifies.","Team members are recruited.","Security is studied.","Complications arise.","The plan changes.","Execution begins.","Unexpected obstacles appear.","Tension builds.","Success seems possible.","Betrayal threatens.","The heist proceeds.","Consequences emerge.","The outcome is decided.","Aftermath follows.","New opportunities arise."],infiltration:["The infiltrator gains access.","Trust is established.","Information is gathered.","Suspicion grows.","The infiltrator acts.","Discovery threatens.","The mission succeeds.","Escape becomes necessary.","Consequences follow.","The infiltrator reflects.","New missions await.","The story evolves.","Allies emerge.","The infiltration ends.","Lessons are learned."],blackmail:["Secrets are discovered.","Demands are made.","Victims react.","The blackmailer acts.","Resistance grows.","Consequences emerge.","The blackmail succeeds.","Exposure threatens.","The blackmailer reflects.","New opportunities arise.","The story continues.","Allies emerge.","The blackmail ends.","Lessons are learned.","Society changes."],imposter:["The deception begins.","Trust is gained.","The imposter acts.","Suspicion emerges.","The deception deepens.","Discovery threatens.","The imposter succeeds.","Exposure occurs.","Consequences follow.","The imposter reflects.","New identities await.","The story evolves.","Allies emerge.","The deception ends.","Lessons are learned."],cult:["The cult grows.","Rituals are performed.","Converts join.","Opposition emerges.","The cult acts.","Internal conflicts arise.","The cult succeeds.","Exposure threatens.","The cult reflects.","New followers await.","The story evolves.","Allies emerge.","The cult ends.","Lessons are learned.","Society changes."],haunting:["Manifestations increase.","The haunted seek help.","The haunting affects the living.","Investigations begin.","The source is revealed.","The haunting intensifies.","Resolution approaches.","The haunting ends.","Consequences remain.","Lessons are learned.","The story continues.","New hauntings begin.","The haunted reflect.","Allies emerge.","Peace returns."],possession:["Changes become noticeable.","The possessed acts strangely.","Loved ones react.","Exorcism is attempted.","The possession deepens.","Control slips.","Resolution approaches.","The possession ends.","Consequences remain.","Lessons are learned.","The possessed reflects.","Allies emerge.","New possessions begin.","The story evolves.","Recovery occurs."],transformation:["Changes begin.","The transformed adapts.","Others react with fear.","The transformation progresses.","Control becomes difficult.","Benefits emerge.","The transformation completes.","Consequences follow.","The transformed reflects.","Allies emerge.","New transformations begin.","The story evolves.","Acceptance occurs.","Lessons are learned."],pact:["The pact is made.","Terms are tested.","Benefits emerge.","Costs become apparent.","The pact deepens.","Regret grows.","Breaking the pact proves difficult.","Consequences follow.","The pact-maker reflects.","Allies emerge.","New pacts are made.","The story evolves.","Redemption occurs.","Lessons are learned."],rift:["The rift opens.","Reality warps.","Creatures emerge.","The rift expands.","Control becomes difficult.","Closing the rift proves hard.","Consequences follow.","The rift closes.","Reality stabilizes.","Lessons are learned.","The story continues.","New rifts open.","Survivors reflect.","Allies emerge."],awakening:["Power manifests.","The awakened adapts.","Others sense the change.","Control becomes difficult.","The awakening progresses.","Responsibilities emerge.","The full awakening occurs.","Consequences follow.","The awakened reflects.","Allies emerge.","New awakenings begin.","The story evolves.","Mastery occurs.","Lessons are learned."]},hh=[{type:"hunt",titles:["The Hunt for %ACTOR%","Tracking the %ACTOR%","%ACTOR%'s Last Stand","Blood on the Trail"],summaries:(u,A)=>[`${u[0]} stalks ${u[1]??"a dangerous quarry"} across the region.`,`A deadly game of cat and mouse unfolds near ${A}.`,"The hunt enters its final phase. One will not survive."],outcomes:["The quarry is slain.","The quarry escapes to parts unknown.","The hunters become the hunted.","An unexpected alliance forms.","The quarry is captured alive\u2014but for what purpose?"]},{type:"feud",titles:["Blood Between %ACTOR% and %ACTOR%","The %LOCATION% Vendetta","Old Grievances","A House Divided"],summaries:(u,A)=>[`Bad blood between ${u[0]} and ${u[1]??"their enemies"} threatens to spill over.`,`${A} becomes the stage for an escalating conflict.`,"Ancient grudges flare anew. Neither side will back down."],outcomes:["One side is destroyed utterly.","A fragile peace is negotiated.","Both sides are weakened; a third party profits.","The feud spreads, drawing in new participants.","Marriage unites the feuding parties\u2014but for how long?"]},{type:"revenge",titles:["%ACTOR%'s Vengeance","Debts Paid in Blood","The Reckoning","Cold Revenge"],summaries:(u,A)=>[`${u[0]} has sworn to make ${u[1]??"someone"} pay.`,`An old wrong demands answer. Blood will flow in ${A}.`,"Years of planning come to fruition. The target has no idea."],outcomes:["Vengeance is achieved. The avenger finds no peace.","The target proves too strong. The avenger falls.","Revenge begets revenge. The cycle continues.","Forgiveness prevails. Both parties find closure.","The wrong turns out to be a misunderstanding\u2014too late."]},{type:"war",titles:["The %LOCATION% War","Drums of War","The Coming Storm","When Banners Fly"],summaries:(u,A)=>[`${u[0]} and ${u[1]??"their enemies"} mass for conflict.`,`War clouds gather over ${A}. The common folk suffer.`,"Armies march. Diplomacy has failed."],outcomes:["One side achieves total victory.","Stalemate grinds both sides down.","A greater threat forces alliance.","The war spreads beyond control.","Mutual exhaustion leads to an uneasy truce."]},{type:"siege",titles:["The Siege of %LOCATION%","Walls of %LOCATION%","Starvation and Steel","No Relief Coming"],summaries:(u,A)=>[`${A} is encircled. Supplies dwindle.`,`${u[0]} tightens the noose around ${A}.`,"Every day without relief, hope fades inside the walls."],outcomes:["The walls are breached. Slaughter follows.","A relief force breaks the siege.","Starvation forces surrender.","A secret tunnel allows escape.","Treachery opens the gates from within."]},{type:"rebellion",titles:["The %LOCATION% Uprising","Torches in the Night","The People Rise","Breaking Chains"],summaries:(u,A)=>[`The common folk of ${A} have had enough.`,`${u[0]} leads the dispossessed against their masters.`,"What begins as protest turns to open rebellion."],outcomes:["The rebellion is crushed. Examples are made.","The old order is swept away.","Concessions buy temporary peace.","The rebels win, then turn on each other.","Outside powers intervene for their own ends."]},{type:"duel",titles:["The %LOCATION% Duel","Dawn and Steel","Honor Demands Blood","Seconds and Swords"],summaries:(u,A)=>[`${u[0]} challenges ${u[1]??"a rival"} to single combat.`,`Honor can only be satisfied with blood. ${A} will witness.`],outcomes:["The challenger prevails.","The defender proves the stronger.","Both combatants fall.","Interference stops the duel\u2014honor unsatisfied.","First blood ends it; mutual respect grows."]},{type:"raid",titles:["Fire in %LOCATION%","The %ACTOR% Raid","Strike and Vanish","Burning Dawn"],summaries:(u,A)=>[`${u[0]} strikes fast at ${A} and withdraws before retaliation.`,`Hit and run tactics terrorize ${A}.`],outcomes:["The raid succeeds with heavy plunder.","The raiders are intercepted and destroyed.","The raid escalates into open war.","The raiders demand tribute to stop."]},{type:"mystery",titles:["The %LOCATION% Mystery","Secrets of %ACTOR%","What Lurks Beneath","Strange Happenings"],summaries:(u,A)=>[`Strange events in ${A} demand explanation.`,`${u[0]} uncovers clues to something best left buried.`,"Every answer raises three more questions."],outcomes:["The truth is revealed\u2014and it's worse than imagined.","The mystery remains unsolved; some doors are better left closed.","A hidden conspiracy is exposed.","The investigation claims lives before answers emerge.",'The "mystery" was an elaborate distraction.']},{type:"treasure",titles:["The %LOCATION% Hoard","%ACTOR%'s Fortune","Riches and Ruin","Gold Fever"],summaries:(u,A)=>[`Word of treasure in ${A} draws fortune-seekers.`,`${u[0]} races rivals to claim the prize.`,"Greed poisons every alliance. Trust no one."],outcomes:["The treasure is claimed. Wealth flows.","The treasure was cursed. Misfortune follows.","The treasure was a trap. Bodies pile up.","The treasure proves smaller than legend suggested.","The true treasure was knowledge, not gold."]},{type:"prophecy",titles:["The Foretelling","Signs and Portents","What Was Written","The Chosen One"],summaries:(u,A)=>[`Ancient prophecy stirs. ${u[0]} may be the key.`,`The seers spoke of ${A}. The time is now.`,"Those who would prevent destiny clash with those who would fulfill it."],outcomes:["The prophecy is fulfilled as foretold.","The prophecy is averted at great cost.","The prophecy was misinterpreted all along.","The prophecy was a lie\u2014or a test.","Multiple claimants fight over the prophetic role."]},{type:"expedition",titles:["Into the Unknown","The %LOCATION% Expedition","Beyond the Map","First Footsteps"],summaries:(u,A)=>[`${u[0]} ventures where none have gone before.`,"The blank spaces on the map call to the bold.",`What wonders\u2014or horrors\u2014await in ${A}?`],outcomes:["New lands are claimed. History is made.","The expedition vanishes without trace.","They return changed\u2014but refuse to speak of what they saw.","Something followed them back.","The discovery reshapes the political landscape."]},{type:"artifact",titles:["The %ACTOR% Blade","Quest for the %LOCATION% Crown","Legendary Arms","The Lost Relic"],summaries:(u,A)=>[`A legendary artifact has surfaced near ${A}.`,`${u[0]} seeks a weapon of terrible power.`,"Whoever claims the relic may tip the balance of power."],outcomes:["The artifact is claimed and its power unleashed.","The artifact proves too dangerous and is destroyed.","The artifact chooses its own wielder.","The artifact was fake\u2014the real one remains hidden.","Multiple fragments must be reunited."]},{type:"lost-heir",titles:["The Hidden Bloodline","Rightful Heir of %LOCATION%","A Crown Unclaimed","Blood Will Tell"],summaries:(u,A)=>[`Someone in ${A} carries royal blood unknowingly.`,`${u[0]} may be heir to more than they know.`,"Birthmarks, signet rings, dying confessions\u2014the truth emerges."],outcomes:["The heir claims their birthright.","The heir rejects the throne for a simpler life.","The heir is assassinated before the claim is made.","The bloodline proves to be a fabrication.","Multiple heirs emerge, each with valid claims."]},{type:"ancient-evil",titles:["The Awakening","What Sleeps Beneath %LOCATION%","The Old Darkness Returns","Seals Breaking"],summaries:(u,A)=>[`Something sealed away long ago stirs in ${A}.`,"Ancient wards fail. What they imprisoned walks again.",`${u[0]} races to prevent catastrophe.`],outcomes:["The evil is resealed, but weakened watchers remain.","The evil is destroyed at tremendous cost.","The evil proves to be misunderstood\u2014not evil at all.","The evil escapes and begins its conquest.","A bargain is struck with the awakened power."]},{type:"portal",titles:["The Gate Opens","Between Worlds","The %LOCATION% Rift","Doorway to Elsewhere"],summaries:(u,A)=>[`A portal has opened near ${A}. What comes through?`,`${u[0]} discovers a gateway between realities.`,"Traffic flows both ways. Not all visitors are welcome."],outcomes:["The portal is closed before disaster.","An alliance forms across the threshold.","Invasion pours through. Defense is mounted.","Someone important is lost to the other side.","The portal becomes a valuable trade route."]},{type:"romance",titles:["%ACTOR% and %ACTOR%","Forbidden Love","Hearts Entwined","Against All Custom"],summaries:(u,A)=>[`Love blooms between ${u[0]} and ${u[1]??"an unlikely partner"}.`,`In ${A}, hearts conspire what politics would forbid.`],outcomes:["Love conquers all. They wed.","Duty prevails over passion. Hearts break.","One lover betrays the other.","They elope, burning all bridges.","Tragedy claims one; the other mourns forever."]},{type:"rise",titles:["The Rise of %ACTOR%","From Nothing to Everything","A Star Ascends","The Climb"],summaries:(u,A)=>[`${u[0]} is becoming someone to watch.`,`Power and fame gather around a rising figure in ${A}.`,"From humble origins, greatness emerges."],outcomes:["They achieve their ambition and more.","They overreach and crash down.","They attract powerful enemies.","They become what they once despised.","They lift others as they climb."]},{type:"fall",titles:["The Fall of %ACTOR%","How the Mighty Crumble","Twilight","The Last Days of %ACTOR%"],summaries:(u,A)=>[`${u[0]}'s power wanes. Vultures circle.`,`What was once mighty in ${A} totters on the brink.`,"Allies become enemies. Friends become strangers."],outcomes:["The fall is complete. Nothing remains.","A desperate comeback succeeds.","They fall, but take enemies with them.","They accept their fate with grace.","A loyal few stand with them to the end."]},{type:"scandal",titles:["The %LOCATION% Scandal","Reputation in Ruins","Whispers and Accusations","Public Disgrace"],summaries:(u,A)=>[`${u[0]}'s secret is about to become very public.`,`Accusations fly in ${A}. Someone's reputation will not survive.`,"The truth\u2014or a convincing lie\u2014threatens to destroy everything."],outcomes:["The scandal proves true. Exile follows.","The accusation is false, but mud sticks.","The accuser is exposed as a fraud.","A greater scandal eclipses the first.","Brazening it out somehow works."]},{type:"betrayal",titles:["%ACTOR%'s Betrayal","The Knife in the Back","Trust Broken","Et Tu?"],summaries:(u,A)=>[`${u[0]} is betrayed by ${u[1]??"someone trusted"}.`,`In ${A}, a trusted ally reveals their true allegiance.`,"The betrayal cuts deep. Nothing will be the same."],outcomes:["The betrayer succeeds completely.","The betrayal is discovered just in time.","Both betrayer and betrayed are destroyed.","The betrayer has a change of heart.","It was a test of loyalty all along."]},{type:"succession",titles:["The %LOCATION% Succession","Crown and Contenders","Who Will Rule?","The Empty Throne"],summaries:(u,A)=>[`With the ruler gone, ${A} needs a new leader.`,`Multiple claimants vie for power. ${u[0]} makes their move.`,"Legitimacy, force, and cunning all have their advocates."],outcomes:["The rightful heir prevails.","The strongest claimant seizes power.","Civil war erupts over the succession.","An outside power dictates the succession.","An unexpected candidate emerges victorious."]},{type:"exile",titles:["The Exile of %ACTOR%","Cast Out","No Home Remaining","Wanderer's Road"],summaries:(u,A)=>[`${u[0]} is banished from ${A}.`,"An exile begins. Where will they go? What will they become?","Behind, everything they knew. Ahead, only uncertainty."],outcomes:["The exile finds a new home and purpose.","The exile returns in triumph.","The exile dies in obscurity.","The exile builds power abroad and returns for vengeance.","The exile is pardoned, but the scars remain."]},{type:"redemption",titles:["%ACTOR%'s Redemption","The Road Back","Atonement","Second Chances"],summaries:(u,A)=>[`${u[0]} seeks to atone for past sins.`,`In ${A}, someone fights to prove they have changed.`,"Can the past truly be escaped?"],outcomes:["Redemption is earned. The past is forgiven.","Some sins cannot be forgiven. The quest fails.","Redemption comes through sacrifice.","The attempt at redemption is a deception.","They save others but cannot save themselves."]},{type:"rescue",titles:["The Rescue of %ACTOR%","Into the %LOCATION%","Against All Odds","Every Hour Counts"],summaries:(u,A)=>[`${u[1]??"Someone important"} has been taken. ${u[0]} must act.`,`A desperate mission into ${A} begins.`,"Time is running out for the captive."],outcomes:["The captive is saved, battered but alive.","The rescue comes too late.","The captive is rescued, but at terrible cost.","The captor is defeated; the captive was bait.","The captive rescues themselves before help arrives."]},{type:"plague",titles:["The %LOCATION% Plague","Death Walks","The Spreading Sickness","Quarantine"],summaries:(u,A)=>[`A deadly sickness sweeps through ${A}.`,"The sick are shunned. The healthy live in fear.",`${u[0]} races to find a cure\u2014or a cause.`],outcomes:["A cure is found. The plague ends.","The plague burns itself out\u2014but at terrible cost.","The plague spreads to new regions.","The plague proves to be deliberate.","Immunity emerges among survivors."]},{type:"famine",titles:["The Hungry Year","Empty Granaries of %LOCATION%","When Harvests Fail","Starvation Stalks"],summaries:(u,A)=>[`Famine grips ${A}. The people starve.`,"Food becomes more precious than gold.",`${u[0]} seeks supplies\u2014by any means necessary.`],outcomes:["Aid arrives from unexpected quarters.","The famine claims countless lives.","Hoarded food is discovered and redistributed.","The famine drives mass migration.","The famine proves to be engineered."]},{type:"migration",titles:["The Great Migration","Exodus from %LOCATION%","A People in Motion","The Long March"],summaries:(u,A)=>[`A great movement of people\u2014or creatures\u2014passes through ${A}.`,`${u[0]} leads their people to a new home.`,"Everything is changing. The old order crumbles."],outcomes:["The migrants find a new home.","The migrants are turned back or destroyed.","The migration destabilizes multiple regions.","The migrants conquer rather than settle.","Integration proves possible, if difficult."]},{type:"sanctuary",titles:["Sanctuary","The Last Refuge","Safe Harbor","Walls Against the Dark"],summaries:(u,A)=>[`${A} is the last safe place\u2014and it is threatened.`,`${u[0]} fights to protect those who cannot protect themselves.`,"If this place falls, there is nowhere left to go."],outcomes:["The sanctuary holds. The threat is repelled.","The sanctuary falls. Refugees scatter.","The threat is revealed to come from within.","The sanctuary is saved, but forever changed.","A new, safer sanctuary is found."]},{type:"curse",titles:["The %LOCATION% Curse","Doom Upon %ACTOR%","The Witch's Word","Malediction"],summaries:(u,A)=>[`A curse has fallen upon ${A}\u2014or upon ${u[0]}.`,"The terms of breaking the curse seem impossible.","Day by day, the curse tightens its grip."],outcomes:["The curse is broken. Freedom restored.","The curse claims its victim.","The curse is transferred to another.","The curse proves to be a blessing in disguise.","Living with the curse proves manageable."]},{type:"hunt-survival",titles:["The Hunted","%ACTOR% Runs","No Escape","Prey"],summaries:(u,A)=>[`${u[0]} is being hunted through ${A}.`,"Pursuers close in from all sides. Escape seems impossible.","Every shadow could hide a hunter."],outcomes:["The hunted escapes against all odds.","The hunted turns the tables on their pursuers.","The hunted is captured or killed.","The hunted finds unexpected allies.","The hunt reveals a larger conspiracy."]},{type:"conspiracy",titles:["The %LOCATION% Conspiracy","Plots and Shadows","They Are Everywhere","The Hidden Hand"],summaries:(u,A)=>[`A conspiracy reaches into the heart of ${A}.`,`${u[0]} stumbles onto a plot that reaches the highest levels.`,"Trust no one. Anyone could be part of it."],outcomes:["The conspiracy is exposed and destroyed.","The conspiracy succeeds in its goals.","The conspiracy is real\u2014but not what it seemed.","Exposing the conspiracy proves impossible.","The conspirators are played by a greater power."]},{type:"heist",titles:["The %LOCATION% Job","The Perfect Crime","One Last Score","Into the Vault"],summaries:(u,A)=>[`${u[0]} plans an audacious theft in ${A}.`,"The target is impregnable. The crew is ready.","Everything must go perfectly. Nothing ever does."],outcomes:["The heist succeeds spectacularly.","The heist fails\u2014someone talks.","The prize is claimed, but at unexpected cost.","The heist was a setup all along.","The crew turns on each other over the prize."]},{type:"infiltration",titles:["The Mole","Enemy Among Us","The %LOCATION% Spy","Trust and Treachery"],summaries:(u,A)=>[`There is a spy in ${A}. But who?`,`${u[0]} must identify the infiltrator before more damage is done.`,"Paranoia spreads. Old friends are suspected."],outcomes:["The spy is caught and justice served.","The spy escapes with critical secrets.","The wrong person is accused. The real spy continues.","The spy becomes a double agent.","Everyone was spying on everyone else."]},{type:"blackmail",titles:["Secrets for Sale","The %ACTOR% Letters","What They Know","Silence Has a Price"],summaries:(u,A)=>[`Someone has damaging information about ${u[0]}.`,`In ${A}, secrets become currency.`,"Pay the price, or face exposure."],outcomes:["The blackmailer is silenced.","The victim pays and pays and pays.","The secret is exposed\u2014consequences follow.","The blackmailer is blackmailed in turn.","The secret turns out to be already known."]},{type:"imposter",titles:["The False %ACTOR%","Who Are You Really?","Stolen Identity","The Pretender"],summaries:(u,A)=>[`Someone in ${A} is not who they claim to be.`,`${u[0]} suspects an imposter\u2014but can they prove it?`,"The deception runs deep. Even memories lie."],outcomes:["The imposter is exposed dramatically.","The imposter achieves their goal before discovery.","The imposter becomes the role they played.",'The "imposter" is actually the real person.',"Multiple imposters complicate everything."]},{type:"cult",titles:["The Hidden Church","Dark Devotion","The %LOCATION% Cult","Forbidden Worship"],summaries:(u,A)=>[`A secret cult spreads its influence through ${A}.`,`${u[0]} uncovers unsettling rituals and darker plans.`,"How many are already members? The answer terrifies."],outcomes:["The cult is destroyed root and branch.","The cult achieves its apocalyptic goal.","The cult is contained but not eliminated.","The cult's beliefs prove to be valid.","The cult fractures into warring sects."]},{type:"haunting",titles:["The %LOCATION% Haunting","Unquiet Dead","What Lingers","Echoes of the Past"],summaries:(u,A)=>[`The dead do not rest peacefully in ${A}.`,`${u[0]} confronts spirits who refuse to pass on.`,"What do the ghosts want? What will make them stop?"],outcomes:["The spirits are laid to rest.","The haunting intensifies to lethal levels.","Coexistence is negotiated.","The ghosts reveal crucial information.",'The "haunting" proves to have mortal origins.']},{type:"possession",titles:["Not Themselves","The Thing Inside","Stolen Mind","The Possession of %ACTOR%"],summaries:(u,A)=>[`Something has taken control of ${u[0]}.`,`In ${A}, a trusted person acts with another's will.`,"Can the possession be broken before irrevocable harm is done?"],outcomes:["The possession is ended. The host recovers.","The host is destroyed to stop the possessor.","The possessor is bargained with.","The host willingly surrendered control.","The possessor and host merge into something new."]},{type:"transformation",titles:["Becoming","%ACTOR%'s Change","What I Am Now","Metamorphosis"],summaries:(u,A)=>[`${u[0]} is changing into something else.`,`In ${A}, a transformation beyond medicine unfolds.`,"Can the change be stopped? Should it be?"],outcomes:["The transformation is reversed.","The transformation completes. A new creature exists.","The transformation is embraced.","The transformation can be controlled.","The transformation spreads to others."]},{type:"pact",titles:["The Bargain","What Was Promised","Payment Due","The %ACTOR% Compact"],summaries:(u,A)=>[`${u[0]} made a deal with powers best left alone.`,`In ${A}, ancient bargains come due.`,"The terms seemed fair once. They do not seem fair now."],outcomes:["The pact is fulfilled as agreed.","A loophole is found. The pact is broken.","The pact-maker pays the full price.","The terms are renegotiated at great cost.","The other party to the pact is destroyed."]},{type:"rift",titles:["The Tear in Reality","Where Worlds Touch","The %LOCATION% Rift","Bleeding Through"],summaries:(u,A)=>[`Reality itself is wounded near ${A}.`,"Strange things leak through. The boundaries fail.",`${u[0]} must seal the rift\u2014or exploit it.`],outcomes:["The rift is sealed. Reality stabilizes.","The rift expands. Multiple realities collide.","The rift becomes permanent but manageable.","Something crosses through that cannot be uncrossed.","The rift proves to be a deliberate doorway."]},{type:"awakening",titles:["Power Manifest","The Gift","Something Awakens","%ACTOR% Awakens"],summaries:(u,A)=>[`${u[0]} discovers power within themselves.`,`In ${A}, latent abilities surge to life.`,"With power comes fear\u2014from others and from within."],outcomes:["The power is mastered and used for good.","The power proves uncontrollable.","Others seek to claim or destroy the awakened one.","The awakening spreads to others.","The power fades as mysteriously as it came."]}];function ab(u,A,h,H,b,i){let G=hh.find((E)=>E.type===A)??hh[0],M=u.pick(G.titles);if(h[0]){let E=h[0];M=M.replace("%ACTOR%",E)}else M=M.replace("%ACTOR%","Someone");if(h[1]){let E=h[1];M=M.replace("%ACTOR%",E)}else if(h[0])M=M.replace("%ACTOR%",h[0]);else M=M.replace("%ACTOR%","Someone");M=M.replace("%LOCATION%",H),M=M.replace(/\bThe The\b/g,"The");let B=G.summaries(h,H),k=u.pick(B),z=Tb(u,A,h,H,b),P=yb(u,A);return{id:`story-${Date.now()}-${u.int(1e4)}`,type:A,title:M,summary:k,phase:"inciting",actors:h,location:H,startedAt:b,lastUpdated:b,tension:1,beats:[{timestamp:b,summary:i,tensionChange:1}],potentialOutcomes:G.outcomes,resolved:!1,context:z,branchingState:P}}function Tb(u,A,h,H,b){let i={actorRelationships:[],keyLocations:[],themes:[],motivations:{}},M={hunt:["pursuit","survival","justice"],feud:["conflict","honor","rivalry"],revenge:["vengeance","justice","obsession"],war:["conquest","survival","glory"],siege:["endurance","strategy","desperation"],rebellion:["freedom","justice","change"],duel:["honor","skill","resolution"],raid:["greed","surprise","destruction"],mystery:["discovery","truth","danger"],treasure:["wealth","adventure","greed"],prophecy:["fate","belief","destiny"],expedition:["exploration","discovery","courage"],artifact:["power","knowledge","danger"],"lost-heir":["identity","inheritance","legitimacy"],"ancient-evil":["corruption","salvation","doom"],romance:["love","passion","heartbreak"],rise:["ambition","success","power"],fall:["hubris","failure","redemption"],scandal:["shame","reputation","deception"],betrayal:["trust","treachery","revenge"],succession:["power","legitimacy","ambition"],exile:["banishment","redemption","survival"],redemption:["forgiveness","atonement","change"],rescue:["heroism","urgency","sacrifice"],plague:["suffering","healing","fear"],famine:["scarcity","survival","community"],migration:["journey","hope","adaptation"],sanctuary:["protection","refuge","threat"],curse:["affliction","breaking","suffering"],"hunt-survival":["pursuit","evasion","survival"],conspiracy:["deception","plot","exposure"],heist:["theft","skill","risk"],infiltration:["deception","espionage","discovery"],blackmail:["secrets","power","extortion"],imposter:["deception","identity","exposure"],cult:["belief","devotion","manipulation"],haunting:["supernatural","torment","release"],possession:["control","struggle","exorcism"],transformation:["change","identity","acceptance"],pact:["bargain","power","consequences"],rift:["reality","chaos","closure"],awakening:["power","responsibility","control"]}[A]||["conflict"],B=Math.min(u.int(3)+1,M.length);i.themes=[];let k=u.shuffle(M);for(let z=0;z<B;z++)i.themes.push(k[z]);for(let z of h){let P=["seeks power and influence","driven by personal vendetta","motivated by duty and honor","seeks wealth and riches","driven by curiosity and discovery","motivated by love and protection","seeks justice and righteousness","driven by ambition and status","motivated by fear and survival","seeks knowledge and wisdom"];i.motivations[z]=u.pick(P)}if(i.keyLocations=[H],u.chance(0.3))i.keyLocations.push(u.pick(["ancient ruins","hidden grove","abandoned tower","sacred temple","forgotten crypt"]));if(h.length>=2&&h[0]&&h[1]){let z=[`${h[0]} and ${h[1]} were once allies`,`${h[0]} betrayed ${h[1]} in the past`,`${h[0]} is ${h[1]}'s rival`,`${h[0]} owes ${h[1]} a debt`,`${h[0]} and ${h[1]} share a common enemy`,`${h[0]} is jealous of ${h[1]}`,`${h[0]} mentors ${h[1]}`,`${h[0]} and ${h[1]} are family`];if(u.chance(0.6))i.actorRelationships.push(u.pick(z))}return i}function yb(u,A){let h=[];if(A==="revenge")h.push("pursue direct confrontation","use deception and allies","seek magical aid");else if(A==="mystery")h.push("follow the evidence trail","consult local experts","risk dangerous shortcuts");else if(A==="war")h.push("focus on defense","launch preemptive strikes","seek diplomatic solutions");return{path:"main",choices:h.length>0?h:void 0,variables:{}}}function lb(u,A,h){let{context:H,actors:b,location:i,type:G}=A,M=u.pick(ih[A.type]??ih.mystery);if(H){if(b.length>0){if(M=M.replace(/\bhunter\b|\bhunters\b|\bavenger\b|\bpursuer\b/gi,b[0]),M=M.replace(/\bseeker\b|\bseekers\b|\bexplorer\b|\bexplorers\b/gi,b[0]),b.length>1)M=M.replace(/\btarget\b|\benemy\b|\bfoe\b|\bquarry\b/gi,b[1]),M=M.replace(/\brival\b|\brivals\b|\bcompetitor\b|\bcompetitors\b/gi,b[1])}if(H.keyLocations&&H.keyLocations.length>1){let B=H.keyLocations.find((k)=>k!==i);if(B&&u.chance(0.3))M=M.replace(/area|region|territory/gi,B)}if(H.motivations&&Object.keys(H.motivations).length>0){let B=Object.values(H.motivations);if(u.chance(0.2)){let k=u.pick(B);if(b[0])M+=` ${b[0]} remains ${k}.`}}if(H.themes&&H.themes.length>0){let B=u.pick(H.themes);if(u.chance(0.15)){let k={revenge:"The cycle of vengeance continues.",justice:"Justice demands its due.",power:"Power shifts in subtle ways.",discovery:"Secrets begin to surface.",betrayal:"Trust proves fragile.",redemption:"Paths to redemption emerge.",corruption:"Darkness spreads its influence.",salvation:"Hope flickers in the darkness."};if(k[B])M+=` ${k[B]}`}}if(H.actorRelationships&&H.actorRelationships.length>0&&u.chance(0.1)){let B=u.pick(H.actorRelationships);if(B&&B.trim())M+=` ${B}, complicating matters.`}}return M}function $A(u,A,h,H){if(u.beats.push({timestamp:H,summary:A,tensionChange:h}),u.tension=Math.max(0,Math.min(10,u.tension+h)),u.lastUpdated=H,u.tension>=8&&u.phase!=="climax")u.phase="climax";else if(u.tension>=5&&u.phase==="inciting")u.phase="rising"}function sb(u,A,h){let H=u.pick(A.potentialOutcomes);return A.resolved=!0,A.resolution=H,A.phase="aftermath",A.lastUpdated=h,$A(A,`Resolution: ${H}`,0,h),H}function Gh(u,A,h,H){if(H.filter((E)=>!E.resolved).length>=8)return null;let i=u.summary.toLowerCase(),G=(u.details??"").toLowerCase(),M=u.actors??[],B=u.location??"the region",k=null,z=0;if(i.includes("ambush")||i.includes("clash")||i.includes("battle")){if(i.includes("defeat")||i.includes("driven back"))k="revenge",z=0.15;else if(M.length>=2)k="feud",z=0.1}if(i.includes("siege")||i.includes("surround")||i.includes("blockade"))k="siege",z=0.25;if(i.includes("uprising")||i.includes("rebel")||i.includes("revolt")||i.includes("riot"))k="rebellion",z=0.2;if(i.includes("duel")||i.includes("challenge")||i.includes("honor demands"))k="duel",z=0.3;if(i.includes("raid")||i.includes("plunder")||i.includes("strike")&&i.includes("withdraw"))k="raid",z=0.15;if(i.includes("discover")||i.includes("uncover")||i.includes("find"))if(i.includes("artifact")||i.includes("legendary")||i.includes("ancient weapon"))k="artifact",z=0.25;else if(i.includes("treasure")||i.includes("gold")||i.includes("hoard"))k="treasure",z=0.2;else if(i.includes("heir")||i.includes("bloodline")||i.includes("birthright"))k="lost-heir",z=0.25;else k="mystery",z=0.1;if(i.includes("expedition")||i.includes("explore")||i.includes("uncharted"))k="expedition",z=0.2;if(i.includes("awaken")||i.includes("stir")||i.includes("seal")||i.includes("ancient evil"))k="ancient-evil",z=0.2;if(i.includes("portal")||i.includes("rift")||i.includes("gateway")||i.includes("tear in reality"))k="portal",z=0.25;if(i.includes("prophecy")||i.includes("foretold")||i.includes("chosen")||i.includes("omen"))k="prophecy",z=0.15;if(i.includes("renown")||i.includes("famous")||i.includes("hailed")||i.includes("celebrated"))k="rise",z=0.15;if(i.includes("disgrace")||i.includes("ruined")||i.includes("downfall")||i.includes("stripped of"))k="fall",z=0.15;if(i.includes("scandal")||i.includes("exposed")||i.includes("shame")||i.includes("accused"))k="scandal",z=0.2;if(i.includes("betray")||i.includes("treacher")||i.includes("turned against"))k="betrayal",z=0.2;if(i.includes("succession")||i.includes("heir")||i.includes("throne")||i.includes("death")&&i.includes("lord"))k="succession",z=0.2;if(i.includes("exile")||i.includes("banish")||i.includes("cast out"))k="exile",z=0.2;if(i.includes("love")||i.includes("court")||i.includes("wed")||i.includes("affair"))k="romance",z=0.12;if(i.includes("threat")||i.includes("danger")||i.includes("monster"))k="hunt",z=0.15;if(i.includes("faction")&&(i.includes("conflict")||i.includes("tension")||i.includes("war")))k="war",z=0.08;if(i.includes("missing")||i.includes("taken")||i.includes("captive")||i.includes("kidnap"))k="rescue",z=0.2;if(i.includes("plague")||i.includes("sickness")||i.includes("disease")||i.includes("epidemic"))k="plague",z=0.2;if(i.includes("famine")||i.includes("starv")||i.includes("hunger")||i.includes("crop fail"))k="famine",z=0.2;if(i.includes("migration")||i.includes("exodus")||i.includes("flee")||i.includes("refugee"))k="migration",z=0.15;if(i.includes("curse")||i.includes("hex")||i.includes("malediction")||i.includes("blighted"))k="curse",z=0.2;if(i.includes("hunted")||i.includes("pursued")||i.includes("on the run")||i.includes("flee")){if(k!=="migration")k="hunt-survival",z=0.15}if(i.includes("conspiracy")||i.includes("plot")||i.includes("scheme")||i.includes("cabal"))k="conspiracy",z=0.2;if(i.includes("heist")||i.includes("rob")||i.includes("steal")||i.includes("vault"))k="heist",z=0.2;if(i.includes("spy")||i.includes("infiltrat")||i.includes("mole")||i.includes("double agent"))k="infiltration",z=0.2;if(i.includes("blackmail")||i.includes("extort")||i.includes("secret")&&i.includes("threaten"))k="blackmail",z=0.18;if(i.includes("imposter")||i.includes("pretend")||i.includes("false identity")||i.includes("disguise"))k="imposter",z=0.2;if(i.includes("cult")||i.includes("sect")||i.includes("dark worship")||i.includes("forbidden ritual"))k="cult",z=0.2;if(i.includes("haunt")||i.includes("ghost")||i.includes("spirit")||i.includes("apparition"))k="haunting",z=0.18;if(i.includes("possess")||i.includes("control")||i.includes("not themselves")||G.includes("acting strangely"))k="possession",z=0.18;if(i.includes("transform")||i.includes("changing")||i.includes("becoming")||i.includes("lycanthrop"))k="transformation",z=0.2;if(i.includes("pact")||i.includes("bargain")||i.includes("deal with")||i.includes("contract"))k="pact",z=0.18;if(i.includes("rift")||i.includes("tear")||i.includes("reality")||i.includes("dimension"))k="rift",z=0.2;if(i.includes("power manifest")||i.includes("ability awaken")||i.includes("gift emerges"))k="awakening",z=0.18;if(!k||!h.chance(z))return null;let P=H.find((E)=>!E.resolved&&E.type===k&&E.actors.some((K)=>M.includes(K)));if(P)return $A(P,u.summary,1,u.worldTime),null;return ab(h,k,M.length>0?M:[$(h)],B,u.worldTime,u.summary)}function mb(u){if(u instanceof Date)return u;return new Date(u)}function IA(u,A,h,H){let b=[];for(let i of A){if(i.resolved)continue;let G=mb(i.lastUpdated);if((H.getTime()-G.getTime())/86400000>=1&&u.chance(0.2)){let B=lb(u,i,H);$A(i,B,1,H),b.push({category:"faction",summary:`${i.title}: ${B}`,details:i.summary,location:i.location,actors:i.actors,worldTime:H,realTime:new Date,seed:h.seed})}if(i.tension>=10||i.phase==="climax"&&u.chance(0.15)){let B=sb(u,i,H);b.push({category:"faction",summary:`${i.title} concludes`,details:B,location:i.location,actors:i.actors,worldTime:H,realTime:new Date,seed:h.seed}),j({type:"settlement-change",triggerEvent:`${i.title} resolution`,turnsUntilResolution:6,data:{settlementName:i.location,change:"mood-shift",magnitude:B.includes("success")||B.includes("achieved")?1:-1},priority:2})}}return b}function db(u,A){if(!u)return A;return u.settlements.find((H)=>H.id===A)?.name??A}var pb=["ambitious","cautious","greedy","honorable","cruel","charitable","cowardly","brave","cunning","naive","pious","skeptical","loyal","treacherous","romantic","pragmatic"],cb=["noble-exile","veteran-soldier","escaped-slave","disgraced-priest","failed-merchant","orphan-thief","hedge-wizard","wandering-bard","reformed-bandit","retired-adventurer","foreign-exile","guild-dropout","farmhand-turned-guard","shipwreck-survivor","plague-orphan"],bh=["wealth","revenge","power","redemption","knowledge","love","duty","survival","fame","home","justice","freedom"],wb=["speaks in proverbs","constantly counts coins","never sits with back to door","hums old war songs","refuses to eat meat","collects small bones","always wears a lucky charm","tells the same three stories","trusts no one who smiles too easily","prays before every meal","sleeps with a blade in hand","fears deep water","cannot resist a wager","speaks to animals as if they understand","always knows which way is north","never reveals their true name","keeps a journal in cipher","has recurring nightmares","laughs at inappropriate moments","quotes ancient philosophers"],gb=["scarred face and knowing eyes","surprisingly young features","weathered hands that speak of hard labor","an aristocratic bearing despite rough clothes","a nervous tic in the left eye","graying at the temples despite apparent youth","missing two fingers on the left hand","a limp from an old wound","elaborate tattoos visible at wrist and neck","eyes of mismatched color","a brand mark, poorly concealed","the bearing of one who has worn armor","ink-stained fingers of a scholar","calluses of a lifetime of sword work","the cautious movements of one used to danger"];function eb(u,A){let h=2+u.int(2),H=[];for(let k=0;k<h;k++){let z=u.pick(pb);if(!H.includes(z))H.push(z)}let b=u.pick(cb),i=u.pick(bh),G=u.chance(0.3)?u.pick(bh):void 0,M=1+u.int(3),B=[];for(let k=0;k<M;k++){let z=u.pick(wb);if(!B.includes(z))B.push(z)}return{traits:H,background:b,motivation:i,secretMotivation:G,relationships:[],memories:[],quirks:B}}function nb(u){return u.pick(gb)}function ob(u,A){let h={merchant:["Master","Goodman","Trader","Merchant-Factor","Chandler"],guard:["Sergeant","Corporal","Watch-Captain","Armsman","Guardsman"],scout:["Ranger","Tracker","Outrider","Path-Finder","Woods-Guide"],priest:["Brother","Sister","Prior","Vicar","Acolyte","Deacon"],bard:["Minstrel","Skald","Troubadour","Cantor","Rhapsode"],laborer:["Goodman","Porter","Dockhand","Digger","Hauler"]};return u.pick(h[A]??["Citizen"])}function rb(u,A,h,H){let b=["rival","ally","enemy","mentor","student","debtor","creditor","betrayer","betrayed"];if(u.chance(0.15))b.push("lover");if(u.chance(0.1))b.push("kin");let i=u.pick(b),G=1+u.int(5),M=db(H,A.home),B={rival:[`Competed for the same position in ${M}.`,"An old grudge over a matter of honor.","Both loved the same person, once."],ally:["Survived a dangerous journey together.","Owe each other debts that gold cannot repay.","Shared a cell, or a foxhole, or both."],lover:["A passion that scandalized the town.","Met under strange circumstances; love was stranger still.","Some say the affair still smolders."],enemy:[`Blood spilled between them in ${M}.`,"Words were said that cannot be unsaid.","Only one of them can have what they both want."],mentor:["Taught them everything worth knowing.","Saw potential where others saw nothing.","The old ways, passed down in secret."],student:["The most promising pupil in years.","Still learning, still surprising.","Will surpass the master, given time."],debtor:["Borrowed gold at the worst possible moment.","The debt was financial; the cost was higher.","Interest compounds, and so does resentment."],creditor:["Extended credit when no one else would.","Expects repayment, with interest.","Gold is owed, and gold will be had."],kin:["The family resemblance is unmistakable.","Blood ties that neither can deny.","Estranged, but kin nonetheless."],betrayer:["Sold them out for gold, or fear, or both.","The knife came from behind, as always.","Trust, once given, was spectacularly misplaced."],betrayed:["Still bears the scars of misplaced faith.","Forgiveness is not forthcoming.","Watches old friends with new suspicion."]};return{targetId:h.id,targetName:h.name,type:i,strength:G,history:u.pick(B[i])}}function Mh(u,A,h){for(let H of A){if(!H.depth)continue;let b=1+u.int(3),i=A.filter((G)=>G.id!==H.id);for(let G=0;G<b&&i.length>0;G++){let M=u.pick(i);if(!M.depth)continue;if(H.depth.relationships.some((k)=>k.targetId===M.id))continue;let B=rb(u,H,M,h);if(H.depth.relationships.push(B),u.chance(0.6)){let k={rival:"rival",ally:"ally",lover:"lover",enemy:"enemy",mentor:"student",student:"mentor",debtor:"creditor",creditor:"debtor",kin:"kin",betrayer:"betrayed",betrayed:"betrayer"};M.depth.relationships.push({targetId:H.id,targetName:H.name,type:k[B.type],strength:B.strength,history:B.history})}}}}function xA(u,A,h,H){let b=A.depth;if(!b||!b.relationships.length)return null;let i=u.pick(b.relationships),M={rival:{summaries:[`${A.name} and ${i.targetName} exchange pointed words`,`Old rivalry flares between ${A.name} and ${i.targetName}`],details:["Neither would yield. The tension was palpable.","Onlookers sensed violence in the air, barely held back."]},ally:{summaries:[`${A.name} and ${i.targetName} seen conferring`,`${A.name} backs ${i.targetName} in public dispute`],details:["Old bonds proved their worth once again.","Their alliance is noted\u2014and envied\u2014by others."]},lover:{summaries:[`Whispers of ${A.name} and ${i.targetName} meeting in secret`,`${A.name} seen leaving ${i.targetName}'s lodgings at dawn`],details:["The affair continues, discretion be damned.","Some say passion; others say scandal."]},enemy:{summaries:[`${A.name} barely avoids confrontation with ${i.targetName}`,`Violence threatened between ${A.name} and ${i.targetName}`],details:["Blood may yet be spilled between them.","The feud grows more dangerous by the day."]},mentor:{summaries:[`${A.name} instructs ${i.targetName}`,`${A.name} takes ${i.targetName} under their wing`],details:["Wisdom passed from one generation to the next.","The student shows promise\u2014or perhaps stubborn foolishness."]},student:{summaries:[`${A.name} seeks guidance from ${i.targetName}`,`${A.name} demonstrates new skills learned from ${i.targetName}`],details:["The lessons take root.","Not every student surpasses the master, but hope remains."]},debtor:{summaries:[`${A.name} negotiates terms with creditor ${i.targetName}`,`${i.targetName} presses ${A.name} for payment`],details:["Gold owed sits heavy on both parties.","The debt strains whatever else exists between them."]},creditor:{summaries:[`${A.name} demands repayment from ${i.targetName}`,`${A.name} grows impatient with ${i.targetName}'s excuses`],details:["Patience has limits, even for gold.","The ledger must balance, one way or another."]},kin:{summaries:[`${A.name} meets with kinsman ${i.targetName}`,`Family business draws ${A.name} and ${i.targetName} together`],details:["Blood calls to blood, for good or ill.","Some family ties bind; others chafe."]},betrayer:{summaries:[`${A.name} avoids ${i.targetName}'s gaze in the market`,`${i.targetName} confronts ${A.name} about old treachery`],details:["Guilt\u2014or its absence\u2014speaks loudly.","Some betrayals can never be undone."]},betrayed:{summaries:[`${A.name} watches ${i.targetName} with cold eyes`,`${A.name} speaks publicly of ${i.targetName}'s treachery`],details:["The wound festers still.","Forgiveness is not in their nature."]}}[i.type];if(!M)return null;let B=h.settlements.find((E)=>E.name===A.location),k=B&&(h.settlementStates?.[B.name]?.safety??5)<0,z=u.pick(M.summaries),P=u.pick(M.details);if(k&&u.chance(0.5))P+=` Amidst the growing danger in ${A.location}, their ${i.type} feels all the more pressing.`;return{category:"town",summary:z,details:P,location:A.location,actors:[A.name,i.targetName],worldTime:H,realTime:new Date,seed:h.seed}}function qA(u,A){let h={guard:["Fighter","Dwarf","Halfling"],priest:["Cleric","Elf"],scout:["Thief","Elf","Halfling"],bard:["Thief","Magic-User"],merchant:["Thief","Fighter"],laborer:["Fighter","Dwarf"]},H=u.pick(h[A.role]||["Fighter"]),b=1+u.int(12),i={...A,class:H,level:b,xp:0,spells:H==="Magic-User"||H==="Elf"||H==="Cleric"?[]:void 0,depth:eb(u,A.role),age:18+u.int(50),title:ob(u,A.role),appearance:nb(u),secretsKnown:[],memories:[],agendas:[],morale:0,loyalty:u.chance(0.7)?`faction-${u.int(3)}`:void 0};if(i.spells){if(H==="Magic-User"||H==="Elf")i.spells=["Read Magic","Sleep","Magic Missile"].slice(0,1+u.int(2));else if(H==="Cleric")i.spells=["Cure Light Wounds","Protection from Evil"].slice(0,1+u.int(2))}if(i.level&&i.level>=9)i.agendas.push({type:"stronghold",priority:8,progress:u.int(50),description:"Establish a seat of power"});if(i.spells)i.agendas.push({type:"research",priority:5,progress:u.int(30),description:"Unlock deeper magical secrets"});return i}function _A(u,A,h){let H=[];for(let b of u.nexuses)if(b.currentOwnerId){let i=u.factions.find((M)=>M.id===b.currentOwnerId),G=u.npcs.find((M)=>M.id===b.currentOwnerId);if(i){i.wealth+=b.intensity;let M=q(u,i.id);M.power=Math.min(100,M.power+1)}else if(G){let M=u.strongholds.find((B)=>B.ownerId===G.id);if(M)M.treasury+=b.intensity*2}}else if(A.chance(0.01))for(let i of u.factions){let G=q(u,i.id);if(G.power>=60&&!G.activeOperations.some((M)=>M.target===b.name))G.activeOperations.push({id:`op-nexus-${Date.now()}`,type:"expansion",target:b.name,startedAt:h,completesAt:new Date(h.getTime()+172800000),participants:[],successChance:0.5,resources:100,secret:!1,reason:`Claim the ${b.powerType} nexus ${b.name}`}),H.push({category:"faction",summary:`${i.name} moves to claim ${b.name}`,details:`The ${b.powerType} energy of the nexus has drawn their attention. An expedition is sent.`,location:`hex:${b.location.q},${b.location.r}`,actors:[i.name],worldTime:h,realTime:new Date,seed:u.seed})}if(h.getUTCDate()===1){let b=["grain","timber","ore","textiles","salt","fish","livestock"];for(let i of u.factions){let G=q(u,i.id);if(A.chance(0.3)){let M=A.pick(b);if(!G.resourceNeeds.includes(M))G.resourceNeeds.push(M),H.push({category:"faction",summary:`${i.name} declares a shortage of ${M}`,details:`Their stockpiles are low. They will seek ${M} by any means necessary.`,worldTime:h,realTime:new Date,seed:u.seed})}}}return H}function NA(u,A,h){let H=[];for(let b of u.factions){let i=q(u,b.id),G=u.armies.filter((M)=>M.ownerId===b.id).length;if(b.wealth>=200&&G<2&&A.chance(0.1)){let M=i.territory.length>0?A.pick(i.territory):u.settlements[0].name,B={id:`army-${b.id}-${Date.now()}`,ownerId:b.id,location:M,strength:50+A.int(100),quality:1+A.int(3),morale:7+A.int(3),status:"idle",supplies:100,supplyLineFrom:M,lastSupplied:h};u.armies.push(B),b.wealth-=200,H.push({category:"faction",summary:`${b.name} raises an army in ${M}`,details:`Standard-bearers and mercenaries flock to their banners. A force of ${B.strength} troops is ready for war.`,location:M,actors:[b.name],worldTime:h,realTime:new Date,seed:u.seed})}}for(let b of u.strongholds){if(!b.constructionFinished)continue;if(!u.armies.find((G)=>G.ownerId===b.ownerId)&&b.treasury>=500&&A.chance(0.05)){let G=u.npcs.find((k)=>k.id===b.ownerId)||u.parties.find((k)=>k.id===b.ownerId);if(!G)continue;let M=u.settlements.find((k)=>k.coord.q===b.location.q&&k.coord.r===b.location.r)?.name||`hex:${b.location.q},${b.location.r}`,B={id:`army-${b.ownerId}-${Date.now()}`,ownerId:b.ownerId,location:M,strength:20+A.int(40),quality:3+A.int(4),morale:9+A.int(2),status:"idle",supplies:100,supplyLineFrom:M,lastSupplied:h};u.armies.push(B),b.treasury-=500,H.push({category:"faction",summary:`${G.name} musters a personal guard`,details:`Elite warriors are hired to defend ${b.name}.`,location:B.location,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}return H}function SA(u,A,h){let H=[];for(let b of u.parties){let G=Math.floor(b.members.reduce((B,k)=>B+k.level,0)/b.members.length),M=G*2000;if(b.xp>=M&&G<36){for(let B of b.members)B.level+=1,B.maxHp+=1+A.int(8),B.hp=B.maxHp;if(H.push({category:"road",summary:`${b.name} grows in power!`,details:`Through hardship and battle, the members of ${b.name} have reached level ${b.members[0].level}.`,location:b.location,actors:[b.name],worldTime:h,realTime:new Date,seed:u.seed}),b.members[0].level===9){let B=n(u,b.id);if(!B.questLog.some((k)=>k.type==="stronghold"))B.questLog.push({id:`quest-stronghold-${Date.now()}`,type:"stronghold",target:b.location,reason:"Establish a permanent seat of power at name level",progress:0})}}}return H}function fA(u,A,h,H,b){let i=[];for(let G of u.npcs){if(G.alive===!1)continue;let M=G;if(M.agendas&&M.agendas.length>0&&A.chance(0.05)){let B=M.agendas.sort((z,P)=>P.priority-z.priority)[0],k=uM(M,B,u,A,h,H,b);i.push(...k)}if(M.memories&&M.memories.length>0&&A.chance(0.02)){let B=M.memories.filter((k)=>!k.acted&&k.intensity>=5);if(B.length>0){let k=A.pick(B),z=tb(M,k,u,A,h);if(z)i.push(z),k.acted=!0}}}for(let G of u.npcs){let M=G;if(M.memories){for(let B of M.memories)if(B.intensity>1)B.intensity-=0.01;M.memories=M.memories.filter((B)=>B.intensity>=1)}}return i}function tb(u,A,h,H,b){let G={"was-betrayed":{summaries:[`${u.name} speaks bitterly of ${A.target??"old treachery"}`,`${u.name}'s eyes darken at mention of ${A.target??"the past"}`,`${u.name} mutters about trust and betrayal`,`${u.name} recalls the day ${A.target??"someone"} turned on them`],details:["The wound has not healed. Perhaps it never will.","Some betrayals cannot be forgiven, only avenged.","The memory poisons every interaction.","They trusted once. They will not make that mistake again."]},"lost-loved-one":{summaries:[`${u.name} visits the grave of ${A.target??"the fallen"}`,`${u.name} grows quiet when ${A.target??"the dead"} is mentioned`,`${u.name} lights a candle in memory of ${A.target??"the departed"}`,`${u.name} speaks of ${A.target??"those gone"} with wet eyes`],details:["Grief does not fade; it only changes shape.","The living must carry the dead with them.","Some absences echo forever.","They would give anything for one more conversation."]},"was-saved":{summaries:[`${u.name} speaks warmly of ${A.target??"a savior"}`,`${u.name} mentions the debt owed to ${A.target??"their rescuer"}`,`${u.name} offers a toast to ${A.target??"absent friends"}`,`${u.name} credits ${A.target??"another"} with their survival`],details:["Some debts can never be repaid, only honored.","Gratitude runs deeper than gold.","They would die for the one who saved them.","Every day since has been a gift."]},"was-attacked":{summaries:[`${u.name} tenses at mention of ${A.target??"the attack"}`,`${u.name} fingers an old scar thoughtfully`,`${u.name} speaks of ${A.target??"violence past"} with cold fury`,`${u.name} recalls the assault by ${A.target??"enemies"}`],details:["The body heals. The fear lingers.","They will be ready next time.","Violence begets violence, they know.","The memory surfaces in every shadow."]},"committed-violence":{summaries:[`${u.name} stares at their hands, lost in thought`,`${u.name} flinches at reminders of ${A.target??"past violence"}`,`${u.name} drinks to forget ${A.target??"what they did"}`,`${u.name} is haunted by what happened with ${A.target??"the fallen"}`],details:["The weight of killing never lightens.","Blood washes off hands, not conscience.","They did what they had to do. They repeat it like a prayer.","Some nights, the faces come back."]},"fell-in-love":{summaries:[`${u.name} watches ${A.target??"someone"} from across the room`,`${u.name} sighs at mention of ${A.target??"their beloved"}`,`${u.name} finds excuses to be near ${A.target??"the one they love"}`,`${u.name} blushes when ${A.target??"a certain name"} is spoken`],details:["Love makes fools of the wise and cowards of the brave.","Every glance speaks volumes, to those who listen.","They burn with feelings they dare not name.","The heart wants what the heart wants."]},"was-rejected":{summaries:[`${u.name} averts their eyes from ${A.target??"the one who spurned them"}`,`${u.name} bristles at mention of ${A.target??"past heartbreak"}`,`${u.name} nurses old wounds over ale`,`${u.name} pretends not to care about ${A.target??"that person"}`],details:["Rejection leaves scars that do not show.","Love unreturned curdles into something else.","They have not moved on. They may never.","The sting fades. The memory does not."]},"discovered-secret":{summaries:[`${u.name} watches ${A.target??"certain people"} with knowing eyes`,`${u.name} hints at knowledge they should not possess`,`${u.name} speaks in riddles about ${A.target??"hidden truths"}`,`${u.name} smiles when ${A.target??"that matter"} is discussed`],details:["Knowledge is power\u2014and danger.","Some secrets are worth more than gold.","They know. And soon, others might too.","Information is the currency of the careful."]},"committed-betrayal":{summaries:[`${u.name} grows tense when ${A.target??"the past"} is mentioned`,`${u.name} avoids ${A.target??"certain people"}`,`${u.name} justifies old decisions to anyone who will listen`,`${u.name} looks over their shoulder when ${A.target??"that name"} comes up`],details:["Guilt is a heavy companion.","They had their reasons. The reasons ring hollow now.","The betrayed may yet learn the truth.","Sleep does not come easy to traitors."]},"witnessed-cruelty":{summaries:[`${u.name} cannot forget what ${A.target??"the cruel"} did`,`${u.name} speaks of horrors witnessed in ${A.location}`,`${u.name} refuses to discuss ${A.target??"that day"}`,`${u.name} shudders at memories of ${A.target??"evil"}`],details:["Some sights cannot be unseen.","Evil has a face now. They know it well.","The nightmares have not stopped.","They will never be the same."]},"witnessed-heroism":{summaries:[`${u.name} tells tales of ${A.target??"heroic deeds"}`,`${u.name} recalls when ${A.target??"a hero"} saved the day`,`${u.name} still speaks of ${A.target??"bravery"} with awe`,`${u.name} holds ${A.target??"the brave one"} as an example`],details:["True courage inspires for a lifetime.","They saw what one person can do.","Heroes are real. They witnessed one.","The memory sustains them in dark times."]},"was-insulted":{summaries:[`${u.name} seethes at the memory of ${A.target??"public humiliation"}`,`${u.name} plots revenge against ${A.target??"those who mocked"}`,`${u.name} cannot forget the words of ${A.target??"mockers"}`],details:["Pride is a wound that festers.","Honor demands satisfaction.","They will have their day."]},"was-exiled":{summaries:[`${u.name} dreams of ${A.target??"their lost homeland"}`,`${u.name} speaks wistfully of ${A.target??"home"}`,`${u.name} marks the anniversary of their exile`],details:["Home is where they cannot return.","The exile plans their return\u2014someday.","Every stranger reminds them of what was lost."]},"made-enemy":{summaries:[`${u.name} speaks darkly of ${A.target??"an enemy"}`,`${u.name} warns others about ${A.target??"a foe"}`,`${u.name} keeps watch for ${A.target??"enemies"}`],details:["They know who wishes them ill.","Trust is earned. This one failed.","The enmity will not be forgotten."]},"made-friend":{summaries:[`${u.name} speaks fondly of ${A.target??"a friend"}`,`${u.name} inquires after ${A.target??"an ally"}`,`${u.name} credits ${A.target??"a companion"} for past support`],details:["True friends are rare treasures.","They would stand with this one through anything.","Some bonds are forged in fire."]}}[A.category];if(!G)return null;return{category:"town",summary:H.pick(G.summaries),details:H.pick(G.details),location:u.location,actors:A.target?[u.name,A.target]:[u.name],worldTime:b,realTime:new Date,seed:h.seed}}function uM(u,A,h,H,b,i,G){let M=[];switch(A.type){case"revenge":{if(!A.target)break;let B=h.npcs.find((P)=>P.name===A.target),k=h.parties.find((P)=>P.name===A.target),z=i.find((P)=>P.name===A.target);if(B&&B.location===u.location&&B.alive!==!1){if(H.chance(0.3))if(H.chance(0.4)){B.alive=!1,A.progress=100;let E={id:`npc-revenge-${Date.now()}`,type:"assassination",timestamp:b,location:u.location,actors:[u.name],victims:[B.name],perpetrators:[u.name],magnitude:6,witnessed:H.chance(0.5),data:{cause:"revenge"}};M.push(...c(E,h,H,i,G)),M.push({category:"town",summary:`${u.name} exacts revenge on ${B.name}`,details:`The ${u.role} finally settles the score. ${B.name} lies dead.`,location:u.location,actors:[u.name,B.name],worldTime:b,realTime:new Date,seed:h.seed})}else M.push({category:"town",summary:`${u.name} confronts ${B.name}`,details:`Harsh words are exchanged. The ${u.role}'s vengeance must wait.`,location:u.location,actors:[u.name,B.name],worldTime:b,realTime:new Date,seed:h.seed}),A.progress+=10}else if(!B&&!k&&!z){if(A.priority-=1,A.priority<=0)M.push({category:"town",summary:`${u.name} abandons their vendetta`,details:`The ${u.role} can no longer find ${A.target}. The grudge fades.`,location:u.location,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed}),u.agendas=u.agendas?.filter((P)=>P!==A)}else if(H.chance(0.1)){let P=B?.location??k?.location;if(P&&P!==u.location)M.push({category:"road",summary:`${u.name} sets out hunting ${A.target}`,details:`The ${u.role} leaves ${u.location}, seeking their prey.`,location:u.location,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed}),j({type:"spawn-event",triggerEvent:`${u.name}'s hunt`,turnsUntilResolution:12+H.int(24),data:{category:"town",summary:`${u.name} arrives in ${P}`,details:"The hunter draws closer to their quarry.",location:P,actors:[u.name]},priority:3}),A.progress+=20}break}case"ambition":{let B=h.settlements.find((k)=>k.name===u.location);if(B){let k=_(h,B.name);if(!k.rulerNpcId&&u.fame&&u.fame>=5){if(H.chance(0.2))k.rulerNpcId=u.id,A.progress=100,M.push({category:"town",summary:`${u.name} claims leadership of ${B.name}`,details:`Through cunning and reputation, the ${u.role} rises to power.`,location:B.name,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed})}else u.fame=(u.fame??0)+1,A.progress+=10}break}case"protection":{if(A.target){let B=h.factions.find((k)=>k.focus==="martial");if(B&&H.chance(0.3)){let k=u;k.loyalty=B.id,A.progress+=30,M.push({category:"faction",summary:`${u.name} joins ${B.name}`,details:`Seeking protection for ${A.target}, the ${u.role} takes up arms with the faction.`,location:u.location,actors:[u.name,B.name],worldTime:b,realTime:new Date,seed:h.seed})}}break}case"greed":{let B=h.settlements.find((k)=>k.name===u.location);if(B){if(H.chance(0.1)){let k=_(h,B.name);if(H.chance(0.3))k.unrest=Math.min(10,(k.unrest??0)+1),u.reputation=Math.max(-3,u.reputation-1),A.progress+=20,M.push({category:"town",summary:`Theft reported in ${B.name}`,details:`Suspicion falls on certain individuals. The ${u.role} ${u.name} is among them.`,location:B.name,worldTime:b,realTime:new Date,seed:h.seed})}}break}case"research":{if(u.spells&&H.chance(0.2)){if(u.level&&u.level>=7&&!u.agendas.some((E)=>E.type==="nexus")){let E=h.nexuses?.find((K)=>!K.currentOwnerId);if(E)u.agendas.push({type:"nexus",target:E.id,priority:9,progress:0,description:`Claim control of the ${E.name}`})}let B=["Detect Magic","Shield","Floating Disc","Hold Portal","Web","Invisibility","Fireball","Lightning Bolt","Fly"],k=["Detect Evil","Hold Person","Bless","Speak with Animals","Continual Light","Striking","Dispel Magic"],P=(u.class==="Magic-User"||u.class==="Elf"?B:k).filter((E)=>!u.spells.includes(E));if(P.length>0){let E=H.pick(P);u.spells.push(E),A.progress=100,M.push({category:"town",summary:`${u.name} masters a new spell: ${E}`,details:`After weeks of intense study and meditation, the ${u.role} has unlocked new power.`,location:u.location,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed})}}break}case"nexus":{if(A.target){let B=h.nexuses?.find((k)=>k.id===A.target);if(B){if(A.progress+=0.5+H.next()*0.5,A.progress>=100)B.currentOwnerId=u.id,A.progress=100,M.push({category:"faction",summary:`${u.name} claims the ${B.name}`,details:`Through long ritual and arcane mastery, the ${u.role} has bound the ${B.powerType} power of the nexus to their own will.`,location:`hex:${B.location.q},${B.location.r}`,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed}),u.fame=(u.fame??0)+5}}break}case"stronghold":{if(u.level&&u.level>=9){if(A.progress+=0.02+H.next()*0.03,A.progress>=100){let B=h.settlements.find((E)=>E.name===u.location),k=B?B.coord:{q:H.int(h.width),r:H.int(h.height)},z=u.class==="Magic-User"?"Tower":u.class==="Cleric"?"Temple":u.class==="Thief"?"Hideout":"Keep",P={id:`stronghold-${u.id}-${Date.now()}`,ownerId:u.id,name:`${u.name}'s ${z}`,location:k,type:z,level:1,staff:10+H.int(20),constructionFinished:!0,treasury:1000+H.int(2000),unrest:0,population:50+H.int(100),taxRate:10};h.strongholds.push(P),M.push({category:"faction",summary:`${u.name} completes their ${z}`,details:`A grand monument to their power. The ${z} rises over the landscape, attracting followers and rivals alike.`,location:u.location,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed}),u.title=u.class==="Fighter"?"Lord":u.class==="Magic-User"?"Wizard":u.class==="Cleric"?"Patriarch":"Guildmaster",A.progress=100}else if(H.chance(0.1))M.push({category:"town",summary:`Construction continues on ${u.name}'s stronghold`,details:"Masons and laborers work tirelessly. The foundations are deep and the walls rise.",location:u.location,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed})}break}case"romance":{if(!A.target)break;let B=h.npcs.find((k)=>k.name===A.target);if(B&&B.location===u.location&&B.alive!==!1){if(H.chance(0.2)){if(A.progress+=2+H.next()*3,M.push({category:"town",summary:`${u.name} seeks the company of ${B.name}`,details:"A quiet walk in the market, a shared meal... the bond between them grows stronger.",location:u.location,actors:[u.name,B.name],worldTime:b,realTime:new Date,seed:h.seed}),A.progress>=100)M.push({category:"town",summary:`${u.name} and ${B.name} are wed`,details:"Against the backdrop of these uncertain times, love prevails. A celebration is held.",location:u.location,actors:[u.name,B.name],worldTime:b,realTime:new Date,seed:h.seed})}}break}case"betrayal":{if(!A.target)break;let B=h.npcs.find((k)=>k.name===A.target);if(B&&B.location===u.location&&B.alive!==!1){if(H.chance(0.1))if(A.progress+=0.3+H.next()*0.4,A.progress>=100){let k={id:`betrayal-${Date.now()}`,type:"betrayal",timestamp:b,location:u.location,actors:[u.name],victims:[B.name],magnitude:7,witnessed:H.chance(0.4),data:{betrayer:u.name,betrayed:B.name,nature:"political"}};M.push(...c(k,h,H,i,G)),u.agendas=u.agendas?.filter((z)=>z!==A)}else M.push({category:"town",summary:`${u.name} plots in shadows`,details:`The ${u.role} was seen conferring with rivals of ${B.name}.`,location:u.location,actors:[u.name],worldTime:b,realTime:new Date,seed:h.seed})}break}}return M}function vA(u,A,h,H,b){let i=[];for(let G of u.parties){if(G.status!=="idle")continue;if(G.restHoursRemaining&&G.restHoursRemaining>0)continue;let M=n(u,G.id);if(M.vendetta){let k=Hh(M.vendetta,u,H);if(k){let z=k.location;if(z&&z!==G.location){if(!G.goal||G.goal.target!==z)G.goal={kind:"travel-to",target:z},i.push({category:"road",summary:`${G.name} tracks ${M.vendetta}`,details:`Their quarry was last seen near ${z}. The hunt continues.`,location:G.location,actors:[G.name,M.vendetta],worldTime:h,realTime:new Date,seed:u.seed})}else if(z===G.location)i.push(...AM(G,M,k,u,A,h,H,b))}else if(M.killList?.includes(M.vendetta))i.push({category:"town",summary:`${G.name} celebrates their victory`,details:`${M.vendetta} is no more. The vendetta is complete.`,location:G.location,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed}),M.vendetta=void 0}if(M.questLog?.length>0){let k=M.questLog[0];if(k.type==="stronghold"){if(G.members.reduce((P,E)=>P+E.level,0)/G.members.length>=9){if(k.progress+=0.02+A.next()*0.03,k.progress>=100){let P={id:`stronghold-${G.id}-${Date.now()}`,ownerId:G.id,name:`${G.name}'s Bastion`,location:u.settlements.find((E)=>E.name===G.location)?.coord??{q:0,r:0},type:"Keep",level:1,staff:20+A.int(30),constructionFinished:!0,treasury:5000,unrest:0,population:100+A.int(200),taxRate:10};u.strongholds.push(P),M.questLog=M.questLog.filter((E)=>E.id!==k.id),G.fame=(G.fame??0)+10,i.push({category:"faction",summary:`${G.name} completes their stronghold!`,details:`The construction is finished. ${G.name} now rules from their own fortress.`,location:G.location,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}else if(A.chance(0.1))i.push({category:"town",summary:`${G.name} oversees stronghold construction`,details:"Stone by stone, the bastion rises. Local workers are busy with the scaffolding.",location:G.location,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}if(k.type==="hunt"){let z=Hh(k.target,u,H);if(z){if(z.location===G.location){if(A.chance(0.3))if(A.chance(0.5+(G.fame??0)*0.05)){if(k.progress=100,M.killList=[...M.killList??[],k.target],G.fame=(G.fame??0)+3,"alive"in z)z.alive=!1;i.push({category:"road",summary:`${G.name} slays ${k.target}!`,details:`The quest is complete. ${k.reason} - fulfilled at last.`,location:G.location,actors:[G.name,k.target],worldTime:h,realTime:new Date,seed:u.seed});let E={id:`quest-kill-${Date.now()}`,type:"death",timestamp:h,location:G.location,actors:[G.name],victims:[k.target],perpetrators:[G.name],magnitude:7,witnessed:!0,data:{cause:"quest completion",killedBy:G.name}};i.push(...c(E,u,A,H,b)),M.questLog=M.questLog.filter((K)=>K.id!==k.id)}else G.wounded=!0,G.restHoursRemaining=12+A.int(12),M.morale=Math.max(-10,(M.morale??0)-2),k.progress=Math.max(0,k.progress-10),i.push({category:"road",summary:`${G.name} driven back by ${k.target}`,details:"The foe proves too strong. They retreat to lick their wounds.",location:G.location,actors:[G.name,k.target],worldTime:h,realTime:new Date,seed:u.seed})}else if(z.location)G.goal={kind:"travel-to",target:z.location}}}}let B=H.filter((k)=>k.alive&&k.territory===G.location);if(B.length>0&&!M.vendetta&&!G.goal){let k=A.pick(B),z=(G.fame??0)+(M.morale??0)/2;if(z>=k.threat)M.vendetta=k.name,M.questLog=M.questLog??[],M.questLog.push({id:`quest-${Date.now()}`,type:"hunt",target:k.name,reason:`End the threat of ${k.name} ${k.epithet}`,progress:0}),i.push({category:"road",summary:`${G.name} decides to confront ${k.name}`,details:`${k.name} ${k.epithet}'s reign of terror must end. They prepare for battle.`,location:G.location,actors:[G.name,k.name],worldTime:h,realTime:new Date,seed:u.seed});else if(z<k.threat-3){let P=u.settlements.filter((E)=>E.name!==G.location&&!H.some((K)=>K.territory===E.name&&K.alive));if(P.length>0){let E=A.pick(P);G.goal={kind:"travel-to",target:E.name},i.push({category:"road",summary:`${G.name} flees ${k.name}'s territory`,details:`Discretion is the better part of valor. They make for ${E.name}.`,location:G.location,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}}}return i}function Hh(u,A,h){let H=A.npcs.find((G)=>G.name===u);if(H&&H.alive!==!1)return{location:H.location,alive:H.alive};let b=A.parties.find((G)=>G.name===u);if(b)return{location:b.location,alive:!0};let i=h.find((G)=>G.name===u);if(i&&i.alive)return{location:i.territory,alive:i.alive};return null}function AM(u,A,h,H,b,i,G,M){let B=[];if(!A.vendetta)return B;let k=(u.fame??0)+(A.morale??0)+b.int(5),z=G.find((J)=>J.name===A.vendetta),P=H.npcs.find((J)=>J.name===A.vendetta),E=H.parties.find((J)=>J.name===A.vendetta),K=5;if(z)K=z.threat+b.int(3);if(E)K=(E.fame??0)+b.int(5);let L=k>K,W={id:`battle-${Date.now()}`,type:"battle",timestamp:i,location:u.location,actors:[u.name,A.vendetta],magnitude:6,witnessed:!0,data:{victor:L?u.name:A.vendetta,loser:L?A.vendetta:u.name,significance:4}};if(B.push(...c(W,H,b,G,M)),L){if(z){z.alive=!1;let J={id:`death-${Date.now()}`,type:"death",timestamp:i,location:u.location,actors:[u.name],victims:[z.name],perpetrators:[u.name],magnitude:8,witnessed:!0,data:{cause:"vendetta",killedBy:u.name}};B.push(...c(J,H,b,G,M))}if(P)P.alive=!1;A.killList=[...A.killList??[],A.vendetta],A.vendetta=void 0,u.fame=(u.fame??0)+5,A.morale=Math.min(10,(A.morale??0)+3),B.push({category:"road",summary:`${u.name} triumphs over ${W.data.loser}!`,details:"A great victory. Their enemy lies defeated. Songs will be sung of this day.",location:u.location,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed})}else if(u.wounded=!0,u.restHoursRemaining=24+b.int(24),A.morale=Math.max(-10,(A.morale??0)-4),u.fame=Math.max(0,(u.fame??0)-2),b.chance(0.3)&&u.members.length>1){let J=u.members.pop();B.push({category:"road",summary:`${J} falls in battle against ${A.vendetta}`,details:`A bitter loss. ${u.name} retreats, diminished.`,location:u.location,actors:[u.name,J],worldTime:i,realTime:new Date,seed:H.seed})}else B.push({category:"road",summary:`${u.name} is defeated by ${A.vendetta}`,details:"They flee, wounded but alive. The vendetta continues.",location:u.location,actors:[u.name],worldTime:i,realTime:new Date,seed:H.seed});return B}function aA(u,A,h,H,b){let i=[];for(let G of u.factions){let M=q(u,G.id);for(let k of M.activeOperations)if(new Date(k.completesAt)<=h)i.push(...iM(k,G,M,u,A,h,H,b));if(M.activeOperations=M.activeOperations.filter((k)=>new Date(k.completesAt)>h),M.enemies.length>0&&M.activeOperations.length<2){if(A.chance(0.05)){let k=A.pick(M.enemies),z=u.factions.find((E)=>E.id===k),P=q(u,k);if(z&&P.territory.length>0){let E=A.pick(P.territory),K=M.casusBelli[k],L=K?"conquest":"raid",W={id:`op-${Date.now()}`,type:L,target:E,startedAt:h,completesAt:new Date(h.getTime()+(12+A.int(24))*60*60*1000),participants:[],successChance:0.4+M.power/200,resources:G.wealth*0.2,secret:!1,reason:K?K.reason:`War against ${z.name}`};if(M.activeOperations.push(W),i.push({category:"faction",summary:`${G.name} marshals forces against ${z.name}`,details:K?`Driven by ${K.reason}, they seek to conquer ${E}.`:`War continues. ${E} is in their sights.`,location:E,actors:[G.name,z.name],worldTime:h,realTime:new Date,seed:u.seed}),!u.armies.some((J)=>J.ownerId===G.id&&J.location===E)){let J=M.territory[0]||G.name,V={id:`army-op-${Date.now()}`,ownerId:G.id,location:J,strength:40+A.int(60),quality:2,morale:8,status:"marching",target:E,supplies:100,supplyLineFrom:J,lastSupplied:h};u.armies.push(V)}}}}if(M.resourceNeeds.length>0&&M.activeOperations.length<2&&A.chance(0.1)){let k=A.pick(M.resourceNeeds),z=u.settlements.find((P)=>P.supply[k]>2);if(z){if(_(u,z.name).controlledBy!==G.id){let K={id:`op-res-${Date.now()}`,type:"resource-grab",target:z.name,startedAt:h,completesAt:new Date(h.getTime()+(24+A.int(48))*60*60*1000),participants:[],successChance:0.3+M.power/200,resources:G.wealth*0.15,secret:!1,reason:`Secure ${k} supplies from ${z.name}`};M.activeOperations.push(K),i.push({category:"faction",summary:`${G.name} eyes ${z.name} for its ${k}`,details:`Desperate for ${k}, the faction has decided to take the settlement by force.`,location:z.name,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}}if(M.recentWins>=3&&A.chance(0.1)){let k=u.settlements.filter((z)=>{let P=_(u,z.name);return!P.controlledBy&&!P.contested});if(k.length>0){let z=A.pick(k),P=_(u,z.name);P.contested=!0,i.push({category:"faction",summary:`${G.name} moves on ${z.name}`,details:"Emboldened by success, they seek to expand their influence.",location:z.name,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed}),j({type:"spawn-event",triggerEvent:`${G.name} expansion`,turnsUntilResolution:24+A.int(48),data:{category:"faction",summary:`${G.name} takes control of ${z.name}`,details:"Through diplomacy and shows of force, the settlement falls under their sway.",location:z.name,actors:[G.name]},priority:4}),setTimeout(()=>{if(!P.controlledBy)P.controlledBy=G.id,P.contested=!1,M.territory.push(z.name)},0),M.recentWins=0}}if(G.focus==="trade"&&M.enemies.length>0&&A.chance(0.03)){let k=A.pick(M.enemies),z=u.factions.find((E)=>E.id===k),P=q(u,k);if(z&&P.territory.length>0&&!M.activeOperations.some((E)=>E.type==="trade-embargo")){let E=A.pick(P.territory),K={id:`op-embargo-${Date.now()}`,type:"trade-embargo",target:E,startedAt:h,completesAt:new Date(h.getTime()+604800000),participants:[],successChance:0.7,resources:G.wealth*0.1,secret:!1,reason:`Economic warfare against ${z.name}`};M.activeOperations.push(K),i.push({category:"faction",summary:`${G.name} declares embargo on ${E}`,details:"Trade caravans are turned away. Merchants grumble. The economic stranglehold begins.",location:E,actors:[G.name,z.name],worldTime:h,realTime:new Date,seed:u.seed})}}if(G.focus==="pious"&&M.power>=60&&A.chance(0.02)){let k=u.settlements.find((z)=>{let P=_(u,z.name);return P.controlledBy&&M.enemies.includes(P.controlledBy)});if(k&&!M.activeOperations.some((z)=>z.type==="crusade")){let z={id:`op-crusade-${Date.now()}`,type:"crusade",target:k.name,startedAt:h,completesAt:new Date(h.getTime()+1209600000),participants:[],successChance:0.5,resources:G.wealth*0.3,secret:!1,reason:`Holy war to reclaim ${k.name} for the faithful`};M.activeOperations.push(z),i.push({category:"faction",summary:`${G.name} declares a crusade against ${k.name}`,details:"The faithful take up arms. Temple bells ring. A holy war begins.",location:k.name,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}if(M.morale<-3&&A.chance(0.05)){let k=M.territory[0]??u.settlements[0]?.name;if(k&&!M.activeOperations.some((z)=>z.type==="propaganda")){let z={id:`op-prop-${Date.now()}`,type:"propaganda",target:k,startedAt:h,completesAt:new Date(h.getTime()+259200000),participants:[],successChance:0.8,resources:50,secret:!1,reason:"Restoring morale through public messaging"};M.activeOperations.push(z),i.push({category:"faction",summary:`${G.name} launches propaganda campaign`,details:"Heralds spread word of past glories. Bards sing of heroic deeds. The people must believe.",location:k,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}if(M.enemies.length>0&&G.focus==="martial"&&A.chance(0.01)){let k=A.pick(M.enemies),z=u.factions.find((E)=>E.id===k),P=u.npcs.filter((E)=>E.alive!==!1&&E.loyalty===k&&(E.level??1)>=5);if(z&&P.length>0&&!M.activeOperations.some((E)=>E.type==="assassination")){let E=A.pick(P),K={id:`op-assassin-${Date.now()}`,type:"assassination",target:E.name,secondaryTarget:z.name,startedAt:h,completesAt:new Date(h.getTime()+432000000),participants:[],successChance:0.3,resources:200,secret:!0,reason:`Eliminate ${E.name}, a key figure in ${z.name}`};M.activeOperations.push(K)}}if(M.allies.length===0&&u.factions.length>2&&A.chance(0.02)){let k=u.factions.find((z)=>z.id!==G.id&&!M.enemies.includes(z.id)&&!M.allies.includes(z.id));if(k&&!M.activeOperations.some((z)=>z.type==="marriage-alliance")){let z={id:`op-marriage-${Date.now()}`,type:"marriage-alliance",target:k.name,startedAt:h,completesAt:new Date(h.getTime()+2592000000),participants:[],successChance:0.5,resources:500,secret:!1,reason:`Forge alliance with ${k.name} through marriage`};M.activeOperations.push(z),i.push({category:"faction",summary:`${G.name} proposes marriage alliance with ${k.name}`,details:"Envoys are sent. Dowries discussed. A political wedding could reshape alliances.",actors:[G.name,k.name],worldTime:h,realTime:new Date,seed:u.seed})}}if(G.focus==="pious"&&A.chance(0.01)){let k=M.territory[0];if(k&&!M.activeOperations.some((z)=>z.type==="inquisition")){let z={id:`op-inq-${Date.now()}`,type:"inquisition",target:k,startedAt:h,completesAt:new Date(h.getTime()+1209600000),participants:[],successChance:0.7,resources:100,secret:!1,reason:"Root out heresy and corruption"};M.activeOperations.push(z),i.push({category:"faction",summary:`${G.name} launches inquisition in ${k}`,details:"Investigators arrive. Questions are asked. The faithful have nothing to fear\u2014or so they say.",location:k,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}if(G.focus==="martial"&&M.enemies.length>0&&A.chance(0.02)){let k=A.pick(M.enemies),z=q(u,k);if(z.territory.length>0&&!M.activeOperations.some((P)=>P.type==="blockade")){let P=A.pick(z.territory),E={id:`op-block-${Date.now()}`,type:"blockade",target:P,startedAt:h,completesAt:new Date(h.getTime()+864000000),participants:[],successChance:0.6,resources:G.wealth*0.15,secret:!1,reason:`Starve out ${P}`};M.activeOperations.push(E),i.push({category:"faction",summary:`${G.name} blockades ${P}`,details:"Roads are cut. Caravans turned back. Nothing enters or leaves.",location:P,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}let B=u.settlements.find((k)=>{let z=_(u,k.name);return z.disease||z.prosperity<-5});if(B&&(G.focus==="pious"||G.focus==="trade")&&A.chance(0.03)){if(!M.activeOperations.some((k)=>k.type==="relief")){let k={id:`op-relief-${Date.now()}`,type:"relief",target:B.name,startedAt:h,completesAt:new Date(h.getTime()+604800000),participants:[],successChance:0.9,resources:300,secret:!1,reason:`Aid the suffering of ${B.name}`};M.activeOperations.push(k),i.push({category:"faction",summary:`${G.name} sends relief to ${B.name}`,details:"Wagons of grain and medicine roll toward the suffering. Compassion\u2014or calculated politics?",location:B.name,actors:[G.name],worldTime:h,realTime:new Date,seed:u.seed})}}}return i}function TA(u,A,h){let H=[],b=u.npcs.filter((i)=>i.alive!==!1&&i.level&&i.level>=5&&(i.class==="Magic-User"||i.class==="Cleric"||i.class==="Elf"));for(let i of b){if(!A.chance(0.02))continue;let G=i.class==="Magic-User"||i.class==="Elf"?["Control Weather","Cloudkill","Wall of Iron"]:["Bless","Cure Disease","Raise Dead","Insect Plague"];switch(A.pick(G)){case"Control Weather":{let B=A.pick(["clear","cloudy","rain","storm","snow","fog"]);if(u.calendar)u.calendar.weather=B;H.push({category:"weather",summary:`${i.name} alters the weather`,details:`Through ancient incantations, the ${i.class} calls forth ${B} over the region.`,location:i.location,actors:[i.name],worldTime:h,realTime:new Date,seed:u.seed});break}case"Cloudkill":{let B=u.settlements.find((k)=>k.name===i.location);if(B){let k=_(u,B.name);k.prosperity=Math.max(-10,k.prosperity-3),k.populationDelta-=50,H.push({category:"town",summary:`Magical mist chokes ${B.name}`,details:`A toxic green cloud, conjured by ${i.name}, rolls through the streets. Panic ensues.`,location:B.name,actors:[i.name],worldTime:h,realTime:new Date,seed:u.seed})}break}case"Bless":{let B=u.settlements.find((k)=>k.name===i.location);if(B){let k=_(u,B.name);k.safety=Math.min(10,k.safety+2),B.mood=Math.min(5,B.mood+1),H.push({category:"town",summary:`Divine blessing upon ${B.name}`,details:`${i.name} performs a grand ritual of sanctification. A sense of peace fills the air.`,location:B.name,actors:[i.name],worldTime:h,realTime:new Date,seed:u.seed})}break}case"Raise Dead":{let B=u.npcs.filter((k)=>k.alive===!1&&k.location===i.location);if(B.length>0){let k=A.pick(B);k.alive=!0,k.wounded=!0,H.push({category:"town",summary:`${i.name} returns ${k.name} from the grave!`,details:`A miracle! The gates of death are pulled back. ${k.name} breathes once more, though they are weak.`,location:i.location,actors:[i.name,k.name],worldTime:h,realTime:new Date,seed:u.seed})}break}}}return H}function iM(u,A,h,H,b,i,G,M){let B=[],k=b.chance(u.successChance);switch(u.type){case"raid":{if(!H.settlements.find((P)=>P.name===u.target))break;if(k){let P={id:`raid-${Date.now()}`,type:"raid",timestamp:i,location:u.target,actors:[A.name],perpetrators:[A.name],magnitude:5,witnessed:!0,data:{damage:2+b.int(3),loot:["gold","supplies"],casualties:b.int(2)}};B.push(...c(P,H,b,G,M)),h.resources+=20,h.recentWins+=1,B.push({category:"faction",summary:`${A.name} raids ${u.target}`,details:"Swift and brutal, they strike and withdraw with plunder.",location:u.target,actors:[A.name],worldTime:i,realTime:new Date,seed:H.seed})}else h.recentLosses+=1,h.power=Math.max(0,h.power-5),B.push({category:"faction",summary:`${A.name}'s raid on ${u.target} fails`,details:"The defenders held strong. They retreat in disarray.",location:u.target,actors:[A.name],worldTime:i,realTime:new Date,seed:H.seed});break}}return B}function yA(u,A,h){let H=[];if(h.getUTCDate()!==1)return H;for(let i of u.strongholds){if(!i.constructionFinished)continue;let G=Math.floor(i.population*(i.taxRate/10));i.treasury+=G;let M=i.staff*2+Math.floor(i.population/10);if(i.treasury=Math.max(0,i.treasury-M),i.taxRate>15)i.unrest+=1;if(i.treasury===0)i.unrest+=2;if(i.unrest>0&&A.chance(0.2))i.unrest-=1;if(i.unrest<3&&i.treasury>M*2){let B=1+A.int(Math.floor(i.population*0.05)+1);i.population+=B,H.push({category:"town",summary:`Settlers arrive at ${i.name}`,details:`Drawn by the promise of safety and fair rule, ${B} new families have taken up residence in the domain.`,location:`hex:${i.location.q},${i.location.r}`,worldTime:h,realTime:new Date,seed:u.seed})}if(H.push({category:"faction",summary:`Monthly report for ${i.name}`,details:`Tax collection: ${G}gp. Upkeep: ${M}gp. Current Treasury: ${i.treasury}gp. Population: ${i.population} families.`,location:`hex:${i.location.q},${i.location.r}`,worldTime:h,realTime:new Date,seed:u.seed}),i.unrest>=8)H.push({category:"faction",summary:`Uprising in ${i.name}!`,details:`The peasantry has reached a breaking point. Angry mobs gather at the gates of the ${i.type}.`,location:`hex:${i.location.q},${i.location.r}`,worldTime:h,realTime:new Date,seed:u.seed})}return H}function Bh(u,A){let h=0;h+=Math.floor(u.strength/10),h+=u.quality*10,h+=(u.morale-7)*5;let H=A.npcs.find((b)=>b.id===u.ownerId);if(H&&H.level)h+=H.level*2;return h}function hM(u,A,h,H,b){let i=[],G=Bh(u,h)+H.int(20),M=Bh(A,h)+H.int(20),B=G-M,k=B>0,z=k?u:A,P=k?A:u,E=10+H.int(Math.abs(B)/2+10),K=H.int(E/2),L=Math.floor(P.strength*(E/100)),W=Math.floor(z.strength*(K/100));if(P.strength-=L,z.strength-=W,P.morale=Math.max(2,P.morale-2),z.morale=Math.min(12,z.morale+1),P.morale<=3&&H.chance(0.5)){P.status="surrendered",i.push({category:"faction",summary:`${P.ownerId}'s forces surrender!`,details:"Facing total annihilation, the remaining troops throw down their arms.",location:u.location,worldTime:b,realTime:new Date,seed:h.seed});let V=h.npcs.find((C)=>C.id===P.ownerId);if(V&&H.chance(0.8)){if(!z.capturedLeaders)z.capturedLeaders=[];z.capturedLeaders.push(V.id),i.push({category:"faction",summary:`${V.name} taken prisoner`,details:"The commander of the defeated forces is led away in chains.",location:u.location,actors:[V.name],worldTime:b,realTime:new Date,seed:h.seed})}}let J={winner:z,loser:P,winnerLosses:W,loserLosses:L,fatality:H.chance(0.05)};return i.push({category:"faction",summary:`Battle at ${u.location}`,details:`${z.ownerId}'s forces triumph over ${P.ownerId}! ${P.ownerId} lost ${L} troops, while ${z.ownerId} lost ${W}.`,location:u.location,worldTime:b,realTime:new Date,seed:h.seed}),{logs:i,result:J}}function GM(u,A,h){let H=[];for(let b of u.armies){let i=0.5+b.strength/200;if(b.supplies=Math.max(0,b.supplies-i),b.supplies<80&&b.supplyLineFrom){if(bM(b,u,A)){let B=Math.max(2,9);if(b.supplies=Math.min(100,b.supplies+B),b.lastSupplied=h,b.status==="starving")b.status="idle"}else if(A.chance(0.1))H.push({category:"faction",summary:`Supply lines disrupted for ${b.ownerId}'s forces`,details:`The path to ${b.supplyLineFrom} is blocked or too dangerous. The troops are beginning to worry.`,location:b.location,worldTime:h,realTime:new Date,seed:u.seed})}if(b.supplies<=0){b.status="starving",b.morale=Math.max(2,b.morale-0.5);let G=Math.floor(b.strength*0.02);if(b.strength-=G,A.chance(0.05))H.push({category:"faction",summary:`${b.ownerId}'s army is starving at ${b.location}`,details:`With no supplies reaching the camp, ${G} troops have perished or deserted. Morale is at a breaking point.`,location:b.location,worldTime:h,realTime:new Date,seed:u.seed})}}return H}function bM(u,A,h){if(!u.supplyLineFrom)return!1;if(u.location===u.supplyLineFrom)return!0;if(A.armies.filter((i)=>i.location===u.supplyLineFrom&&kh(i.ownerId,u.ownerId,A)).length>0)return!1;let b=_(A,u.supplyLineFrom);if(b&&b.unrest>7)return!1;return!0}function lA(u,A,h){let H=[];H.push(...GM(u,A,h));for(let i of u.armies)if(i.status==="marching"&&i.target){let G=u.settlements.find((B)=>B.name===i.location),M=u.settlements.find((B)=>B.name===i.target);if(!G||!M){if(A.chance(0.1))i.location=i.target,i.status="idle",i.target=void 0}else if(A.chance(0.015))i.location=i.target,i.status="idle",i.target=void 0,H.push({category:"faction",summary:`Army arrives at ${i.location}`,details:`The forces of ${i.ownerId} have completed their march.`,location:i.location,worldTime:h,realTime:new Date,seed:u.seed})}let b=new Set(u.armies.map((i)=>i.location));for(let i of b){let G=u.armies.filter((M)=>M.location===i&&M.strength>0);if(G.length>=2)for(let M=0;M<G.length;M++)for(let B=M+1;B<G.length;B++){let k=G[M],z=G[B];if(kh(k.ownerId,z.ownerId,u)){let{logs:P}=hM(k,z,u,A,h);H.push(...P)}}}return u.armies=u.armies.filter((i)=>i.strength>0),H}function kh(u,A,h){if(u===A)return!1;let H=h.factions.find((k)=>k.id===u||k.name===u),b=h.factions.find((k)=>k.id===A||k.name===A);if(H&&b){if(h.factionStates?.[H.id]?.enemies.includes(b.id))return!0;if(h.factionStates?.[b.id]?.enemies.includes(H.id))return!0}let i=h.parties.find((k)=>k.id===u||k.name===u),G=h.parties.find((k)=>k.id===A||k.name===A);if(i&&b){if(h.partyStates?.[i.id]?.enemies.includes(b.id))return!0}if(G&&H){if(h.partyStates?.[G.id]?.enemies.includes(H.id))return!0}let M=h.npcs.find((k)=>k.id===u||k.name===u),B=h.npcs.find((k)=>k.id===A||k.name===A);if(M&&B){if((M.agendas||[]).some((z)=>z.type==="revenge"&&z.target===B.name))return!0}return!1}function sA(u,A,h){let H=[];for(let b of u.settlements){let i=_(u,b.name);if(!i.disease&&A.chance(0.001-i.prosperity/1e4))i.disease={type:A.pick(["Camp Fever","The Red Ache","Gripsha","Yellow Plague"]),intensity:2+A.int(3),spreadRate:0.1+A.next()*0.2,discovered:!1};if(i.disease){let G=i.disease;if(!G.discovered&&A.chance(0.1))G.discovered=!0,H.push({category:"town",summary:`Disease outbreak in ${b.name}!`,details:`Local healers have identified ${G.type} among the populace. Fear spreads as quickly as the sickness.`,location:b.name,worldTime:h,realTime:new Date,seed:u.seed}),i.safety-=2,i.unrest+=1;if(A.chance(0.1)){if(G.intensity+=A.next()>0.6?1:-1,G.intensity<=0){H.push({category:"town",summary:`${G.type} fades in ${b.name}`,details:"The worst of the sickness has passed. The bells ring in celebration.",location:b.name,worldTime:h,realTime:new Date,seed:u.seed}),i.disease=void 0;continue}}let M=u.armies.filter((k)=>k.location===b.name);for(let k of M)if(k.status!=="diseased"&&A.chance(G.spreadRate)){if(k.status="diseased",G.discovered)H.push({category:"faction",summary:`${k.ownerId}'s forces infected with ${G.type}`,details:`While stationed at ${b.name}, the troops have fallen ill.`,location:b.name,worldTime:h,realTime:new Date,seed:u.seed})}let B=u.parties.filter((k)=>k.location===b.name);for(let k of B)if(!k.wounded&&A.chance(G.spreadRate/2)){if(k.wounded=!0,k.restHoursRemaining=48,G.discovered)H.push({category:"road",summary:`${k.name} falls ill in ${b.name}`,details:`The ${G.type} has claimed members of the company. They must rest to recover.`,location:b.name,worldTime:h,realTime:new Date,seed:u.seed})}}}for(let b of u.armies)if(b.status==="diseased"){let i=_(u,b.location);if(i&&!i.disease&&A.chance(0.1))i.disease={type:"Camp Fever",intensity:3,spreadRate:0.15,discovered:!1}}for(let b of u.caravans){let i=_(u,b.location);if(i.disease&&A.chance(i.disease.spreadRate)){let G=u.settlements.find((M)=>(b.route[0]===b.location?b.route[1]:b.route[0])===M.id);if(G){let M=_(u,G.name);if(!M.disease&&A.chance(0.3))M.disease={...i.disease,discovered:!1,intensity:1}}}}for(let b of u.armies)if(b.status==="diseased"){let i=Math.floor(b.strength*0.01);if(b.strength-=i,b.morale=Math.max(2,b.morale-0.1),A.chance(0.05))H.push({category:"faction",summary:`Sickness ravages ${b.ownerId}'s army`,details:`Fever spreads through the camp. ${i} soldiers are unfit for duty or dead.`,location:b.location,worldTime:h,realTime:new Date,seed:u.seed});if(A.chance(0.05))b.status="idle"}return H}function mA(u,A,h){let H=[];for(let b of u.mercenaries){if(!b.hiredById&&A.chance(0.02)){let i=A.pick(u.settlements);b.location=i.name}if(!b.hiredById)for(let i of u.factions){let G=q(u,i.id);if(i.wealth>b.monthlyRate*3&&G.power<40&&A.chance(0.05)){b.hiredById=i.id,i.wealth-=b.monthlyRate;let M={id:`army-merc-${b.id}`,ownerId:i.id,location:b.location,strength:b.size,quality:b.quality,morale:b.loyalty,status:"idle",supplies:100,supplyLineFrom:b.location,lastSupplied:h,isMercenary:!0,costPerMonth:b.monthlyRate};u.armies.push(M),H.push({category:"faction",summary:`${i.name} hires ${b.name}`,details:`The mercenary company has signed a contract for ${b.monthlyRate}gp per month. Their spears are now at the faction's disposal.`,location:b.location,actors:[i.name,b.name],worldTime:h,realTime:new Date,seed:u.seed});break}}}return H}function dA(u,A,h){let H=[];for(let b of u.armies)if(b.capturedLeaders&&b.capturedLeaders.length>0){for(let i of b.capturedLeaders)if(A.chance(0.05)){let G=u.npcs.find((k)=>k.id===i);if(!G)continue;let M=u.factions.find((k)=>k.id===b.ownerId),B=u.factions.find((k)=>k.id===G.loyalty);if(M&&B){let k=(G.level??1)*100;if(B.wealth>=k){if(B.wealth-=k,M.wealth+=k,b.capturedLeaders=b.capturedLeaders.filter((z)=>z!==i),H.push({category:"faction",summary:`${G.name} is ransomed`,details:`${B.name} has paid ${k}gp to ${M.name} for the release of their leader.`,location:b.location,actors:[G.name,M.name],worldTime:h,realTime:new Date,seed:u.seed}),A.chance(0.3))j({type:"spawn-event",triggerEvent:`Ransom of ${G.name}`,turnsUntilResolution:24+A.int(48),data:{category:"faction",summary:`Peace talks begin between ${M.name} and ${B.name}`,details:`The return of ${G.name} has opened a window for diplomacy.`,actors:[M.name,B.name]},priority:5})}}}}for(let b of u.factions){let i=q(u,b.id);for(let G of i.enemies){let M=q(u,G);if(i.recentLosses>5&&M.recentLosses>5||i.power>80&&M.power<20){if(A.chance(0.01)){i.enemies=i.enemies.filter((k)=>k!==G),M.enemies=M.enemies.filter((k)=>k!==b.id);let B=u.factions.find((k)=>k.id===G);H.push({category:"faction",summary:`Peace treaty signed: ${b.name} and ${B?.name}`,details:"After long conflict, both sides have agreed to lay down their arms. The borders are recognized once more.",worldTime:h,realTime:new Date,seed:u.seed})}}}}return H}var zh={sword:["Dawnbringer","Nightfall","Oathkeeper","Widowmaker","Soulreaver","Frostbite","Hellfire","Starfall","Griefbringer","Peacemaker"],axe:["Skullsplitter","Worldbreaker","Headswoman","Thunderclap","Blooddrinker","Giantsbane","Treefeller","Bonecruncher"],spear:["Godspear","Serpent-Tongue","Skypierce","Heartseeker","Stormcaller","Orc-Prod","Dragonlance","Soulspear"],bow:["Whisperwind","Deadeye","Starshot","Nighthawk","Doomstring","Farseeker","Moonbow","Sunfire"],mace:["Doomhammer","Bonecrusher","Judgement","Penitence","Stonebreaker","Lawbringer","Mercy","Wrath"],dagger:["Whisper","Backstab","Heartsting","Shadowfang","Venom","Silencer","Kingslayer","Nightblade"],staff:["Worldtree","Stormcaller","Lifegiver","Deathshead","Starfire","Moonbeam","Sunray","Shadowstaff"],hammer:["Earthshaker","Thunderstrike","Godsforge","Titanhammer","Giantmaker","Worldforger","Doomfall","Mountainbreaker"]},MM=["the Orc-Cleaver","Bane of Dragons","the Kingmaker","Doom of the Undead","the Godslayer","Hope of the Faithful","Terror of the North","the Liberator","Scourge of Demons","the Peacekeeper","Destroyer of Armies","the Last Word","Friend of Heroes","the Betrayer","Light in Darkness","the Final Mercy"],HM=["star-metal","dragon-bone","shadow-forged","sky-iron","mithril","adamantine","crystal","obsidian","blessed silver","demon-steel","phoenix-feather","elf-wrought","dwarf-forged","giant-bone","god-touched"],BM=["Forged in the First Age by the Smith-God himself.","Carried by the Last King into the Battle of Broken Crowns.","Pulled from the heart of a dying star by heroes of legend.","Cursed by a dying witch-queen, blessed by a saint.","Lost for a thousand years beneath the Sunken Temple.","Won from a dragon's hoard by trickery and courage.","The only weapon ever to wound the Immortal Tyrant.","Passed down through twelve generations of heroes, each dying gloriously.","Forged from the chains that bound an ancient god.","Created to slay a specific demon; that demon still lives."],kM=["Cannot be sheathed once drawn until it tastes blood.","Whispers the names of all it has slain.","Burns the unworthy who dare wield it.","Brings doom to all who love its bearer.","Thirsts for the blood of innocents.","Will one day betray its wielder at the worst moment.","Slowly corrupts the soul of its bearer.","Attracts the attention of dark powers."];var Ph=[{species:"dragon",names:["Vermithrax","Smaug-spawn","Ancalagon the Lesser","Glaurung-kin","Fafnir-blood"],epithets:["the Desolator","Bane of Kingdoms","the Eternal","Father of Ash","the Unconquered"],descriptions:["Scales like black iron, eyes like dying suns.","So ancient even other dragons fear to speak its name.","Three heads, each with its own cruel cunning.","Wingspan blots out the sun for a mile."]},{species:"giant",names:["Ymir-spawn","Gogmagog","Typhon","Atlas-kin","Kronos-blood"],epithets:["the Mountain-Walker","World-Shaker","the Undying","Breaker of Cities"],descriptions:["Taller than castle walls, older than kingdoms.","Stone for flesh, magma for blood.","Last of a race of world-builders.","Carries a club that was once a great oak."]},{species:"demon",names:["Azmodeth","Bael-spawn","Mephistar","Abraxon","Demonlord"],epithets:["the Corruptor","Prince of Lies","the Bargainer","Soultrader"],descriptions:["Beauty and horror wed in impossible form.","Speaks every language ever uttered.","Bound here by ancient pact, seeking freedom.","Collects souls like others collect coins."]},{species:"undead",names:["the Nameless King","Dust-Lord","He-Who-Was","the Unremembered","Bone-Emperor"],epithets:["the Deathless","Lord of Ashes","the Eternal Hunger","King of Graves"],descriptions:["Once a great king, now animated by vengeance alone.","Commands legions of the restless dead.","Death itself fears to claim this one.","Seeks the living to remember its forgotten name."]},{species:"beast",names:["the Nemean","Fenrir-spawn","Cerberus-kin","Chimera Prime","Behemoth"],epithets:["the Untameable","Eater of Heroes","the Unstoppable","Apex Predator"],descriptions:["Hide that turns aside any blade.","Hunts for sport, not hunger.","Three times the size of any natural beast.","Intelligence gleams in ancient eyes."]},{species:"aberration",names:["the Thing Below","Star-Spawn","the Unnameable","That Which Waits","the Dreamer"],epithets:["from Beyond the Stars","the Incomprehensible","Madness-Bringer","Reality-Render"],descriptions:["Geometry that hurts to perceive.","Existed before the gods were born.","To look upon it is to forget sanity.","Communicates in nightmares."]}],zM=[{template:"When %ACTOR% stands at the crossroads of %LOCATION%, the world shall tremble.",interpretation:"A great decision awaits."},{template:"Three signs herald the doom: %SIGN1%, %SIGN2%, and %SIGN3%. Then %ACTOR% shall rise.",interpretation:"Watch for the portents."},{template:"%WEAPON% shall be found again, and in the hands of %ACTOR%, kingdoms fall.",interpretation:"A legendary weapon seeks a wielder."},{template:"The blood of %ACTOR% shall water the fields of %LOCATION%, and from that sacrifice, hope blooms.",interpretation:"A hero must fall for others to rise."},{template:"When %MONSTER% wakes from its long slumber, only %ACTOR% can stand against it.",interpretation:"An ancient evil stirs."},{template:"The stars align once in a thousand years. At that hour, %LOCATION% shall burn or be reborn.",interpretation:"Celestial forces at work."},{template:"%ACTOR% shall betray %ACTOR2%, and in that betrayal, find either damnation or redemption.",interpretation:"Trust will be tested."},{template:"The child of %LOCATION% shall wear the crown of thorns, and weep for what they must become.",interpretation:"A reluctant hero emerges."}],lu=["a comet streaks across the sky","the moon bleeds red","birds fall dead from the sky","fish swim upstream","wolves howl at midday","flowers bloom in winter","snow falls in summer","the dead walk briefly","children speak in tongues","statues weep blood","wells run dry","crops grow overnight","animals speak prophecy","the sun rises in the west","shadows move against the light"],PM=[{type:"vault",names:["The Vault of Kings","The Emperor's Treasury","The Dragon's Hoard","The Forgotten Cache"],descriptions:["Sealed for a thousand years, waiting for a worthy finder.","The combined wealth of a dozen conquered kingdoms.","Said to bankrupt empires with its contents."]},{type:"tomb",names:["The Tomb of the Nameless Pharaoh","The Barrow of Heroes","The Crypt of the Last King"],descriptions:["Buried with treasures to shame the living.","The dead king clutches his crown still.","Grave goods worth more than cities."]},{type:"library",names:["The Library of Shadows","The Arcane Archives","The Forbidden Collection"],descriptions:["Knowledge that could remake the world.","Spells lost since the Age of Wonders.","The collected wisdom of a dead civilization."]},{type:"armory",names:["The Armory of the Gods","The Arsenal of Heroes","The Weapon-Vault of Legend"],descriptions:["Weapons forged for wars that ended the world.","Every blade has slain a king.","Armor worn by demigods."]}];function EM(u,A){let h=u.pick(["sword","axe","spear","bow","mace","dagger","staff","hammer"]),H=u.pick(zh[h]);return{id:`weapon-${Date.now()}-${u.int(1000)}`,name:H,epithet:u.pick(MM),type:h,material:u.pick(HM),power:7+u.int(4),curse:u.chance(0.3)?u.pick(kM):void 0,history:u.pick(BM),discovered:!1,sightings:0}}function KM(u,A){let h=u.pick(Ph),H=u.pick(A.settlements).name;return{id:`monster-${Date.now()}-${u.int(1000)}`,name:u.pick(h.names),epithet:u.pick(h.epithets),species:h.species,description:u.pick(h.descriptions),threat:8+u.int(3),territory:H,weakness:u.chance(0.5)?u.pick(["Only vulnerable to silver.","Cannot cross running water.","Blinded by sunlight.","Must be killed by the same weapon thrice.","A specific ancient song weakens it.","Only a sacrifice of love can end it."]):void 0,treasure:u.chance(0.7)?u.pick(["guards a legendary weapon","hoards the wealth of a fallen kingdom","protects ancient knowledge","sleeps upon a dragon's hoard"]):void 0,history:`Legends speak of ${h.names[0]} for as long as there have been storytellers.`,alive:!0,sightings:0}}function DM(u,A,h){let H=u.pick(zM),b=h.length>0?u.pick(h):$(u),i=h.length>1?u.pick(h.filter((B)=>B!==b)):$(u),G=u.pick(A.settlements).name,M=H.template.replace("%ACTOR%",b).replace("%ACTOR2%",i).replace("%LOCATION%",G).replace("%WEAPON%",u.pick(zh.sword)).replace("%MONSTER%",u.pick(Ph).names[0]).replace("%SIGN1%",u.pick(lu)).replace("%SIGN2%",u.pick(lu)).replace("%SIGN3%",u.pick(lu));return{id:`prophecy-${Date.now()}`,text:M,interpretation:H.interpretation,subjects:[b,i].filter(Boolean),fulfilled:!1,announced:!1}}function LM(u,A){let h=u.pick(PM),H=u.pick(A.settlements).name;return{id:`treasure-${Date.now()}`,name:u.pick(h.names),type:h.type,description:u.pick(h.descriptions),location:H,contents:[u.pick(["gold beyond counting","jewels by the bushel","ancient coins","silver ingots"]),u.pick(["a legendary weapon","priceless artifacts","magical items","relics of power"]),u.pick(["forbidden knowledge","lost spells","ancient maps","historical records"])],guardian:u.chance(0.7)?u.pick(["an ancient golem","the restless dead","a bound demon","deadly traps","a dragon","a curse that kills intruders"]):void 0,discovered:!1,looted:!1,clues:[`An old map mentions ruins near ${H}.`,"A dying explorer spoke of treasures beyond imagining.",`Ancient texts reference the ${h.names[0]}.`]}}function pA(u,A,h,H){let b=[];if(u.chance(0.08)){let i=H.weapons.find((M)=>!M.discovered)??EM(u,A);if(!H.weapons.includes(i))H.weapons.push(i);i.sightings++;let G=u.pick(A.settlements);b.push({category:"town",summary:`Whispers of ${i.name} ${i.epithet}`,details:`A traveler speaks of a legendary ${i.type} of ${i.material}. ${i.history} ${i.curse?`But beware: ${i.curse}`:""}`,location:G.name,worldTime:h,realTime:new Date,seed:A.seed}),j({type:"spawn-rumor",triggerEvent:`Legendary weapon: ${i.name}`,turnsUntilResolution:288+u.int(144),data:{origin:G.name,target:G.name,kind:"mystery",text:`Treasure-seekers speak of ${i.name}. Some say it lies in a forgotten ruin. Others claim a monster guards it.`},priority:5})}if(u.chance(0.06)){let i=H.monsters.find((M)=>M.alive&&M.sightings<5)??KM(u,A);if(!H.monsters.includes(i))H.monsters.push(i);i.sightings++,i.lastSeen=h,b.push({category:"road",summary:`${i.name} ${i.epithet} spotted near ${i.territory}`,details:`${i.description} Travelers flee in terror. ${i.weakness?`Ancient lore suggests: ${i.weakness}`:"None know how to defeat such a creature."}`,location:i.territory,actors:[i.name],worldTime:h,realTime:new Date,seed:A.seed});let G=A.settlements.find((M)=>M.name===i.territory);if(G)G.mood=Math.max(-5,G.mood-2)}if(u.chance(0.05)){let i=[...A.parties.map((G)=>G.name),...A.npcs.filter((G)=>G.alive!==!1&&(G.fame??0)>=2).map((G)=>G.name)];if(i.length>0){let G=DM(u,A,i);H.prophecies.push(G),G.announced=!0;let M=u.pick(["an old hermit","a dying oracle","a child in a trance","flames in a temple brazier","a voice from the sky"]),B=u.pick(A.settlements);b.push({category:"town",summary:`A prophecy is spoken in ${B.name}`,details:`${M.charAt(0).toUpperCase()+M.slice(1)} declares: "${G.text}" ${G.interpretation}`,location:B.name,actors:G.subjects,worldTime:h,realTime:new Date,seed:A.seed})}}if(u.chance(0.08)){let i=H.treasures.find((B)=>!B.discovered)??LM(u,A);if(!H.treasures.includes(i))H.treasures.push(i);let G=u.pick(A.settlements),M=u.pick(i.clues);b.push({category:"town",summary:`Tales of ${i.name} surface in ${G.name}`,details:`${i.description} ${M} ${i.guardian?`Legends warn that ${i.guardian} protects it.`:""}`,location:G.name,worldTime:h,realTime:new Date,seed:A.seed})}if(u.chance(0.04)){let i=u.pick(lu),G=u.pick(["The priests are divided on what this means.","The old tales speak of such signs before great change.","Some weep with joy; others weep with terror.","The wise prepare for what comes next."]);b.push({category:"weather",summary:`A great omen: ${i}`,details:`Across the land, ${i}. ${G}`,worldTime:h,realTime:new Date,seed:A.seed});for(let M of A.settlements)M.mood+=u.chance(0.5)?1:-1,M.mood=Math.max(-5,Math.min(5,M.mood))}return b}function su(){return{weapons:[],armor:[],monsters:[],prophecies:[],treasures:[]}}function cA(u,A,h,H,b,i,G,M,B){let k=[],z=H.monsters.filter((E)=>E.alive&&E.territory===h);for(let E of z)if(u.chance(0.05))if((A.fame??0)+A.members.length*2>E.threat+u.int(5)){E.alive=!1;let W={id:`slayer-${Date.now()}`,type:"death",timestamp:b,location:h,actors:[A.name],victims:[E.name],magnitude:10,witnessed:!0,data:{cause:"legendary battle",legendary:!0}};return k.push(...c(W,G,u,M,B)),k.push({category:"road",summary:`${A.name} SLAYS ${E.name} ${E.epithet}!`,details:`Against all odds, they defeat the legendary ${E.species}! ${E.treasure?`In its lair, they find ${E.treasure}.`:""} Songs will be sung for generations!`,location:h,actors:[A.name,E.name],worldTime:b,realTime:new Date,seed:i}),k}else return A.wounded=!0,A.restHoursRemaining=48,k.push({category:"road",summary:`${A.name} flees ${E.name} ${E.epithet}`,details:`The legendary ${E.species} proves too powerful. They escape with their lives\u2014barely.`,location:h,actors:[A.name,E.name],worldTime:b,realTime:new Date,seed:i}),k;let P=H.weapons.filter((E)=>!E.discovered&&E.sightings>=3);for(let E of P)if(u.chance(0.03)){E.discovered=!0,E.owner=A.name,E.location=h;let K={id:`discovery-${Date.now()}`,type:"discovery",timestamp:b,location:h,actors:[A.name],magnitude:8,witnessed:!0,data:{item:E.name,type:"legendary weapon"}};return k.push(...c(K,G,u,M,B)),k.push({category:"road",summary:`${A.name} discovers ${E.name} ${E.epithet}!`,details:`In a forgotten place, they find the legendary ${E.type} of ${E.material}. ${E.history} ${E.curse?`But a dark truth emerges: ${E.curse}`:"A new chapter begins."}`,location:h,actors:[A.name],worldTime:b,realTime:new Date,seed:i}),k}return k}var JM={torchbearer:1,porter:2,"man-at-arms":4,squire:3,acolyte:2,apprentice:2,scout:10,sergeant:20,bodyguard:25,herald:15,sage:200,armorer:100,weaponsmith:100,"animal-trainer":50,alchemist:300,engineer:150,spy:125,assassin:500,captain:250,navigator:150};function WM(u,A,h,H){let b=["sage","armorer","weaponsmith","animal-trainer","alchemist","engineer","spy","assassin","captain","navigator"].includes(A),i=b?1+u.int(4):u.int(3),G=b?6+u.int(8):4+u.int(6),M;if(["man-at-arms","squire","sergeant","bodyguard"].includes(A))M="Fighter";else if(A==="acolyte")M="Cleric";else if(A==="apprentice")M="Magic-User";else if(A==="scout")M=u.pick(["Thief","Elf","Halfling"]);let B=7+u.int(3)-1,k;if(A==="sage")k=u.pick(["history","arcana","religion","nature","geography","languages","monsters","artifacts"]);else if(A==="animal-trainer")k=u.pick(["horses","dogs","hawks","war-beasts","exotic"]);else if(A==="engineer")k=u.pick(["fortifications","siege-weapons","bridges","mines"]);return{id:`retainer-${Date.now()}-${u.int(1e4)}`,name:$(u),type:A,level:i,class:M,hp:G,maxHp:G,loyalty:B,loyaltyModifier:0,employerId:"",hiredAt:H,lastPaid:H,monthlyWage:JM[A],alive:!0,wounded:!1,location:h,previousEmployers:[],betrayals:u.chance(0.05)?1:0,heroicActs:0,specialty:k}}function OM(u,A,h,H){let b=[];for(let i of A.pendingHires)if(new Date(i.searchCompletes)<=H&&i.candidates.length===0){let G=1+u.int(3),M=h.settlements.find((z)=>z.name===i.settlement),B=M?.type==="city"?2:M?.type==="town"?1:0;for(let z=0;z<G;z++){let P=WM(u,i.type,i.settlement,H);P.level=Math.min(P.level+B,5),i.candidates.push(P)}let k=h.parties.find((z)=>z.id===i.requesterId)??h.npcs.find((z)=>z.id===i.requesterId);b.push({category:"town",summary:`${G} ${i.type} candidates found in ${i.settlement}`,details:`After days of inquiry, ${G} potential ${i.type}s have been identified. ${k?.name??"The employer"} must choose.`,location:i.settlement,actors:i.candidates.map((z)=>z.name),worldTime:H,realTime:new Date,seed:h.seed})}return b}function Eh(u,A,h,H,b){let i=[],M={combat:-2,danger:-1,unpaid:-3,"employer-wounded":-2,"better-offer":-2,hardship:-1}[h]+A.loyaltyModifier,B=2+u.int(11),k=A.loyalty+M,z=B<=k;if(!z){let P=k-B;if(P<=-4||h==="better-offer"){A.betrayals++;let E=u.int(50)+10;i.push({category:"town",summary:`${A.name} betrays their employer!`,details:`The ${A.type}'s loyalty breaks. They flee with ${E} gold, their oath forgotten.`,location:A.location,actors:[A.name],worldTime:b,realTime:new Date,seed:H.seed});let K={retainerId:A.id,retainerName:A.name,employerId:A.employerId,reason:h,timestamp:b,betrayal:!0,stolenGoods:E};A.alive=!1}else if(P<=-2)i.push({category:"road",summary:`${A.name} deserts`,details:`Unable to face the ${h}, the ${A.type} slips away in the night.`,location:A.location,actors:[A.name],worldTime:b,realTime:new Date,seed:H.seed}),A.alive=!1;else A.loyalty=Math.max(2,A.loyalty-1),i.push({category:"road",summary:`${A.name}'s loyalty wavers`,details:`The ${A.type} grumbles and hesitates. Their commitment is shaken.`,location:A.location,actors:[A.name],worldTime:b,realTime:new Date,seed:H.seed})}return{passed:z,logs:i}}function FM(u,A,h,H){let b=[];if(H.getUTCDate()!==1)return b;for(let i of A.retainers){if(!i.alive||!i.employerId)continue;let G=h.parties.find((z)=>z.id===i.employerId),M=h.npcs.find((z)=>z.id===i.employerId),B=G?n(h,G.id):null;if(B?(B.resources??0)>=i.monthlyWage:!0){if(i.lastPaid=H,B)B.resources=(B.resources??0)-i.monthlyWage;if(u.chance(0.1))i.loyalty=Math.min(12,i.loyalty+1)}else{let z=Eh(u,i,"unpaid",h,H);if(b.push(...z.logs),z.passed)b.push({category:"town",summary:`${i.name} accepts late payment`,details:`Though wages are delayed, the ${i.type} remains loyal\u2014for now.`,location:i.location,actors:[i.name],worldTime:H,realTime:new Date,seed:h.seed})}}return b}function RM(u,A,h,H,b){let i=[];A.heroicActs++,A.loyalty=Math.min(12,A.loyalty+2);let G={"save-employer":[`${A.name} throws themselves between their master and danger!`,`${A.name} drags their wounded employer to safety.`,`${A.name}'s quick thinking saves the day.`],"hold-line":[`${A.name} holds the line while others retreat.`,`${A.name} refuses to give ground.`,`${A.name} buys precious time with blood and steel.`],sacrifice:[`${A.name} gives their life so others may live.`,`${A.name} falls, but their sacrifice is not in vain.`,`${A.name}'s last act is one of selfless courage.`]},M=u.pick(G[h]);if(h==="sacrifice")A.alive=!1,A.hp=0;else if(u.chance(0.3))A.wounded=!0,A.hp=Math.max(1,A.hp-u.int(A.maxHp/2));return i.push({category:"road",summary:M,details:h==="sacrifice"?`The ${A.type}'s name will be remembered. Their loyalty was beyond question.`:`The ${A.type}'s heroism inspires all who witness it. Their bond to their employer deepens.`,location:A.location,actors:[A.name],worldTime:b,realTime:new Date,seed:H.seed}),i}function ZM(u,A,h,H,b){let i=[];if(!A.members.every((z)=>z.hp<=0))return i;let M=h.retainers.filter((z)=>z.employerId===A.id&&z.alive).sort((z,P)=>{if(P.loyalty!==z.loyalty)return P.loyalty-z.loyalty;if(P.level!==z.level)return P.level-z.level;return P.heroicActs-z.heroicActs});if(M.length===0)return i.push({category:"road",summary:`${A.name} falls\u2014none remain`,details:"With no heir and no loyal retainer to carry on, the company passes into legend.",location:A.location,worldTime:b,realTime:new Date,seed:H.seed}),i;let B=M[0],k={name:B.name,class:B.class??"Fighter",level:Math.max(1,B.level),hp:B.hp,maxHp:B.maxHp};A.members=[k];for(let z of M.slice(1,3))if(z.loyalty>=9&&z.class)A.members.push({name:z.name,class:z.class,level:Math.max(1,z.level),hp:z.hp,maxHp:z.maxHp}),z.alive=!1;return B.alive=!1,i.push({category:"road",summary:`${B.name} inherits leadership of ${A.name}`,details:`From the ashes of tragedy, a new leader rises. The ${B.type} ${B.name} gathers the survivors and vows to continue.`,location:A.location,actors:[B.name,A.name],worldTime:b,realTime:new Date,seed:H.seed}),i}function VM(u,A,h,H){let b=[];for(let i of A.retainers){if(!i.alive||!i.projectType)continue;let M={research:0.3,"craft-armor":0.2,"craft-weapon":0.25,"train-animal":0.15,"brew-potion":0.5,"build-engine":0.1,"gather-intel":0.4}[i.projectType]??0.2;if(i.projectProgress=(i.projectProgress??0)+M,i.projectProgress>=100){i.projectProgress=0;let B=i.projectType;i.projectType=void 0,b.push({category:"town",summary:`${i.name} completes their ${B}`,details:`After weeks of dedicated work, the ${i.type}'s ${B} project is finished.`,location:i.location,actors:[i.name],worldTime:H,realTime:new Date,seed:h.seed})}}return b}function wA(u,A,h,H){let b=[];if(b.push(...OM(u,A,h,H)),b.push(...FM(u,A,h,H)),b.push(...VM(u,A,h,H)),u.chance(0.01)){let i=A.retainers.filter((G)=>G.alive);if(i.length>0){let G=u.pick(i);if(u.chance(0.5)&&G.loyalty<=6){let M=Eh(u,G,"hardship",h,H);b.push(...M.logs)}else if(u.chance(0.3)&&G.loyalty>=10)b.push(...RM(u,G,"hold-line",h,H))}}for(let i of h.parties)b.push(...ZM(u,i,A,h,H));return b}function mu(){return{retainers:[],pendingHires:[],desertions:[]}}var CM=["Shadow Hand","Black Masks","Night Knives","Silent Coin","Velvet Glove","Iron Rats","Golden Shadows","Crimson Purse","Twilight Fingers","Whisper Guild","Dark Lantern","Pale Hand","Silver Serpents","Dead Man's Purse","Ghost Coin"],UM=["masters of the underworld","rulers of the shadows","keepers of secrets","merchants of the night","princes of thieves","children of the dark"];function gA(u,A,h,H){let b=u.pick(CM),i=$(u),G={id:`guild-${Date.now()}-${u.int(1e4)}`,name:`The ${b}`,epithet:u.pick(UM),territory:[A],headquarters:A,guildmasterId:`guildmaster-${Date.now()}`,lieutenants:[],operatives:[],treasury:100+u.int(500),infamy:10+u.int(30),heat:u.int(20),secrets:[],informants:[],enemies:[],allies:[],active:!0,foundedAt:H},M=5+u.int(8);for(let B=0;B<M;B++)G.operatives.push({npcId:`thief-${Date.now()}-${B}`,name:$(u),rank:B<2?"lieutenant":B<5?"operative":"apprentice",specialty:u.pick(["heist","pickpocket","burglary","fence","smuggling"]),skill:3+u.int(5),loyalty:7+u.int(3),heistsCompleted:u.int(10),arrested:u.int(2),joinedAt:new Date(H.getTime()-u.int(31536000000))});return G.lieutenants=G.operatives.filter((B)=>B.rank==="lieutenant").map((B)=>B.npcId),G}function Kh(u,A,h,H,b,i,G,M,B){let k=[],P={caravan:{min:48,max:96},vault:{min:120,max:240},noble:{min:96,max:168},merchant:{min:48,max:96},guild:{min:168,max:336},temple:{min:120,max:240},person:{min:24,max:72}}[h],E=P.min+u.int(P.max-P.min),K=A.operatives.filter((Y)=>Y.rank!=="apprentice");if(K.length===0)return k;let L=Math.min(K.length,2+u.int(3)),W=K.slice(0,L),J=W.sort((Y,X)=>X.skill-Y.skill)[0],V=h==="vault"?8+u.int(3):h==="noble"?6+u.int(3):h==="guild"?9+u.int(2):h==="temple"?7+u.int(3):4+u.int(4),C={id:`op-${Date.now()}-${u.int(1e4)}`,guildId:A.id,type:"heist",status:"planning",planningStarted:B,planningCompletes:new Date(B.getTime()+E*60*60*1000),targetType:h,targetId:H,targetName:b,targetLocation:i,leaderId:J.npcId,teamIds:W.map((Y)=>Y.npcId),estimatedTake:G,riskLevel:V,casualties:[],discovered:!1,witnesses:[]};M.operations.push(C);let O=Math.round(E/24);return k.push({category:"town",summary:`${A.name} plans a job against ${b}`,details:`The ${A.epithet} have set their sights on a ${h}. ${J.name} leads the planning. It will take approximately ${O} days to prepare.`,location:A.headquarters,actors:[A.name,J.name],worldTime:B,realTime:new Date,seed:""}),k}function jM(u,A,h,H,b,i){let G=[],M=A.teamIds.reduce((P,E)=>{let K=h.operatives.find((L)=>L.npcId===E);return P+(K?.skill??3)},0)/A.teamIds.length,B=0.5+M/20-A.riskLevel/20,k=u.chance(B),z=2+u.int(7);if(A.executionStarted=i,A.executionCompletes=new Date(i.getTime()+z*60*60*1000),A.status="active",k){A.status="completed";let P=0.6+u.next()*0.8;A.actualTake=Math.floor(A.estimatedTake*P),h.treasury+=A.actualTake,h.infamy+=2;let E=b.settlements.find((K)=>K.name===A.targetLocation);if(E)E.mood=Math.max(-5,E.mood-1);for(let K of A.teamIds){let L=h.operatives.find((W)=>W.npcId===K);if(L)L.heistsCompleted++}if(A.discovered=u.chance(0.3-M/30),A.discovered)h.heat+=10+u.int(10);H.hotGoods.push({id:`goods-${Date.now()}`,guildId:h.id,stolenFrom:A.targetName,stolenAt:i,type:A.targetType==="caravan"?"trade goods":A.targetType==="noble"?"jewelry and valuables":A.targetType==="vault"?"coin and treasures":"stolen merchandise",value:A.actualTake,fenceValue:Math.floor(A.actualTake*(0.3+u.next()*0.3)),heat:A.discovered?80+u.int(20):20+u.int(30)}),G.push({category:"town",summary:`${h.name} pulls off a heist on ${A.targetName}`,details:`${A.actualTake} gold worth of goods vanish in the night. ${A.discovered?"Suspicion falls on known criminal elements.":"The perpetrators leave no trace."}`,location:A.targetLocation,actors:[h.name],worldTime:i,realTime:new Date,seed:b.seed})}else{A.status="failed",A.discovered=!0,h.heat+=20+u.int(20);for(let P of A.teamIds)if(u.chance(0.2)){let E=h.operatives.find((K)=>K.npcId===P);if(E)if(A.casualties.push(P),u.chance(0.5))h.operatives=h.operatives.filter((K)=>K.npcId!==P),G.push({category:"town",summary:`${E.name} slain during botched heist`,details:`The ${A.targetType} was better protected than expected. ${E.name} paid the ultimate price.`,location:A.targetLocation,worldTime:i,realTime:new Date,seed:b.seed});else E.arrested++,G.push({category:"town",summary:`${E.name} arrested for attempted theft`,details:`The watch drags away a member of ${h.name}. How much will they talk?`,location:A.targetLocation,actors:[E.name],worldTime:i,realTime:new Date,seed:b.seed})}if(A.casualties.length===0)G.push({category:"town",summary:`${h.name}'s heist on ${A.targetName} fails`,details:"Alarms are raised. The thieves flee empty-handed into the night.",location:A.targetLocation,actors:[h.name],worldTime:i,realTime:new Date,seed:b.seed})}return G}function XM(u,A,h,H){let b=[];for(let i of A.hotGoods){if(i.fencedAt)continue;let G=A.guilds.find((k)=>k.id===i.guildId);if(!G)continue;let M=(H.getTime()-new Date(i.stolenAt).getTime())/3600000,B=0.3;if(i.heat=Math.max(0,i.heat-B),M>=24&&i.heat<50){let k=(100-i.heat)/200;if(u.chance(k))i.fencedAt=H,G.treasury+=i.fenceValue,b.push({category:"town",summary:`${G.name} moves stolen goods`,details:`The ${i.type} from ${i.stolenFrom} finally finds a buyer. ${i.fenceValue} gold changes hands in a shadowy transaction.`,location:G.headquarters,actors:[G.name],worldTime:H,realTime:new Date,seed:h.seed})}}return A.hotGoods=A.hotGoods.filter((i)=>!i.fencedAt),b}function YM(u,A,h,H,b,i){let G=[{type:"affair",severity:5+u.int(3),value:50+u.int(200)},{type:"debt",severity:3+u.int(4),value:30+u.int(100)},{type:"crime",severity:6+u.int(4),value:100+u.int(300)},{type:"scandal",severity:4+u.int(4),value:50+u.int(150)},{type:"conspiracy",severity:8+u.int(3),value:200+u.int(500)},{type:"identity",severity:7+u.int(4),value:150+u.int(350)}],M=u.pick(G);return{id:`secret-${Date.now()}-${u.int(1e4)}`,targetId:h,targetName:H,type:M.type,severity:M.severity,knownBy:[A.id],discoveredAt:i,monetaryValue:M.value,usedForBlackmail:!1}}function QM(u,A,h,H,b,i){let G=[],M=h.operatives.find((z)=>z.npcId===A.leaderId);if(!M)return G;let B=0.3+M.skill/15;if(u.chance(B)){if(A.status="completed",A.actualTake=A.estimatedTake,h.treasury+=A.estimatedTake,h.infamy+=10,M.heistsCompleted++,A.discovered=u.chance(0.4),A.discovered)h.heat+=30;let z=b.npcs.find((P)=>P.id===A.targetId||P.name===A.targetName);if(z){z.alive=!1;let P={id:`assassination-${Date.now()}`,type:"assassination",timestamp:i,location:A.targetLocation,actors:[h.name],victims:[A.targetName],perpetrators:[h.name],magnitude:8,witnessed:A.discovered,data:{cause:"contract killing"}};j({type:"spawn-event",triggerEvent:`Assassination of ${A.targetName}`,turnsUntilResolution:1,data:P,priority:5})}G.push({category:"town",summary:`${A.targetName} found dead`,details:A.discovered?`Poison. Blade. No witnesses\u2014almost. Word on the street points to ${h.name}.`:"A sudden death. Natural causes, they say. But those who know, know better.",location:A.targetLocation,actors:[A.targetName],worldTime:i,realTime:new Date,seed:b.seed})}else if(A.status="failed",A.discovered=!0,h.heat+=40,u.chance(0.4))h.operatives=h.operatives.filter((z)=>z.npcId!==M.npcId),A.casualties.push(M.npcId),G.push({category:"town",summary:`Assassination attempt on ${A.targetName} foiled`,details:`${M.name} is slain in the attempt. ${h.name}'s involvement is exposed.`,location:A.targetLocation,actors:[A.targetName,M.name],worldTime:i,realTime:new Date,seed:b.seed});else M.arrested++,G.push({category:"town",summary:`Assassination attempt on ${A.targetName} foiled`,details:`The would-be killer escapes into the shadows. ${A.targetName} lives\u2014for now.`,location:A.targetLocation,actors:[A.targetName],worldTime:i,realTime:new Date,seed:b.seed});return G}function $M(u,A,h,H){let b=[];for(let i of A.guilds){if(!i.active)continue;for(let G of A.guilds){if(G.id===i.id||!G.active)continue;let M=i.territory.filter((z)=>G.territory.includes(z));if(M.length===0)continue;let k=i.enemies.includes(G.id)?0.05:0.01;if(u.chance(k)){let z=u.pick(M),P=i.operatives.length+i.infamy/10,E=G.operatives.length+G.infamy/10,K=P+u.int(10)>E+u.int(10),L=K?i:G,W=K?G:i,J=1+u.int(2);for(let V=0;V<J&&W.operatives.length>2;V++){let C=W.operatives[W.operatives.length-1];if(W.operatives.pop(),u.chance(0.5))b.push({category:"town",summary:`${C.name} killed in guild war`,details:`The streets of ${z} run red as ${i.name} and ${G.name} clash.`,location:z,worldTime:H,realTime:new Date,seed:h.seed})}if(!i.enemies.includes(G.id))i.enemies.push(G.id),G.enemies.push(i.id);if(L.operatives.length>W.operatives.length*2)W.territory=W.territory.filter((V)=>V!==z),b.push({category:"faction",summary:`${L.name} drives ${W.name} from ${z}`,details:`The guild war ends decisively. ${z} belongs to ${L.name} now.`,location:z,actors:[L.name,W.name],worldTime:H,realTime:new Date,seed:h.seed})}}}return b}function IM(u,A,h,H){let b=[];if(H.getUTCDate()!==1)return b;for(let i of A.guilds){if(!i.active)continue;for(let G of i.territory){let M=h.settlements.find((z)=>z.name===G);if(!M)continue;let B=M.type==="city"?100:M.type==="town"?50:20,k=Math.floor(B*(1+i.infamy/100));if(i.treasury+=k,i.heat+=2,u.chance(0.05)){let z=$(u);if(u.chance(0.3))b.push({category:"town",summary:`Merchant refuses ${i.name}'s "protection"`,details:`${z} stands up to the guild. A brave but perhaps foolish act.`,location:G,actors:[z,i.name],worldTime:H,realTime:new Date,seed:h.seed}),j({type:"spawn-event",triggerEvent:`${z} defiance`,turnsUntilResolution:24+u.int(48),data:{category:"town",summary:`${z}'s shop burns`,details:"A midnight fire. No one is surprised. The message is clear.",location:G},priority:3})}}}return b}function eA(u,A,h,H){let b=[];for(let i of A.operations){let G=A.guilds.find((M)=>M.id===i.guildId);if(!G||!G.active)continue;if(i.status==="planning"&&new Date(i.planningCompletes)<=H){if(i.type==="heist")b.push(...jM(u,i,G,A,h,H));else if(i.type==="assassination")b.push(...QM(u,i,G,A,h,H))}}A.operations=A.operations.filter((i)=>i.status==="planning"||i.status==="active"||H.getTime()-new Date(i.planningStarted).getTime()<604800000),b.push(...XM(u,A,h,H)),b.push(...IM(u,A,h,H)),b.push(...$M(u,A,h,H));for(let i of A.guilds)i.heat=Math.max(0,i.heat-0.5);if(u.chance(0.02)){let i=A.guilds.filter((G)=>G.active);if(i.length>0){let G=u.pick(i);if(G.informants.length>0||u.chance(0.3)){let M=h.npcs.filter((B)=>B.alive!==!1&&(B.fame??0)>=2&&!G.secrets.some((k)=>k.targetId===B.id));if(M.length>0){let B=u.pick(M),k=YM(u,G,B.id,B.name,h,H);if(k)G.secrets.push(k),b.push({category:"town",summary:`${G.name} uncovers a secret about ${B.name}`,details:`The ${k.type} will fetch a pretty price\u2014one way or another.`,location:G.headquarters,actors:[G.name,B.name],worldTime:H,realTime:new Date,seed:h.seed})}}if(G.treasury>=50&&A.operations.filter((M)=>M.guildId===G.id&&M.status==="planning").length<2){let M=u.pick(G.territory);if(h.settlements.find((k)=>k.name===M)){let k=h.caravans.filter((z)=>z.location===M||z.route.some((P)=>{return h.settlements.find((K)=>K.id===P)?.name===M}));if(k.length>0&&u.chance(0.5)){let z=u.pick(k);b.push(...Kh(u,G,"caravan",z.id,z.name,M,100+u.int(200),A,H))}else{let z=50+u.int(150);b.push(...Kh(u,G,"merchant",`merchant-${Date.now()}`,`a ${M} merchant`,M,z,A,H))}}}}}return b}function Ru(){return{guilds:[],operations:[],hotGoods:[]}}function Dh(u,A,h){let H=Ru();for(let b of A.settlements)if(b.type==="city"){if(H.guilds.push(gA(u,b.name,A,h)),u.chance(0.7)){let i=gA(u,b.name,A,h);H.guilds.push(i),H.guilds[H.guilds.length-2].enemies.push(i.id),i.enemies.push(H.guilds[H.guilds.length-2].id)}}else if(b.type==="town"&&u.chance(0.6))H.guilds.push(gA(u,b.name,A,h));return H}var xM=["orc","goblin","kobold","gnoll","hobgoblin","bugbear","lizardfolk","troglodyte","gnome","duergar","derro","kuo-toa","sahuagin","locathah","bullywug","grippli","kenku","tengu","jackalwere","wererat","werebear","werewolf","wereboar","weretiger","rakshasa","yuan-ti","naga-guardian","centaur","satyr","sprite","pixie","nixie","dryad","nereid","sylph","skeleton","zombie","ghoul","wight","wraith","vampire-spawn","shadow","specter","banshee","ghost","poltergeist","haunt","phantom","mummy","lich-spawn","death-knight","revenant","draugr","barrow-wight","bone-golem","corpse-crawler","rot-grub-swarm","will-o-wisp","groaning-spirit","wolf","dire-wolf","bear","giant-spider","giant-rat","worg","giant-ant","giant-beetle","giant-centipede","giant-scorpion","giant-wasp","giant-snake","giant-constrictor","giant-lizard","giant-toad","giant-frog","giant-crab","giant-octopus","giant-eel","giant-pike","giant-shark","giant-eagle","giant-owl","giant-hawk","giant-raven","giant-bat","giant-boar","giant-elk","giant-weasel","giant-badger","giant-wolverine","dire-bear","dire-boar","dire-lion","dire-tiger","saber-tooth","cave-bear","cave-lion","mammoth","mastodon","woolly-rhino","crocodile","giant-crocodile","python","viper","cobra","asp","swarm-of-bats","swarm-of-rats","swarm-of-insects","swarm-of-spiders","young-dragon","drake","wyvern","white-dragon","black-dragon","green-dragon","blue-dragon","red-dragon","brass-dragon","bronze-dragon","copper-dragon","silver-dragon","gold-dragon","fire-drake","ice-drake","swamp-drake","forest-drake","sea-drake","pseudodragon","faerie-dragon","dragon-turtle","hydra","pyrohydra","ogre","troll","hill-giant","frost-giant","fire-giant","stone-giant","cloud-giant","storm-giant","mountain-giant","sea-giant","cyclops","ettin","fomorian","athach","verbeeg","ogre-mage","oni","troll-ice","troll-rock","troll-war","orc-warchief","orc-shaman","orc-berserker","half-orc-bandit","goblin-worg-rider","goblin-shaman","goblin-king","hobgoblin-captain","hobgoblin-warlord","hobgoblin-devastator","bugbear-chief","bugbear-stalker","carrion-crawler","rust-monster","otyugh","neo-otyugh","grell","hook-horror","umber-hulk","xorn","roper","piercer","lurker-above","trapper","cloaker","darkmantle","choker","grick","intellect-devourer","mind-flayer","aboleth","beholder","beholder-kin","eye-of-the-deep","gibbering-mouther","chaos-beast","phasm","mimic","doppelganger","gray-ooze","ochre-jelly","black-pudding","gelatinous-cube","green-slime","mustard-jelly","olive-slime","crystal-ooze","slithering-tracker","id-ooze","animated-armor","flying-sword","golem-flesh","golem-clay","golem-stone","golem-iron","golem-bronze","golem-wood","scarecrow","gargoyle","shield-guardian","helmed-horror","homunculus","marionette","living-statue","fire-elemental","water-elemental","earth-elemental","air-elemental","magma-elemental","ice-elemental","mud-elemental","smoke-elemental","fire-mephit","ice-mephit","dust-mephit","steam-mephit","salt-mephit","salamander","azer","magmin","thoqqua","galeb-duhr","dao","djinni","efreeti","marid","imp","quasit","dretch","manes","lemure","nupperibo","hell-hound","nightmare","barghest","shadow-demon","vrock","hezrou","glabrezu","nalfeshnee","succubus","incubus","cambion","bearded-devil","chain-devil","bone-devil","horned-devil","ice-devil","night-hag","green-hag","sea-hag","annis-hag","coven-hag","lantern-archon","hound-archon","astral-deva","planetar","solar","pegasus","unicorn","ki-rin","couatl","shedu","lammasu","sphinx","harpy","manticore","griffon","hippogriff","chimera","peryton","cockatrice","stymphalian-bird","roc","thunderbird","giant-vulture","stirge","dire-bat","mobat","giant-mosquito","blood-hawk","basilisk","gorgon","catoblepas","medusa","giant-basilisk","dracolisk","pyrolisk","sea-serpent","linnorm","amphisbaena","jormungandr-spawn","quetzalcoatl-spawn","cave-fisher","myconid","shrieker","violet-fungus","gas-spore","vegepygmy","phantom-fungus","ascomoid","basidirond","drow","drow-priestess","drow-mage","drider","deep-gnome","merfolk","triton","sea-elf","siren","selkie","merrow","scrag","kapoacinth","kelpie","vodyanoi","kraken-spawn","aboleth-spawn","chuul","kopru","ixitxachitl","minotaur","owlbear","displacer-beast","blink-dog","phase-spider","bulette","ankheg","purple-worm","remorhaz","leucrotta","caterwaul","su-monster","thoul","shambling-mound","treant","tendriculos","assassin-vine","blood-tree","phantom-warrior","death-dog","bonesnapper","osquip","jermlaine","tarrasque","elder-brain","kraken","leviathan","phoenix","titan","empyrean","astral-dreadnought","nightwalker"];function qM(u){let A=u.toLowerCase(),h="beast";if(/orc|goblin|kobold|gnoll|hobgoblin|bugbear|lizard|trog|gnome|duergar|derro|kuo|sahuagin|locathah|bully|gripp|kenku|tengu|were|yuan|naga|centaur|satyr|sprite|pixie|nixie|dryad|nereid|sylph|merfolk|triton|elf|drow|deep-gnome/.test(A))h="humanoid";if(/skeleton|zombie|ghoul|wight|wraith|vampire|shadow|specter|banshee|ghost|poltergeist|haunt|phantom|mummy|lich|death-knight|revenant|draugr|barrow|bone-golem|corpse|rot-grub|will-o|groaning/.test(A))h="undead";if(/dragon|drake|wyvern|hydra|pyro/.test(A))h="dragon";if(/giant|cyclops|ettin|fomorian|athach|verbeeg|ogre|troll|oni/.test(A))h="giant";if(/demon|devil|imp|quasit|dretch|manes|lemure|hell-hound|nightmare|barghest|vrock|hezrou|glabrezu|nalfeshnee|succubus|incubus|cambion|chain-devil|bone-devil|horned|ice-devil|hag|fiend/.test(A))h="demon";if(/archon|deva|planetar|solar|pegasus|unicorn|ki-rin|couatl|shedu|lammasu|sphinx|phoenix/.test(A))h="fey";if(/elemental|mephit|salamander|azer|magmin|thoqqua|galeb|dao|djinni|efreeti|marid/.test(A))h="elemental";if(/golem|animated|flying-sword|scarecrow|gargoyle|shield-guardian|helmed|homunculus|marionette|living-statue/.test(A))h="construct";if(/ooze|jelly|pudding|cube|slime|slither|id-ooze|carrion|rust|otyugh|grell|hook|umber|xorn|roper|piercer|lurker|trapper|cloaker|darkmantle|choker|grick|intellect|mind-flayer|aboleth|beholder|gibbering|chaos|phasm|mimic|doppel/.test(A))h="aberration";let H={min:5,max:20};if(/swarm|horde|colony/.test(A))H={min:30,max:100};if(/giant|dire|dragon|hydra|titan|tarrasque|kraken|leviathan|roc|purple-worm|elder/.test(A))H={min:1,max:3};if(/kobold|goblin|rat|ant|beetle/.test(A))H={min:20,max:80};if(/orc|gnoll|hobgoblin|lizardfolk/.test(A))H={min:15,max:50};if(/lich|beholder|mind-flayer|aboleth|medusa|sphinx/.test(A))H={min:1,max:1};let b=0.03;if(h==="undead"||h==="construct")b=0;if(/rat|ant|beetle|swarm|kobold|goblin/.test(A))b=0.06;if(/dragon|giant|titan|tarrasque|lich|beholder/.test(A))b=0.005;if(/orc|gnoll|hobgoblin/.test(A))b=0.04;let i=5;if(/demon|devil|undead|shadow|wraith|vampire/.test(A))i=8;if(/dragon|giant|tarrasque|kraken|beholder/.test(A))i=9;if(/goblin|kobold|rat/.test(A))i=3;if(/orc|gnoll|bugbear|troll/.test(A))i=7;if(/sprite|pixie|pegasus|unicorn/.test(A))i=2;if(h==="aberration")i=7;let G=["forest","hills"];if(/ice|frost|snow|white-dragon|winter|mammoth|woolly|polar/.test(A))G=["mountains"];if(/fire|magma|flame|red-dragon|salamander|azer|efreeti/.test(A))G=["mountains","desert"];if(/swamp|marsh|black-dragon|toad|frog|crocodile|lizard|bullywug|hag/.test(A))G=["swamp"];if(/desert|sand|blue-dragon|scorpion|asp|cobra/.test(A))G=["desert"];if(/forest|wood|green|treant|dryad|owl|hawk|boar|elk/.test(A))G=["forest"];if(/mountain|stone|hill|cliff|cave|giant|dwarf|rock/.test(A))G=["mountains","hills"];if(/road|bandit|brigand/.test(A))G=["road","clear"];if(/underground|cave|deep|drow|duergar|hook|umber|mind-flayer|aboleth|purple-worm/.test(A))G=["mountains","hills"];if(/sea|ocean|aquatic|fish|shark|kraken|merfolk|triton|sahuagin|crab|octopus|eel|squid|whale|dolphin|sea-serpent|dragon-turtle|morkoth|laceddon|nixie|nereid|water-elemental|kelpie|sea-hag|sea-giant|giant-shark|giant-crab|giant-octopus/.test(A))G=["coastal","ocean","reef"],h="aquatic";if(/river|pike|otter|beaver|crocodile|hippopotamus|nixie/.test(A))G=["river","swamp","coastal"];let M=[3,4,5];if(h==="undead"||h==="construct"||h==="elemental")M=[];if(/rat|ant|beetle|roach/.test(A))M=[1,2,3,4,5,6,7,8,9,10,11,12];if(/frost|ice|winter|white/.test(A))M=[1,2];if(/fire|flame|summer/.test(A))M=[6,7,8];let B=!1,k;if(/orc|gnoll|wolf|dire-wolf|wyvern|harpy|bird|eagle|hawk/.test(A))B=!0,k=[10,11];let z=5;if(/tarrasque|kraken|leviathan|elder-brain|titan/.test(A))z=10;if(/dragon|beholder|mind-flayer|aboleth|giant|lich|nightwalker/.test(A))z=9;if(/troll|ogre|wyvern|hydra|manticore|chimera/.test(A))z=8;if(/orc|gnoll|bugbear|dire/.test(A))z=6;if(/goblin|kobold|skeleton|zombie/.test(A))z=3;if(/rat|ant|beetle/.test(A))z=2;let P="pack";if(/horde|swarm|zombie|skeleton|rat|ant|beetle/.test(A))P="horde";if(/dragon|lich|beholder|medusa|sphinx|titan|tarrasque/.test(A))P="solitary";if(/ant|bee|wasp|spider|kobold/.test(A))P="hive";if(/orc|goblin|hobgoblin|gnoll|lizardfolk|merfolk|drow|yuan-ti/.test(A))P="tribe";return{category:h,basePop:H,growthRate:b,aggression:i,preferredTerrain:G,breedingSeason:M,migratory:B,migrationMonths:k,foodChain:z,socialStructure:P}}function m(u){if(Lh[u])return Lh[u];return qM(u)}var Lh={orc:{category:"humanoid",basePop:{min:20,max:80},growthRate:0.04,aggression:7,preferredTerrain:["hills","mountains","forest"],breedingSeason:[3,4,5],migratory:!0,migrationMonths:[10,11],foodChain:6,socialStructure:"tribe"},goblin:{category:"humanoid",basePop:{min:30,max:100},growthRate:0.06,aggression:4,preferredTerrain:["forest","hills","swamp"],breedingSeason:[2,3,4,5,6],migratory:!1,foodChain:3,socialStructure:"horde"},kobold:{category:"humanoid",basePop:{min:40,max:150},growthRate:0.08,aggression:3,preferredTerrain:["hills","mountains"],breedingSeason:[1,2,3,4,5,6],migratory:!1,foodChain:2,socialStructure:"hive"},gnoll:{category:"humanoid",basePop:{min:15,max:50},growthRate:0.03,aggression:8,preferredTerrain:["desert","clear"],breedingSeason:[4,5],migratory:!0,migrationMonths:[11,12,1],foodChain:7,socialStructure:"pack"},hobgoblin:{category:"humanoid",basePop:{min:15,max:60},growthRate:0.03,aggression:6,preferredTerrain:["hills","forest"],breedingSeason:[3,4,5],migratory:!1,foodChain:6,socialStructure:"tribe"},bugbear:{category:"humanoid",basePop:{min:5,max:20},growthRate:0.02,aggression:7,preferredTerrain:["forest","hills"],breedingSeason:[4,5],migratory:!1,foodChain:6,socialStructure:"pack"},lizardfolk:{category:"humanoid",basePop:{min:20,max:70},growthRate:0.03,aggression:5,preferredTerrain:["swamp"],breedingSeason:[5,6,7],migratory:!1,foodChain:5,socialStructure:"tribe"},skeleton:{category:"undead",basePop:{min:10,max:50},growthRate:0,aggression:8,preferredTerrain:["swamp","mountains","hills"],breedingSeason:[],migratory:!1,foodChain:4,socialStructure:"horde"},zombie:{category:"undead",basePop:{min:5,max:30},growthRate:0,aggression:9,preferredTerrain:["swamp","forest"],breedingSeason:[],migratory:!1,foodChain:3,socialStructure:"horde"},ghoul:{category:"undead",basePop:{min:3,max:15},growthRate:0.01,aggression:9,preferredTerrain:["swamp","forest"],breedingSeason:[],migratory:!1,foodChain:5,socialStructure:"pack"},wight:{category:"undead",basePop:{min:1,max:5},growthRate:0,aggression:8,preferredTerrain:["mountains","hills"],breedingSeason:[],migratory:!1,foodChain:7,socialStructure:"solitary"},wraith:{category:"undead",basePop:{min:1,max:3},growthRate:0,aggression:9,preferredTerrain:["mountains","swamp"],breedingSeason:[],migratory:!1,foodChain:8,socialStructure:"solitary"},"vampire-spawn":{category:"undead",basePop:{min:1,max:5},growthRate:0.005,aggression:7,preferredTerrain:["forest","hills"],breedingSeason:[],migratory:!1,foodChain:8,socialStructure:"pack"},wolf:{category:"beast",basePop:{min:5,max:20},growthRate:0.04,aggression:5,preferredTerrain:["forest","hills","clear"],breedingSeason:[2,3],migratory:!0,migrationMonths:[11,12],foodChain:5,socialStructure:"pack"},"dire-wolf":{category:"beast",basePop:{min:3,max:12},growthRate:0.03,aggression:7,preferredTerrain:["forest","mountains"],breedingSeason:[2,3],migratory:!0,migrationMonths:[11,12],foodChain:7,socialStructure:"pack"},bear:{category:"beast",basePop:{min:2,max:8},growthRate:0.02,aggression:4,preferredTerrain:["forest","mountains"],breedingSeason:[5,6],migratory:!1,foodChain:7,socialStructure:"solitary"},"giant-spider":{category:"beast",basePop:{min:10,max:40},growthRate:0.05,aggression:6,preferredTerrain:["forest","swamp"],breedingSeason:[4,5,6],migratory:!1,foodChain:5,socialStructure:"hive"},"giant-rat":{category:"beast",basePop:{min:20,max:100},growthRate:0.1,aggression:3,preferredTerrain:["swamp","forest"],breedingSeason:[1,2,3,4,5,6,7,8,9,10,11,12],migratory:!1,foodChain:2,socialStructure:"horde"},worg:{category:"beast",basePop:{min:5,max:15},growthRate:0.03,aggression:7,preferredTerrain:["forest","hills"],breedingSeason:[3,4],migratory:!1,foodChain:6,socialStructure:"pack"},"young-dragon":{category:"dragon",basePop:{min:1,max:1},growthRate:0,aggression:8,preferredTerrain:["mountains","hills"],breedingSeason:[],migratory:!1,foodChain:10,socialStructure:"solitary"},drake:{category:"dragon",basePop:{min:1,max:3},growthRate:0.01,aggression:7,preferredTerrain:["mountains","desert"],breedingSeason:[6,7],migratory:!1,foodChain:8,socialStructure:"solitary"},wyvern:{category:"dragon",basePop:{min:1,max:4},growthRate:0.01,aggression:8,preferredTerrain:["mountains","hills"],breedingSeason:[5,6],migratory:!0,migrationMonths:[10,11],foodChain:8,socialStructure:"solitary"},ogre:{category:"giant",basePop:{min:2,max:8},growthRate:0.02,aggression:7,preferredTerrain:["hills","forest","mountains"],breedingSeason:[4,5],migratory:!1,foodChain:7,socialStructure:"pack"},troll:{category:"giant",basePop:{min:1,max:4},growthRate:0.015,aggression:8,preferredTerrain:["swamp","forest"],breedingSeason:[3,4],migratory:!1,foodChain:8,socialStructure:"solitary"},"hill-giant":{category:"giant",basePop:{min:1,max:3},growthRate:0.01,aggression:6,preferredTerrain:["hills"],breedingSeason:[5,6],migratory:!1,foodChain:8,socialStructure:"pack"},"frost-giant":{category:"giant",basePop:{min:1,max:2},growthRate:0.005,aggression:7,preferredTerrain:["mountains"],breedingSeason:[1,2],migratory:!1,foodChain:9,socialStructure:"tribe"},"fire-giant":{category:"giant",basePop:{min:1,max:2},growthRate:0.005,aggression:8,preferredTerrain:["mountains"],breedingSeason:[7,8],migratory:!1,foodChain:9,socialStructure:"tribe"},harpy:{category:"beast",basePop:{min:3,max:12},growthRate:0.03,aggression:6,preferredTerrain:["mountains","hills"],breedingSeason:[4,5],migratory:!0,migrationMonths:[10,11],foodChain:5,socialStructure:"pack"},manticore:{category:"beast",basePop:{min:1,max:2},growthRate:0.01,aggression:9,preferredTerrain:["mountains","desert"],breedingSeason:[6],migratory:!1,foodChain:8,socialStructure:"solitary"},griffon:{category:"beast",basePop:{min:2,max:6},growthRate:0.02,aggression:5,preferredTerrain:["mountains","hills"],breedingSeason:[4,5],migratory:!1,foodChain:7,socialStructure:"pack"},basilisk:{category:"beast",basePop:{min:1,max:2},growthRate:0.005,aggression:7,preferredTerrain:["desert","hills"],breedingSeason:[7,8],migratory:!1,foodChain:7,socialStructure:"solitary"},medusa:{category:"aberration",basePop:{min:1,max:1},growthRate:0,aggression:6,preferredTerrain:["mountains","hills"],breedingSeason:[],migratory:!1,foodChain:7,socialStructure:"solitary"},minotaur:{category:"beast",basePop:{min:1,max:3},growthRate:0.01,aggression:8,preferredTerrain:["hills","mountains"],breedingSeason:[5,6],migratory:!1,foodChain:7,socialStructure:"solitary"}};function du(u,A,h,H,b){let i=m(A),G=i.basePop.min+u.int(i.basePop.max-i.basePop.min);return{id:`pop-${A}-${Date.now()}-${u.int(1e4)}`,species:A,category:i.category,hexCoord:h,territoryName:`hex:${h.q},${h.r}`,preferredTerrain:i.preferredTerrain,population:G,maxPopulation:Math.floor(G*(1.5+u.next())),growthRate:i.growthRate,aggression:i.aggression+u.int(3)-1,territorialRadius:i.socialStructure==="solitary"?1:i.socialStructure==="pack"?2:3,nomadic:i.migratory,breedingSeason:i.breedingSeason,migrationSeason:i.migrationMonths,lastBreeding:b,recentLosses:0,recentHunting:0,morale:0,roomsClaimed:0}}function _M(u,A,h,H){let b=[],i=H.getUTCMonth()+1;for(let G of A.populations){if(G.population<=0)continue;if(!G.breedingSeason.includes(i))continue;let M=new Date(G.lastBreeding).getUTCMonth()+1,B=new Date(G.lastBreeding).getUTCFullYear();if(M===i&&B===H.getUTCFullYear())continue;let k=G.growthRate;if(G.morale>0)k+=G.morale/100;if(G.recentLosses>G.population*0.2)k-=0.02;if(G.population>=G.maxPopulation*0.9)k*=0.5;if(A.populations.filter((E)=>E.id!==G.id&&m(E.species).foodChain>m(G.species).foodChain&&Zu(E.hexCoord,G.hexCoord)<=2).length>0)k*=0.7;let P=Math.max(0,Math.floor(G.population*k));if(P>0){if(G.population=Math.min(G.maxPopulation,G.population+P),G.lastBreeding=H,P>=5||G.species==="young-dragon"){let E=m(G.species);b.push({category:"road",summary:`${G.species} population swells near ${G.territoryName}`,details:`${P} new ${G.species}s emerge. The ${E.socialStructure} grows stronger. Travelers beware.`,location:G.territoryName,worldTime:H,realTime:new Date,seed:h.seed})}}}return b}function NM(u,A,h,H){let b=[],i=H.getUTCMonth()+1;for(let G of A.migrations)if(new Date(G.arrivesAt)<=H){let M=A.populations.find((B)=>B.id===G.populationId);if(M){M.hexCoord=G.toHex,M.territoryName=`hex:${G.toHex.q},${G.toHex.r}`,M.lastMigration=H;let B=nA(G.toHex,h);if(b.push({category:"road",summary:`${M.species} arrive in new territory`,details:`A ${m(M.species).socialStructure} of ${M.population} ${M.species}s completes their migration. ${B?`The people of ${B.name} grow uneasy.`:""}`,location:M.territoryName,worldTime:H,realTime:new Date,seed:h.seed}),B){let k=_(h,B.name);k.safety=Math.max(-10,k.safety-2),B.mood=Math.max(-5,B.mood-1)}}}A.migrations=A.migrations.filter((G)=>new Date(G.arrivesAt)>H);for(let G of A.populations){if(!G.nomadic||G.population<=0)continue;if(!G.migrationSeason?.includes(i))continue;if(A.migrations.some((z)=>z.populationId===G.id))continue;if(G.lastMigration){if((H.getTime()-new Date(G.lastMigration).getTime())/2592000000<6)continue}let M=!1,B="";if(i>=10||i<=2)M=!0,B="seeking warmer territories for winter";if(G.population>=G.maxPopulation*0.9)M=!0,B="seeking new hunting grounds";let k=A.populations.filter((z)=>z.id!==G.id&&m(z.species).foodChain>m(G.species).foodChain+2&&Zu(z.hexCoord,G.hexCoord)<=2);if(k.length>0)M=!0,B=`fleeing from ${k[0].species}`;if(M&&u.chance(0.3)){let z=G.hexCoord.q+u.int(7)-3,P=G.hexCoord.r+u.int(7)-3,E={q:Math.max(0,Math.min(h.width-1,z)),r:Math.max(0,Math.min(h.height-1,P))};if(E.q===G.hexCoord.q&&E.r===G.hexCoord.r)continue;let K=168+u.int(504);A.migrations.push({populationId:G.id,fromHex:{...G.hexCoord},toHex:E,startedAt:H,arrivesAt:new Date(H.getTime()+K*60*60*1000),reason:B});let L=Math.round(K/24);b.push({category:"road",summary:`${G.species} begin migration`,details:`A ${m(G.species).socialStructure} of ${G.population} ${G.species}s departs, ${B}. They will travel for approximately ${L} days.`,location:G.territoryName,worldTime:H,realTime:new Date,seed:h.seed})}}return b}function SM(u,A,h,H,b){let i=[],G=A.populations.filter((M)=>m(M.species).foodChain>=8&&M.population>0);for(let M of G){let B=A.populations.filter((z)=>z.id!==M.id&&m(z.species).foodChain<m(M.species).foodChain-1&&Zu(z.hexCoord,M.hexCoord)<=M.territorialRadius&&z.population>0);if(B.length>0&&u.chance(0.1)){let z=u.pick(B),P=Math.min(z.population,1+u.int(Math.ceil(M.population/2)));if(z.population-=P,z.recentLosses+=P,z.morale=Math.max(-10,z.morale-2),M.recentHunting+=P,M.morale=Math.min(10,M.morale+1),P>=5)i.push({category:"road",summary:`${M.species} hunts ${z.species}`,details:`The ${M.species} of ${M.territoryName} feast on ${P} ${z.species}s. The balance of power is maintained.`,location:M.territoryName,worldTime:b,realTime:new Date,seed:h.seed})}let k=H.find((z)=>z.alive&&z.type==="dragon"&&z.territory===nA(M.hexCoord,h)?.name);if(k&&!M.leaderId&&M.species.includes("dragon"))M.leaderId=k.id}return i}function fM(u,A,h,H){let b=[];for(let i=0;i<A.populations.length;i++){let G=A.populations[i];if(G.population<=0)continue;for(let M=i+1;M<A.populations.length;M++){let B=A.populations[M];if(B.population<=0)continue;if(G.species===B.species)continue;let k=Zu(G.hexCoord,B.hexCoord);if(Math.max(G.territorialRadius,B.territorialRadius)-k<=0)continue;if(G.tributeTo===B.id||B.tributeTo===G.id)continue;let P=A.territorialDisputes.find((E)=>E.population1Id===G.id&&E.population2Id===B.id||E.population1Id===B.id&&E.population2Id===G.id);if(P){if(u.chance(0.2)){if(P.intensity++,P.intensity>=5){let E=G.population*(m(G.species).foodChain+G.morale),K=B.population*(m(B.species).foodChain+B.morale),L=E+u.int(50)>K+u.int(50),W=L?G:B,J=L?B:G,V=Math.floor(J.population*(0.2+u.next()*0.3)),C=Math.floor(W.population*(0.05+u.next()*0.15));if(J.population-=V,J.recentLosses+=V,J.morale-=3,W.population-=C,W.recentLosses+=C,W.morale+=2,b.push({category:"road",summary:`${G.species} and ${B.species} clash`,details:`Territorial war erupts! The ${W.species} triumph, but ${C} fall. The ${J.species} lose ${V} and retreat.`,location:`hex:${P.contestedHex.q},${P.contestedHex.r}`,worldTime:H,realTime:new Date,seed:h.seed}),J.population<W.population*0.5&&u.chance(0.4))J.tributeTo=W.id,b.push({category:"road",summary:`${J.species} submit to ${W.species}`,details:`The beaten ${J.species} now serve their conquerors.`,location:J.territoryName,worldTime:H,realTime:new Date,seed:h.seed});A.territorialDisputes=A.territorialDisputes.filter((O)=>O.id!==P.id)}}}else if(u.chance(0.05)){if(A.territorialDisputes.push({id:`dispute-${Date.now()}`,population1Id:G.id,population2Id:B.id,contestedHex:G.hexCoord,startedAt:H,intensity:1}),u.chance(0.3))b.push({category:"road",summary:`${G.species} and ${B.species} tensions rise`,details:"Two populations eye the same territory. Conflict seems inevitable.",location:G.territoryName,worldTime:H,realTime:new Date,seed:h.seed})}}}return b}function vM(u,A,h,H){let b=[];for(let i of h.dungeons){if(!i.rooms||i.rooms.length===0)continue;let G=i.rooms.filter((z)=>z.type==="empty").length,M=i.rooms.length,B=(i.explored??0)/M,k=A.populations.find((z)=>z.dungeonId===i.id);if(!k&&B>0.5&&G>0){if(u.chance(0.01)){let z=u.pick(["goblin","kobold","orc","skeleton","giant-spider","giant-rat"]),P=du(u,z,i.coord,"hills",H);P.dungeonId=i.id,P.territoryName=i.name,P.roomsClaimed=1,A.populations.push(P),b.push({category:"dungeon",summary:`${z} move into ${i.name}`,details:`The empty halls of ${i.name} attract new inhabitants. The ${z} begin to claim the depths.`,location:i.name,worldTime:H,realTime:new Date,seed:h.seed})}}else if(k&&k.population>0){if(k.roomsClaimed<G&&u.chance(0.006)){k.roomsClaimed++;let z=i.rooms.find((P)=>P.type==="empty");if(z)z.type="lair";if(u.chance(0.3))b.push({category:"dungeon",summary:`${k.species} spread deeper into ${i.name}`,details:"Another chamber falls under their control. The dungeon grows more dangerous.",location:i.name,worldTime:H,realTime:new Date,seed:h.seed})}}}return b}function aM(u,A,h,H,b){let i=[];for(let G of H){if(!G.alive)continue;if(!["orc-warlord","dark-wizard","necromancer","dragon","demon-bound"].includes(G.type))continue;let M=A.populations.filter((B)=>{if(B.population<=0||B.leaderId)return!1;if(nA(B.hexCoord,h)?.name!==G.territory)return!1;if(G.type==="orc-warlord"&&!["orc","goblin","hobgoblin","worg"].includes(B.species))return!1;if(G.type==="necromancer"&&B.category!=="undead")return!1;if(G.type==="dragon"&&!["kobold","drake","wyvern"].includes(B.species))return!1;return!0});for(let B of M)if(u.chance(0.02))B.leaderId=G.id,i.push({category:"faction",summary:`${B.species} rally to ${G.name}`,details:`The ${B.species} of ${B.territoryName} swear allegiance to ${G.name} ${G.epithet}. Their numbers swell the villain's forces.`,location:G.territory,actors:[G.name],worldTime:b,realTime:new Date,seed:h.seed}),G.followers=(G.followers??0)+B.population}return i}function TM(u,A,h,H){let b=[];for(let i of A.populations){if(i.recentLosses>i.population*0.3)i.morale=Math.max(-10,i.morale-2);if(i.category!=="undead"&&i.category!=="construct"){if(i.recentHunting<i.population*0.1&&u.chance(0.1)){let G=Math.floor(i.population*0.05);i.population-=G,i.morale-=1}}if(H.getUTCDate()===1)i.recentLosses=0,i.recentHunting=0;if(i.population<=0)A.extinctions.push({species:i.species,location:i.territoryName,timestamp:H,cause:i.recentLosses>0?"combat losses":"starvation or disease"}),b.push({category:"road",summary:`${i.species} wiped out in ${i.territoryName}`,details:`The last of the ${i.species} have fallen. The region grows quieter\u2014for now.`,location:i.territoryName,worldTime:H,realTime:new Date,seed:h.seed})}return A.populations=A.populations.filter((i)=>i.population>0),b}function Zu(u,A){return(Math.abs(u.q-A.q)+Math.abs(u.q+u.r-A.q-A.r)+Math.abs(u.r-A.r))/2}function nA(u,A){let h,H=1/0;for(let b of A.settlements){let i=Zu(u,b.coord);if(i<H)H=i,h=b}return h}function oA(u,A,h,H,b){let i=[];return i.push(..._M(u,A,h,b)),i.push(...NM(u,A,h,b)),i.push(...SM(u,A,h,H,b)),i.push(...fM(u,A,h,b)),i.push(...vM(u,A,h,b)),i.push(...aM(u,A,h,H,b)),i.push(...TM(u,A,h,b)),i}function Vu(){return{populations:[],extinctions:[],migrations:[],territorialDisputes:[]}}function Jh(u,A,h){let H=Vu();for(let b of A.hexes){if(A.settlements.some((M)=>M.coord.q===b.coord.q&&M.coord.r===b.coord.r))continue;let G=xM.filter((M)=>m(M).preferredTerrain.includes(b.terrain));if(G.length===0)continue;if(u.chance(0.3)){let M=u.pick(G),B=du(u,M,b.coord,b.terrain,h);H.populations.push(B)}if(u.chance(0.1)){let M=u.pick(G),B=du(u,M,b.coord,b.terrain,h);B.population=Math.floor(B.population*0.5),H.populations.push(B)}}for(let b of A.dungeons){let i=u.pick(["goblin","orc","skeleton","kobold","giant-rat"]),G=du(u,i,b.coord,"hills",h);G.dungeonId=b.id,G.territoryName=b.name,G.roomsClaimed=Math.min(b.rooms?.length??1,3+u.int(5)),H.populations.push(G)}return H}var yM=["Blackwood","Ironheart","Stormborn","Goldmane","Ravencrest","Whitehall","Thornwood","Dragonbane","Oakheart","Silverton","Darkwater","Brightblade","Wolfsbane","Firestone","Shadowmere","Stonefist","Greycloak","Redmoor","Winterfell","Sunspear","Highborn","Coldbrook","Swiftwind","Nightshade","Crowley"],lM=["Honor Above All","We Do Not Forget","Strength Through Unity","From Darkness, Light","The Storm Comes","Unbowed, Unbroken","Steel and Faith","Blood and Gold","First in Battle","Our Word is Law","We Rise Again","The Night Remembers","Fortune Favors the Bold","Loyalty Unto Death","Fire and Fury"],Wh={Fighter:{adolescence:14,adulthood:18,elderlyStart:55,maxAge:75,healthDeclineRate:0.05},Cleric:{adolescence:14,adulthood:18,elderlyStart:60,maxAge:80,healthDeclineRate:0.04},"Magic-User":{adolescence:14,adulthood:18,elderlyStart:65,maxAge:90,healthDeclineRate:0.03},Thief:{adolescence:14,adulthood:18,elderlyStart:50,maxAge:70,healthDeclineRate:0.06},Dwarf:{adolescence:30,adulthood:40,elderlyStart:200,maxAge:350,healthDeclineRate:0.01},Elf:{adolescence:50,adulthood:100,elderlyStart:500,maxAge:1000,healthDeclineRate:0.005},Halfling:{adolescence:20,adulthood:30,elderlyStart:80,maxAge:120,healthDeclineRate:0.03},Druid:{adolescence:14,adulthood:18,elderlyStart:70,maxAge:100,healthDeclineRate:0.03},Mystic:{adolescence:14,adulthood:18,elderlyStart:80,maxAge:120,healthDeclineRate:0.02}};function sM(u,A,h,H){let b=u.pick(yM);return{id:`bloodline-${Date.now()}-${u.int(1e4)}`,name:b,motto:u.chance(0.7)?u.pick(lM):void 0,founderId:A,currentHeadId:A,seat:H,reputation:u.int(11)-5,wealth:100+u.int(400),members:[A],deceasedMembers:[],alliances:[],enemies:[],traits:[u.pick(["ambitious","honorable","cunning","brave","cruel","charitable"])]}}function o(u,A){let h=A.getTime()-new Date(u).getTime();return Math.floor(h/31557600000)}function mM(u,A,h,H){let b=[];for(let i of h.npcs){if(i.alive===!1||!i.birthDate)continue;let G=o(i.birthDate,H),M=i.class??"Fighter",B=Wh[M];if(G>=B.elderlyStart){let k=i.lastHealthCheck?new Date(i.lastHealthCheck):new Date(0);if((H.getTime()-k.getTime())/86400000>=1){i.lastHealthCheck=H;let E=(G-B.elderlyStart)*B.healthDeclineRate;if(u.chance(E)){if(i.healthCondition==="healthy"){if(i.healthCondition="frail",i.fame&&i.fame>=3)b.push({category:"town",summary:`${i.name} grows frail with age`,details:`The years weigh heavy on the ${i.role}. Their step slows, their grip weakens.`,location:i.location,actors:[i.name],worldTime:H,realTime:new Date,seed:h.seed})}else if(i.healthCondition==="frail")i.healthCondition="ill",b.push({category:"town",summary:`${i.name} falls ill`,details:`The ${i.role} takes to their bed. Healers are summoned.`,location:i.location,actors:[i.name],worldTime:H,realTime:new Date,seed:h.seed});else if(i.healthCondition==="ill")i.healthCondition="dying",b.push({category:"town",summary:`${i.name} is dying`,details:`The end approaches for the ${i.role}. Family and rivals alike watch and wait.`,location:i.location,actors:[i.name],worldTime:H,realTime:new Date,seed:h.seed});else if(i.healthCondition==="dying")b.push(...rA(u,i,"old age",A,h,H))}if(G>=B.maxAge-10){let K=(G-(B.maxAge-10))*0.02;if(u.chance(K))b.push(...rA(u,i,"old age",A,h,H))}}}}return b}function rA(u,A,h,H,b,i){let G=[];A.alive=!1,A.deathDate=i,A.causeOfDeath=h;let M=H.bloodlines.find((z)=>z.id===A.bloodlineId);H.burials.push({npcId:A.id,npcName:A.name,bloodlineId:A.bloodlineId,deathDate:i,causeOfDeath:h,burialLocation:A.location,childrenLeft:A.childrenIds?.length??0,wealthInherited:M?.wealth??0}),G.push({category:"town",summary:`${A.name} has died`,details:`The ${A.role} passes away from ${h}. ${M?`The House of ${M.name} mourns.`:"They will be remembered."}`,location:A.location,actors:[A.name],worldTime:i,realTime:new Date,seed:b.seed});let B=b.settlements.find((z)=>z.name===A.location);if(B&&M)B.mood=Math.max(-5,B.mood-1);if(A.spouseId){let z=b.npcs.find((P)=>P.id===A.spouseId);if(z&&z.alive!==!1){z.widowed=!0,z.spouseId=void 0;let P=H.marriages.find((E)=>(E.spouse1Id===A.id||E.spouse2Id===A.id)&&!E.dissolved);if(P)P.dissolved=!0,P.dissolvedAt=i,P.dissolvedReason="death"}}if(M){if(M.members=M.members.filter((z)=>z!==A.id),M.deceasedMembers.push(A.id),M.currentHeadId===A.id)G.push(...dM(u,A,M,H,b,i))}let k=b.strongholds.filter((z)=>z.ownerId===A.id);for(let z of k)G.push(...pM(u,A,z,H,b,i));return G}function dM(u,A,h,H,b,i){let G=[],M;if(A.heir)M=b.npcs.find((B)=>B.id===A.heir&&B.alive!==!1);if(!M&&A.childrenIds?.length){let B=A.childrenIds.map((k)=>b.npcs.find((z)=>z.id===k)).filter((k)=>k&&k.alive!==!1&&k.legitimate).sort((k,z)=>new Date(k.birthDate).getTime()-new Date(z.birthDate).getTime());if(B.length>0)M=B[0]}if(!M&&A.childrenIds?.length){let B=A.childrenIds.map((k)=>b.npcs.find((z)=>z.id===k)).filter((k)=>k&&k.alive!==!1&&k.acknowledged).sort((k,z)=>new Date(k.birthDate).getTime()-new Date(z.birthDate).getTime());if(B.length>0)M=B[0]}if(!M&&A.spouseId)M=b.npcs.find((B)=>B.id===A.spouseId&&B.alive!==!1);if(!M&&A.fatherId){let B=b.npcs.find((k)=>k.id===A.fatherId);if(B?.childrenIds){let k=B.childrenIds.map((z)=>b.npcs.find((P)=>P.id===z)).filter((z)=>z&&z.alive!==!1&&z.id!==A.id);if(k.length>0)M=k[0]}}if(M){if(h.currentHeadId=M.id,A.titles?.length)M.titles=[...M.titles??[],...A.titles];G.push({category:"faction",summary:`${M.name} becomes head of House ${h.name}`,details:`Following the death of ${A.name}, ${M.name} assumes leadership of the bloodline.`,location:M.location,actors:[M.name,A.name],worldTime:i,realTime:new Date,seed:b.seed})}else{let B={id:`crisis-${Date.now()}`,title:`Head of House ${h.name}`,asset:h.id,assetType:"title",deceasedId:A.id,claimants:[],startedAt:i,resolved:!1};for(let k of h.members){let z=b.npcs.find((K)=>K.id===k);if(!z||z.alive===!1)continue;if(o(z.birthDate,i)<16)continue;let E=3;if(z.legitimate)E+=2;if(z.fatherId===A.id||z.motherId===A.id)E+=2;if(z.fame&&z.fame>=3)E+=1;if(z.level&&z.level>=5)E+=1;B.claimants.push({npcId:z.id,npcName:z.name,claimStrength:E,supporters:[],method:u.pick(["legal","force","bribery"])})}if(B.claimants.length>1)H.successionCrises.push(B),G.push({category:"faction",summary:`Succession crisis in House ${h.name}!`,details:`With no clear heir, ${B.claimants.length} claimants vie for leadership. The house may tear itself apart.`,location:h.seat??A.location,worldTime:i,realTime:new Date,seed:b.seed});else if(B.claimants.length===1)h.currentHeadId=B.claimants[0].npcId;else G.push({category:"faction",summary:`House ${h.name} is extinct`,details:"With no living heirs, the ancient bloodline ends. Their seat and wealth fall to the wind.",location:h.seat??A.location,worldTime:i,realTime:new Date,seed:b.seed})}return G}function pM(u,A,h,H,b,i){let G=[],M;if(A.heir)M=b.npcs.find((B)=>B.id===A.heir&&B.alive!==!1);if(!M&&A.childrenIds?.length){let B=A.childrenIds.map((k)=>b.npcs.find((z)=>z.id===k)).filter((k)=>k&&k.alive!==!1).sort((k,z)=>{if(k.legitimate!==z.legitimate)return k.legitimate?-1:1;return new Date(k.birthDate).getTime()-new Date(z.birthDate).getTime()});if(B.length>0)M=B[0]}if(M)h.ownerId=M.id,G.push({category:"faction",summary:`${M.name} inherits ${h.name}`,details:`The fortress passes to a new master. ${M.name} claims their birthright.`,location:h.name,actors:[M.name],worldTime:i,realTime:new Date,seed:b.seed});else{let B={id:`crisis-stronghold-${Date.now()}`,title:`Lordship of ${h.name}`,asset:h.id,assetType:"stronghold",deceasedId:A.id,claimants:[],startedAt:i,resolved:!1};for(let k of b.factions){let z=q(b,k.id);if(z.power>=40&&u.chance(0.3))B.claimants.push({npcId:k.id,npcName:k.name,claimStrength:Math.floor(z.power/20),supporters:[],method:"force"})}H.successionCrises.push(B),G.push({category:"faction",summary:`${h.name} falls into dispute`,details:"With no clear heir, the fortress attracts ambitious claimants. Conflict looms.",location:h.name,worldTime:i,realTime:new Date,seed:b.seed})}return G}function cM(u,A,h,H){let b=[];for(let i of A.courtships){if(i.stage==="rejected"||i.stage==="married")continue;let G=h.npcs.find((k)=>k.id===i.suiterId),M=h.npcs.find((k)=>k.id===i.targetId);if(!G||G.alive===!1||!M||M.alive===!1){i.stage="rejected";continue}let B=i.obstacles.length>0?0.2:0.4;if(i.progress+=B,i.progress>=30&&i.stage==="interest")i.stage="courting",b.push({category:"town",summary:`${G.name} courts ${M.name}`,details:"Gifts are exchanged. Time is spent together. The town gossips.",location:M.location,actors:[G.name,M.name],worldTime:H,realTime:new Date,seed:h.seed});if(i.progress>=70&&i.stage==="courting")i.stage="betrothed",b.push({category:"town",summary:`${G.name} and ${M.name} are betrothed`,details:"A formal agreement is made. The wedding will follow in due time.",location:M.location,actors:[G.name,M.name],worldTime:H,realTime:new Date,seed:h.seed});if(i.progress>=100&&i.stage==="betrothed")i.stage="married",b.push(...wM(u,G,M,!1,A,h,H));if(u.chance(0.02)){if(u.chance(0.3)){let k=["a rival suitor","family objection","scandal","distance"];i.obstacles.push(u.pick(k)),i.progress-=10}else if(i.progress>20)i.gifts+=10+u.int(40),i.progress+=5}}return b}function wM(u,A,h,H,b,i,G){let M=[];A.spouseId=h.id,h.spouseId=A.id,A.marriedAt=G,h.marriedAt=G;let B={id:`marriage-${Date.now()}`,spouse1Id:A.id,spouse2Id:h.id,marriedAt:G,location:A.location,political:H,children:[],dissolved:!1};if(A.bloodlineId&&h.bloodlineId&&A.bloodlineId!==h.bloodlineId){let z=b.bloodlines.find((E)=>E.id===A.bloodlineId),P=b.bloodlines.find((E)=>E.id===h.bloodlineId);if(z&&P){if(!z.alliances.includes(P.id))z.alliances.push(P.id);if(!P.alliances.includes(z.id))P.alliances.push(z.id);B.allianceForged=P.id,M.push({category:"faction",summary:`Houses ${z.name} and ${P.name} unite`,details:`The marriage of ${A.name} and ${h.name} forges an alliance between the bloodlines.`,location:B.location,actors:[A.name,h.name],worldTime:G,realTime:new Date,seed:i.seed})}}b.marriages.push(B),M.push({category:"town",summary:`${A.name} and ${h.name} are wed`,details:H?"A political union is sealed. The celebrations are formal and precise.":"Love, or something like it, blooms. The celebrations continue well into the night.",location:B.location,actors:[A.name,h.name],worldTime:G,realTime:new Date,seed:i.seed});let k=i.settlements.find((z)=>z.name===B.location);if(k){let z=b.bloodlines.find((K)=>K.id===A.bloodlineId),P=b.bloodlines.find((K)=>K.id===h.bloodlineId),E=(z?1:0)+(P?1:0);k.mood=Math.min(5,k.mood+1+E)}return M}function gM(u,A,h,H){let b=[];for(let i of A.pregnancies){let G=h.npcs.find((M)=>M.id===i.motherId);if(!G||G.alive===!1){A.pregnancies=A.pregnancies.filter((M)=>M.id!==i.id);continue}if(new Date(i.dueDate)<=H)b.push(...eM(u,i,A,h,H))}for(let i of A.marriages){if(i.dissolved)continue;let G=h.npcs.find((L)=>L.id===i.spouse1Id),M=h.npcs.find((L)=>L.id===i.spouse2Id);if(!G||!M||G.alive===!1||M.alive===!1)continue;let B=G,k=M;if(A.pregnancies.some((L)=>L.motherId===B.id))continue;let z=o(B.birthDate,H),P=B.class??"Fighter",E=Wh[P],K=E.elderlyStart*0.7;if(z<E.adulthood||z>K)continue;if(u.chance(0.00014)){let L=new Date(H.getTime()+23328000000);if(A.pregnancies.push({id:`pregnancy-${Date.now()}`,motherId:B.id,fatherId:k.id,conceivedAt:H,dueDate:L,complications:u.chance(0.1),twins:u.chance(0.03)}),B.fame&&B.fame>=2)b.push({category:"town",summary:`${B.name} is with child`,details:"Happy news for the household. An heir is expected.",location:B.location,actors:[B.name,k.name],worldTime:H,realTime:new Date,seed:h.seed})}}return b}function eM(u,A,h,H,b){let i=[],G=H.npcs.find((E)=>E.id===A.motherId),M=H.npcs.find((E)=>E.id===A.fatherId);if(!G)return i;if(A.complications&&u.chance(0.2)){if(u.chance(0.3))i.push(...rA(u,G,"childbirth",h,H,b));else i.push({category:"town",summary:`Tragedy strikes: ${G.name} loses the child`,details:"Despite the healers' efforts, the baby does not survive.",location:G.location,actors:[G.name],worldTime:b,realTime:new Date,seed:H.seed});return h.pregnancies=h.pregnancies.filter((E)=>E.id!==A.id),i}let B=A.twins?2:1,k=[];for(let E=0;E<B;E++){let K=$(u),L={id:`npc-child-${Date.now()}-${E}`,name:K,role:"laborer",home:G.home,location:G.location,reputation:0,fame:0,alive:!0,wounded:!1,bloodlineId:G.bloodlineId??M?.bloodlineId,fatherId:M?.id,motherId:G.id,childrenIds:[],birthDate:b,legitimate:!!G.spouseId&&G.spouseId===M?.id,acknowledged:!0,healthCondition:"healthy",titles:[],claims:[],widowed:!1,divorces:0};if(G.depth?.traits)L.depth={...L.depth,traits:[u.pick(G.depth.traits)],background:"noble-exile",motivation:"duty",relationships:[],memories:[],quirks:[]};if(H.npcs.push(L),k.push(L),!G.childrenIds)G.childrenIds=[];if(G.childrenIds.push(L.id),M){if(!M.childrenIds)M.childrenIds=[];M.childrenIds.push(L.id)}let W=h.bloodlines.find((V)=>V.id===L.bloodlineId);if(W)W.members.push(L.id);let J=h.marriages.find((V)=>(V.spouse1Id===G.id||V.spouse2Id===G.id)&&!V.dissolved);if(J)J.children.push(L.id)}h.pregnancies=h.pregnancies.filter((E)=>E.id!==A.id);let z=h.bloodlines.find((E)=>E.id===G.bloodlineId);i.push({category:"town",summary:A.twins?`${G.name} gives birth to twins!`:`${G.name} gives birth`,details:z?`An heir is born to House ${z.name}. ${k.map((E)=>E.name).join(" and ")} ${A.twins?"enter":"enters"} the world.`:`${k[0].name} is born. A new life begins.`,location:G.location,actors:[G.name,...k.map((E)=>E.name)],worldTime:b,realTime:new Date,seed:H.seed});let P=H.settlements.find((E)=>E.name===G.location);if(P&&z)P.mood=Math.min(5,P.mood+1);return i}function nM(u,A,h,H){let b=[];for(let i of A.successionCrises){if(i.resolved)continue;let G=(H.getTime()-new Date(i.startedAt).getTime())/86400000;if(G<14)continue;let M=0.01+(G-14)*0.005;if(u.chance(M)){let B,k=0;for(let P of i.claimants)k+=P.claimStrength+P.supporters.length*2;let z=u.int(k);for(let P of i.claimants)if(z-=P.claimStrength+P.supporters.length*2,z<0){B=P;break}if(!B)B=i.claimants[0];if(i.resolved=!0,i.resolvedAt=H,i.winnerId=B.npcId,i.assetType==="stronghold"){let P=h.strongholds.find((E)=>E.id===i.asset);if(P)P.ownerId=B.npcId}else if(i.assetType==="title"){let P=A.bloodlines.find((E)=>E.id===i.asset);if(P)P.currentHeadId=B.npcId}b.push({category:"faction",summary:`${B.npcName} wins the ${i.title}`,details:`After weeks of intrigue and ${B.method==="force"?"bloodshed":"maneuvering"}, the succession crisis is resolved.`,location:B.npcName,actors:[B.npcName],worldTime:H,realTime:new Date,seed:h.seed});for(let P of i.claimants.filter((E)=>E.npcId!==B.npcId))if(u.chance(0.3)){let E=h.npcs.find((L)=>L.id===P.npcId),K=h.npcs.find((L)=>L.id===B.npcId);if(E&&K&&E.bloodlineId&&K.bloodlineId){let L=A.bloodlines.find((J)=>J.id===E.bloodlineId),W=A.bloodlines.find((J)=>J.id===K.bloodlineId);if(L&&W&&L.id!==W.id){if(!L.enemies.includes(W.id))L.enemies.push(W.id)}}}}}return b}function tA(u,A,h,H){let b=[];if(b.push(...mM(u,A,h,H)),b.push(...gM(u,A,h,H)),b.push(...cM(u,A,h,H)),b.push(...nM(u,A,h,H)),u.chance(0.005)){let i=h.npcs.filter((M)=>M.alive!==!1&&!M.spouseId&&M.birthDate&&o(M.birthDate,H)>=18&&o(M.birthDate,H)<=50&&(M.fame??0)>=2),G=h.npcs.filter((M)=>M.alive!==!1&&!M.spouseId&&M.birthDate&&o(M.birthDate,H)>=18&&o(M.birthDate,H)<=45);if(i.length>0&&G.length>1){let M=u.pick(i),B=u.pick(G.filter((k)=>k.id!==M.id));if(B&&!A.courtships.some((k)=>k.suiterId===M.id))A.courtships.push({id:`courtship-${Date.now()}`,suiterId:M.id,targetId:B.id,startedAt:H,stage:"interest",progress:0,obstacles:[],gifts:0}),b.push({category:"town",summary:`${M.name} shows interest in ${B.name}`,details:"Glances are exchanged. Inquiries are made. A courtship may be beginning.",location:M.location,actors:[M.name,B.name],worldTime:H,realTime:new Date,seed:h.seed})}}return b}function Cu(){return{bloodlines:[],marriages:[],pregnancies:[],successionCrises:[],courtships:[],burials:[]}}function Oh(u,A,h){let H=Cu(),b=A.npcs.filter((G)=>G.alive!==!1&&((G.fame??0)>=3||(G.level??0)>=5));for(let G of b)if(u.chance(0.5)){let M=A.strongholds.find((k)=>k.ownerId===G.id)?.name,B=sM(u,G.id,G.name,M);H.bloodlines.push(B),G.bloodlineId=B.id,G.birthDate=new Date(h.getTime()-(25+u.int(40))*365*24*60*60*1000),G.childrenIds=[],G.titles=[(G.level??0)>=9?"Lord":"Esquire"],G.claims=[],G.legitimate=!0,G.acknowledged=!0,G.healthCondition="healthy",G.widowed=!1,G.divorces=0}for(let G of A.npcs){let M=G;if(!M.birthDate)M.birthDate=new Date(h.getTime()-(18+u.int(50))*365*24*60*60*1000),M.childrenIds=[],M.titles=[],M.claims=[],M.legitimate=!0,M.acknowledged=!0,M.healthCondition="healthy",M.widowed=!1,M.divorces=0}let i=[];for(let G of A.npcs){if(i.includes(G.id))continue;if(!G.birthDate)continue;let M=o(G.birthDate,h);if(M<20||M>60)continue;if(u.chance(0.3)){let B=A.npcs.filter((k)=>k.id!==G.id&&!i.includes(k.id)&&k.alive!==!1&&k.birthDate&&o(k.birthDate,h)>=18&&o(k.birthDate,h)<=60&&k.location===G.location);if(B.length>0){let k=u.pick(B);G.spouseId=k.id,k.spouseId=G.id;let z=u.int(Math.min(M-18,20)),P=new Date(h.getTime()-z*365*24*60*60*1000);G.marriedAt=P,k.marriedAt=P,i.push(G.id,k.id),H.marriages.push({id:`marriage-init-${H.marriages.length}`,spouse1Id:G.id,spouse2Id:k.id,marriedAt:P,location:G.location,political:u.chance(0.3),children:[],dissolved:!1})}}}return H}var Rh={"fishing-boat":{crew:4,cargo:2,speed:24,seaworthiness:0.3,cost:100,marines:0},"merchant-cog":{crew:12,cargo:20,speed:48,seaworthiness:0.6,cost:2000,marines:5},longship:{crew:60,cargo:10,speed:90,seaworthiness:0.5,cost:3000,marines:40},galley:{crew:150,cargo:30,speed:72,seaworthiness:0.4,cost:1e4,marines:75},carrack:{crew:30,cargo:50,speed:60,seaworthiness:0.8,cost:8000,marines:20},warship:{crew:100,cargo:15,speed:72,seaworthiness:0.7,cost:15000,marines:60}},ui=["spices","silk","gems","ivory","wine","dyes"],oM=["sea-serpent","giant-octopus","dragon-turtle","kraken","merfolk","sahuagin","sea-hag","water-elemental","laceddon","nixie","sea-giant","giant-crab","giant-shark","whale","morkoth"];function Zh(u,A){let h={ships:[],seaRoutes:[],pirates:[],recentShipwrecks:[],portActivity:{},distantLands:[],distantFigures:[]},H=u.settlements.filter((b)=>b.isPort);for(let b=0;b<H.length;b++)for(let i=b+1;i<H.length;i++){let G=H[b],M=H[i],B=Math.abs(G.coord.q-M.coord.q),k=Math.abs(G.coord.r-M.coord.r),z=Math.max(B,k,Math.abs(B-k)),P=Math.max(1,Math.ceil(z/4));h.seaRoutes.push({id:`route-${G.id}-${M.id}`,from:G.name,to:M.name,distanceDays:P,dangerLevel:1+A.int(4),primaryGoods:A.shuffle([...ui]).slice(0,2+A.int(3))})}for(let b of H){let i=b.portSize==="great"?3+A.int(5):b.portSize==="major"?2+A.int(3):1+A.int(2);for(let G=0;G<i;G++){let M=A.pick(["fishing-boat","merchant-cog","carrack"]),B=Rh[M];h.ships.push({id:`ship-${b.id}-${G}`,name:rM(A),type:M,ownerId:b.id,ownerName:`Merchants of ${b.name}`,status:"docked",homePort:b.name,currentLocation:b.name,cargo:{},crew:B.crew,marines:Math.floor(B.marines*0.5),condition:80+A.int(20)})}h.portActivity[b.name]={shipsInPort:i,exoticGoodsAvailable:A.shuffle([...ui]).slice(0,1+A.int(3))}}if(H.length>=2&&A.chance(0.7)){let b=1+A.int(2);for(let i=0;i<b;i++)h.pirates.push({id:`pirates-${i}`,name:tM(A),captain:uH(A),ships:1+A.int(3),crew:30+A.int(70),basedAt:"Unknown Cove",territory:h.seaRoutes.slice(0,1+A.int(h.seaRoutes.length)).map((G)=>G.id),notoriety:20+A.int(60),bounty:100+A.int(900)})}return h}function rM(u){let A=["Swift","Gallant","Golden","Silver","Crimson","Azure","Iron","Proud","Lucky","Bold","Faithful","Northern","Southern","Royal","Ancient","Blessed","Storm","Sea","Wind","Star"],h=["Maiden","Lady","Queen","Spirit","Dragon","Serpent","Lion","Eagle","Rose","Star","Wave","Tide","Wind","Merchant","Voyager","Fortune","Destiny","Dawn","Dusk","Horizon","Wanderer"];return`The ${u.pick(A)} ${u.pick(h)}`}function tM(u){let A=["Black","Red","Crimson","Dread","Shadow","Storm","Blood","Skull","Death","Iron","Ghost","Howling","Raging"],h=["Brotherhood","Corsairs","Raiders","Reavers","Wolves","Serpents","Tide","Fleet","Scourge","Terror","Plague","Hunters"];return`The ${u.pick(A)} ${u.pick(h)}`}function uH(u){let A=["Captain","Admiral","Dread Captain","Black","Red","One-Eyed","Bloody","Iron","Storm","Mad"],h=["Morgan","Blackbeard","Redhand","Silverfin","Darkwater","Stormborn","Daggertooth","Ironhook","Saltblood","Wavecrest","Deepscar","Krakensbane","Tidewraith","Vortex","Maelstrom"];return`${u.pick(A)} ${u.pick(h)}`}var AH=["Jade","Sapphire","Golden","Silver","Obsidian","Crystal","Amber","Crimson","Azure","Ivory","Ebony","Pearl","Coral","Opal","Onyx","Scarlet","Verdant","Twilight","Dawn","Dusk","Storm","Sun","Moon"],iH={eastern:["Empire","Dynasty","Dominion","Celestial Realm","Kingdom of Ten Thousand"],southern:["Kingdoms","Confederacy","Tribal Lands","Coast","Shore"],northern:["Reaches","Tundra","Wastes","Fjords","Holdfast"],western:["Republic","Principalities","Duchies","Marches","Frontier"],island:["Isles","Archipelago","Atoll","Chain","Sea Kingdom"],desert:["Sands","Dunes","Sultanate","Caliphate","Oasis Kingdoms"],jungle:["Jungles","Rainlands","Serpent Kingdoms","Vine Realm","Green Hell"]},hH={eastern:["across the Jade Sea","beyond the Dragon Gate","where the sun rises","of the silk roads"],southern:["beyond the burning straits","where the monsoons blow","of endless summer","past the spice routes"],northern:["beyond the ice","where winter never ends","of the aurora","past the frozen sea"],western:["across the sunset waters","beyond the horizon","where the old gods sleep","of the dying light"],island:["in the endless sea","beyond the last lighthouse","where maps end","of a thousand isles"],desert:["beyond the burning sands","where the oases bloom","of the shifting dunes","past the great waste"],jungle:["in the green darkness","where the serpents rule","of the endless canopy","past the fever swamps"]},GH={eastern:[["silk","jade"],["martial arts","paper"],["fireworks","tea"],["porcelain","philosophy"]],southern:[["spices","elephants"],["gold","ivory"],["drums","masks"],["exotic beasts","tribal magic"]],northern:[["furs","whale oil"],["berserkers","rune magic"],["ice ships","sea monsters"],["legendary smiths","mead"]],western:[["banking","mercenaries"],["wine","olive oil"],["ancient ruins","lost magic"],["clockwork","alchemy"]],island:[["pearls","coral"],["navigation","sea-craft"],["unique creatures","volcanic glass"],["cannibals","hidden temples"]],desert:[["glass","astronomy"],["horses","falconry"],["djinn-binding","oasis magic"],["geometric art","mathematics"]],jungle:[["poisons","healing herbs"],["feathered serpents","step pyramids"],["blood magic","obsidian"],["rubber","cacao"]]},bH={eastern:["Emperor","Heavenly Sovereign","Dragon Throne","Celestial Majesty","Divine Ruler"],southern:["High King","Paramount Chief","Lion Lord","Sun King","Great Chief"],northern:["High Jarl","Storm King","Frost Monarch","All-Father","Ice Throne"],western:["Doge","Prince-Elector","Grand Duke","Oligarch","First Citizen"],island:["Sea King","Island Lord","Tide Master","Coral Throne","Wave Monarch"],desert:["Sultan","Caliph","Shah","Vizier Supreme","Sand King"],jungle:["Serpent King","Jaguar Lord","Green Emperor","Vine Throne","Blood King"]},MH={eastern:["Xian","Zhao","Ming","Liu","Wei","Chen","Huang","Jin","Long","Feng"],southern:["Mansa","Shaka","Kwame","Amara","Zuri","Kofi","Nia","Sekou","Imani","Jabari"],northern:["Bjorn","Ragnar","Sigrid","Freya","Thorin","Helga","Orm","Astrid","Leif","Ingrid"],western:["Lorenzo","Isabella","Marcus","Helena","Cassius","Octavia","Nero","Livia","Titus","Claudia"],island:["Kai","Moana","Tane","Leilani","Koa","Malia","Nalu","Keoni","Ailani","Makoa"],desert:["Rashid","Fatima","Harun","Layla","Omar","Yasmin","Khalid","Amira","Saladin","Soraya"],jungle:["Itzamna","Ixchel","Kukulkan","Xochitl","Tlaloc","Quetzal","Cipactli","Coatl","Yaotl","Citlali"]},HH=["the Magnificent","the Terrible","the Wise","the Cruel","the Golden","the Undying","the Conqueror","the Dreamer","the Mad","the Blessed","the Accursed","the Beloved","the Feared","the Forgotten","the Returned","Worldbreaker","Stormcaller","Sunbringer","Nightwalker","Deathless"],BH=["ruler","warlord","merchant-prince","prophet","archmage","pirate-lord","beast-master"],kH={ruler:["commands absolute loyalty","rules with an iron fist","beloved by the common folk","whispered to be a god incarnate"],warlord:["has never lost a battle","commands armies beyond counting","leaves only ashes","seeks worthy opponents"],"merchant-prince":["owns half the world's trade","knows every secret","can buy nations","trades in the forbidden"],prophet:["speaks with the voice of gods","sees the future","commands fanatical followers","performs miracles"],archmage:["bends reality to their will","has transcended mortality","seeks forbidden knowledge","guards ancient secrets"],"pirate-lord":["rules the sea lanes","has sunk a hundred ships","answers to no crown","knows every hidden cove"],"beast-master":["commands terrible creatures","speaks to monsters","rides a dragon","has tamed the untameable"]};function zH(u){let A=u.pick(["eastern","southern","northern","western","island","desert","jungle"]),h=u.pick(AH),H=u.pick(iH[A]);return{id:`distant-land-${Date.now()}-${u.int(1e4)}`,name:`the ${h} ${H}`,epithet:u.pick(hH[A]),culture:A,knownFor:u.pick(GH[A]),rulerTitle:u.pick(bH[A]),mentionCount:0}}function PH(u,A){let h=u.pick(BH),H=u.pick(MH[A.culture]),b=u.pick(HH),i=h==="ruler"?`${A.rulerTitle} ${H}`:`${H} ${b}`;return{id:`distant-figure-${Date.now()}-${u.int(1e4)}`,name:H,title:i,landId:A.id,role:h,reputation:u.pick(kH[h]),alive:!0,mentionCount:0}}function EH(u,A){if(A.distantLands.length>0&&u.chance(0.7)){let H=u.pick(A.distantLands);return H.mentionCount++,H.lastMentioned=new Date,H}let h=zH(u);return h.mentionCount=1,h.lastMentioned=new Date,A.distantLands.push(h),h}function KH(u,A,h){let H=A.distantFigures.filter((i)=>i.landId===h.id&&i.alive);if(H.length>0&&u.chance(0.6)){let i=u.pick(H);return i.mentionCount++,i.lastMentioned=new Date,i}let b=PH(u,h);return b.mentionCount=1,b.lastMentioned=new Date,A.distantFigures.push(b),b}function Fh(u,A){let h=EH(u,A),H=KH(u,A,h),b=[{kind:"distant-war",texts:[`War has broken out in ${h.name}. ${H.title} marshals armies beyond counting.`,`${H.title} has been overthrown in ${h.name}. Chaos spreads across the realm.`,`A great battle was fought in ${h.name}. The dead number in the thousands.`,`${h.name} has fallen to invaders from ${h.epithet}.`,`Civil war tears ${h.name} apart. Refugees flee by the shipload.`,`${H.title} demands tribute from all neighboring kingdoms.`]},{kind:"distant-treasure",texts:[`${H.title} has discovered a treasure vault beneath ${h.name}. Gold beyond measure.`,`A merchant from ${h.name} arrived with ${u.pick(h.knownFor)} worth a king's ransom.`,`The lost fleet of ${h.name} has been found\u2014holds still full of ancient gold.`,`${H.title} offers a fortune for adventurers willing to sail ${h.epithet}.`,`The mines of ${h.name} have struck a new vein. ${H.title} grows richer by the day.`,`A dying sailor spoke of a map to the treasure of ${h.name}.`]},{kind:"distant-monster",texts:[`A great sea beast has destroyed three ships bound for ${h.name}.`,`${H.title} battles a dragon that has made its lair in ${h.name}.`,`The sailors speak of leviathans stirring in the waters ${h.epithet}.`,`Something ancient has awakened beneath ${h.name}. Ships flee the coast.`,`${h.name} is overrun with creatures from the deep places.`,`A kraken was sighted in waters ${h.epithet}. Trade routes are abandoned.`]},{kind:"distant-plague",texts:[`A terrible plague sweeps ${h.name}. The dead walk in the streets.`,`${h.name} has been struck by a great earthquake. Cities crumble.`,`Famine grips ${h.name}. They say people resort to terrible things.`,`A cursed fog has descended on ${h.name}. None who enter return.`,`The waters around ${h.name} have turned to blood. Fish die in heaps.`,`${H.title} has sealed the borders of ${h.name}. No one knows why.`]},{kind:"distant-magic",texts:[`The wizards of ${h.name} have opened a gate to another world.`,`${H.title} has achieved immortality through forbidden rites.`,`A new moon appeared over ${h.name} last month. It still hangs there.`,`${h.name} is said to possess a weapon that can sink entire fleets.`,`The oracles of ${h.name} have seen a vision of the world's ending.`,`Strange lights in the sky over ${h.name}. The stars themselves move.`]},{kind:"distant-trade",texts:[`${h.name} seeks new trading partners. Their ${u.pick(h.knownFor)} are beyond compare.`,`${H.title} has cornered the ${u.pick(h.knownFor)} market. Prices will triple.`,`A new sea route ${h.epithet} has been discovered. Fortunes to be made.`,`The guilds of ${h.name} craft wonders unknown in these lands.`,`${h.name} exports substances that grant visions of the future.`,`${H.title} seeks rare components. Pays in rubies.`]}],i=u.pick(b);return{text:u.pick(i.texts),kind:i.kind,landId:h.id,figureId:H.id}}function Ai(u,A,h,H,b){let i=[];for(let G of u.ships){if(G.status!=="at-sea"||!G.arrivesAt)continue;let M=new Date(G.arrivesAt);if(H>=M){G.status="docked",G.currentLocation=G.destination;let B=A.settlements.find((k)=>k.name===G.destination);if(B){let z=Object.keys(G.cargo).filter((P)=>ui.includes(P));if(z.length>0){i.push({category:"town",summary:`${G.name} arrives in ${B.name} with exotic cargo`,details:`The ship brings ${z.join(", ")} from distant shores. Merchants rush to bid.`,location:B.name,worldTime:H,realTime:new Date,seed:A.seed});let P=u.portActivity[B.name]??{shipsInPort:0,exoticGoodsAvailable:[]};for(let E of z)if(!P.exoticGoodsAvailable.includes(E))P.exoticGoodsAvailable.push(E);if(P.shipsInPort++,P.lastArrival=H,u.portActivity[B.name]=P,h.chance(0.25)){let E=Fh(h,u),K=u.distantLands.find((L)=>L.id===E.landId);i.push({category:"town",summary:`Sailors bring tales from ${K?.name??"distant lands"}`,details:`The crew of ${G.name} shares news from across the sea: "${E.text}"`,location:B.name,worldTime:H,realTime:new Date,seed:A.seed})}}else if(i.push({category:"town",summary:`${G.name} makes port in ${B.name}`,details:"Another vessel completes its voyage safely.",location:B.name,worldTime:H,realTime:new Date,seed:A.seed}),h.chance(0.15)){let P=Fh(h,u),E=u.distantLands.find((K)=>K.id===P.landId);i.push({category:"town",summary:`Sailors bring tales from ${E?.name??"distant lands"}`,details:`The crew of ${G.name} shares news from across the sea: "${P.text}"`,location:B.name,worldTime:H,realTime:new Date,seed:A.seed})}}G.destination=void 0,G.departedAt=void 0,G.arrivesAt=void 0,G.cargo={}}}return i}function ii(u,A,h,H,b,i){let G=[],M=u.ships.filter((k)=>k.status==="docked"&&(k.type==="merchant-cog"||k.type==="carrack"));for(let k of M){let z=0.15;if(b==="storm")z=0.02;else if(b==="rain")z=0.08;if(i==="winter")z*=0.5;if(h.chance(z)){let P=u.seaRoutes.filter((E)=>E.from===k.currentLocation||E.to===k.currentLocation);if(P.length>0){let E=h.pick(P),K=E.from===k.currentLocation?E.to:E.from,L=E.distanceDays;if(b==="storm")L*=2;else if(b==="rain")L=Math.ceil(L*1.5);if(i==="winter")L=Math.ceil(L*1.3);let W=L*24;k.status="at-sea",k.destination=K,k.departedAt=H,k.arrivesAt=new Date(H.getTime()+W*60*60*1000);let J={};for(let O of E.primaryGoods)if(h.chance(0.5))J[O]=1+h.int(5);k.cargo=J;let V=u.portActivity[k.currentLocation];if(V)V.shipsInPort=Math.max(0,V.shipsInPort-1),V.lastDeparture=H;let C=Object.keys(J).length>0?`carrying ${Object.keys(J).join(", ")}`:"with empty holds seeking cargo";G.push({category:"town",summary:`${k.name} sets sail from ${k.currentLocation}`,details:`The ${k.type} departs for ${K}, ${C}. Expected voyage: ${L} days.`,location:k.currentLocation,worldTime:H,realTime:new Date,seed:A.seed})}}}for(let k of u.pirates){let z=0.08;if(b==="storm")z=0.01;if(i==="summer")z*=1.5;if(k.lastRaid){if((H.getTime()-new Date(k.lastRaid).getTime())/86400000<3)z=0}if(h.chance(z)){let P=u.ships.filter((E)=>E.status==="at-sea"&&E.type!=="warship"&&u.seaRoutes.some((K)=>k.territory.includes(K.id)&&(K.from===E.homePort||K.to===E.destination)));if(P.length>0){let E=h.pick(P);k.lastRaid=H;let K=k.crew*0.8,L=E.marines*1+E.crew*0.3,W=K*(0.5+h.next()),J=L*(0.5+h.next());if(W>J*1.5)G.push({category:"road",summary:`${k.name} capture ${E.name}!`,details:`${k.captain} and their crew overwhelm the ${E.type}. The cargo is seized, the crew ransomed or pressed into service.`,location:"the high seas",actors:[k.captain,E.ownerName],worldTime:H,realTime:new Date,seed:A.seed}),E.status="shipwrecked",E.currentLocation="captured",k.notoriety=Math.min(100,k.notoriety+10),k.bounty+=100+h.int(200);else if(W>J)G.push({category:"road",summary:`${k.name} raid ${E.name}`,details:`${k.captain}'s corsairs board and plunder the vessel, but it limps away with survivors.`,location:"the high seas",actors:[k.captain,E.ownerName],worldTime:H,realTime:new Date,seed:A.seed}),E.condition=Math.max(20,E.condition-30),E.cargo={},k.notoriety=Math.min(100,k.notoriety+5);else G.push({category:"road",summary:`${E.name} repels pirate attack`,details:`${k.name} attempt to take the ${E.type}, but the crew fights them off. The corsairs withdraw with casualties.`,location:"the high seas",actors:[k.captain,E.ownerName],worldTime:H,realTime:new Date,seed:A.seed}),k.crew=Math.max(10,k.crew-5-h.int(10)),E.condition=Math.max(40,E.condition-15)}}}if(b==="storm"){let k=u.ships.filter((z)=>z.status==="at-sea");for(let z of k){let E=Rh[z.type].seaworthiness*(z.condition/100);if(h.chance(0.2))if(h.chance(E)){if(G.push({category:"weather",summary:`${z.name} weathers the storm`,details:`The ${z.type} is battered but stays afloat. Repairs will be needed.`,location:"the high seas",worldTime:H,realTime:new Date,seed:A.seed}),z.condition=Math.max(30,z.condition-20-h.int(20)),z.arrivesAt)z.arrivesAt=new Date(z.arrivesAt.getTime()+43200000)}else G.push({category:"weather",summary:`${z.name} lost in the storm!`,details:`The ${z.type} founders in the tempest. Wreckage may wash ashore. ${z.crew} souls aboard.`,location:"the high seas",worldTime:H,realTime:new Date,seed:A.seed}),z.status="shipwrecked",u.recentShipwrecks.push({shipName:z.name,location:z.destination??"unknown waters",date:H,cargo:{...z.cargo},salvaged:!1})}}if(h.chance(0.03)){let k=A.settlements.filter((z)=>z.isPort);if(k.length>0){let z=h.pick(k),P=h.pick([...oM]),K={"sea-serpent":{summary:`Sea serpent spotted near ${z.name}`,details:"Fishermen report a massive scaled form in the waves. Several boats refuse to leave harbor."},"giant-octopus":{summary:`Giant octopus attacks boat near ${z.name}`,details:"Tentacles the size of masts drag a fishing vessel under. One survivor babbles of eyes like cartwheels."},"dragon-turtle":{summary:`Dragon turtle surfaces off ${z.name}`,details:"The ancient creature rises from the deep. Its shell is an island. Its breath is steam. Offerings are prepared."},kraken:{summary:`The kraken stirs in waters near ${z.name}`,details:"Sailors whisper the dread name. Ships are kept in harbor. The sea itself seems to hold its breath."},merfolk:{summary:`Merfolk seen near ${z.name}`,details:"The sea folk have been spotted watching the harbor. Their intentions are unknown."},sahuagin:{summary:`Sahuagin raid coast near ${z.name}`,details:"The fish-men emerge from the waves at night. A fishing hamlet is found empty, blood on the sand."},"sea-hag":{summary:`Sea hag's curse afflicts ${z.name}`,details:"Nets come up empty. Hulls rot overnight. Someone has angered the old woman of the waves."},"water-elemental":{summary:`Water elemental rampages near ${z.name}`,details:"A living wave tears through the harbor. Some wizard's summoning gone wrong, perhaps."},laceddon:{summary:`Drowned dead walk near ${z.name}`,details:"Corpses of the drowned claw up from the sea. The beach becomes a battlefield."},nixie:{summary:`Nixies enchant sailors near ${z.name}`,details:"Men walk into the sea in a trance. Some do not return."},"sea-giant":{summary:`Sea giant demands tribute from ${z.name}`,details:"The giant wades in the shallows, demanding gold and cattle. The harbor master negotiates."},"giant-crab":{summary:`Giant crabs emerge near ${z.name}`,details:"Monstrous crustaceans scuttle onto the beach. Their claws can sever a man in two."},"giant-shark":{summary:`Giant shark terrorizes waters near ${z.name}`,details:"A fin the size of a sail circles the harbor. Swimming is forbidden."},whale:{summary:`Great whale sighted off ${z.name}`,details:"A leviathan surfaces, spraying water high. An omen, say the old sailors. But of what?"},morkoth:{summary:`Strange disappearances near ${z.name}`,details:"Ships vanish in calm seas. Survivors speak of hypnotic lights in the deep."}}[P]??{summary:`Sea creature spotted near ${z.name}`,details:"Something lurks in the waters. Sailors are wary."};G.push({category:"road",summary:K.summary,details:K.details,location:z.name,worldTime:H,realTime:new Date,seed:A.seed})}}let B=u.recentShipwrecks.filter((k)=>!k.salvaged);if(B.length>0&&h.chance(0.1)){let k=h.pick(B),z=A.settlements.filter((P)=>P.isPort);if(z.length>0){let P=h.pick(z);G.push({category:"town",summary:`Wreckage of ${k.shipName} washes ashore near ${P.name}`,details:"Salvagers rush to the beach. Cargo may be recoverable.",location:P.name,worldTime:H,realTime:new Date,seed:A.seed}),k.salvaged=!0}}for(let[k,z]of Object.entries(u.portActivity))if(h.chance(0.1)&&z.exoticGoodsAvailable.length>0){let P=z.exoticGoodsAvailable.pop()}return G}function Vh(u,A){if(u.isPort=!0,u.type==="city")u.portSize=A.chance(0.3)?"great":"major";else if(u.type==="town")u.portSize=A.chance(0.5)?"major":"minor";else u.portSize="minor";u.shipyard=u.type==="city"||u.type==="town"&&A.chance(0.3),u.lighthouse=u.portSize==="great"||u.portSize==="major"&&A.chance(0.5)}var pu=new eu,F=t(U.seed),Ch=new ou(U.logDir),D,T,N=[],S=[],Gu=su(),cu=null;async function DH(){if(cu===null)return!1;try{return(await hi("world.json")).mtime.getTime()>cu}catch(u){return!1}}async function LH(){if(await DH()){console.log("\uD83D\uDD04 World.json modified externally, reloading...");let u=await OA();if(u){D=u;try{cu=(await hi("world.json")).mtime.getTime()}catch(A){}return T=Fu(D.lastTickAt||U.startWorldTime),N=D.antagonists||[],S=D.storyThreads||[],Gu=D.legendaryState||su(),zu=D.retainerRoster||mu(),bu=D.guildState||Ru(),Mu=D.ecologyState||Vu(),Hu=D.dynastyState||Cu(),iu=D.treasureState||Nu(),s=D.navalState||{ships:[],seaRoutes:[],pirates:[],recentShipwrecks:[],portActivity:{},distantLands:[],distantFigures:[]},console.log("\u2705 World reloaded successfully"),!0}}return!1}var zu=mu(),bu=Ru(),Mu=Vu(),Hu=Cu(),iu=Nu(),s={ships:[],seaRoutes:[],pirates:[],recentShipwrecks:[],portActivity:{},distantLands:[],distantFigures:[]},Gi=!1;process.on("uncaughtException",(u)=>{if(console.error("\uD83D\uDEA8 UNCAUGHT EXCEPTION:",u),console.error("Stack trace:",u.stack),D)w(D).catch((A)=>{console.error("Failed to save world on crash:",A)}).finally(()=>{process.exit(1)});else process.exit(1)});process.on("unhandledRejection",(u,A)=>{console.error("\uD83D\uDEA8 UNHANDLED REJECTION at:",A,"reason:",u)});process.on("SIGTERM",()=>{if(console.log("\uD83D\uDCE1 Received SIGTERM, shutting down gracefully..."),D)w(D).then(()=>{console.log("\uD83D\uDCBE World saved successfully"),process.exit(0)}).catch((u)=>{console.error("Failed to save world on shutdown:",u),process.exit(1)});else process.exit(0)});process.on("SIGINT",()=>{if(console.log("\uD83D\uDCE1 Received SIGINT, shutting down gracefully..."),D)w(D).then(()=>{console.log("\uD83D\uDCBE World saved successfully"),process.exit(0)}).catch((u)=>{console.error("Failed to save world on shutdown:",u),process.exit(1)});else process.exit(0)});async function Q(u){let A={...u,realTime:new Date};if(await Ch.log(A),u.category!=="weather"&&u.category!=="system"){let h=Gh(A,D,F,S);if(h)S.push(h),await Q({category:"faction",summary:`A new tale begins: "${h.title}"`,details:h.summary,location:h.location,actors:h.actors,worldTime:u.worldTime,seed:D.seed??U.seed});xu(A,D,F)}}async function JH(){let u=await OA();if(u){D=u;try{cu=(await hi("world.json")).mtime.getTime()}catch(h){}let A=process.env.FORCE_SEED;if(A&&A!==D.seed)console.log(`\uD83D\uDD04 FORCE SEED: Overriding world seed "${D.seed}" with "${A}"`),D.seed=A,F=t(A);else if(D.seed){if(D.seed!==U.seed)console.log(`\uD83D\uDD04 Using world seed: "${D.seed}" (config had: "${U.seed}")`);F=t(D.seed),U.seed=D.seed}else console.log(`\u26A0\uFE0F  World missing seed, setting to: "${U.seed}"`),D.seed=U.seed,F=t(U.seed);if(D.consequenceQueue)Ui(D.consequenceQueue);for(let h=0;h<D.npcs.length;h++){let H=D.npcs[h];if(!H.depth)D.npcs[h]=qA(F,H)}if(T=Fu(U.startWorldTime,D.calendar?.weather),D.calendar)T={...T,...D.calendar};N=D.antagonists??[],S=D.storyThreads??[],Gu=D.legendaryState??su(),zu=D.retainerRoster??mu(),bu=D.guildState??Ru(),Mu=D.ecologyState??Vu(),Hu=D.dynastyState??Cu(),iu=D.treasureState??Nu(),s=D.navalState??{ships:[],seaRoutes:[],pirates:[],recentShipwrecks:[],portActivity:{},distantLands:[],distantFigures:[]}}else{if(D=Li(F,U.seed,U.startWorldTime),!D.seed)D.seed=U.seed;D.npcs=D.npcs.map((A)=>qA(F,A)),Mh(F,D.npcs,D),T=Fu(U.startWorldTime),T.weather=VA(F,hu(U.startWorldTime.getUTCMonth())),N=gi(F,D),bu=Dh(F,D,U.startWorldTime),Mu=Jh(F,D,U.startWorldTime),Hu=Oh(F,D,U.startWorldTime);for(let A of D.settlements)if(Di(D,A.coord))Vh(A,F);s=Zh(D,F),await Q({category:"system",summary:`The chronicle begins: ${D.archetype}`,details:`${yu(U.startWorldTime)}. The simulation awakens in an era known as the ${D.archetype}.`,worldTime:U.startWorldTime,seed:D.seed??U.seed});for(let A of D.settlements){let h=yi(F,A,U.startWorldTime);await Q({category:"town",summary:`${A.name} stirs to life`,details:h,location:A.name,worldTime:U.startWorldTime,seed:D.seed??U.seed})}for(let A of N){let h=wi(A,D,F,U.startWorldTime);for(let H of h)await Q(H)}await w(D)}Gi=!0}async function Uh(u){if(!Gi)return;await LH(),(async()=>{if(u.worldTime.getUTCHours()%6===0){let R=D.parties.filter((x)=>x.status==="travel").length,I=D.parties.filter((x)=>x.status==="idle").length;await Ch.log({category:"system",summary:`The world turns (${yu(u.worldTime)})`,details:`${R} parties traveling, ${I} resting. ${N.filter((x)=>x.alive).length} threats lurk.`,worldTime:u.worldTime,realTime:new Date,seed:D.seed??U.seed})}for(let R of D.parties)if(R.status==="travel"&&R.travel){let I=QA(F,R.travel.terrain,u.worldTime,R.location,R.name,D.seed);if(I)await Q(I);let x=YA(F,R.travel.terrain,u.worldTime,R.location,R,D,T);if(x){if(x.delayMiles)R.travel.milesRemaining+=x.delayMiles;if(x.fatigueDelta)R.fatigue=(R.fatigue??0)+x.fatigueDelta;if(x.injured)R.wounded=!0,R.restHoursRemaining=Math.max(R.restHoursRemaining??0,24);if(x.death)R.fame=Math.max(0,(R.fame??0)-1);else if(x.category==="road")R.fame=(R.fame??0)+1;await Q(x)}let uu=cA(F,R,R.location,Gu,u.worldTime,D.seed,D,N,S);for(let Pu of uu)await Q(Pu),R.fame=(R.fame??0)+5}let h=WA(D,F,u.worldTime);for(let R of h)await Q(R);let H=RA(D,F,u.worldTime);for(let R of H)await Q(R);let b=PA(D,F,u.worldTime);for(let R of b)await Q(R);if(F.chance(0.05)){let R=F.pick(D.npcs);if(R.depth&&R.alive!==!1){let I=xA(F,R,D,u.worldTime);if(I)await Q(I)}}if(F.chance(0.03)){let R=N.filter((I)=>I.alive);if(R.length){let I=F.pick(R),x=jA(I,D,F,u.worldTime);for(let uu of x)await Q(uu)}}if(F.chance(0.1)){let R=IA(F,S,D,u.worldTime);for(let I of R)await Q(I)}let i=fA(D,F,u.worldTime,N,S);for(let R of i)await Q(R);let G=vA(D,F,u.worldTime,N,S);for(let R of G)await Q(R);let M=aA(D,F,u.worldTime,N,S);for(let R of M)await Q(R);let B=TA(D,F,u.worldTime);for(let R of B)await Q(R);let k=_A(D,F,u.worldTime);for(let R of k)await Q(R);let z=SA(D,F,u.worldTime);for(let R of z)await Q(R);let P=NA(D,F,u.worldTime);for(let R of P)await Q(R);let E=XA(D,F,u.worldTime);for(let R of E)await Q(R);let K=lA(D,F,u.worldTime);for(let R of K)await Q(R);let L=sA(D,F,u.worldTime);for(let R of L)await Q(R);let W=mA(D,F,u.worldTime);for(let R of W)await Q(R);let J=dA(D,F,u.worldTime);for(let R of J)await Q(R);let V=wA(F,zu,D,u.worldTime);for(let R of V)await Q(R);let C=eA(F,bu,D,u.worldTime);for(let R of C)await Q(R);let O=oA(F,Mu,D,N,u.worldTime);for(let R of O)await Q(R);let Y=tA(F,Hu,D,u.worldTime);for(let R of Y)await Q(R);let X=DA(F,iu,D,u.worldTime);for(let R of X)await Q(R);let a=Ai(s,D,F,u.worldTime,T.weather);for(let R of a)await Q(R);D.calendar=T,D.antagonists=N,D.storyThreads=S,D.consequenceQueue=zA(),D.retainerRoster=zu,D.guildState=bu,D.ecologyState=Mu,D.dynastyState=Hu,D.treasureState=iu,D.navalState=s,D.lastTickAt=u.worldTime,D.lastRealTickAt=new Date,await w(D)})()}function jh(u){let H=u.getTime();if(S=S.filter((b)=>{if(!b.resolved)return!0;let i=b.lastUpdated?.getTime()??b.startedAt.getTime();return H-i<2592000000}),N=N.filter((b)=>{if(b.alive)return!0;let i=b.lastSeen?.getTime()??0;return H-i<7776000000}),D.npcs=D.npcs.filter((b)=>{if(b.alive!==!1)return!0;let i=b;if(i.memories?.length>5||(b.fame??0)>10)return!0;let M=i.diedAt?.getTime()??0;return H-M<7776000000}),s.distantLands.length>50)s.distantLands=s.distantLands.sort((b,i)=>(i.mentionCount??0)-(b.mentionCount??0)).slice(0,50);if(s.distantFigures.length>100)s.distantFigures=s.distantFigures.filter((b)=>b.alive).sort((b,i)=>(i.mentionCount??0)-(b.mentionCount??0)).slice(0,100)}function Xh(u){if(!Gi)return;(async()=>{jh(u.worldTime);let{logs:A,newCalendar:h}=UA(D,F,u.worldTime,T);T=h;for(let B of A)await Q(B);let H=Su(D,F,u.worldTime);for(let B of H)await Q(B);for(let B of D.settlements){let k=D.npcs.filter((E)=>E.location===B.name&&E.alive!==!1),z=D.parties.filter((E)=>E.location===B.name),P=ZA(F,B,u.worldTime,{npcs:k,parties:z,tension:B.mood});if(P)await Q({category:"town",summary:P.summary,details:P.details,location:B.name,worldTime:u.worldTime,seed:D.seed??U.seed})}let b=BA(D,F,u.worldTime);for(let B of b)await Q(B);let i=yA(D,F,u.worldTime);for(let B of i)await Q(B);let G=pA(F,D,u.worldTime,Gu);for(let B of G)await Q(B);let M=ii(s,D,F,u.worldTime,T.weather,hu(u.worldTime.getUTCMonth()));for(let B of M)await Q(B);D.calendar=T,D.antagonists=N,D.storyThreads=S,D.consequenceQueue=zA(),D.retainerRoster=zu,D.guildState=bu,D.ecologyState=Mu,D.dynastyState=Hu,D.treasureState=iu,D.navalState=s,D.lastTickAt=u.worldTime,D.lastRealTickAt=new Date,D.legendaryState=Gu,await w(D)})()}function Yh(u){(async()=>{for(let A of D.parties)if(A.status==="idle"){let h=D.dungeons.find((H)=>H.name===A.location);if(h&&h.rooms&&h.rooms.length>0){let H=LA(F,h,[A.name],u.worldTime,D.seed,D,iu);for(let b of H)await Q(b)}}})()}async function WH(u,A){let h={kind:"turn",worldTime:u,turnIndex:A};if(Yh(h),A%U.hourTurns===0)Uh({...h,kind:"hour"});if(A%(U.hourTurns*U.dayHours)===0)Xh({...h,kind:"day"})}async function OH(){if(!U.catchUp){console.log("\u23F0 Catch-up disabled (SIM_CATCH_UP=false)");return}if(!D.lastTickAt){console.log("\u23F0 No lastTickAt in world - starting fresh (no catch-up needed)");return}let u=new Date(D.lastTickAt),A=D.lastRealTickAt?new Date(D.lastRealTickAt):new Date(D.startedAt),h=new Date,b=(h.getTime()-A.getTime())/3600000;if(b>48){console.log(`\u23F0 Large time gap detected (${Math.round(b)}h) - skipping catch-up (likely uploaded world)`);return}let i=new Date(D.startedAt),G=i,M=h.getTime()-G.getTime(),B=new Date(i.getTime()+M),k=U.turnMinutes*60*1000,z=B.getTime()-u.getTime(),P=Math.floor(z/k);if(P<=0){console.log(`\u23F0 World is current (world time: ${u.toISOString()})`),D.lastRealTickAt=h,await w(D);return}let K=Math.min(P,1008),L=U.hourTurns*U.dayHours,W=Math.floor(K/L),J=Math.floor(K%L/U.hourTurns);console.log(`
\u23F0 Catching up ${W}d ${J}h of missed time (${K} turns)...`),console.log(`   Last world time: ${u.toISOString()}`),console.log(`   Target world time: ${B.toISOString()}`);let V=1000/U.catchUpSpeed,C=0;for(let O=0;O<K;O++){let Y=new Date(u.getTime()+(O+1)*k);if(await WH(Y,O+1),C++,C%100===0){let X=Math.floor(C/K*100);process.stdout.write(`\r\u23F0 Catch-up progress: ${X}% (${C}/${K} turns)`)}await new Promise((X)=>setTimeout(X,V))}console.log(`
\u2713 Caught up! World time is now synchronized.`),D.lastTickAt=B,D.lastRealTickAt=h,await w(D)}async function FH(u){let A=U.hourTurns*U.dayHours,h=u*A;console.log(`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550`),console.log(`  BATCH MODE: ${u} days (${h} turns)`),console.log(`  Seed: ${D.seed??U.seed}`),console.log(`  Start: ${U.startWorldTime.toISOString()}`),console.log(`  End: ${new Date(U.startWorldTime.getTime()+u*24*60*60*1000).toISOString()}`),console.log(`\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550
`);let H=0,b=0,i=Q,G=async(z)=>{await i(z),H++},M=Date.now();for(let z=0;z<=h;z++){let P=new Date(U.startWorldTime.getTime()+z*U.turnMinutes*60000),E={kind:"turn",worldTime:P,turnIndex:z};for(let K of D.parties)if(K.status==="idle"){let L=D.dungeons.find((W)=>W.name===K.location);if(L&&L.rooms&&L.rooms.length>0){let W=LA(F,L,[K.name],P,D.seed,D,iu);for(let J of W)await G(J)}}if(z%U.hourTurns===0){for(let Z of D.parties)if(Z.status==="travel"&&Z.travel){let l=QA(F,Z.travel.terrain,P,Z.location,Z.name,D.seed);if(l)await G(l);let v=YA(F,Z.travel.terrain,P,Z.location,Z,D,T);if(v){if(v.delayMiles)Z.travel.milesRemaining+=v.delayMiles;if(v.fatigueDelta)Z.fatigue=(Z.fatigue??0)+v.fatigueDelta;if(v.injured)Z.wounded=!0,Z.restHoursRemaining=Math.max(Z.restHoursRemaining??0,24);if(v.death)Z.fame=Math.max(0,(Z.fame??0)-1);else if(v.category==="road")Z.fame=(Z.fame??0)+1;await G(v)}let Au=cA(F,Z,Z.location,Gu,P,D.seed,D,N,S);for(let Qh of Au)await G(Qh),Z.fame=(Z.fame??0)+5}let K=WA(D,F,P);for(let Z of K)await G(Z);let L=RA(D,F,P);for(let Z of L)await G(Z);let W=PA(D,F,P);for(let Z of W)await G(Z);if(F.chance(0.05)){let Z=F.pick(D.npcs);if(Z.depth&&Z.alive!==!1){let l=xA(F,Z,D,P);if(l)await G(l)}}if(F.chance(0.03)){let Z=N.filter((l)=>l.alive);if(Z.length){let l=F.pick(Z),v=jA(l,D,F,P);for(let Au of v)await G(Au)}}if(F.chance(0.1)){let Z=IA(F,S,D,P);for(let l of Z)await G(l)}let J=fA(D,F,P,N,S);for(let Z of J)await G(Z);let V=vA(D,F,P,N,S);for(let Z of V)await G(Z);let C=aA(D,F,P,N,S);for(let Z of C)await G(Z);let O=TA(D,F,P);for(let Z of O)await G(Z);let Y=_A(D,F,P);for(let Z of Y)await G(Z);let X=SA(D,F,P);for(let Z of X)await G(Z);let a=NA(D,F,P);for(let Z of a)await G(Z);let R=XA(D,F,P);for(let Z of R)await G(Z);let I=lA(D,F,P);for(let Z of I)await G(Z);let x=sA(D,F,P);for(let Z of x)await G(Z);let uu=mA(D,F,P);for(let Z of uu)await G(Z);let Pu=dA(D,F,P);for(let Z of Pu)await G(Z);let Uu=wA(F,zu,D,P);for(let Z of Uu)await G(Z);let wu=eA(F,bu,D,P);for(let Z of wu)await G(Z);let r=oA(F,Mu,D,N,P);for(let Z of r)await G(Z);let Eu=tA(F,Hu,D,P);for(let Z of Eu)await G(Z);let f=DA(F,iu,D,P);for(let Z of f)await G(Z);let y=Ai(s,D,F,P,T.weather);for(let Z of y)await G(Z)}if(z%A===0){let K=z/A;jh(P);let{logs:L,newCalendar:W}=UA(D,F,P,T);T=W;for(let X of L)await G(X);let J=Su(D,F,P);for(let X of J)await G(X);for(let X of D.settlements){let a=D.npcs.filter((x)=>x.location===X.name&&x.alive!==!1),R=D.parties.filter((x)=>x.location===X.name),I=ZA(F,X,P,{npcs:a,parties:R,tension:X.mood});if(I)await G({category:"town",summary:I.summary,details:I.details,location:X.name,worldTime:P,seed:D.seed??U.seed})}let V=BA(D,F,P);for(let X of V)await G(X);let C=yA(D,F,P);for(let X of C)await G(X);let O=pA(F,D,P,Gu);for(let X of O)await G(X);let Y=ii(s,D,F,P,T.weather,hu(P.getUTCMonth()));for(let X of Y)await G(X);if(K>b+30){let X=((Date.now()-M)/1000).toFixed(1);console.log(`  Day ${K}/${u}: ${H} events (${X}s elapsed)`),b=K}}}let B=((Date.now()-M)/1000).toFixed(1);console.log(`
\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550`),console.log(`  BATCH COMPLETE in ${B}s`),console.log("\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),console.log(`  Total events: ${H}`),console.log(`  Final parties: ${D.parties.length}`),console.log(`  Living NPCs: ${D.npcs.filter((z)=>z.alive!==!1).length}`),console.log(`  Active antagonists: ${N.filter((z)=>z.alive).length}`),console.log(`  Resolved stories: ${S.filter((z)=>z.resolved).length}`),console.log(`  Active stories: ${S.filter((z)=>!z.resolved).length}`),console.log(`
Output: ${U.logDir}/events.log
`);let k=new Date(U.startWorldTime.getTime()+u*24*60*60*1000);D.lastTickAt=k,D.storyThreads=S,D.antagonists=N,await w(D),process.exit(0)}async function RH(){if(await JH(),pu.subscribe("turn",Yh),pu.subscribe("hour",Uh),pu.subscribe("day",Xh),U.batchDays!==null&&U.batchDays>0){await FH(U.batchDays);return}await OH();let u=Su(D,F,U.startWorldTime);for(let G of u)await Q(G);await w(D);let A=U.msPerWorldMinute*U.turnMinutes,h=(G)=>`\u2551  ${G.padEnd(62)}\u2551`,H=S.filter((G)=>!G.resolved).length,b=`Settlements: ${D.settlements.length}   Parties: ${D.parties.length}   Antagonists: ${N.length}`;process.stdout.write(`
\u2554${"\u2550".repeat(64)}\u2557
`+h("BECMI Real-Time Simulator")+`
`+h(yu(U.startWorldTime))+`
`+`\u2560${"\u2550".repeat(64)}\u2563
`+h(`Seed: ${D.seed??U.seed}`)+`
`+h(`Time Scale: ${U.timeScale}x (turn every ${A}ms)`)+`
`+h(b)+`
`+h(`Active Stories: ${H}`)+`
`+`\u255A${"\u2550".repeat(64)}\u255D

`),new ru(pu,U,D).start()}RH();
